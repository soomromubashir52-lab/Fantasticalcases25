;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="2760e8f6-9ba8-8de0-458f-486e197b0849")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,91442,e=>{"use strict";var t=e.i(541793),r=e.i(852819);let n=(0,t.atom)(null),i=(0,t.atom)(e=>{let t=e(n);return t?.isVisible?t.path:null}),o=(0,t.atom)(null,(e,t,r,i)=>{switch(i.type){case"focus":return void t(n,{hasFocus:!0,isVisible:!0,position:i.position,path:r});case"update":return void t(n,{hasFocus:i.hasFocus,isVisible:!0,position:i.position,path:r});case"blur":return void t(n,e=>({hasFocus:!1,isVisible:!!e?.isVisible,position:e?.position??{line:1,column:1,offset:0},path:r}));case"unmount":return void t(n,null);case"hidden":return void t(n,e=>({hasFocus:!1,isVisible:!1,position:e?.position??{line:1,column:1,offset:0},path:r}));case"unhidden":return void t(n,e=>({hasFocus:!!e?.hasFocus,isVisible:!0,position:e?.position??{line:1,column:1,offset:0},path:r}))}});function l(){return(0,r.useSet)(o)}function s(){return(0,r.useValue)(i)}function a(){return(0,r.useGet)(n)}function u(){return(0,r.useObservableValue)(n)}e.s(["cursorStateAtom",0,n,"useCursorFilepath",()=>s,"useGetCursorState",()=>a,"useObservableCursorState",()=>u,"useUpdateCursorState",()=>l])},513905,584647,e=>{"use strict";var t=e.i(389959),r=e.i(541793);function n(){let[e]=(0,t.useState)(()=>(0,r.createStore)());return e}e.s(["useInitStore",()=>n],513905);var i=e.i(814563),o=e.i(299798),l=e.i(927158),s=e.i(852819);let a=(0,r.atom)([]);function u(){let e=(0,s.useSet)(a);(0,o.usePid2)(async(t,{signal:r})=>{let{resReadable:n}=t.jsNotebook.takeoverRequestsStatus.subscribe({},{signal:r});for await(let t of n)t.ok&&e(t.payload.requests);return()=>{e([])}},[e])}function c({sessionId:e=null}={}){let r=(0,s.useValue)((0,t.useMemo)(()=>(0,i.selectAtom)(a,t=>{let r=e?t.filter(t=>t.sessionId===e):t,n=r.find(e=>"pending"===e.status)??null;return r.find(e=>"accepted"===e.status)??null??n??null}),[e])),n=(0,l.usePid2Callback)(e=>async()=>{r&&"pending"===r.status&&e.jsNotebook.acceptTakeover.subscribe({sessionId:r.sessionId})},[r]),o=(0,l.usePid2Callback)(e=>async t=>{if(r&&"accepted"===r.status&&!(await e.jsNotebook.completeTakeover.rpc({sessionId:r.sessionId,userNotes:t})).ok)throw Error("Failed to complete takeover")},[r]),u=(0,l.usePid2Callback)(e=>async()=>{r&&await e.jsNotebook.rejectTakeover.rpc({sessionId:r.sessionId})},[r]);return(0,t.useMemo)(()=>r&&n&&o&&u?{request:r,accept:n,complete:o,reject:u}:null,[r,n,o,u])}e.s(["useCurrentAgentTestingTakeover",()=>c,"useTrackAgentTestingTakeoverRequests",()=>u],584647)},375310,803542,698626,e=>{"use strict";var t=e.i(541793),r=e.i(852819);let n=(0,t.atom)(null);function i(){return(0,r.useValue)(n)}function o(){return(0,r.useSet)(n)}e.s(["usePendingDeleteFile",()=>i,"useSetPendingDeleteFile",()=>o],375310);var l=e.i(131141),s=e.i(125674);let a=(0,t.atom)(new Map),u=(0,t.atom)(null,(e,t,r)=>{t(a,e=>(0,l.produce)(e,e=>{r.indicatorType?e.set(r.paneType,r.indicatorType):e.delete(r.paneType)}))});function c(){return(0,r.useSet)(u)}function d({paneType:e}){return(0,r.useValue)(function({paneType:e}){return(0,s.default)(()=>(0,t.atom)(t=>e?t(a).get(e):void 0),[e])}({paneType:e}))}e.s(["usePaneIndicator",()=>d,"useSetPaneIndicator",()=>c],803542);var f=e.i(973245);let p=f.gql`
    query WorkspaceSessionPresence($userIds: [Int!]!) {
  usersByIds(ids: $userIds) {
    id
    image
  }
}
    `;e.s(["WorkspaceSessionPresenceDocument",0,p],698626)},520839,e=>{"use strict";let t=Object.values(e.i(880176).default.multiplayer);function r(e){let r={};return t.forEach(e=>{r[e]=0}),e.forEach(e=>{r[e.color]++}),Object.keys(r).sort((e,t)=>r[e]-r[t])[0]}function n(e){for(let t of e.sessions.sort((e,t)=>e.timestamp-t.timestamp))if(t.activeFile)return t.activeFile;return null}function i(e,t){let r=t.find(t=>t.sessions.some(t=>t.id===e));if(!r)throw Error(`Expected user with session ID ${e}`);return r}function o(e){let{seconds:t,nanos:r}=e;return Number(t||0)+(r||0)/1e9}e.s(["convertTimestampToNumber",()=>o,"getActiveFileForUser",()=>n,"getLeastUsedColor",()=>r,"getUserForSession",()=>i])},545082,663762,e=>{"use strict";var t=e.i(276385),r=e.i(513905),n=e.i(852819);e.i(584647),e.i(91442),e.i(375310),e.i(803542);var i=e.i(389959),o=e.i(992785),l=e.i(131141),s=e.i(541793),a=e.i(814563),u=e.i(223808),c=e.i(698626),d=e.i(47503),f=e.i(125674),p=e.i(173738),h=e.i(520839);let m=(0,s.atom)(new Map),g=(0,s.atom)(null,(e,t,r)=>t(m,e=>(0,l.produce)(e,e=>{e.set(r.userId,r.color)})));function y(){let e=(0,n.useGet)(x),t=(0,n.useSet)(g);return(0,i.useCallback)(r=>{let n=e(),i=n.get(r.userId)?.color;return i||t({color:i=(0,h.getLeastUsedColor)(Object.values(n)),userId:r.userId}),i},[e,t])}function w(e,t,r,n){let i=n||{timestamp:Math.floor(Date.now()/1e3),activeFile:null},o=e.get(t.id);o?o.sessions.set(t.session,i):e.set(t.id,{id:t.id,username:t.name,color:r??(0,h.getLeastUsedColor)([...e.values()]),roles:t.roles,sessions:new Map([[t.session,i]])})}let x=(0,s.atom)(new Map);(0,a.selectAtom)(x,function(e){let t=new Map;for(let[,r]of e){let e=null;for(let[,t]of r.sessions)t.activeFile&&(e&&e.timestamp>t.timestamp||(e=t));if(!e?.activeFile)continue;let n=t.get(e.activeFile),i={id:r.id,username:r.username,image:r.image,color:r.color,roles:r.roles};n?n.push(i):t.set(e.activeFile,[i])}return t},o.default);let v=(0,a.selectAtom)(x,e=>[...e.values()].map(e=>({id:e.id,username:e.username,color:e.color,image:e.image,roles:e.roles})),o.default);function T(){return(0,n.useValue)(v)}function S(e){let{id:t,name:r,session:n,roles:i}=e;return t&&r&&n&&i?{id:t,name:r,session:n,roles:i}:null}function A({seconds:e,nanos:t}){return"number"!=typeof e||"number"!=typeof t?null:(0,h.convertTimestampToNumber)({seconds:e,nanos:t})}let b=(0,s.atom)(null,(e,t,r,n)=>{t(x,t=>(0,l.produce)(t,t=>{if(r.roster?.user){for(let i of r.roster.user){let o=S(i);if(null===o||o?.id===n)continue;let l=function(e,t){if(!e.files)return null;let r=e.files.find(e=>e.userId===t.id&&e.session===t.session);if(!r)return null;let n=r.timestamp?A(r.timestamp):null;return n?{activeFile:r.file||null,timestamp:n}:null}(r.roster,o),s=e(m).get(o.id);w(t,o,s,l)}return}if(r.join){let i=S(r.join);if(!i||i.id===n)return;let o=e(m).get(i.id);w(t,i,o);return}if(r.part){var i;let e,{id:n,session:o}=r.part;if(!n||!o)return;i={id:n,session:o},(e=t.get(i.id))&&(1===e.sessions.size?t.delete(i.id):e.sessions.delete(i.session));return}if(r.fileOpened){let{session:e,userId:n,file:i}=r.fileOpened,o=r.fileOpened.timestamp?A(r.fileOpened.timestamp):null;if(!o||!e||!n||!i)return;!function(e,t){let r=e.get(t.userId);if(!r)return;let n=r.sessions.get(t.session);n?(n.timestamp=t.timestamp,n.activeFile=t.file):r.sessions.set(t.session,{timestamp:t.timestamp,activeFile:t.file})}(t,{timestamp:o,session:e,userId:n,file:i});return}if(r.sessionTimestampUpdated){let{session:e}=r.sessionTimestampUpdated,n=r.sessionTimestampUpdated.timestamp?A(r.sessionTimestampUpdated.timestamp):null;if(!n||!e)return;!function(e,{session:t,timestamp:r}){for(let[,n]of e){let e=n.sessions.get(t);if(e){e.timestamp=r;break}}}(t,{timestamp:n,session:e});return}}))}),D=(0,s.atom)(null,async(e,t)=>{let r=[];for(let[t,n]of e(x))n.image||r.push(t);if(!r.length)return;let n=await p.apolloClient?.query({query:c.WorkspaceSessionPresenceDocument,variables:{userIds:r}}),i=n?.data.usersByIds;i&&t(x,e=>(0,l.produce)(e,e=>{for(let t of i){let r=e.get(t.id);r&&(r.image=t.image)}}))});function F(){let e=(0,d.useCurrentUserId)(),t=(0,n.useSet)(D),r=(0,n.useSet)(b),o=(0,n.useObservableValue)(x);return(0,i.useEffect)(()=>{t();let e=(0,u.default)(t,2e3);return o.subscribe(()=>e())},[t,o]),(0,f.default)(()=>t=>{e&&r(t,e)},[r,e])}function P(e){let i=(0,r.useInitStore)();return(0,t.jsx)(n.SessionContext.Provider,{value:i,children:e.children})}e.s(["useActiveUsers",()=>T,"useGetColorForUser",()=>y,"useUpdatePresence",()=>F],663762),e.i(423111),e.s(["SessionProvider",()=>P],545082)},487824,e=>{"use strict";var t=e.i(193060);e.i(240913);var r=e.i(968069);function n(e){return".breakpoints"===e.toString()||".cache"===e.toString()||(0,t.isDescendantOf)((0,t.toRelativeFsPath)(".cache"),e)||".local"===e.toString()||(0,t.isDescendantOf)((0,t.toRelativeFsPath)(".local"),e)}function i(e){return r.configFiles.includes(e.toString())}function o(e,r){if(!r)return!1;let n=(0,t.splitFsPaths)(e).slice(1);for(let e of r)for(let t of n)if(t.toString().match(e))return!0;return!1}e.s(["isConfigFile",()=>i,"isPathBreakpointsOrNixCache",()=>n,"isPathHiddenByDotReplit",()=>o])},406393,e=>{"use strict";var t=e.i(389959),r=e.i(960933),n=e.i(862927);e.i(312917);var i=e.i(619319),o=e.i(641326),l=e.i(207237),s=e.i(125674),a=e.i(282453);let u=r.Type.Array(r.Type.String()),c={get(e){let t=a.default.get("repl:hiddenFiles:"+e);return n.Value.Check(u,t)?t:null},set(e,t){a.default.set("repl:hiddenFiles:"+e,t)}},d=e=>{let r=(0,l.default)(),[n,i]=(0,t.useState)(()=>c.get(r));return(0,t.useEffect)(()=>e.watch(e=>{function t(e){c.set(r,e),i(e)}if(e.error){e.error===o.DotReplitErrors.NotFound&&t([]);return}t(e.config.hidden?e.config.hidden:[])}),[e,r]),n};e.s(["useHiddenFiles",0,e=>{let t=d(e);return(0,s.default)(()=>null===t?null:t.map(e=>(0,i.globToRegExp)(e)||e),[t])},"useHiddenFilesGlobPatterns",0,d])},1736,e=>{"use strict";var t=e.i(389959);e.i(694906);var r=e.i(55449),n=e.i(487824),i=e.i(406393),o=e.i(529810);e.i(545082);var l=e.i(423111);e.s(["useShouldHideFileInWorkspace",0,(e=!1)=>{let{dotReplit:s}=(0,o.default)(),a=(0,i.useHiddenFiles)(s),u=(0,l.useAreHiddenFilesVisible)();return(0,t.useCallback)(t=>!!(0,n.isPathBreakpointsOrNixCache)(t)||!!e&&!u&&((0,n.isConfigFile)(t)||(0,r.isHiddenFile)(t)||(0,r.isDotFile)(t)||(0,n.isPathHiddenByDotReplit)(t,a)),[u,a,e])}])},803640,e=>{"use strict";var t=e.i(276385),r=e.i(116235);function n(e){return(0,t.jsx)(r.default,{...e,children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M20.593 10.91a1.25 1.25 0 0 1 0 2.18l-14.48 8.145a1.25 1.25 0 0 1-1.863-1.09V3.855a1.25 1.25 0 0 1 1.863-1.09l14.48 8.146Z",clipRule:"evenodd"})})}e.s(["default",()=>n])},759130,214007,e=>{"use strict";class t extends Error{line;column;codeblock;constructor(e,t){const[r,n]=function(e,t){let r=e.slice(0,t).split(/\r\n|\n|\r/g);return[r.length,r.pop().length+1]}(t.toml,t.ptr),i=function(e,t,r){let n=e.split(/\r\n|\n|\r/g),i="",o=(0|Math.log10(t+1))+1;for(let e=t-1;e<=t+1;e++){let l=n[e-1];l&&(i+=e.toString().padEnd(o," "),i+=":  ",i+=l,i+="\n",e===t&&(i+=" ".repeat(o+r+2),i+="^\n"))}return i}(t.toml,r,n);super(`Invalid TOML document: ${e}

${i}`,t),this.line=r,this.column=n,this.codeblock=i}}function r(e,t=0,n=e.length){let i=e.indexOf("\n",t);return"\r"===e[i-1]&&i--,i<=n?i:-1}function n(e,r){for(let n=r;n<e.length;n++){let i=e[n];if("\n"===i)return n;if("\r"===i&&"\n"===e[n+1])return n+1;if(i<" "&&"	"!==i||""===i)throw new t("control characters are not allowed in comments",{toml:e,ptr:r})}return e.length}function i(e,t,r,o){let l;for(;" "===(l=e[t])||"	"===l||!r&&("\n"===l||"\r"===l&&"\n"===e[t+1]);)t++;return o||"#"!==l?t:i(e,n(e,t),r)}function o(e,n,i,l,s=!1){if(!l)return(n=r(e,n))<0?e.length:n;for(let t=n;t<e.length;t++){let n=e[t];if("#"===n)t=r(e,t);else if(n===i)return t+1;else if(n===l)return t;else if(s&&("\n"===n||"\r"===n&&"\n"===e[t+1]))return t}throw new t("cannot find end of structure",{toml:e,ptr:n})}function l(e,t){let r=e[t],n=r===e[t+1]&&e[t+1]===e[t+2]?e.slice(t,t+3):r;t+=n.length-1;do t=e.indexOf(n,++t);while(t>-1&&"'"!==r&&"\\"===e[t-1]&&"\\"!==e[t-2])return t>-1&&(t+=n.length,n.length>1&&(e[t]===r&&t++,e[t]===r&&t++)),t}let s=/^(\d{4}-\d{2}-\d{2})?[T ]?(?:(\d{2}):\d{2}:\d{2}(?:\.\d+)?)?(Z|[-+]\d{2}:\d{2})?$/i;class a extends Date{#e=!1;#t=!1;#r=null;constructor(e){let t=!0,r=!0,n="Z";if("string"==typeof e){let i=e.match(s);i?(i[1]||(t=!1,e=`0000-01-01T${e}`),r=!!i[2],i[2]&&+i[2]>23?e="":(n=i[3]||null,e=e.toUpperCase(),!n&&r&&(e+="Z"))):e=""}super(e),isNaN(this.getTime())||(this.#e=t,this.#t=r,this.#r=n)}isDateTime(){return this.#e&&this.#t}isLocal(){return!this.#e||!this.#t||!this.#r}isDate(){return this.#e&&!this.#t}isTime(){return this.#t&&!this.#e}isValid(){return this.#e||this.#t}toISOString(){let e=super.toISOString();if(this.isDate())return e.slice(0,10);if(this.isTime())return e.slice(11,23);if(null===this.#r)return e.slice(0,-1);if("Z"===this.#r)return e;let t=60*this.#r.slice(1,3)+ +this.#r.slice(4,6);return t="-"===this.#r[0]?t:-t,new Date(this.getTime()-6e4*t).toISOString().slice(0,-1)+this.#r}static wrapAsOffsetDateTime(e,t="Z"){let r=new a(e);return r.#r=t,r}static wrapAsLocalDateTime(e){let t=new a(e);return t.#r=null,t}static wrapAsLocalDate(e){let t=new a(e);return t.#t=!1,t.#r=null,t}static wrapAsLocalTime(e){let t=new a(e);return t.#e=!1,t.#r=null,t}}let u=/^((0x[0-9a-fA-F](_?[0-9a-fA-F])*)|(([+-]|0[ob])?\d(_?\d)*))$/,c=/^[+-]?\d(_?\d)*(\.\d(_?\d)*)?([eE][+-]?\d(_?\d)*)?$/,d=/^[+-]?0[0-9_]/,f=/^[0-9a-f]{4,8}$/i,p={b:"\b",t:"	",n:"\n",f:"\f",r:"\r",'"':'"',"\\":"\\"};function h(e,r=0,n=e.length){let o,l="'"===e[r],s=e[r++]===e[r]&&e[r]===e[r+1];s&&(n-=2,"\r"===e[r+=2]&&r++,"\n"===e[r]&&r++);let a=0,u="",c=r;for(;r<n-1;){let n=e[r++];if("\n"===n||"\r"===n&&"\n"===e[r]){if(!s)throw new t("newlines are not allowed in strings",{toml:e,ptr:r-1})}else if(n<" "&&"	"!==n||""===n)throw new t("control characters are not allowed in strings",{toml:e,ptr:r-1});if(o){if(o=!1,"u"===n||"U"===n){let i=e.slice(r,r+="u"===n?4:8);if(!f.test(i))throw new t("invalid unicode escape",{toml:e,ptr:a});try{u+=String.fromCodePoint(parseInt(i,16))}catch{throw new t("invalid unicode escape",{toml:e,ptr:a})}}else if(s&&("\n"===n||" "===n||"	"===n||"\r"===n)){if(r=i(e,r-1,!0),"\n"!==e[r]&&"\r"!==e[r])throw new t("invalid escape: only line-ending whitespace may be escaped",{toml:e,ptr:a});r=i(e,r)}else if(n in p)u+=p[n];else throw new t("unrecognized escape sequence",{toml:e,ptr:a});c=r}else l||"\\"!==n||(a=r-1,o=!0,u+=e.slice(c,a))}return u+e.slice(c,n-1)}let m=/^[a-zA-Z0-9-_]+[ \t]*$/;function g(e,n,o="="){let s=n-1,a=[],u=e.indexOf(o,n);if(u<0)throw new t("incomplete key-value: cannot find end of key",{toml:e,ptr:n});do{let i=e[n=++s];if(" "!==i&&"	"!==i)if('"'===i||"'"===i){if(i===e[n+1]&&i===e[n+2])throw new t("multiline strings are not allowed in keys",{toml:e,ptr:n});let c=l(e,n);if(c<0)throw new t("unfinished string encountered",{toml:e,ptr:n});s=e.indexOf(".",c);let d=e.slice(c,s<0||s>u?u:s),f=r(d);if(f>-1)throw new t("newlines are not allowed in keys",{toml:e,ptr:n+s+f});if(d.trimStart())throw new t("found extra tokens after the string part",{toml:e,ptr:c});if(u<c&&(u=e.indexOf(o,c))<0)throw new t("incomplete key-value: cannot find end of key",{toml:e,ptr:n});a.push(h(e,n,c))}else{s=e.indexOf(".",n);let r=e.slice(n,s<0||s>u?u:s);if(!m.test(r))throw new t("only letter, numbers, dashes and underscores are allowed in keys",{toml:e,ptr:n});a.push(r.trimEnd())}}while(s+1&&s<u)return[a,i(e,u+1,!0,!0)]}function y(e,t,r,n){let i,o,l=t,s=r,a=!1;for(let t=0;t<e.length;t++){if(t){if(l=a?l[i]:l[i]={},s=(o=s[i]).c,0===n&&(1===o.t||2===o.t))return null;if(2===o.t){let e=l.length-1;l=l[e],s=s[e].c}}if((a=Object.hasOwn(l,i=e[t]))&&s[i]?.t===0&&s[i]?.d)return null;a||("__proto__"===i&&(Object.defineProperty(l,i,{enumerable:!0,configurable:!0,writable:!0}),Object.defineProperty(s,i,{enumerable:!0,configurable:!0,writable:!0})),s[i]={t:t<e.length-1&&2===n?3:n,d:!1,i:0,c:{}})}if((o=s[i]).t!==n&&(1!==n||3!==o.t)||(2===n&&(o.d||(o.d=!0,l[i]=[]),l[i].push(l={}),o.c[o.i++]=o={t:1,d:!1,i:0,c:{}}),o.d))return null;if(o.d=!0,1===n)l=a?l[i]:l[i]={};else if(0===n&&a)return null;return[i,l,o.c]}function w(e,s){let f=s?.maxDepth??1e3,p={},m={},w=p,x=m;for(let s=i(e,0);s<e.length;){if("["===e[s]){let r="["===e[++s],n=g(e,s+=+r,"]");if(r){if("]"!==e[n[1]-1])throw new t("expected end of table declaration",{toml:e,ptr:n[1]-1});n[1]++}let i=y(n[0],p,m,r?2:1);if(!i)throw new t("trying to redefine an already defined table or value",{toml:e,ptr:s});x=i[2],w=i[1],s=n[1]}else{let p=g(e,s),m=y(p[0],w,x,0);if(!m)throw new t("trying to redefine an already defined table or value",{toml:e,ptr:s});let v=function e(s,f,p,m){let y;if(0===m)throw new t("document contains excessively nested structures. aborting.",{toml:s,ptr:f});let w=s[f];if("["===w||"{"===w){let[i,l]="["===w?function(r,i,o){let l,s=[];for(i++;"]"!==(l=r[i++])&&l;)if(","===l)throw new t("expected value, found comma",{toml:r,ptr:i-1});else if("#"===l)i=n(r,i);else if(" "!==l&&"	"!==l&&"\n"!==l&&"\r"!==l){let t=e(r,i-1,"]",o-1);s.push(t[0]),i=t[1]}if(!l)throw new t("unfinished array encountered",{toml:r,ptr:i});return[s,i]}(s,f,m):function(r,n,i){let o,l={},s=new Set,a=0;for(n++;"}"!==(o=r[n++])&&o;)if("\n"===o)throw new t("newlines are not allowed in inline tables",{toml:r,ptr:n-1});else if("#"===o)throw new t("inline tables cannot contain comments",{toml:r,ptr:n-1});else if(","===o)throw new t("expected key-value, found comma",{toml:r,ptr:n-1});else if(" "!==o&&"	"!==o){let o,u=l,c=!1,[d,f]=g(r,n-1);for(let e=0;e<d.length;e++){if(e&&(u=c?u[o]:u[o]={}),(c=Object.hasOwn(u,o=d[e]))&&("object"!=typeof u[o]||s.has(u[o])))throw new t("trying to redefine an already defined value",{toml:r,ptr:n});c||"__proto__"!==o||Object.defineProperty(u,o,{enumerable:!0,configurable:!0,writable:!0})}if(c)throw new t("trying to redefine an already defined value",{toml:r,ptr:n});let[p,h]=e(r,f,"}",i-1);s.add(p),u[o]=p,a=","===r[(n=h)-1]?n-1:0}if(a)throw new t("trailing commas are not allowed in inline tables",{toml:r,ptr:a});if(!o)throw new t("unfinished table encountered",{toml:r,ptr:n});return[l,n]}(s,f,m),a=o(s,l,",",p);if("}"===p){let e=r(s,l,a);if(e>-1)throw new t("newlines are not allowed in inline tables",{toml:s,ptr:e})}return[i,a]}if('"'===w||"'"===w){y=l(s,f);let e=h(s,f,y);if(p){if(y=i(s,y,"]"!==p),s[y]&&","!==s[y]&&s[y]!==p&&"\n"!==s[y]&&"\r"!==s[y])throw new t("unexpected character encountered",{toml:s,ptr:y});y+=+(","===s[y])}return[e,y]}y=o(s,f,",",p);let x=function(e,r,i,o){let l=e.slice(r,i),s=l.indexOf("#");s>-1&&(n(e,s),l=l.slice(0,s));let a=l.trimEnd();if(!o){let n=l.indexOf("\n",a.length);if(n>-1)throw new t("newlines are not allowed in inline tables",{toml:e,ptr:r+n})}return[a,s]}(s,f,y-(","===s[y-1]),"]"===p);if(!x[0])throw new t("incomplete key-value declaration: no value specified",{toml:s,ptr:f});return p&&x[1]>-1&&(y=i(s,f+x[1]),y+=+(","===s[y])),[function(e,r,n){let i;if("true"===e)return!0;if("false"===e)return!1;if("-inf"===e)return-1/0;if("inf"===e||"+inf"===e)return 1/0;if("nan"===e||"+nan"===e||"-nan"===e)return NaN;if("-0"===e)return 0;if((i=u.test(e))||c.test(e)){if(d.test(e))throw new t("leading zeroes are not allowed",{toml:r,ptr:n});let o=+e.replace(/_/g,"");if(isNaN(o))throw new t("invalid number",{toml:r,ptr:n});if(i&&!Number.isSafeInteger(o))throw new t("integer value cannot be represented losslessly",{toml:r,ptr:n});return o}let o=new a(e);if(!o.isValid())throw new t("invalid value",{toml:r,ptr:n});return o}(x[0],s,f),y]}(e,p[1],void 0,f);m[1][m[0]]=v[0],s=v[1]}if(s=i(e,s,!0),e[s]&&"\n"!==e[s]&&"\r"!==e[s])throw new t("each key-value declaration must be followed by an end-of-line",{toml:e,ptr:s});s=i(e,s)}return p}e.s(["parse",()=>w],214007),e.s([],759130)},641365,e=>{"use strict";let t;var r=e.i(389959);function n(e){(0,r.useEffect)(()=>{e((t||((t=new Image).src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="),t),{captureDraggingState:!0})},[e])}e.s(["useDisableNativeDragPreview",()=>n],641365)},498596,e=>{"use strict";var t=e.i(389959),r=e.i(606389),n=e.i(687382);function i(e){let i=(0,n.useDragDropManager)().getMonitor(),[o,l]=(0,r.useCollector)(i,e);return(0,t.useEffect)(()=>i.subscribeToOffsetChange(l)),(0,t.useEffect)(()=>i.subscribeToStateChange(l)),o}e.s(["useDragLayer",()=>i])},831787,e=>{"use strict";var t=e.i(276385),r=e.i(116235);function n(e){return(0,t.jsx)(r.default,{...e,children:(0,t.jsx)("path",{d:"M3 4.25a.75.75 0 0 1 .75.75v5A1.25 1.25 0 0 0 5 11.25h3a.75.75 0 0 1 0 1.5H5c-.44 0-.866-.107-1.25-.304V17A1.25 1.25 0 0 0 5 18.25h3a.75.75 0 0 1 0 1.5H5A2.75 2.75 0 0 1 2.25 17V5A.75.75 0 0 1 3 4.25ZM21 18.25a.75.75 0 0 1 0 1.5h-8a.75.75 0 0 1 0-1.5h8ZM21 11.25a.75.75 0 0 1 0 1.5h-8a.75.75 0 0 1 0-1.5h8ZM21 4.25a.75.75 0 0 1 0 1.5H8a.75.75 0 0 1 0-1.5h13Z"})})}e.s(["default",()=>n])},717639,e=>{"use strict";function t(e){return Math.log(e)*Math.LOG10E+1|0}function r(e,t,r){return Math.floor(Math.min(t,Math.max(e,r)))}e.s(["clampToRange",()=>r,"getDigits",()=>t])},411928,e=>{"use strict";var t=e.i(276385),r=e.i(389959),n=e.i(162914),i=e.i(125674),o=e.i(828224),l=e.i(205104),s=e.i(445864),a=e.i(668967),u=e.i(703774);async function c(t,r){try{let{exportToSvg:n}=await e.A(532703),{elements:i,files:o}=JSON.parse(t),l=await n({elements:i,appState:{exportWithDarkMode:r,exportBackground:!1},files:o});return window.btoa(window.unescape(window.encodeURIComponent(l.outerHTML)))}catch(e){return null}}var d=e.i(916271);let f=(0,r.memo)(d.default);function p({source:e,sourcePos:d,fs:p,path:h,onCodeInsert:m}){let g=function(e,n){let{isDarkColorScheme:i}=(0,u.useTheme)(),o=(0,s.default)({fs:e,onContentProcess:async(e,t)=>(0,l.isDrawFile)(t)?await c(e.toString(),i):Promise.resolve(e.toString("base64"))});return(0,r.useCallback)(e=>(0,t.jsx)(a.ContainerImageRenderer,{...e,previewFilePath:n,getCachedImage:o}),[o,n])}(p,h),y=(0,n.default)(e,100),w=(0,i.default)(()=>({img:g,a:e=>(0,t.jsx)(o.default,{filePath:h,...e})}),[g,h]);return(0,t.jsx)(f,{onCodeInsert:m,components:w,sourcePos:d,children:y})}e.s(["default",()=>p],411928)},722441,27304,274445,624525,820170,e=>{"use strict";var t=e.i(389959),r=e.i(541793),n=e.i(205104),i=e.i(903381),o=e.i(131141),l=e.i(814563);e.i(694906);var s=e.i(515672),a=e.i(240913),u=e.i(703631),c=e.i(487824),d=e.i(799581);let f="No files",p="Loading...";function h(e,t=0){let r=[],i=0;for(let o of[...e.values()].sort((e,t)=>e.index-t.index)){let e={height:o.height,y:o.y,cols:[]};if(r.push(e),0===o.depth)continue;let l=o.depth+t;l>i&&(i=l);let s="divider"===o.row.type||"error"===o.row.type||"create"===o.row.type||"emptyDir"===o.row.type?o.row.dir:(0,n.getParentPath)(o.row.path),a=s.split("/");for(let t=0;t<(0,n.getPathDepth)(s);t++){let r=a.slice(0,Number(t+1)).join("/");e.cols.push(r)}}let o=new Map;for(let e=t;e<i;e++){let n=[];for(let i of(o.set(e,n),r)){let r=i.cols[e],o=i.y;if(r){let l=n[n.length-1];l&&l.y+l.height===o?l.height+=i.height:n.push({y:o,height:i.height,dir:r,depth:e-t})}}}let l=[];for(let[e,t]of o)l.push(...t);return l}function m(e,{fromIndex:t,dir:r}){if("next"===r){for(let r=t+1;r<e.length;r++){let t=e[r];if(t&&("dir"===t.type||"file"===t.type))return t}return null}for(let r=t-1;r>=0;r--){let t=e[r];if(t&&("dir"===t.type||"file"===t.type))return t}return null}function g(e,t,r){if(r){let r=s.configFiles.includes(t.filename),n=s.configFiles.includes(e.filename);if(r&&!n)return -1;if(!r&&n)return 1;let i=s.packagerFiles.includes(t.filename),o=s.packagerFiles.includes(e.filename);if(i&&!o)return -1;if(!i&&o)return 1}return t.type===i.FileType.Directory&&e.type!==i.FileType.Directory?1:e.type===i.FileType.Directory&&t.type!==i.FileType.Directory?-1:(0,n.compareFilePaths)(e.filename,t.filename)}function y({row:e,baseDepth:t}){return"dir"===e.type||"file"===e.type||"uploadFile"===e.type?e.path===a.ROOT_PATH?0:(0,n.getPathDepth)(e.path)-1-t:e.dir===a.ROOT_PATH?0:(0,n.getPathDepth)(e.dir)-t}function w({rows:e,baseDepth:t}){let r=[],i=new Map;for(let r of e){let{depth:e,text:o}=function({row:e,baseDepth:t}){let r=y({row:e,baseDepth:t});switch(e.type){case"file":case"dir":case"uploadFile":return{text:(0,n.getFileName)(e.path),depth:r};case"error":return{text:e.message,depth:r};case"divider":return{text:e.label,depth:r};case"create":case"emptyDir":return{text:f,depth:r}}}({row:r,baseDepth:t}),l=i.get(e);if(!l){i.set(e,new Map([[r.type,o]]));continue}let s=l.get(r.type);s&&s?.length>o.length||l.set(r.type,o)}for(let[e,t]of i)for(let[n,i]of t)r.push({depth:e,type:n,text:i});return r}e.s(["LOADING",0,p,"NO_FILES",0,f],27304);let x=(e,t)=>e===a.ROOT_PATH?t:e+"/"+t,v=(e,t)=>e===a.ROOT_PATH&&1===(0,n.getPathDepth)(t)||(0,u.childOf)(e,t);function T({root:e=a.ROOT_PATH,dirInfo:t,filter:r,sort:o,getSection:l,readOnly:s,pendingUploads:u,pendingMoves:f,pathBeingRenamed:p,alwaysShowCreateRow:h}){let m=[],g=u?.length?function(e){let t=new Map;for(let r of e){let e=(0,n.getParentPath)(r.targetPath)||a.ROOT_PATH,i=t.get(e),o={filename:(0,n.getFileName)(r.targetPath),progress:r.progress};i?i.push(o):t.set(e,[o])}return t}(u):null,y=new Map,w=new Map;if(f?.length)for(let{from:e,to:t}of f)y.set(e.path,e.type),w.set(t,e.type);return!function u(f){let T=t.get(f);if(!T||y.has(f)||!T.expanded)return;if(f===e&&T.loading&&!T.children)return void m.push({type:"dir",path:f});if(T.error)return void m.push({type:"error",message:T.error.message,dir:f});let S=T.children?[...T.children]:void 0;for(let[e,t]of((S=S?.filter(e=>!(0,c.isPathBreakpointsOrNixCache)(e.filename)))&&y.size>0&&(S=S.filter(e=>!y.has(x(f,e.filename)))),w)){if(!v(f,e))continue;let r=(0,n.getFileName)(e);S?.some(e=>e.filename===r)||(S||(S=[]),S.push({filename:r,type:t}))}let A=g?.get(f);if(A)for(let{filename:e,progress:t}of(S||(S=[]),A))S.push({filename:e,type:i.FileType.File,progress:t});if(!S)return;if(!T.create&&!A&&S&&0===S.length)return void m.push({type:s?"emptyDir":"create",dir:f});let b=function(e,{getSection:t}){let r=[],n=new Map;for(let o of e){let e=t(o),l=o.progress?{type:"upload",progress:o.progress,filename:o.filename}:{type:o.type===i.FileType.File?"file":"dir",filename:o.filename};if(!e){r.push(l);continue}let s=n.get(e);if(s){s.push(l);continue}n.set(e,[l])}for(let[e,t]of n)r.push({type:"divider",label:e}),(0,d.pushInChunks)(r,t);return r}(S.filter(r).sort((t,r)=>o(t,r,f===e)),{getSection:f===a.ROOT_PATH?l:()=>null}),D=-1;for(let e of b){if("error"===e.type||"emptyDir"===e.type)throw Error("Expected dir, file, or divider row");if("divider"===e.type){-1===D&&(D=m.length),m.push({type:"divider",dir:f,label:e.label});continue}let r=x(f,e.filename);if("dir"===e.type){let e={type:"dir",path:r};p===r&&(e.rename=!0),w.has(r)&&(e.pending=!0);let n=g?.get(r);if(n&&(e.uploadProgress=n.map(e=>e.progress)),m.push(e),!t.get(r))continue;u(r)}else if("upload"===e.type)m.push({type:"uploadFile",path:r,progress:e.progress});else if(!A||!A.some(t=>t.filename===e.filename)){let e={type:"file",path:r};p===r&&(e.rename=!0),w.has(r)&&(e.pending=!0),m.push(e)}}if(!T.create&&!h)return;let F={type:"create",dir:f,fileType:T.create?T.create:void 0};-1===D?m.push(F):m.splice(D,0,F)}(e),m}function S(e,t){let r=e.get(t);if(!r)return null;let n=0,i=r.height,o="dir"===r.row.type?r.depth+1:r.depth;if("dir"===r.row.type)o=r.depth+1,n=r.y;else{o=r.depth;for(let o=t-1;o>=0;o--){let t=e.get(o);if(!t)break;if("dir"===t.row.type&&("file"===r.row.type||"uploadFile"===r.row.type?v(t.row.path,r.row.path):t.row.path===r.row.dir)){i+=t.height,n=t.y;break}t.depth>=r.depth&&(i+=t.height)}}for(let n=t+1;n<e.size;n++){let t=e.get(n);if(!t||t.depth<=("dir"===r.row.type?r.depth:r.depth-1))break;i+=t.height}return{y:n,height:i,depth:o}}function A(e,{node:t,rows:r,mode:n,anchor:o}){if(!n){e.clear(),e.set(t.path,t.type);return}if("multi"===n&&e.has(t.path))return void e.delete(t.path);if("multi"===n)return void e.set(t.path,t.type);let l=t.type===i.FileType.Directory?"dir":"file",s=r.findIndex(e=>e.type===l&&e.path===t.path);if(-1===s)return;let a=o?.type===i.FileType.Directory?"dir":"file",u=o?r.findIndex(e=>e.type===a&&e.path===o.path):-1;if(-1===u)return;let c=u<s?r.slice(u,s+1):r.slice(s,u+1);for(let t of r)("file"===t.type||"dir"===t.type)&&(c.includes(t)?e.set(t.path,"file"===t.type?i.FileType.File:i.FileType.Directory):e.delete(t.path))}function b(e,t=a.ROOT_PATH){let r=new Set;for(let[n,i]of e)n!==t&&i.expanded&&(t===a.ROOT_PATH||(0,u.descendantOf)(t,n))&&r.add(n);return 0===r.size?null:r}e.s(["dirInfoToRows",()=>T,"findAdjacentNode",()=>m,"getDropPreview",()=>S,"getExpandedDirs",()=>b,"getGutters",()=>h,"getLongestRows",()=>w,"getRowDepth",()=>y,"sortChildren",()=>g,"toggleSelectNode",()=>A],274445);let D=(0,r.atom)(new Map),F=(0,r.atom)({width:0,height:0}),P=(0,r.atom)(0),R=(0,r.atom)(null),C=(0,r.atom)(new Map),k=(0,r.atom)(e=>e(L).root??a.ROOT_PATH),O=(0,r.atom)(null),I=(0,r.atom)(void 0),j=(0,r.atom)(null),E=(0,r.atom)(null,(e,t,r)=>{e(_)||t(j,r)}),V=(0,r.atom)(e=>{let{root:t=a.ROOT_PATH}=e(L);return t===a.ROOT_PATH?0:(0,n.getPathDepth)(t)}),N=(0,r.atom)(e=>h(e(C),e(V))),z=(0,r.atom)(!1),M=(0,r.atom)(null,(e,t,r)=>{let n=new Map,i=e(er),o=e(V);for(let e of r.rows){let t=e.key.toString(),r=i[e.index];if(!r)continue;let l=Math.max(0,y({row:r,baseDepth:o}));n.set(e.index,{y:e.start+8,height:e.size,index:e.index,key:t,depth:l,row:r})}t(C,n),t(P,r.scrollHeight+16)}),L=(0,r.atom)({}),H=(0,l.selectAtom)(L,e=>e.onContextMenu??null),_=(0,r.atom)(e=>!!e(L).readOnly||!e(z)),G=(0,r.atom)(e=>e(L).fontSize??14),U=(e,t)=>{if("divider"===t)switch(e){case 10:return 28;case 12:case 13:case 14:return 38;case 18:return 44;default:return 48}switch(e){case 10:return 18;case 12:case 13:return 24;case 14:return 32;case 18:return 38;default:return 40}},W=(0,r.atom)(e=>U(e(G),"file")),B=(0,r.atom)(e=>(e=>{switch(e){case 10:case 12:return 12;case 13:case 14:return 16;case 18:return 20;default:return 24}})(e(G))),$=(0,r.atom)(e=>14>e(G)?4:8),K=(0,r.atom)(e=>14>=e(G)?4:8),Y=(0,r.atom)(e=>13===e(G)?6:16>e(G)?4:8),q=(0,r.atom)(e=>(e=>{switch(e){case 10:return 12;case 12:case 13:return 16;case 14:return 24;case 18:return 32;default:return 40}})(e(G))),Z=(0,r.atom)(e=>(e=>{switch(e){case 10:return 10;case 12:case 13:case 14:return 12;case 18:return 14;default:return 18}})(e(G))),X=(0,r.atom)(e=>(e=>{switch(e){case 10:case 12:case 13:return 10;case 14:case 18:return 16;default:return 20}})(e(G))),J=(0,r.atom)(new Map);function Q({filename:e}){return s.configFiles.includes(e)?"Config files":s.packagerFiles.includes(e)?"Packager files":null}let ee=(0,r.atom)([]),et=(0,r.atom)([]),er=(0,r.atom)(e=>{let{filter:t,alwaysShowCreateRow:r,root:n=a.ROOT_PATH,sort:i=g,readOnly:o=!1}=e(L),l=e(J),s=e(ee);return T({root:n,dirInfo:l,filter:t,sort:i,readOnly:o,getSection:Q,pendingUploads:s,pathBeingRenamed:e(j)??void 0,pendingMoves:e(et)??void 0,alwaysShowCreateRow:r})}),en=(0,r.atom)(e=>{let t=e(R);if(!t)return null;let r=e(er).findIndex(e=>("file"===e.type||"dir"===e.type)&&e.path===t);return -1!==r?r:null}),ei=(0,r.atom)(null,(e,t,r)=>{let n=e(en),i=e(R);if(document.activeElement?.tagName==="INPUT"||null===n||null===i)return;let o=e(er);switch(r.key){case"ArrowDown":{r.preventDefault();let e=m(o,{dir:"next",fromIndex:n});(e?.type==="dir"||e?.type==="file")&&t(R,e.path);return}case"ArrowUp":{r.preventDefault();let e=m(o,{dir:"previous",fromIndex:n});(e?.type==="dir"||e?.type==="file")&&t(R,e.path);return}case"ArrowLeft":case"ArrowRight":{r.preventDefault();let n=e(J).get(i);if(!n)return;"ArrowLeft"===r.key&&n.expanded?t(es,i):"ArrowRight"!==r.key||n.expanded||t(eu,i);return}case"Enter":case" ":if("Enter"===r.key&&!e(_))return;if(e(J).has(i))return void t(ec,i);e(L).onFileSelect({event:r,path:i,type:"keydown"});return}}),eo=(0,r.atom)(null,(e,t,r)=>{r.path===(e(L).root??a.ROOT_PATH)&&t(z,!0),t(J,e=>(0,o.produce)(e,e=>{let t=r.path===a.ROOT_PATH?null:r.path+"/";for(let n of r.children){let r=t?t+n.filename:n.filename,o=e.get(r);if(n.type!==i.FileType.Directory){o&&(o.disposeWatcher?.(),e.delete(r));continue}o||e.set(r,{expanded:!1})}let n=e.get(r.path);n&&(n.children=r.children,n.loading=!1,n.error=void 0)}))}),el=(0,r.atom)(null,(e,t,r)=>{r.path===(e(L).root??a.ROOT_PATH)&&t(z,!0),t(J,e=>(0,o.produce)(e,e=>{let t=e.get(r.path);t&&(t.loading=!1,t.error=r.error,t.disposeWatcher?.(),t.disposeWatcher=null)}))}),es=(0,r.atom)(null,(e,t,r)=>{let n=Array.isArray(r)?r:[r];t(J,e=>(0,o.produce)(e,e=>{for(let t of n){let r=e.get(t);r&&(r.expanded=!1,r.loading=!1,r.disposeWatcher&&(r.disposeWatcher(),r.disposeWatcher=null))}}))}),ea=(0,r.atom)(null,(e,t,r)=>{t(J,e=>(0,o.produce)(e,e=>{let t=e.get(r);t&&(t.disposeWatcher?.(),e.delete(r))}))}),eu=(0,r.atom)(null,(e,t,r)=>{let n=Array.isArray(r)?r:[r],{fs:i}=e(L);t(J,e=>(0,o.produce)(e,e=>{for(let r of n){let n=e.get(r)??{expanded:!0};e.has(r)?n.expanded=!0:e.set(r,n),n.disposeWatcher?n.disposeWatcher():n.loading=!0,n.disposeWatcher=i.watchDir(r,{onError:e=>t(el,{path:r,error:e}),onChange:e=>t(eo,{path:r,children:e}),onMoveOrDelete:()=>t(ea,r)})}}))}),ec=(0,r.atom)(null,(e,t,r)=>{let n=e(J).get(r);if(!n){t(J,e=>(0,o.produce)(e,e=>{e.set(r,{expanded:!1})})),t(eu,r);return}n.expanded?t(es,r):t(eu,r)}),ed=(0,r.atom)(e=>e(L).manageWidth?e(z)?w({rows:e(er),baseDepth:e(V)}):[{type:"dir",text:p,depth:1}]:null),ef=(0,r.atom)(null,(e,t,r)=>{let{onCreateStart:n}=e(L);n?n({parentPath:r.parentPath,fileType:r.fileType}):(t(eu,r.parentPath),t(J,e=>(0,o.produce)(e,e=>{let t=e.get(r.parentPath);t&&(t.create=r.fileType)})),t(R,null))}),ep=(0,r.atom)(null,(e,t,r)=>{t(J,e=>(0,o.produce)(e,e=>{let t=e.get(r);t&&(t.create=void 0)}))}),eh=(0,r.atom)(null,(e,t,r)=>{let n={path:r.path,type:r.fileType};t(R,n.path),t(ex,{node:n}),t(J,e=>(0,o.produce)(e,e=>{let t=e.get(r.parentPath);t&&(t.create=void 0)})),n.type===i.FileType.Directory&&t(eu,n.path)}),em=(0,r.atom)(new Map),eg=(0,r.atom)(null),ey=(0,r.atom)(e=>e(eg)?.path??null),ew=(0,r.atom)(!0),ex=(0,r.atom)(null,(e,t,{node:r,mode:n})=>{let i=e(er),l=e(eg);t(ew,!n),t(em,e=>(0,o.produce)(e,e=>{A(e,{node:r,rows:i,mode:n,anchor:l})}));let s=e(em);if(!(s.size>1))for(let[e,r]of s)t(eg,{path:e,type:r})}),ev=(0,r.atom)(null,(e,t)=>{t(em,new Map),t(ew,!0),t(eg,null)}),eT=(0,r.atom)(null,async(e,t,r)=>{let{fs:n}=e(L),i=await Promise.all(r.map(async e=>{let t=await n.readDir(e);return t.error?t:{path:e,children:t.children,error:null}})),l=i.filter(e=>null!==e.error);return l.length?{errors:l}:(t(J,e=>(0,o.produce)(e,e=>{for(let t of i){if(t.error)throw Error("Unexpected error");let r=e.get(t.path);if(!r){e.set(t.path,{loading:!1,expanded:!0,children:t.children,error:void 0});continue}r.loading=!1,r.expanded=!0,r.children=t.children,r.error=void 0}})),{errors:null})}),eS=(0,r.atom)(null,async(e,t,r)=>{let n,i=e(J),o=[];for(let e of((n=r.path.split("/")).pop(),[a.ROOT_PATH,...n.map((e,t)=>n.slice(0,t+1).join("/"))])){let t=i.get(e);t?.expanded||o.push(e)}o.length&&await t(eT,o),t(ex,{node:r})}),eA=(0,r.atom)(null),eb=(0,r.atom)(null,(e,t,r)=>{let n=e(eA);if(!n)return;let i=e(er);for(let e=0;e<i.length;e++){let t=i[e];if(("file"===t.type||"dir"===t.type)&&t.path===r&&!(e>n.options.count-1)){n.scrollToIndex(e);break}}});e.s(["avatarSizeAtom",0,q,"borderRadiusAtom",0,K,"cancelCreateFileAtom",0,ep,"clearNodeSelectionAtom",0,ev,"collapseAtom",0,es,"completeCreateFileAtom",0,eh,"configAtom",0,L,"containerSizeAtom",0,F,"didLoadRootAtom",0,z,"dirInfoAtom",0,J,"expandAtom",0,eu,"fileStatusAtom",0,O,"filteredRowsAtom",0,er,"focusedIndexAtom",0,en,"focusedPathAtom",0,R,"fontSizeAtom",0,G,"fontSizeSmallAtom",0,Z,"getRowHeight",0,U,"gutterWidthAtom",0,X,"guttersAtom",0,N,"horizontalPaddingAtom",0,$,"iconTextGapAtom",0,Y,"iconsSizeAtom",0,B,"initialOffsetAtom",0,I,"lastSelectWasSingleAtom",0,ew,"loadAndSelectNodeAtom",0,eS,"minHeightAtom",0,W,"onContextMenuAtom",0,H,"onKeyDownAtom",0,ei,"pathToBeRenamedAtom",0,j,"pendingMovesAtom",0,et,"pendingUploadsAtom",0,ee,"presenceStateAtom",0,D,"readOnlyAtom",0,_,"renameAtom",0,E,"renderedRowsAtom",0,C,"rootPathAtom",0,k,"scrollHeightAtom",0,P,"scrollToPathAtom",0,eb,"selectNodeAtom",0,ex,"selectedNodeAnchorAtom",0,eg,"selectedNodesAtom",0,em,"selectedPathAnchorAtom",0,ey,"setRenderedRowAtom",0,M,"startCreateFileAtom",0,ef,"toggleExpandedAtom",0,ec,"virtualizerAtom",0,eA,"widestRowsAtom",0,ed],624525);var eD=e.i(276385),eF=e.i(161322),eP=e.i(719518),eR=e.i(824359);let eC=(0,t.createContext)(null);function ek(e){return(0,eD.jsx)(eC.Provider,{value:e.store,children:e.children})}function eO(){let e=(0,t.useContext)(eC);if(!e)throw Error("Expected store in context");return e}function eI(e){return(0,eF.useAtomValue)(e,{store:eO()})}function ej(e){return(0,eR.useObservableAtom)(e,eO())}function eE(e){return(0,eP.useAtomCallback)((0,t.useCallback)(t=>t(e),[e]),{store:eO()})}e.s(["StoreProvider",()=>ek,"useGet",()=>eE,"useObservableValue",()=>ej,"useSet",0,e=>(0,eF.useSetAtom)(e,{store:eO()}),"useValue",()=>eI],820170);let eV=(0,r.atom)(null),eN=(0,r.atom)(null,(e,t,r)=>{let i=[r];if(!e(ew))for(let[t,n]of e(em))r.path!==t&&i.push({path:t,type:n});t(eV,(0,n.coalesceFsNodes)(i))});async function ez(e,t){return{error:(await Promise.all(t.map(t=>t.type===i.FileType.Directory?e.deleteDir(t.path):e.deleteFile(t.path)))).filter(e=>e.error).length?"Something went wrong deleting files":null}}function eM(){let e=ej(eV),r=eE(L);(0,t.useEffect)(()=>e.subscribe(e=>{if(!e)return;let{readOnly:t,onDeleteNodes:n,fs:i}=r();!t&&n&&n({nodes:e,confirm:()=>ez(i,e)})}),[r,e])}e.s(["requestDeleteNodesAtom",0,eN,"useConfirmDeleteNodes",()=>eM],722441)},460365,(e,t,r)=>{var n=1/0,i=0/0,o=/^\s+|\s+$/g,l=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,a=/^0o[0-7]+$/i,u=parseInt,c=Object.prototype.toString,d=Math.max,f=Math.min;function p(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function h(e){return e?(e=m(e))===n||e===-n?(e<0?-1:1)*17976931348623157e292:e==e?e:0:0===e?e:0}function m(e){if("number"==typeof e)return e;if("symbol"==typeof(t=e)||t&&"object"==typeof t&&"[object Symbol]"==c.call(t))return i;if(p(e)){var t,r="function"==typeof e.valueOf?e.valueOf():e;e=p(r)?r+"":r}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(o,"");var n=s.test(e);return n||a.test(e)?u(e.slice(2),n?2:8):l.test(e)?i:+e}t.exports=function(e,t,r){var n,i,o;return t=h(t),void 0===r?(r=t,t=0):r=h(r),(n=e=m(e))>=f(i=t,o=r)&&n<d(i,o)}},540697,e=>{e.v({icon:"Autocomplete-module__0pd8DG__icon",itemActive:"Autocomplete-module__0pd8DG__itemActive",itemInactive:"Autocomplete-module__0pd8DG__itemInactive",text:"Autocomplete-module__0pd8DG__text"})},369685,874311,666729,10261,525544,453955,916866,189739,518093,942527,788123,e=>{"use strict";var t=e.i(276385),r=e.i(389959),n=e.i(822243),i=e.i(498596),o=e.i(848415),l=e.i(288148),s=e.i(971131),a=e.i(960933),u=e.i(862927),c=e.i(131141),d=e.i(541793),f=e.i(316699),p=e.i(302905),h=e.i(205104),m=e.i(240913),g=e.i(903381),y=e.i(641365),w=e.i(222342),x=e.i(736451),v=e.i(460365),T=e.i(717639),S=e.i(869226),A=e.i(399978),b=e.i(274445),D=e.i(143003),F=e.i(790486),P=e.i(992785),R=e.i(814563),C=e.i(995683),k=e.i(703631),O=e.i(125674),I=e.i(670413);e.i(694906);var j=e.i(55449);function E({siblingNames:e,fileName:t,initialValue:r,parentPath:n}){if(t.includes("/"))return"File names cannot include forward slashes";if("."===t||".."===t)return`File names cannot be "${t}"`;if(t.match(/^\s/)||t.match(/\s$/))return"File names cannot start or end with whitespace";if(r!==t&&e.includes(t))return"A file or folder with that name already exists";if(t.length>100)return"File names cannot be longer than 100 characters";let i=n===m.ROOT_PATH?t:n+"/"+t;return(0,j.isHiddenFile)(i)?`"${i}" is reserved`:null}function V({fileName:e,parentPath:t}){let r=t===m.ROOT_PATH?"":t+"/",n=r+e,i=n.split("/");return{pathPrefix:r,newFilePath:n,segments:i}}async function N({fileName:e,parentPath:t,fs:r}){if(e.startsWith("/"))return"File names cannot include forward slashes";let{pathPrefix:n,newFilePath:i,segments:o}=V({fileName:e,parentPath:t});for(let[e,t]of Object.entries(o)){let l=Number(e),s=[];l===o.length-1&&(await r.stat(i)).exists&&s.push((0,h.getFileName)(i));let a=E({fileName:t,siblingNames:s,parentPath:n+o.slice(0,l).join("/")});if(a)return a}return null}function z({fileName:e,parentPath:t}){let{pathPrefix:r,segments:n}=V({fileName:e,parentPath:t});for(let[e,t]of Object.entries(n)){let i=Number(e),o=E({fileName:t,siblingNames:[],parentPath:r+n.slice(0,i).join("/")});if(o)return o}return null}e.s(["validateFileName",()=>E],874311);var M=e.i(624525),L=e.i(820170),H=e.i(123850),_=e.i(613355);let{cssVars:G,styleTokens:U}=(0,H.createCssVarTokens)(["scrollHeight","fontSize","fontSizeSmall","iconSize","horizontalPadding","borderRadius","gutterWidth","minHeight","iconTextGap","rowWidth","rowHeight","rowLeftIndent","rowY","dropPreviewDepth","dropPreviewHeight","dropPreviewY","dropPreviewOpacity","strokeDashoffset","statusColor","statusBackgroundColor","dirStatusIconSize","nodeBackgroundColor","dragPreviewX","dragPreviewY","contextMenuButtonDisplay","hasUnsavedChangesDisplay"]),W={paddingLeft:U.horizontalPadding,paddingRight:U.horizontalPadding},B={"&& svg":{minWidth:U.iconSize+" !important",minHeight:U.iconSize+" !important",width:U.iconSize+" !important",height:U.iconSize+" !important"}},$=[_.rcss.truncate,{fontSize:U.fontSize}];function K(e,t){return e.shiftKey?"bulk":"altKey"===t&&e.altKey||"cmdOrCtrlKey"===t&&(0,I.getCmdOrCtrl)(e)?"multi":void 0}function Y(e){let t=(0,L.useGet)(M.configAtom),r=(0,L.useSet)(M.selectNodeAtom),n=(0,L.useSet)(M.focusedPathAtom);return(0,O.default)(()=>({onClick(i){let{onFileSelect:o,multiselectModifierKey:l}=t(),s=l?K(i,l):void 0;r({node:{path:e,type:g.FileType.File},mode:s}),n(e),s||o?.({path:e,event:i,type:"click"})},onDoubleClick(r){let{onFileDoubleClick:n}=t();n?.(r,e)}}),[e,t,n,r])}e.s(["cssVars",0,G,"iconSize",0,B,"rowPadding",0,W,"styleTokens",0,U,"textCss",0,$],666729);let q=(0,d.atom)(null,(e,t,{event:r,path:n})=>{t(M.focusedPathAtom,n);let{multiselectModifierKey:i}=e(M.configAtom);t(M.selectNodeAtom,{node:{path:n,type:g.FileType.Directory},mode:i?K(r,i):void 0}),t(M.focusedPathAtom,n),r.shiftKey||r.altKey||(0,I.getCmdOrCtrl)(r)||t(M.toggleExpandedAtom,n)});function Z(e){let t=(0,L.useSet)(q);return(0,O.default)(()=>r=>{t({event:r,path:e})},[t,e])}function X(){return(0,L.useValue)(M.widestRowsAtom)}function J(){return(0,L.useValue)(M.guttersAtom)}function Q(){return(0,L.useValue)(M.renderedRowsAtom)}function ee(e){return(0,L.useValue)((0,O.default)(()=>(0,d.atom)(t=>t(M.renderedRowsAtom).get(e)?.row??null),[e]))}function et(){return{fontSize:(0,L.useObservableValue)(M.fontSizeAtom),fontSizeSmall:(0,L.useObservableValue)(M.fontSizeSmallAtom),iconSize:(0,L.useObservableValue)(M.iconsSizeAtom),scrollHeight:(0,L.useObservableValue)(M.scrollHeightAtom),horizontalPadding:(0,L.useObservableValue)(M.horizontalPaddingAtom),borderRadius:(0,L.useObservableValue)(M.borderRadiusAtom),gutterWidth:(0,L.useObservableValue)(M.gutterWidthAtom),minHeight:(0,L.useObservableValue)(M.minHeightAtom),iconTextGap:(0,L.useObservableValue)(M.iconTextGapAtom)}}function er(e){return(0,L.useValue)((0,O.default)(()=>(0,R.selectAtom)(M.dirInfoAtom,t=>!!t.get(e)?.loading),[e]))}function en(e){return(0,L.useValue)((0,O.default)(()=>(0,R.selectAtom)(M.dirInfoAtom,t=>!!t.get(e)?.expanded),[e]))}function ei(e){let t=(0,O.default)(()=>(0,R.selectAtom)(M.focusedPathAtom,t=>t===e?0:-1),[e]);return(0,L.useValue)(t)}function eo(){return(0,L.useSet)(M.collapseAtom)}function el(){return(0,L.useSet)(M.expandAtom)}function es(){return(0,L.useSet)(M.onKeyDownAtom)}function ea(){let e,t,n=(0,r.useRef)(null),i=(0,L.useValue)(M.filteredRowsAtom),o=(e=(0,L.useGet)(M.filteredRowsAtom),t=(0,L.useGet)(M.fontSizeAtom),(0,O.default)(()=>r=>{let n=e()[r];return n?(0,M.getRowHeight)(t(),n.type):0},[e,t])),l=(0,L.useGet)(M.configAtom),s=(0,L.useObservableValue)(M.focusedIndexAtom),a=(0,r.useRef)((0,L.useValue)(M.initialOffsetAtom)),u=(0,F.useVirtualizer)({count:i.length,overscan:l().overscan??100,getScrollElement:()=>n.current,getItemKey(e){let t=i[e];return t?"error"===t.type?"error:"+t.dir+t.message:"divider"===t.type?"divider:"+t.dir+t.label:"emptyDir"===t.type?"emptyDir:"+t.dir:"create"===t.type?"create:"+t.dir:t.type+":"+t.path:""},estimateSize:o,rangeExtractor(e){let t=(0,D.defaultRangeExtractor)(e);return null===s.current||t.includes(s.current)||void 0===i[s.current]?t:[...t,s.current]}});(0,r.useEffect)(()=>{a.current&&u.scrollToOffset(a.current)},[u,a]);let c=(0,L.useSet)(M.setRenderedRowAtom),d=u.getVirtualItems(),f=u.getTotalSize();(0,r.useEffect)(()=>{c({rows:d,scrollHeight:f})},[c,d,f]);let p=(0,L.useValue)(M.didLoadRootAtom);(0,r.useEffect)(function(){if(!p)return;let e=e=>{null!==e&&u.getVirtualItems()[e]&&u.scrollToIndex(e,{align:"auto",behavior:"auto"})};return setTimeout(()=>e(s.current)),s.subscribe(e)},[u,s,p]);let h=(0,L.useSet)(M.virtualizerAtom);return(0,r.useEffect)(()=>{h(u)},[h,u]),{scrollRef:n,virtualizer:u}}function eu(e){let t=(0,O.default)(()=>(0,R.selectAtom)(M.renderedRowsAtom,t=>{let r=t.get(e);return r?{style:{[G.rowHeight]:r.height+"px",[G.rowY]:r.y+"px",[G.rowLeftIndent]:`calc(${r.depth} * ${U.gutterWidth})`},depth:r.depth}:void 0},P.default),[e]);return(0,L.useValue)(t)}function ec({index:e,path:t}){let n=(0,r.useRef)(null),i=(0,L.useObservableValue)(M.focusedPathAtom);return(0,r.useEffect)(()=>{function r(e){n.current?.setAttribute("tabIndex",e.toString())}function o(n){n?r(n===t?0:-1):r(0===e?0:-1)}return o(i.current),i.subscribe(o)},[i,t,e]),(0,r.useEffect)(()=>{let e=null;function r(r){null!==e&&clearTimeout(e),r!==t||document.activeElement!==n.current&&(e=setTimeout(()=>{n.current?.focus()},50))}r(i.current);let o=i.subscribe(r);return()=>{null!==e&&clearTimeout(e),o()}},[i,t]),[n,(0,L.useSet)(M.focusedPathAtom)]}function ed(e){let t=(0,L.useSet)(M.startCreateFileAtom),n=(0,L.useSet)(M.cancelCreateFileAtom),i=(0,L.useSet)(M.completeCreateFileAtom),[o,l]=(0,r.useState)(""),s=(0,L.useGet)(M.configAtom),[a,u]=(0,r.useState)(!1),[c,d]=(0,r.useState)(null),f=(0,O.default)(()=>(0,R.selectAtom)(M.dirInfoAtom,t=>t.get(e)),[e]),p=(0,O.default)(()=>(0,R.selectAtom)(f,e=>e?.create??null),[f]),h=(0,O.default)(()=>(0,R.selectAtom)(f,e=>e?.children??null),[f]),y=(0,L.useValue)(h),w=(0,L.useValue)(p),x=async t=>{if(!w)return;let{readOnly:r,fs:n}=s();if(r)return;let o=null;if(o=0===t.length?"File names cannot be empty":t.includes("/")?await N({fileName:t,parentPath:e,fs:n}):E({fileName:t,siblingNames:y?.map(e=>e.filename)??[],parentPath:e}))return void d(o);let a=e===m.ROOT_PATH?null:e+"/",c=a?a+t:t;(c.includes("//")&&(c=c.split("/").filter(e=>e.length>0).join("/")),u(!0),(w===g.FileType.Directory?await n.createDir(c):await n.writeFile(c,new C.default(""))).error)?d("Something went wrong"):(u(!1),l(""),i({parentPath:e,path:c,fileType:w}),s().onCreate?.({path:c,type:w}))},v=c;return!v&&o.includes("/")?v=z({fileName:o,parentPath:e}):v||(v=E({fileName:o,siblingNames:y?.map(e=>e.filename)??[],parentPath:e})),{value:o,setValue:l,fileType:w,create:x,creating:a,error:v,clearError:()=>d(null),cancel:(0,O.default)(()=>()=>n(e),[e,n]),start:(0,O.default)(()=>r=>t({parentPath:e,fileType:r}),[e,t]),siblings:y}}function ef(e){let t=(0,O.default)(()=>(0,d.atom)(t=>{let r=[];for(let[n,i]of t(M.presenceStateAtom)){if(!(0,k.descendantOf)(e,n))return;r.push(...i)}return r.length?r:null}),[e]);return(0,L.useValue)(t)}function ep(e){let t=(0,O.default)(()=>(0,d.atom)(t=>t(M.presenceStateAtom).get(e)??null),[e]);return(0,L.useValue)(t)}function eh(){return(0,L.useSet)(M.renameAtom)}function em(e){let t=(0,O.default)(()=>(0,R.selectAtom)(M.selectedNodesAtom,t=>t.has(e)),[e]);return(0,L.useObservableValue)(t)}function eg(e,t){if(t===e.path)return!1;let r=t+"/"+(0,h.getFileName)(e.path);return!(r===e.path||(0,k.descendantOf)(e.path,t)||(0,k.descendantOf)(r,e.path))}e.s(["useCollapse",()=>eo,"useContentContainer",()=>et,"useCreateFile",()=>ed,"useDirPresence",()=>ef,"useExpand",()=>el,"useFilePresence",()=>ep,"useGutters",()=>J,"useIsExpanded",()=>en,"useIsLoading",()=>er,"useIsSelected",()=>em,"useItemNode",()=>ee,"useLayoutRow",()=>eu,"useOnDirOnClick",()=>Z,"useOnFileClick",()=>Y,"useOnFocus",()=>ec,"useOnKeyDown",()=>es,"useRename",()=>eh,"useRenderedRows",()=>Q,"useTabIndex",()=>ei,"useVirtualizeRows",()=>ea,"useWidestRows",()=>X],10261);let ey=(0,d.atom)(null,async(e,t,r)=>{var n,i,o,l,s;let a,u=e(M.dirInfoAtom).get(r.to),c=u?.children;if(!c){let{fs:t}=e(M.configAtom),n=await t.readDir(r.to);if(n.error)return;c=n.children}if(!c)throw Error("Expected children");let d=(n=r.nodes,i=r.to,o=c,n.reduce((e,t)=>{let r=(0,h.getFileName)(t.path),n=(0,h.getParentPath)(t.path),l=o?.find(e=>e.filename===r);return l&&(""===n?m.ROOT_PATH:n)!==i&&e.push({type:l.type,path:i===m.ROOT_PATH?l.filename:i+"/"+l.filename}),e},[])),f=(l=r.nodes,s=r.to,(a=(0,h.coalesceFsNodes)(l)).every(e=>eg(e,s))?a.map(e=>{let t=(0,h.getFileName)(e.path);return{from:e,to:s===m.ROOT_PATH?t:s+"/"+t}}):null);if(!f)return;let{readOnly:p,fs:y}=e(M.configAtom);if(p)return;if(d.length){if(d.some(e=>f.some(({from:t})=>(0,k.descendantOf)(e.path,t.path))))return;if(!r.overwrite){let{onConflicts:t}=e(M.configAtom);t?.({type:"move",nodes:r.nodes,to:r.to,conflicts:d});return}if((await Promise.all(d.map(async e=>{let t=await (e.type===g.FileType.Directory?y.deleteDir(e.path):y.deleteFile(e.path));return t.error?{error:t.error,node:e}:null}))).filter(Boolean).length)return}t(M.pendingMovesAtom,f);let w=await Promise.all(f.map(async({from:e,to:t})=>{let r=await (e.type===g.FileType.Directory?y.moveDir(e.path,t):y.moveFile(e.path,t));return r.error?{error:r.error,from:e,to:t}:null}));t(M.pendingMovesAtom,[]),w.filter(Boolean).length||t(M.selectedNodesAtom,new Map(f.map(e=>[e.to,e.from.type])))});e.s(["canMove",()=>eg,"moveFilesAtom",0,ey],525544);var ew=e.i(664152);let ex=(0,d.atom)(null,async(e,t,r)=>{let{readOnly:n,fs:i}=e(M.configAtom);if(n)return;let o=r.parentPath||m.ROOT_PATH,l=e(M.dirInfoAtom).get(o),s=l?.children;if(r.files.length>A.MAX_NUM_FILES_UPLOAD_LIMIT)return void r.onError("Trying to upload too many files at once. Please try again with fewer files.");if(r.files.reduce((e,t)=>t.size+e,0)>A.MAX_FILE_UPLOAD_SIZE_LIMIT_BYTES)return void r.onError("Total file upload size exceeds maximum limit. Please try again with smaller files.");if(!s){let e=await i.readDir(o);if(e.error)return;s=e.children}if(!s)throw Error("Expected children");let a=[...new Set(r.files.map(e=>e.dirPath?e.dirPath.split("/")[0]:e.name))],u=s.filter(e=>a.some(t=>t===e.filename)),d=u.length?u.map(e=>({path:o===m.ROOT_PATH?e.filename:o+"/"+e.filename,type:e.type})):null;if(d&&!r.overwrite){let{onConflicts:t}=e(M.configAtom);t?.({type:"upload",files:r.files,to:o,conflicts:u.map(e=>({path:o===m.ROOT_PATH?e.filename:o+"/"+e.filename,type:e.type}))});return}d&&(await Promise.all(d.map(async e=>{let t=await (e.type===g.FileType.Directory?i.deleteDir(e.path):i.deleteFile(e.path));return t.error?{error:t.error,node:e}:null}))).filter(Boolean).length||(0,A.uploadFiles)({parentPath:r.parentPath,files:r.files,fs:i,onStart:e=>{t(M.pendingUploadsAtom,t=>(0,c.produce)(t,t=>{for(let r of e)t.push(r)}))},onUpload:e=>{t(M.pendingUploadsAtom,t=>(0,c.produce)(t,t=>{let r=t.findIndex(t=>t.targetPath===e.path);-1!==r&&t.splice(r,1)}))},onError:e=>{e.error===A.UploadErrors.FileRead&&r.onError("Error reading file. Try uploading again."),t(M.pendingUploadsAtom,t=>(0,c.produce)(t,t=>{let r=t.findIndex(t=>t.targetPath===e.path);-1!==r&&t.splice(r,1)}))},onDone:({errors:e,parentPath:t})=>{if(!e.length)return void ew.logger.info("Successfully uploaded files",{uploadSource:"filetree",parentPath:t})}})});e.s(["uploadFilesAtom",0,ex],453955);var ev=e.i(480028),eT=e.i(446530),eS=e.i(630818),eA=e.i(625484);let eb=(0,d.atom)(0),eD=(0,d.atom)(null),eF=(0,d.atom)(e=>{let t=e(eD);if(null===t)return null;let r=e(M.renderedRowsAtom),n=-1!==t?r.get(t):null;return n&&n.depth>0||n?.row.type==="dir"?(0,b.getDropPreview)(r,t):{y:e(eb),depth:1,height:e(M.containerSizeAtom).height-8}}),eP=`(${U.dropPreviewDepth} - 1) * ${U.gutterWidth}`,eR=(0,eT.cssRecord)({root:[_.rcss.position.absolute,_.rcss.top(0),_.rcss.left(0),_.rcss.borderRadius(8),{pointerEvents:"none",transform:`translate(calc(${eP}), ${U.dropPreviewY})`,width:`calc(100% - ${eP})`,height:U.dropPreviewHeight,opacity:U.dropPreviewOpacity,outline:`1px dashed ${U.statusColor}`,outlineOffset:-1}]}),eC=(0,r.memo)(function(){let e=(0,L.useObservableValue)(eF),n=(0,L.useObservableValue)(eL),i=(0,L.useObservableValue)(eM),o=(0,r.useRef)(null);(0,S.useStyleSet)(o,e,e=>({[G.dropPreviewY]:(e?.y??0)+"px",[G.dropPreviewHeight]:(e?.height??0)+"px",[G.dropPreviewDepth]:e?.depth.toString()??"0"})),(0,S.useStyleSet)(o,i,e=>({[G.dropPreviewOpacity]:e?"1":"0"})),(0,S.useStyleSet)(o,n,e=>({[G.statusColor]:e?ev.tokens.accentPrimaryDefault:ev.tokens.accentNegativeDefault}));let l=(0,x.usePrefersReducedMotion)();return(0,t.jsx)(eA.View,{style:{transition:l?void 0:"transform 140ms, width 140ms, height 140ms, opacity 140ms ease-out 60ms"},innerRef:o,css:eR.root})}),ek=(0,d.atom)(null,(e,t,r)=>{if(null!==r){for(let[n,i]of e(M.renderedRowsAtom))if(!(r.y<i.y)&&!(r.y>i.y+i.height))return t(eD,n),i;t(eD,-1)}}),eO=a.Type.Object({type:a.Type.Literal("nodes"),width:a.Type.Number(),height:a.Type.Number(),nodes:a.Type.Array(a.Type.Object({path:a.Type.String(),type:a.Type.Enum(g.FileType)}))});function eI(){let e=(0,L.useSet)(ek),t=(0,L.useSet)(eD),n=(0,r.useRef)(null),i=(0,r.useRef)(null),s=(0,r.useRef)(null),{showError:a}=(0,w.default)(),u=(0,L.useGet)(eb),c=(0,L.useSet)(ex),d=(0,L.useSet)(ey),p=(0,L.useSet)(eL),y=(0,r.useRef)(null),x=(0,L.useGet)(M.dirInfoAtom),S=(0,L.useGet)(M.rootPathAtom),b=(0,L.useSet)(M.containerSizeAtom),D=el(),F=(0,L.useValue)(M.readOnlyAtom),[{isOver:P},R]=(0,o.useDrop)(()=>({accept:[g.FileType.File,g.FileType.Directory,l.NativeTypes.FILE],canDrop:()=>!0,hover:(t,r)=>{let o=s.current;if(!o)return;i.current&&function(e,t,r={scrollZoneSize:{w:50,h:50},scrollVelocity:{x:50,y:50},scrollUpdateThrottle:100}){let{scrollZoneSize:n,scrollVelocity:i,scrollUpdateThrottle:o}=r,l=(0,f.default)(()=>{let r=t.getClientOffset();if(!r)return[0,0];let{x:o,y:l}=r,{x:s,y:a,width:u,height:c}=e.getBoundingClientRect(),d=Math.min(u/2,n.w),f=Math.min(c/2,n.h),p=(e,t)=>{let[r,n]=t;return(0,v.default)(e,r[0],r[1])?(e-r[1])/(r[1]-r[0]):(0,v.default)(e,n[0],n[1])?(e-n[0])/(n[1]-n[0]):0};return[p(o,[[s,s+d],[s+u-d,s+u]])*i.x,p(l,[[a,a+f],[a+c-f,a+c]])*i.y]},o,{trailing:!1})();if(!l)return;let[s,a]=l;if(0===s&&0===a)return;let{scrollLeft:u,scrollTop:c,scrollWidth:d,scrollHeight:p,clientWidth:h,clientHeight:m}=e;requestAnimationFrame(()=>{e.scrollTop=(0,T.clampToRange)(0,d-h,u+s),e.scrollTop=(0,T.clampToRange)(0,p-m,c+a)})}(i.current,r);let l=r.getClientOffset();if(!l)return;let a=e({x:l.x-o.x,y:l.y-o.y+u()});a?"file"===a.row.type||"uploadFile"===a.row.type?n.current=(0,h.getParentPath)(a.row.path)||m.ROOT_PATH:"dir"===a.row.type?n.current=a.row.path:n.current=a.row.dir:n.current=S();let c="nodes"!==t.type||(0,h.coalesceFsNodes)(t.nodes).every(e=>eg(e,n.current??S()));if(p(c),a?.row.type!=="dir"){y.current&&(clearTimeout(y.current.timer),y.current=null);return}let d=a.row.path;if(y.current){if(y.current.dir===d)return;clearTimeout(y.current.timer),y.current=null}if(!c)return;let g=setTimeout(()=>{x().get(d)?.expanded||D(d)},400);y.current={dir:d,timer:g}},drop:(e,t)=>{let r=n.current??S();if("nodes"===e.type){d({to:r,nodes:e.nodes}),n.current=null;return}e.dirContent.then(e=>{let t=e.reduce((e,t)=>t.size+e,0);e.length>A.MAX_NUM_FILES_UPLOAD_LIMIT?a("Trying to upload too many files at once. Please try again with fewer files."):t>A.MAX_FILE_UPLOAD_SIZE_LIMIT_BYTES?a("Total file upload size exceeds maximum limit. Please try again with smaller files."):c({parentPath:r===m.ROOT_PATH?void 0:r,files:e.filter(Boolean),onError:a})}),n.current=null},collect:e=>({isOver:e.isOver()})}),[]),C=(0,L.useSet)(eM);(0,r.useEffect)(()=>{if(C(P),P){let e=i.current?.getBoundingClientRect();s.current=e?{x:e.x,y:e.y}:null,e&&b({width:e.width,height:e.height});return}y.current&&(clearTimeout(y.current.timer),y.current=null),n.current=null,t(null)},[C,P,t,b]);let k=(0,L.useSet)(eb);return(0,r.useEffect)(()=>{let e=i.current;if(!e)return;let t=(0,f.default)(()=>{k(e.scrollTop)},200);return e.addEventListener("scroll",t),()=>{t.cancel(),e.removeEventListener("scroll",t)}},[k]),{dropRef:F?void 0:R,containerRef:i}}let ej=(0,d.atom)(null,(e,t,r)=>{t(M.selectedNodesAtom,e=>(0,c.produce)(e,e=>{e.set(r.path,r.type)}));let n=[r];if(e(M.lastSelectWasSingleAtom))return n;for(let[t,i]of e(M.selectedNodesAtom))t!==r.path&&n.push({path:t,type:i});return n});function eE(e){let t=(0,L.useSet)(eD),i=(0,L.useSet)(ej),o=(0,L.useValue)(M.readOnlyAtom),l=(0,r.useRef)(null),[s,a,u]=(0,n.useDrag)({type:e.type,item:()=>{let t=i(e),r=l.current?.getBoundingClientRect()??{width:160,height:32};return{nodes:t,type:"nodes",width:r.width,height:r.height}},collect:t=>{let r=t.getItem();return{isDragging:!!(r?.type==="nodes"&&r.nodes.some(t=>t.path===e.path))}},end:()=>{t(null)}}),{isDragging:c}=s;return(0,y.useDisableNativeDragPreview)(u),{isDragging:c,dragRef:o?void 0:a,sizeRef:l}}let eV=(0,eT.cssRecord)({root:[_.rcss.position.absolute,{left:0,top:0,transform:`translate(${U.dragPreviewX}, ${U.dragPreviewY})`,pointerEvents:"none"}],item:[_.rcss.backgroundColor.backgroundHighest,_.rcss.flex.row,_.rcss.align.center,_.rcss.shadow(3),W,{height:U.rowHeight,borderRadius:U.borderRadius}],icon:[B,{marginRight:U.iconTextGap}],text:[$,_.rcss.flex.growAndShrink(1),{color:U.statusColor}],count:[$,_.rcss.backgroundColor.accentPrimaryDimmest,_.rcss.color.accentPrimaryStrongest,_.rcss.fontWeight.medium,_.rcss.position.absolute,_.rcss.left("calc(50% - 4px)"),_.rcss.top("calc(100% - 4px)"),_.rcss.borderRadius("full"),_.rcss.px(4),_.rcss.center,{fontSize:U.fontSizeSmall}]}),eN=(0,r.memo)(function(e){let n=(0,r.useRef)(null),i=et(),o=(0,L.useObservableValue)(ez);return(0,S.useStyleSet)(n,o,e=>({[G.dragPreviewX]:(e?e.x:0)+"px",[G.dragPreviewY]:(e?e.y:0)+"px"})),(0,S.useStyleSet)(n,i.horizontalPadding,e=>({[G.horizontalPadding]:e+"px"})),(0,S.useStyleSet)(n,i.fontSize,e=>({[G.fontSize]:e+"px"})),(0,S.useStyleSet)(n,i.fontSizeSmall,e=>({[G.fontSizeSmall]:e+"px"})),(0,S.useStyleSet)(n,i.iconSize,e=>({[G.iconSize]:e+"px"})),(0,S.useStyleSet)(n,i.iconTextGap,e=>({[G.iconTextGap]:e+"px"})),(0,S.useStyleSet)(n,i.borderRadius,e=>({[G.borderRadius]:e+"px"})),(0,S.useStyleSet)(n,i.gutterWidth,e=>({[G.gutterWidth]:e+"px"})),(0,t.jsx)(eA.View,{innerRef:n,css:eV.root,children:(0,t.jsxs)(eA.View,{css:eV.item,style:{width:e.width,height:e.height},children:[(0,t.jsx)(eA.View,{css:eV.icon,children:e.type===g.FileType.File?(0,t.jsx)(eS.default,{path:e.path}):(0,t.jsx)(p.default,{})}),(0,t.jsx)(eA.View,{css:eV.text,children:(0,h.getFileName)(e.path)}),e.count>1?(0,t.jsx)(eA.View,{css:eV.count,children:e.count}):null]})})}),ez=(0,d.atom)(null);(0,d.atom)(e=>null!==e(ez));let eM=(0,d.atom)(!1),eL=(0,d.atom)(!1);function eH(){let{isDragging:e,item:n,currentOffset:o}=(0,i.useDragLayer)(e=>({item:e.getItem(),isDragging:e.isDragging(),initialOffset:e.getInitialSourceClientOffset(),currentOffset:e.getSourceClientOffset()})),l=(0,L.useSet)(ez);if((0,r.useEffect)(()=>{l(o?{x:o.x,y:o.y}:null)},[l,o]),!e||!u.Value.Check(eO,n))return null;let{nodes:a,width:c,height:d}=n,[f]=a;return f?(0,s.createPortal)((0,t.jsx)(eN,{type:f.type,path:f.path,count:a.length,width:c,height:d}),document.body):null}e.s(["DragLayer",()=>eH,"DropPreview",0,eC,"useDragFile",()=>eE,"useDropFile",()=>eI],369685);var e_=e.i(223808),eG=e.i(282453);let eU=a.Type.Enum(g.FileType),eW=a.Type.Object({filename:a.Type.String({minLength:1}),type:eU}),eB=a.Type.Object({scrollOffset:a.Type.Number({minimum:0}),dirInfo:a.Type.Record(a.Type.String(),a.Type.Object({expanded:a.Type.Boolean(),children:a.Type.Array(eW)}))});function e$(e){var t;return t=eG.default.get(eK(e)),u.Value.Check(eB,t)?{dirInfo:new Map(Object.entries(t.dirInfo)),scrollOffset:t.scrollOffset}:null}function eK(e){return"repl:workspace:filetree:"+e}let eY=a.Type.Array(a.Type.String()),eq="repl:workspace:filetree:savedKeys",eZ=(0,R.selectAtom)(M.configAtom,e=>e.localCacheKey?eK(e.localCacheKey):null),eX=(0,d.atom)(null,e=>{let t,{localCacheKey:r,filter:n}=e(M.configAtom);if(!r)return;let i=e(M.virtualizerAtom)?.scrollOffset??0,o=e(M.dirInfoAtom),l=!1;for(let[,{children:e}]of o)if(l=!!e?.length)break;if(!l)return;let s=function(e,t){let r={dirInfo:Object.create(null),scrollOffset:e.scrollOffset};for(let[n,{expanded:i,children:o}]of e.dirInfo){if(!o)continue;let e=o.filter(t);e.length&&(r.dirInfo[n]={expanded:i,children:e})}return r}({dirInfo:o,scrollOffset:i},n),a=eK(r),c=(t=eG.default.get(eq),u.Value.Check(eY,t)?t:null);if(c){let e=c.filter(e=>e!==a);for(let t of(e.unshift(a),e.splice(20)))eG.default.remove(t);eG.default.set(eq,e)}else eG.default.set(eq,[a]);return eG.default.set(eK(r),s)});function eJ(){let e=(0,L.useValue)(eZ),t=(0,L.useObservableValue)(M.dirInfoAtom),n=(0,L.useSet)(eX);(0,r.useEffect)(()=>{if(!e)return;let r=null,i=window.requestIdleCallback??window.requestAnimationFrame,o=window.cancelIdleCallback??window.cancelAnimationFrame,l=(0,e_.default)(()=>{r&&o(r),r=i(n)},1e3),s=t.subscribe(l);return document.addEventListener("visibilitychange",n),document.addEventListener("beforeunload",n),()=>{l.cancel(),r&&o(r),document.removeEventListener("visibilitychange",n),document.removeEventListener("beforeunload",n),s(),n()}},[e,t,n])}e.s(["getLocalCache",()=>e$,"useLocalCache",()=>eJ],916866);var eQ=e.i(32988),e0=e.i(416298),e1=e.i(672963),e2=e.i(315801),e5=e.i(343252);let e4={name:"sameWidth",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:({state:e})=>{e.styles.popper.width=`${e.rects.reference.width}px`},effect:({state:e})=>{e.elements.reference instanceof HTMLElement&&(e.elements.popper.style.width=`${e.elements.reference.offsetWidth}px`)}};var e3=e.i(98816),e8=e.i(907371),e9=e.i(290446),e6=e.i(540697);let e7=(0,R.selectAtom)(M.configAtom,e=>e.autocomplete);function te({id:e,items:r,activeIndex:n,onSuggestion:i,fileType:o,innerRef:l}){return(0,t.jsx)(eA.View,{tag:"ul",id:e,"aria-label":"Suggestions",innerRef:l,children:r.map((e,r)=>{let l=r===n;return(0,t.jsxs)(e8.Interactive,{id:e.value,tag:"li",role:"option","aria-selected":l,variant:"listItem",row:!0,align:"center",gap:8,px:8,height:24,clsx:l?e6.default.itemActive:e6.default.itemInactive,onClick:()=>i(e.value),children:[(0,t.jsx)(eA.View,{clsx:e6.default.icon,children:o===g.FileType.Directory?(0,t.jsx)(p.default,{}):(0,t.jsx)(eS.default,{path:e.value})}),(0,t.jsx)(e9.HighlightMatches,{clsx:e6.default.text,text:e.value,highlight:e.highlight,dimmed:!l})]},e.value)})})}var tt=e.i(754873),tr=e.i(6338),tn=e.i(173703),ti=e.i(399144);let to=[U.horizontalPadding,U.iconSize,U.iconTextGap].join(" + "),tl=[tt.interactive.filled,{height:"100%",width:"100%",paddingLeft:`calc(${to})`,paddingRight:U.horizontalPadding,fontSize:U.fontSize}],ts=(0,eT.cssRecord)({root:[W,{padding:U.horizontalPadding}],icon:[B,_.rcss.color.accentNegativeDefault,{marginRight:U.iconTextGap}],text:[{fontSize:U.fontSize},_.rcss.color.foregroundDimmer,_.rcss.flex.growAndShrink(1)]});function ta(e){return(0,t.jsxs)(eA.View,{css:ts.root,row:!0,children:[(0,t.jsx)(eA.View,{css:ts.icon,children:(0,t.jsx)(e0.default,{})}),(0,t.jsx)(eA.View,{css:ts.text,children:e.message})]})}let tu=(0,eT.cssRecord)({root:[_.rcss.position.relative,_.rcss.flex.growAndShrink(1),{height:"100%"}],icon:[B,_.rcss.position.absolute,_.rcss.left(U.horizontalPadding),_.rcss.top("50%"),{transform:"translateY(-50%)"}],input:tl,inputLoading:[tl,tr.loadingStyle.backgroundPulse()],menu:[_.rcss.overflow("hidden"),{borderRadius:U.borderRadius,border:"1px solid",borderColor:ev.tokens.outlineDefault}],label:[_.rcss.visuallyHidden]});function tc(e){let n=(0,r.useId)(),i=(0,r.useId)(),o=function(){let e=(0,r.useRef)(null),t=et();(0,S.useStyleSet)(e,t.fontSize,e=>({[G.fontSize]:e+"px"})),(0,S.useStyleSet)(e,t.iconTextGap,e=>({[G.iconTextGap]:e+"px"})),(0,S.useStyleSet)(e,t.borderRadius,e=>({[G.borderRadius]:e+"px"})),(0,S.useStyleSet)(e,t.horizontalPadding,e=>({[G.horizontalPadding]:e+"px"})),(0,S.useStyleSet)(e,t.iconSize,e=>({[G.iconSize]:e+"px"})),(0,S.useStyleSet)(e,t.fontSize,e=>({[G.rowHeight]:(0,M.getRowHeight)(e,"file")+"px"})),(0,S.useStyleSet)(e,t.iconTextGap,e=>({[G.iconTextGap]:e+"px"}));let[n,i]=(0,r.useState)(null),[o,l]=(0,r.useState)(null),{styles:s,attributes:a}=(0,eQ.usePopper)(n,o,{modifiers:[{name:"offset",options:{offset:[0,4]}},e4],placement:"bottom-start"});return{menuRef:(0,e5.useMergeRefs)([e,l],{breadcrumb:"client/workspace/components/Filetree/FileNodeInput.tsx:100"}),menuAnchorRef:i,styles:s.popper,attributes:a.popper}}(),l=function({onSuggestion:e,siblings:t,value:n}){let i=(0,L.useValue)(e7),[o,l]=(0,r.useState)({items:[],activeIndex:null}),s=(0,e3.default)(t),a=(0,e3.default)(n),[,u]=(0,r.useTransition)(),d=i?function(e){u(()=>{let t=i(e);l(e=>(0,c.produce)(e,e=>{e.items=t.filter(e=>e.value!==a.current&&!s.current.some(t=>t.filename===e.value))}))})}:null;function f(){l({items:[],activeIndex:null})}return{items:o.items.length?o.items:null,activeIndex:o.activeIndex,query:d,onKeyDown:function(t){if("Enter"===t.key){let r=null!==o.activeIndex?o.items[o.activeIndex]:null;if(!r)return;return t.preventDefault(),e(r.value),f(),!0}return"ArrowDown"===t.key?(t.preventDefault(),l(e=>(0,c.produce)(e,e=>{if(null===e.activeIndex||e.activeIndex>e.items.length-1){e.activeIndex=0;return}e.activeIndex++})),!0):"ArrowUp"===t.key?(t.preventDefault(),l(e=>(0,c.produce)(e,e=>{if(null===e.activeIndex){e.activeIndex=e.items.length-1;return}if(0===e.activeIndex){e.activeIndex=null;return}e.activeIndex--})),!0):void 0},clear:f}}({onSuggestion:e.onSuggestion,siblings:e.siblings,value:e.value}),s=(0,L.useGet)(M.virtualizerAtom),[a,u]=(0,r.useState)(!0),d=(0,r.useRef)(null);(0,r.useEffect)(()=>{if(!d.current)return;let e=s()?.scrollElement;if(e)return(0,e2.inView)(d.current,()=>(u(!0),()=>u(!1)),{root:e})},[s]);let f=a&&!!(e.error||l.items),h=l.items&&l.activeIndex?l.items[l.activeIndex]:void 0,m=!e.error&&l.items?l.items:null,y=(0,r.useRef)(null),w=l.clear,x=(0,e1.default)(e=>{y.current?.contains(e.target)||w()},[w]),v=(0,e1.default)(t=>{let r=e.inputRef.current;!r||y.current?.contains(t.target)||x.current?.contains(t.target)||e.onClickOutside({inputValue:r.value})},[]),{menuAnchorRef:T}=o,A=(0,e5.useMergeRefs)([y,T],{breadcrumb:"client/workspace/components/Filetree/FileNodeInput.tsx:250"});return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("label",{css:tu.label,htmlFor:n,children:"file name"}),(0,t.jsxs)(eA.View,{css:tu.root,innerRef:A,children:[(0,t.jsx)(eA.View,{css:tu.icon,children:e.fileType===g.FileType.Directory?(0,t.jsx)(p.default,{}):(0,t.jsx)(eS.default,{path:e.value})}),(0,t.jsx)("input",{spellCheck:!1,"aria-controls":l.query?i:void 0,"aria-expanded":l.items?"true":"false","aria-activedescendant":h?.value,role:l.query?"combobox":void 0,id:n,ref:(0,e5.useMergeRefs)([e.inputRef,d,v],{breadcrumb:"client/workspace/components/Filetree/FileNodeInput.tsx:274"}),css:e.loading?tu.inputLoading:tu.input,value:e.value,onChange:e.loading?void 0:t=>{e.onChange(t),l.query?.({input:t.currentTarget.value,fileType:e.fileType,type:e.type,siblings:e.siblings})},onKeyDown:t=>{l.onKeyDown(t)||e.onKeyDown(t)}})]}),(0,t.jsx)(ti.Portal,{children:(0,t.jsxs)(tn.ShadesSurface,{colorShade:"popup",css:tu.menu,innerRef:o.menuRef,style:{...o.styles,display:f?"block":"none"},...o.attributes,children:[e.error?(0,t.jsx)(ta,{message:e.error}):null,m?(0,t.jsx)(te,{id:i,innerRef:x,items:m,activeIndex:l.activeIndex,onSuggestion:t=>{e.onSuggestion(t),w()},fileType:e.fileType}):null]})})]})}let td=(0,eT.cssRecord)({createFilePicker:[{fontSize:U.fontSize,paddingRight:U.horizontalPadding,paddingLeft:U.horizontalPadding}],button:[_.rcss.reset.button,_.rcss.p(2),tt.interactive.filled,_.rcss.color.foregroundDimmer,{fontSize:"inherit"}],text:[$,_.rcss.color.foregroundDimmest]});function tf(e){let n=ed(e.dir),i=(0,r.useRef)(null);return((0,r.useEffect)(()=>{n.fileType&&i.current?.focus()},[n.fileType]),n.fileType)?(0,t.jsx)(tc,{siblings:n.siblings||[],type:"create",inputRef:i,loading:n.creating,error:n.error,value:n.value,fileType:n.fileType,onClickOutside:({inputValue:e})=>{""===e?n.cancel():n.create(e)},onChange:e=>{n.error&&n.clearError(),n.setValue(e.currentTarget.value)},onKeyDown:e=>{"Escape"===e.key?n.cancel():"Enter"===e.key&&n.create(e.currentTarget.value)},onSuggestion:e=>{n.setValue(e),n.create(e)}}):(0,t.jsx)(tp,{create:n.start})}function tp(e){return(0,t.jsxs)(eA.View,{css:td.createFilePicker,align:"center",row:!0,gap:4,children:[(0,t.jsx)(eA.View,{css:td.text,children:"Add a"}),(0,t.jsx)(eA.View,{tag:"button",css:td.button,onClick:()=>e.create(g.FileType.File),children:"file"}),(0,t.jsx)(eA.View,{css:td.text,children:"or "}),(0,t.jsx)(eA.View,{tag:"button",css:td.button,onClick:()=>e.create(g.FileType.Directory),children:"folder"})]})}e.s(["CreateFileNode",()=>tf,"CreateFilePicker",()=>tp],189739);var th=e.i(62674),tm=e.i(116235);function tg(e){return(0,t.jsxs)(tm.default,{...e,children:[(0,t.jsx)("path",{fillRule:"evenodd",d:"M1.25 5A2.75 2.75 0 0 1 4 2.25h4.999c.251 0 .485.125.625.334L11.4 5.25H20A2.75 2.75 0 0 1 22.75 8v4.5a.75.75 0 0 1-1.5 0V8c0-.69-.56-1.25-1.25-1.25h-9a.751.751 0 0 1-.625-.335L8.598 3.75H4c-.69 0-1.25.56-1.25 1.25v14c0 .69.56 1.25 1.25 1.25h9a.75.75 0 0 1 0 1.5H4A2.75 2.75 0 0 1 1.25 19V5Z",clipRule:"evenodd"}),(0,t.jsx)("path",{fillRule:"evenodd",d:"M18.438 13.8c-.147-.4-.73-.4-.875 0l-1.005 2.744a.458.458 0 0 1-.298.278l-2.436.746a.446.446 0 0 0 0 .857l2.437.752a.458.458 0 0 1 .297.279l1.005 2.745c.146.399.728.399.875 0l1.004-2.745a.458.458 0 0 1 .297-.278l2.437-.75a.446.446 0 0 0 0-.857l-2.437-.749a.458.458 0 0 1-.297-.278L18.437 13.8Z",clipRule:"evenodd"})]})}let ty={custom_instruction:{expanded:e=>(0,t.jsx)(tg,{...e}),collapsed:e=>(0,t.jsx)(tg,{...e})}};e.s(["FolderIconComponent",0,({isExpanded:e=!1,path:r,size:n=16})=>{let i=Object.hasOwn(ty,r)?ty[r]:null;return i?i[e?"expanded":"collapsed"]({size:n}):e?(0,t.jsx)(th.default,{color:ev.tokens.foregroundDimmer,size:n}):(0,t.jsx)(p.default,{color:ev.tokens.foregroundDimmer,size:n})}],518093);let tw=(0,eT.cssRecord)({root:[{marginLeft:"auto",paddingLeft:U.horizontalPadding}],svg:[{transform:"rotate(-90deg)",transformOrigin:"center center","& .inner-circle":{strokeDashoffset:U.strokeDashoffset}}]});function tx(e){let n=(0,L.useValue)(M.fontSizeAtom)/2,i=n/2,o=2*i*Math.PI,l=(0,r.useRef)(null);return(0,S.useStyleSet)(l,e.progress,e=>({[G.strokeDashoffset]:(o-e*o).toString()})),(0,t.jsx)(eA.View,{innerRef:l,css:tw.root,children:(0,t.jsxs)("svg",{css:tw.svg,height:2*n,width:2*n,children:[(0,t.jsx)("circle",{fill:ev.tokens.backgroundHigher,r:n,cx:n,cy:n}),(0,t.jsx)("circle",{className:"inner-circle",stroke:ev.tokens.foregroundDimmest,fill:"transparent",strokeWidth:n,strokeDasharray:o+" "+o,r:i,cx:n,cy:n})]})})}let tv=e=>e.reduce((e,t)=>e+t.current,0)/e.length;function tT(e){let n=(0,L.useValue)(M.fontSizeAtom)/2,i=n/2,o=2*i*Math.PI,l=function(e){let[t,n]=(0,r.useState)(tv(e));return(0,r.useEffect)(()=>{let t=[];for(let r of e)t.push(r.subscribe(()=>{n(tv(e))}));return()=>{t.map(e=>e())}},[e]),t}(e.uploadProgress),s=(0,r.useRef)(null);return(0,t.jsx)(eA.View,{innerRef:s,css:tw.root,children:(0,t.jsxs)("svg",{css:tw.svg,height:2*n,width:2*n,children:[(0,t.jsx)("circle",{fill:ev.tokens.backgroundHigher,r:n,cx:n,cy:n}),(0,t.jsx)("circle",{className:"inner-circle",style:{[G.strokeDashoffset]:(o-l*o).toString()},stroke:ev.tokens.foregroundDimmest,fill:"transparent",strokeWidth:n,strokeDasharray:o+" "+o,r:i,cx:n,cy:n})]})})}function tS(e){let[n,{setValue:i,rename:o,cancel:l}]=function(e){let t=(0,L.useGet)(M.configAtom),[n,i]=(0,r.useState)(null),o=(0,h.getParentPath)(e.path)||m.ROOT_PATH,l=(0,h.getFileName)(e.path),s=(0,L.useSet)(M.pathToBeRenamedAtom),a=(0,L.useSet)(M.focusedPathAtom),[u,c]=(0,r.useState)(l),[d,f]=(0,r.useState)(!1),p=(0,O.default)(()=>(0,R.selectAtom)(M.dirInfoAtom,e=>e.get(o)?.children),[o]),y=u!==l,w=(0,L.useValue)(p),x=null;y&&u.includes("/")?x=z({fileName:u,parentPath:o}):y&&(x=E({fileName:u,siblingNames:w?.map(e=>e.filename)??[],parentPath:o}));let v=async r=>{if(x||!r||r===l)return;let{readOnly:n,fs:u,onFileRenameStart:c,onFileRenameEnd:d}=t();if(n)return;let p=null;if(p=r.includes("/")?await N({fileName:r,parentPath:o,fs:u}):E({fileName:r,siblingNames:w?.map(e=>e.filename)??[],parentPath:o}))return void i(p);let y=o===m.ROOT_PATH?null:o+"/",v=y?y+r:r,T=(0,h.getParentPath)(v)||m.ROOT_PATH;if(f(!0),c?.({from:e.path,to:v}),T!==m.ROOT_PATH&&((await u.stat(T)).exists||await u.createDir(T)),(e.type===g.FileType.Directory?await u.moveDir(e.path,v):await u.moveFile(e.path,v)).error){i("Something went wrong"),f(!1),d?.();return}s(null),d?.(),a(v)};return[{canRename:!!u&&y&&!x,value:u,renaming:d,error:n||x,siblings:w},{setValue:c,rename:v,cancel:()=>{let{onFileRenameEnd:r}=t();s(null),r?.(),a(e.path)}}]}({path:e.path,type:e.fileType}),s=(0,r.useRef)(null),a=(0,r.useRef)(n.value);return(0,r.useEffect)(()=>{if(!s.current)return;let e=a.current;if(!e)return;let t=e.lastIndexOf(".");t<=1&&(t=e.length);let r=+!!e.startsWith(".");s.current.focus(),s.current.setSelectionRange(r,t)},[]),(0,t.jsx)(tc,{siblings:n.siblings?n.siblings.filter(t=>t.filename!==(0,h.getFileName)(e.path)):[],type:"rename",inputRef:s,loading:n.renaming,error:n.error,value:n.value,fileType:e.fileType,onClickOutside:({inputValue:e})=>{n.canRename?o(e):n.error||l()},onChange:e=>{i(e.currentTarget.value)},onKeyDown:e=>{"Escape"===e.key?l():"Enter"===e.key&&(n.canRename?o(e.currentTarget.value):n.error||l())},onSuggestion:e=>{i(e),o(e)}})}e.s(["CumulativeProgressCircle",()=>tT,"ProgressCircle",()=>tx],942527),e.s(["RenameFileNode",()=>tS],788123)},234961,e=>{"use strict";var t,r=e.i(960933),n=((t={}).UNTRACKED="UNTRACKED",t.UNMODIFIED="UNMODIFIED",t.MODIFIED="MODIFIED",t.TYPE_CHANGED="TYPE_CHANGED",t.ADDED="ADDED",t.DELETED="DELETED",t.RENAMED="RENAMED",t.COPIED="COPIED",t.UNMERGED="UNMERGED",t);let i=r.Type.Enum(n),o=r.Type.Object({type:r.Type.Object({index:i,worktree:i}),path:r.Type.String(),staged:r.Type.Boolean(),unmerged:r.Type.Boolean(),source:r.Type.Optional(r.Type.Object({type:r.Type.Union([r.Type.Literal("RENAMED"),r.Type.Literal("COPIED")]),score:r.Type.Number(),path:r.Type.String()}))});r.Type.Object({commit:r.Type.Union([r.Type.String(),r.Type.Null()]),branch:r.Type.Union([r.Type.String(),r.Type.Null()]),upstream:r.Type.Union([r.Type.Null(),r.Type.Object({branch:r.Type.String(),ahead:r.Type.Number(),behind:r.Type.Number()})]),stashes:r.Type.Number(),changes:r.Type.Array(o)}),e.s(["GitStatusChangedFileType",()=>n])},160290,e=>{"use strict";var t=e.i(276385),r=e.i(389959),n=e.i(903381),i=e.i(343252),o=e.i(869226),l=e.i(722441),s=e.i(369685),a=e.i(10261),u=e.i(916866),c=e.i(269848),d=e.i(828322),f=e.i(416298),p=e.i(205104),h=e.i(189739),m=e.i(518093),g=e.i(27304),y=e.i(942527),w=e.i(788123),x=e.i(624525),v=e.i(992785),T=e.i(814563),S=e.i(234961),A=e.i(703631),b=e.i(125674),D=e.i(820170),F=e.i(666729),P=e.i(480028),R=e.i(446530),C=e.i(613355),k=e.i(625484);let O={[S.GitStatusChangedFileType.ADDED]:"A",[S.GitStatusChangedFileType.UNTRACKED]:"A",[S.GitStatusChangedFileType.MODIFIED]:"M",[S.GitStatusChangedFileType.DELETED]:"D",[S.GitStatusChangedFileType.RENAMED]:"R",[S.GitStatusChangedFileType.COPIED]:"C"},I={[S.GitStatusChangedFileType.ADDED]:P.tokens.greenDimmest,[S.GitStatusChangedFileType.UNTRACKED]:P.tokens.greenDimmest,[S.GitStatusChangedFileType.MODIFIED]:P.tokens.yellowDimmest,[S.GitStatusChangedFileType.DELETED]:P.tokens.redDimmest,[S.GitStatusChangedFileType.RENAMED]:P.tokens.tealDimmest,[S.GitStatusChangedFileType.COPIED]:P.tokens.limeDimmest},j={[S.GitStatusChangedFileType.ADDED]:P.tokens.greenStrongest,[S.GitStatusChangedFileType.UNTRACKED]:P.tokens.greenStrongest,[S.GitStatusChangedFileType.MODIFIED]:P.tokens.yellowStrongest,[S.GitStatusChangedFileType.DELETED]:P.tokens.redStrongest,[S.GitStatusChangedFileType.RENAMED]:P.tokens.tealStrongest,[S.GitStatusChangedFileType.COPIED]:P.tokens.limeStrongest};function E(e){return e===S.GitStatusChangedFileType.ADDED||e===S.GitStatusChangedFileType.UNTRACKED||e===S.GitStatusChangedFileType.MODIFIED||e===S.GitStatusChangedFileType.DELETED||e===S.GitStatusChangedFileType.RENAMED||e===S.GitStatusChangedFileType.COPIED}let V={color:F.styleTokens.statusColor,fontSize:F.styleTokens.fontSizeSmall,minWidth:F.styleTokens.dirStatusIconSize,height:F.styleTokens.dirStatusIconSize},N=(0,R.cssRecord)({fileIcon:[C.rcss.fontWeight.bold,C.rcss.px(2),C.rcss.center,V],directoryCountIcon:[C.rcss.fontWeight.medium,C.rcss.borderRadius(4),C.rcss.px(2),C.rcss.center,V,{backgroundColor:F.styleTokens.statusBackgroundColor}],directoryDraftBufferIndicator:[C.rcss.width(8),C.rcss.height(8),C.rcss.ml(8),C.rcss.border({color:P.tokens.foregroundDimmer,width:1}),{borderRadius:"50%"}],fileDraftBufferIndicator:[C.rcss.width(8),C.rcss.height(8),C.rcss.backgroundColor.foregroundDimmer,{borderRadius:"50%"}]});function z(e){return(0,t.jsx)(k.View,{css:N.fileIcon,children:(0,t.jsx)(k.View,{children:e.text})})}function M(e){return(0,t.jsx)(k.View,{css:N.directoryCountIcon,children:(0,t.jsx)(k.View,{children:e.count})})}var L=e.i(754873),H=e.i(630818),_=e.i(818138),G=e.i(960178);let U=[C.rcss.position.absolute,C.rcss.top(0),C.rcss.left(0),{width:`calc(100% - ${F.styleTokens.rowLeftIndent})`,height:F.styleTokens.rowHeight,transform:`translateY(${F.styleTokens.rowY})`,marginLeft:F.styleTokens.rowLeftIndent}],W=(0,R.cssRecord)({divider:[...U,F.rowPadding,C.rcss.flex.growAndShrink(1),C.rcss.justify.center],dividerInner:[{borderTop:"1px dashed",borderColor:P.tokens.outlineDimmest,height:"70%",justifyContent:"end"}],dividerText:[C.rcss.truncate,C.rcss.color.foregroundDimmer,{fontSize:F.styleTokens.fontSizeSmall}],error:[...U,C.rcss.rowWithGap(4),C.rcss.align.center,F.rowPadding],emptyDir:[...U,F.rowPadding,C.rcss.color.foregroundDimmest,C.rcss.justify.center,{paddingLeft:F.styleTokens.iconSize,paddingRight:F.styleTokens.horizontalPadding}],row:[...U,C.rcss.flex.growAndShrink(1),C.rcss.flex.row,C.rcss.align.center,L.interactive.nofill,{backgroundColor:F.styleTokens.nodeBackgroundColor,borderRadius:F.styleTokens.borderRadius,cursor:"pointer","&:focus":{outline:"none !important",boxShadow:"0 0 0 1px "+P.tokens.accentPrimaryDefault,zIndex:1},[F.cssVars.hasUnsavedChangesDisplay]:"flex","@media (hover: hover)":{[F.cssVars.contextMenuButtonDisplay]:"none"},"&:hover, &:active, &:focus":{[F.cssVars.contextMenuButtonDisplay]:"flex",[F.cssVars.hasUnsavedChangesDisplay]:"none"},transitionDuration:"0ms"}],rowContent:[C.rcss.flex.row,C.rcss.align.center,C.rcss.flex.growAndShrink(1),F.rowPadding],uploadRow:[...U,C.rcss.flex.growAndShrink(1),C.rcss.align.center,C.rcss.flex.row,C.rcss.align.center,F.rowPadding,C.rcss.border({color:"transparent"}),{backgroundColor:F.styleTokens.nodeBackgroundColor,borderRadius:F.styleTokens.borderRadius,[F.cssVars.statusColor]:P.tokens.foregroundDimmer}],createRow:[...U,C.rcss.justify.center],icon:[F.iconSize,{marginRight:F.styleTokens.iconTextGap}],text:[F.textCss,C.rcss.flex.growAndShrink(1),{color:F.styleTokens.statusColor}],emptyDirText:[F.textCss,C.rcss.display.flex,C.rcss.justify.center,C.rcss.flex.growAndShrink(1),{color:F.styleTokens.statusColor}],contextMenuButton:[C.rcss.reset.button,C.rcss.height("100%"),C.rcss.center,C.rcss.cursor.pointer,L.interactive.filled,F.iconSize,{display:F.styleTokens.contextMenuButtonDisplay,borderRadius:`0 ${F.styleTokens.borderRadius} ${F.styleTokens.borderRadius} 0`,transitionDuration:"0ms",backgroundColor:"transparent"}],draftBufferContainer:[{display:F.styleTokens.hasUnsavedChangesDisplay}]});function B(e){let r=(0,a.useFilePresence)(e.path),n=(0,D.useValue)(x.avatarSizeAtom);return r?.length?(0,t.jsx)(_.default,{size:n,activeUsers:r}):null}function $(e){let r=(0,a.useDirPresence)(e.path);return r?.length?(0,t.jsx)(_.default,{activeUsers:r}):null}function K(e){return(0,t.jsx)(k.View,{title:"menu",tag:"button",css:W.contextMenuButton,onClick:e.onClick,children:(0,t.jsx)(d.default,{})})}function Y(e,t){let n=(0,a.useIsSelected)(t);(0,o.useStyleSet)(e,n,e=>({[F.cssVars.nodeBackgroundColor]:e?P.tokens.backgroundHigher:"transparent"})),(0,r.useEffect)(()=>{function t(t){e.current&&e.current.setAttribute("aria-selected",t?"true":"false")}return t(n.current),n.subscribe(t)},[e,n,t])}let q=(0,r.memo)(function(e){var o;let l,u=(0,r.useRef)(null),d=(0,a.useLayoutRow)(e.index),f=(0,a.useIsExpanded)(e.path),h=(0,a.useIsLoading)(e.path),w=function(e){let[t,n]=(0,r.useState)(e);return(0,r.useEffect)(()=>{if(!e)return void n(!1);let t=setTimeout(()=>n(!0),500);return()=>{clearTimeout(t)}},[e]),t}(h),R=(0,a.useRename)(),C=(0,D.useValue)(x.rootPathAtom),O=(0,a.useTabIndex)(e.path),V=(0,a.useOnDirOnClick)(e.path),[N,z]=(0,a.useOnFocus)({path:e.path,index:e.index}),L=e.path===C&&h,H=L?g.LOADING:(0,p.getFileName)(e.path),{dragRef:_,sizeRef:G,isDragging:U}=(0,s.useDragFile)({path:e.path,type:n.FileType.Directory});Y(u,e.path);let B=(o=e.path,l=(0,b.default)(()=>(0,T.selectAtom)(x.fileStatusAtom,e=>e?function(e,t){let r=[];for(let[n,{index:i,worktree:o}]of e)(0,A.descendantOf)(t,n)&&r.push({path:n,index:i,worktree:o});if(0===r.length)return null;let n=r.every(e=>e.index===S.GitStatusChangedFileType.ADDED||e.worktree===S.GitStatusChangedFileType.UNTRACKED)?S.GitStatusChangedFileType.ADDED:S.GitStatusChangedFileType.MODIFIED;if(!E(n))return null;let i=r.length;return{color:j[n],backgroundColor:I[n],count:i}}(e,o):null,v.default),[o]),(0,D.useValue)(l)),q=(0,D.useValue)(x.onContextMenuAtom);return(0,t.jsxs)(k.View,{style:{...d?.style,[F.cssVars.statusColor]:B?.color??P.tokens.foregroundDimmer,[F.cssVars.statusBackgroundColor]:B?.backgroundColor,opacity:U?.1:void 0},tabIndex:O,role:"treeitem","aria-label":H,"aria-expanded":f,"aria-level":(d?.depth??0)+1,css:W.row,onFocus:()=>z(e.path),innerRef:(0,i.useMergeRefs)([u,N,G,e.pending?void 0:_],{breadcrumb:"client/workspace/components/Filetree/Row.tsx:345"}),onContextMenu:q?t=>{q(t,{path:e.path,type:n.FileType.Directory})}:void 0,onKeyDown:e.pending?void 0:t=>{"Enter"===t.key&&R(e.path)},onClick:e.pending?void 0:e=>{e.currentTarget===e.target&&V(e)},children:[(0,t.jsxs)(k.View,{title:e.path,css:W.rowContent,onClick:e.pending?void 0:V,children:[(0,t.jsx)(k.View,{css:W.icon,children:L||w&&!f?(0,t.jsx)(c.default,{}):(0,t.jsx)(m.FolderIconComponent,{path:e.path,isExpanded:f})}),(0,t.jsx)(k.View,{css:W.text,children:H}),e.uploadProgress?(0,t.jsx)(y.CumulativeProgressCircle,{uploadProgress:e.uploadProgress}):null,B?(0,t.jsx)(M,{count:B.count}):null,f?null:(0,t.jsx)($,{path:e.path}),null]}),q?(0,t.jsx)(K,{onClick:t=>{q(t,{path:e.path,type:n.FileType.Directory})}}):null]})}),Z=(0,r.memo)(function(e){var o;let l,u=(0,r.useRef)(null),c=(0,a.useLayoutRow)(e.index),{onClick:d,onDoubleClick:f}=(0,a.useOnFileClick)(e.path),h=(0,a.useTabIndex)(e.path),m=(0,a.useRename)(),[g,y]=(0,a.useOnFocus)({path:e.path,index:e.index}),w=(0,p.getFileName)(e.path),{dragRef:A,sizeRef:R,isDragging:C}=(0,s.useDragFile)({path:e.path,type:n.FileType.File});Y(u,e.path);let I=(o=e.path,l=(0,b.default)(()=>(0,T.selectAtom)(x.fileStatusAtom,e=>e?function(e,t){let r=e?.get(t);if(!r)return null;let n=null;return r.worktree!==S.GitStatusChangedFileType.UNMODIFIED?n=r.worktree:r.index!==S.GitStatusChangedFileType.UNMODIFIED&&(n=r.index),n&&E(n)?{color:j[n],text:O[n]}:null}(e,o):null,v.default),[o]),(0,D.useValue)(l)),V=(0,D.useValue)(x.onContextMenuAtom);return(0,t.jsxs)(k.View,{style:{...c?.style,[F.cssVars.statusColor]:I?.color??P.tokens.foregroundDimmer,opacity:C?.1:void 0},tabIndex:h,dataCy:"filetree-file",css:W.row,onFocus:()=>y(e.path),innerRef:(0,i.useMergeRefs)([u,g,R,e.pending?void 0:A],{breadcrumb:"client/workspace/components/Filetree/Row.tsx:464"}),role:"treeitem","aria-label":w,"aria-level":(c?.depth??0)+1,onDoubleClick:e.pending?void 0:f,onContextMenu:V?t=>{V(t,{path:e.path,type:n.FileType.File})}:void 0,onKeyDown:e.pending?void 0:t=>{"Enter"===t.key&&m(e.path)},onClick:e.pending?void 0:e=>{e.currentTarget===e.target&&d(e)},children:[(0,t.jsxs)(k.View,{title:e.path,css:W.rowContent,onClick:e.pending?void 0:d,children:[(0,t.jsx)(k.View,{css:W.icon,children:(0,t.jsx)(H.default,{path:e.path})}),(0,t.jsx)(k.View,{css:W.text,children:w}),I?(0,t.jsx)(z,{text:I.text}):null,(0,t.jsx)(B,{path:e.path}),null]}),V?(0,t.jsx)(K,{onClick:t=>{V(t,{path:e.path,type:n.FileType.File})}}):null]})}),X=(0,r.memo)(function(e){let r=(0,a.useLayoutRow)(e.index);return(0,t.jsx)(k.View,{css:W.divider,style:r?.style,role:"treeitem",children:(0,t.jsx)(k.View,{css:W.dividerInner,children:(0,t.jsx)(k.View,{css:W.dividerText,children:e.label})})})}),J=(0,r.memo)(function(e){let r=(0,a.useLayoutRow)(e.index);return(0,t.jsxs)(k.View,{css:W.error,style:r?.style,role:"treeitem",children:[(0,t.jsx)(f.default,{}),(0,t.jsx)(G.Text,{multiline:!1,children:e.message})]})}),Q=(0,r.memo)(function(e){let r=(0,a.useLayoutRow)(e.index);return(0,t.jsx)(k.View,{css:W.emptyDir,style:r?.style,role:"treeitem",children:(0,t.jsx)(k.View,{css:W.emptyDirText,children:g.NO_FILES})})}),ee=(0,r.memo)(function(e){let r=(0,a.useLayoutRow)(e.index);return(0,t.jsx)(k.View,{css:W.createRow,style:r?.style,role:"treeitem",children:(0,t.jsx)(h.CreateFileNode,{dir:e.dir})})}),et=(0,r.memo)(function(e){let r=(0,a.useLayoutRow)(e.index),n=(0,p.getFileName)(e.path);return(0,t.jsx)(k.View,{style:r?.style,css:W.createRow,role:"treeitem","aria-label":n,children:(0,t.jsx)(w.RenameFileNode,{path:e.path,fileType:e.fileType})})}),er=(0,r.memo)(function(e){let r=(0,a.useLayoutRow)(e.index),n=(0,p.getFileName)(e.path);return(0,t.jsxs)(k.View,{style:r?.style,css:W.uploadRow,role:"treeitem","aria-label":n,children:[(0,t.jsx)(k.View,{css:W.icon,children:(0,t.jsx)(H.default,{path:e.path})}),(0,t.jsx)(k.View,{css:W.text,children:n}),(0,t.jsx)(y.ProgressCircle,{progress:e.progress})]})}),en=(0,r.memo)(function(e){let r=(0,a.useItemNode)(e.index);return r?"error"===r.type?(0,t.jsx)(J,{index:e.index,message:r.message}):"divider"===r.type?(0,t.jsx)(X,{index:e.index,label:r.label}):"emptyDir"===r.type?(0,t.jsx)(Q,{index:e.index}):"create"===r.type?(0,t.jsx)(ee,{index:e.index,dir:r.dir}):"uploadFile"===r.type?(0,t.jsx)(er,{index:e.index,path:r.path,progress:r.progress}):r.rename?(0,t.jsx)(et,{index:e.index,path:r.path,fileType:"file"===r.type?n.FileType.File:n.FileType.Directory}):"file"===r.type?(0,t.jsx)(Z,{index:e.index,path:r.path,pending:!!r.pending}):(0,t.jsx)(q,{index:e.index,path:r.path,pending:!!r.pending,uploadProgress:r.uploadProgress}):null}),ei=[F.styleTokens.horizontalPadding,F.styleTokens.rowLeftIndent,F.styleTokens.iconSize,F.styleTokens.iconTextGap].join(" + "),eo=(0,R.cssRecord)({root:[C.rcss.overflow("hidden"),C.rcss.height(0),{pointerEvents:"none"}],file:[{paddingLeft:`calc(${ei})`,paddingRight:F.styleTokens.horizontalPadding}]}),el=(0,r.memo)(function(){let e=(0,a.useWidestRows)();return e?(0,t.jsx)(k.View,{css:eo.root,children:e.map(({type:e,text:r,depth:n})=>{let i={[F.cssVars.rowLeftIndent]:`calc(${n} * ${F.styleTokens.gutterWidth})`},o=e+n;return"divider"===e?(0,t.jsx)(k.View,{style:i,css:W.dividerInner,children:(0,t.jsx)(G.Text,{css:W.dividerInner,multiline:!1,children:r.toUpperCase()})},o):(0,t.jsx)(k.View,{css:eo.file,style:i,children:"create"===e?(0,t.jsx)(h.CreateFilePicker,{create:()=>{}}):(0,t.jsx)(k.View,{css:W.text,children:r.toUpperCase()})},o)})}):null});var es=e.i(541793),ea=e.i(193060),eu=e.i(240913),ec=e.i(98816),ed=e.i(222342),ef=e.i(274445),ep=e.i(525544),eh=e.i(453955);let em=(0,R.cssRecord)({content:[C.rcss.position.relative,{overflowY:"auto",height:"100%",minHeight:F.styleTokens.minHeight}],scroll:[{position:"relative",height:F.styleTokens.scrollHeight}],gutter:[C.rcss.position.absolute,C.rcss.top(0),C.rcss.left(0),C.rcss.reset.button,C.rcss.align.end,C.rcss.cursor.pointer,{width:F.styleTokens.gutterWidth,"& > div":[C.rcss.height("100%"),C.rcss.highRes({borderLeftWidth:.5}),{borderLeft:"1px solid",marginRight:"25%",opacity:0,borderLeftColor:"transparent",transitionProperty:"border-color",transitionDuration:"0",transitionDelay:"0"}],"&:hover > div":{borderColor:P.tokens.outlineDimmest,transitionDuration:"200ms",transitionDelay:"100ms",opacity:1}}]}),eg=(0,r.memo)(function(e){let l,u,c=(0,a.useRenderedRows)(),d=(0,a.useContentContainer)();(0,o.useStyleSet)(e.scrollRef,d.fontSize,e=>({[F.cssVars.fontSize]:e+"px",[F.cssVars.dirStatusIconSize]:e+"px"})),(0,o.useStyleSet)(e.scrollRef,d.fontSizeSmall,e=>({[F.cssVars.fontSizeSmall]:e+"px"})),(0,o.useStyleSet)(e.scrollRef,d.iconSize,e=>({[F.cssVars.iconSize]:e+"px"})),(0,o.useStyleSet)(e.scrollRef,d.iconTextGap,e=>({[F.cssVars.iconTextGap]:e+"px"})),(0,o.useStyleSet)(e.scrollRef,d.horizontalPadding,e=>({[F.cssVars.horizontalPadding]:e+"px"})),(0,o.useStyleSet)(e.scrollRef,d.borderRadius,e=>({[F.cssVars.borderRadius]:e+"px"})),(0,o.useStyleSet)(e.scrollRef,d.scrollHeight,e=>({[F.cssVars.scrollHeight]:e+"px"})),(0,o.useStyleSet)(e.scrollRef,d.gutterWidth,e=>({[F.cssVars.gutterWidth]:e+"px"})),(0,o.useStyleSet)(e.scrollRef,d.minHeight,e=>({[F.cssVars.minHeight]:e+"px"}));let f=(0,a.useOnKeyDown)(),{dropRef:p,containerRef:h}=(0,s.useDropFile)(),m=(0,D.useSet)(x.clearNodeSelectionAtom),g=(0,D.useValue)(x.onContextMenuAtom),y=(0,D.useValue)(x.rootPathAtom);l=(0,D.useSet)(x.scrollToPathAtom),u=(0,D.useObservableValue)(x.selectedPathAnchorAtom),(0,r.useEffect)(()=>{function e(){u.current&&l(u.current)}return e(),u.subscribe(e)},[u,l]);let w=(0,i.useMergeRefs)([e.scrollRef,p,h],{breadcrumb:"client/workspace/components/Filetree/index.tsx:163"});return(0,t.jsxs)(k.View,{css:em.content,px:2,innerRef:w,translate:"no",onKeyDown:f,onContextMenu:g?e=>{e.target===e.currentTarget&&g(e,{type:n.FileType.Directory,path:y})}:void 0,onClick:e=>{e.target===e.currentTarget&&m()},children:[(0,t.jsx)(el,{}),(0,t.jsxs)(k.View,{css:em.scroll,role:"tree",children:[[...c.values()].map(({key:e,index:r})=>(0,t.jsx)(en,{index:r},e)),(0,t.jsx)(ew,{}),(0,t.jsx)(s.DropPreview,{}),(0,t.jsx)(s.DragLayer,{})]})]})}),ey=(0,r.memo)(function(){let{scrollRef:e}=(0,a.useVirtualizeRows)();return(0,l.useConfirmDeleteNodes)(),(0,u.useLocalCache)(),(0,t.jsx)(eg,{scrollRef:e})}),ew=(0,r.memo)(function(){let e=(0,a.useGutters)(),r=(0,a.useCollapse)();return(0,t.jsx)(t.Fragment,{children:e.map(e=>(0,t.jsx)(k.View,{tag:"button",onClick:()=>r(e.dir),css:em.gutter,style:{height:e.height,transform:`translate(calc(${e.depth} * ${F.styleTokens.gutterWidth}), ${e.y}px)`},children:(0,t.jsx)(k.View,{})},"gutter"+e.dir+e.depth+e.y))})});function ex(e){return function(e){let{showError:t}=(0,ed.default)(),[i]=(0,r.useState)(()=>{let r=(0,es.createStore)();r.set(x.configAtom,e);let i=e.root??eu.ROOT_PATH,o=e.localCacheKey?(0,u.getLocalCache)(e.localCacheKey):null;o&&r.set(x.initialOffsetAtom,o.scrollOffset);let s=o?.dirInfo??new Map;return s.has(i)||s.set(i,{expanded:!0}),r.set(x.dirInfoAtom,s),e.focusedPath&&r.set(x.focusedPathAtom,e.focusedPath),{store:r,create:function(e,t){if(t)return void r.set(x.startCreateFileAtom,{parentPath:t,fileType:e});let o=i,l=r.get(x.selectedNodeAnchorAtom);l?.type===n.FileType.File?o=(0,p.getParentPath)(l.path)||eu.ROOT_PATH:l?.type===n.FileType.Directory&&(o=l.path),r.set(x.startCreateFileAtom,{parentPath:o,fileType:e})},setPresenceState:function(e){r.set(x.presenceStateAtom,e)},setFileStatus:function(e){r.set(x.fileStatusAtom,e)},rename:function(e){r.set(x.renameAtom,e)},move:function(e){r.set(ep.moveFilesAtom,e)},upload:function(e){r.set(eh.uploadFilesAtom,{...e,onError:t})},onLoad:function(t){let r=e.fs.watchDir(i,{onChange:()=>{t({error:null}),r()},onError:e=>{t({error:e}),r()}});return r},select:function(e){return null===e?r.set(x.clearNodeSelectionAtom):r.set(x.loadAndSelectNodeAtom,e)},scrollToPath:function(e){return r.set(x.scrollToPathAtom,e)},hasLocalCache:!!o,getChildren:function(e){return r.get(x.dirInfoAtom).get(e)?.children??null},getSelectedNode:function(){return r.get(x.selectedNodeAnchorAtom)},getSelectedNodes:function(){return r.get(x.selectedNodesAtom)},deleteNodes:function(e){r.set(l.requestDeleteNodesAtom,e)},collapse:e=>r.set(x.collapseAtom,e),getExpandedDirs:e=>(0,ef.getExpandedDirs)(r.get(x.dirInfoAtom),e),expandParentDirsToPath:function(e){for(let t of(0,ea.splitFsPaths)(e).slice(0,-1))r.set(x.expandAtom,t)}}});(0,r.useEffect)(()=>{i.store.set(x.configAtom,e)},[i.store,e]),(0,r.useEffect)(()=>{for(let[e,t]of i.store.get(x.dirInfoAtom))t.expanded&&i.store.set(x.expandAtom,e);return()=>{for(let[e,t]of i.store.get(x.dirInfoAtom))t.disposeWatcher?.()}},[i.store]);let o=(0,ec.default)(e.onLoad);return(0,r.useEffect)(()=>i.onLoad(e=>o.current?.(e)),[i,o]),i}(e)}function ev(e){return(0,t.jsx)(D.StoreProvider,{store:e.store,children:(0,t.jsx)(ey,{})})}e.s(["Filetree",()=>ev,"useFiletree",()=>ex],160290)},144619,e=>{"use strict";var t=e.i(276385),r=e.i(389959),n=e.i(927600),i=e.i(205104),o=e.i(240913),l=e.i(903381),s=e.i(672963),a=e.i(529810),u=e.i(160290),c=e.i(518093),d=e.i(1736),f=e.i(967629),p=e.i(480028),h=e.i(446530),m=e.i(754873),g=e.i(123850),y=e.i(173703),w=e.i(613355),x=e.i(630818),v=e.i(399144),T=e.i(625484);function S({node:e}){return e.type===l.FileType.Directory?(0,t.jsx)(c.FolderIconComponent,{path:e.path,size:12}):(0,t.jsx)(x.default,{size:12,path:e.path})}let{cssVars:A,styleTokens:b}=(0,g.createCssVarTokens)(["menuY","menuX"]),D=(0,h.cssRecord)({root:[w.rcss.maxHeight(400),w.rcss.position.absolute,w.rcss.shadow(1),{border:"1px solid",borderColor:p.tokens.outlineDefault,top:b.menuY,left:b.menuX,"& > div":[w.rcss.maxHeight(400)]}]}),F=(0,f.css)([m.interactive.nofill,{transitionProperty:"background-color, box-shadow, opacity",opacity:.8,":focus":{zIndex:1,opacity:1}}]),P={button:(0,f.css)([w.rcss.reset.button,w.rcss.p(2),w.rcss.rowWithGap(4),w.rcss.align.center,F]),text:(0,f.css)({fontSize:p.tokens.fontSizeSmall})},R={opacity:1};function C(e){let{node:n,openFile:l,expandable:a=!0}=e,[u,c]=(0,r.useState)(!1),d=(0,r.useRef)(null),f=(0,s.default)(e=>{!u||e.target instanceof HTMLElement&&d.current?.contains(e.target)||c(!1)},[u]),p=(0,r.useId)(),h=(0,r.useId)(),m=(0,i.getParentPath)(n.path)||o.ROOT_PATH,g=(0,i.getFileName)(n.path);function w(){let e=d.current?.getBoundingClientRect();e&&a&&c({x:e.x+"px",y:e.y+e.height+4+"px"})}return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(T.View,{innerRef:d,tag:"button",id:p,style:u?R:void 0,"aria-haspopup":"true","aria-expanded":!!u,"aria-controls":h,css:P.button,onClick:()=>{a&&(u?c(!1):w())},onKeyDown:e=>{switch(e.key){case" ":case"Enter":case"ArrowDown":if(!a)return;w()}},children:[(0,t.jsx)(S,{node:n}),(0,t.jsx)(T.View,{css:P.text,children:g})]}),u&&a?(0,t.jsx)(v.Portal,{children:(0,t.jsx)(y.ShadesSurface,{id:h,css:D.root,innerRef:f,style:{[A.menuX]:u.x,[A.menuY]:u.y},onKeyDown:e=>{"Escape"===e.key&&(c(!1),d.current?.focus())},colorShade:"popup",br:"container",children:(0,t.jsx)(k,{openFile:l,parentPath:m,currentPath:n.path,readOnly:e.readOnly})})}):null]})}function k(e){let{fs:n}=(0,a.default)(),i=(0,d.useShouldHideFileInWorkspace)(!0),o=(0,r.useCallback)(e=>!i(e.filename),[i]),l=(0,u.useFiletree)({fs:n,filter:o,focusedPath:e.currentPath,fontSize:13,root:e.parentPath,manageWidth:!0,onFileSelect({path:t}){e.openFile(t)},alwaysShowCreateRow:!0,readOnly:e.readOnly});return(0,t.jsx)(u.Filetree,{store:l.store})}let O=(0,f.css)([w.rcss.flex.row,w.rcss.align.center,w.rcss.height("100%"),w.rcss.px(2)]),I=(0,r.memo)(function({path:e,onFileClick:i,expandable:o=!0,readOnly:s,children:a}){let u,c,d=(c=(u=e.split("/")).length,u.map((e,t)=>({type:t===c-1?l.FileType.File:l.FileType.Directory,path:u.slice(0,t+1).join("/")})));return(0,t.jsxs)(T.View,{css:O,children:[d.map(e=>(0,t.jsxs)(r.Fragment,{children:[(0,t.jsx)(C,{node:e,openFile:i,expandable:o,readOnly:s}),e.type===l.FileType.Directory?(0,t.jsx)(n.default,{size:12}):null]},CSS.escape(e.path))),a||null]})});e.s(["FileBreadcrumbs",0,I])},603237,e=>{"use strict";var t,r=e.i(205104),n=((t={}).Media="Media",t.Binary="Binary",t.Code="Code",t.Markdown="Markdown",t.Draw="Draw",t);function i(e){return(0,r.isMarkdownFile)(e)?"Markdown":(0,r.isDrawFile)(e)?"Draw":(0,r.isMedia)(e)?"Media":(0,r.isBinary)(e)?"Binary":"Code"}e.s(["FileViewerType",()=>n,"getFileViewerType",()=>i])}]);

//# debugId=2760e8f6-9ba8-8de0-458f-486e197b0849
//# sourceMappingURL=5e82002f33b7271f.js.map