;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="cfa16032-4eea-4c43-5e14-36fe1072159d")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,351981,745383,861644,e=>{"use strict";e.i(221042);var t=e.i(715463),i=e.i(940879),n=e.i(389959),s=e.i(971131);let a=n.default.createContext(null);e.s(["default",0,a],745383);var r=function(e){return e.scrollTop};e.s(["forceReflow",()=>r],861644);var o="unmounted",l="exited",d="entering",c="entered",u="exiting",p=function(e){function p(t,i){var n,s=e.call(this,t,i)||this,a=i&&!i.isMounting?t.enter:t.appear;return s.appearStatus=null,t.in?a?(n=l,s.appearStatus=d):n=c:n=t.unmountOnExit||t.mountOnEnter?o:l,s.state={status:n},s.nextCallback=null,s}(0,i.default)(p,e),p.getDerivedStateFromProps=function(e,t){return e.in&&t.status===o?{status:l}:null};var h=p.prototype;return h.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},h.componentDidUpdate=function(e){var t=null;if(e!==this.props){var i=this.state.status;this.props.in?i!==d&&i!==c&&(t=d):(i===d||i===c)&&(t=u)}this.updateStatus(!1,t)},h.componentWillUnmount=function(){this.cancelNextCallback()},h.getTimeouts=function(){var e,t,i,n=this.props.timeout;return e=t=i=n,null!=n&&"number"!=typeof n&&(e=n.exit,t=n.enter,i=void 0!==n.appear?n.appear:t),{exit:e,enter:t,appear:i}},h.updateStatus=function(e,t){if(void 0===e&&(e=!1),null!==t)if(this.cancelNextCallback(),t===d){if(this.props.unmountOnExit||this.props.mountOnEnter){var i=this.props.nodeRef?this.props.nodeRef.current:s.default.findDOMNode(this);i&&r(i)}this.performEnter(e)}else this.performExit();else this.props.unmountOnExit&&this.state.status===l&&this.setState({status:o})},h.performEnter=function(e){var t=this,i=this.props.enter,n=this.context?this.context.isMounting:e,a=this.props.nodeRef?[n]:[s.default.findDOMNode(this),n],r=a[0],o=a[1],l=this.getTimeouts(),u=n?l.appear:l.enter;(e||i)&&1?(this.props.onEnter(r,o),this.safeSetState({status:d},function(){t.props.onEntering(r,o),t.onTransitionEnd(u,function(){t.safeSetState({status:c},function(){t.props.onEntered(r,o)})})})):this.safeSetState({status:c},function(){t.props.onEntered(r)})},h.performExit=function(){var e=this,t=this.props.exit,i=this.getTimeouts(),n=this.props.nodeRef?void 0:s.default.findDOMNode(this);t?(this.props.onExit(n),this.safeSetState({status:u},function(){e.props.onExiting(n),e.onTransitionEnd(i.exit,function(){e.safeSetState({status:l},function(){e.props.onExited(n)})})})):this.safeSetState({status:l},function(){e.props.onExited(n)})},h.cancelNextCallback=function(){null!==this.nextCallback&&(this.nextCallback.cancel(),this.nextCallback=null)},h.safeSetState=function(e,t){t=this.setNextCallback(t),this.setState(e,t)},h.setNextCallback=function(e){var t=this,i=!0;return this.nextCallback=function(n){i&&(i=!1,t.nextCallback=null,e(n))},this.nextCallback.cancel=function(){i=!1},this.nextCallback},h.onTransitionEnd=function(e,t){this.setNextCallback(t);var i=this.props.nodeRef?this.props.nodeRef.current:s.default.findDOMNode(this),n=null==e&&!this.props.addEndListener;if(!i||n)return void setTimeout(this.nextCallback,0);if(this.props.addEndListener){var a=this.props.nodeRef?[this.nextCallback]:[i,this.nextCallback],r=a[0],o=a[1];this.props.addEndListener(r,o)}null!=e&&setTimeout(this.nextCallback,e)},h.render=function(){var e=this.state.status;if(e===o)return null;var i=this.props,s=i.children,r=(i.in,i.mountOnEnter,i.unmountOnExit,i.appear,i.enter,i.exit,i.timeout,i.addEndListener,i.onEnter,i.onEntering,i.onEntered,i.onExit,i.onExiting,i.onExited,i.nodeRef,(0,t.default)(i,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]));return n.default.createElement(a.Provider,{value:null},"function"==typeof s?s(e,r):n.default.cloneElement(n.default.Children.only(s),r))},p}(n.default.Component);function h(){}p.contextType=a,p.propTypes={},p.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:h,onEntering:h,onEntered:h,onExit:h,onExiting:h,onExited:h},p.UNMOUNTED=o,p.EXITED=l,p.ENTERING=d,p.ENTERED=c,p.EXITING=u,e.s(["ENTERED",()=>c,"ENTERING",()=>d,"EXITING",()=>u,"default",0,p],351981)},117807,e=>{"use strict";var t=e.i(82259),i=e.i(374106),n=e.i(986194),s=e.i(924908);e.i(925218);var a=e.i(641555);function r(){let e=(0,s.useMaybeChatter)(),t=e?.sessions.agent.all.list??null,i=(0,a.useObservableMemo)(()=>t?.map(e=>[...e].reverse()[0]),[t],{default:void 0}),n=(0,a.useObservableMemo)(()=>i?i.reduce(o,"global"):void 0,[i],{default:void 0}),r=(0,a.useObservableMemo)(()=>i?i.reduce(l,"global"):void 0,[i],{default:void 0}),d=n?.initialBuildTier;return e?n?.didUseInitialPlanning?{stackBlueprint:r?.stackBlueprint,initialBuildTier:d}:{stackBlueprint:n?.stackBlueprint,initialBuildTier:d}:{stackBlueprint:void 0,initialBuildTier:void 0}}let o={direction:"forward",state:{stackBlueprint:void 0,didUseInitialPlanning:void 0,initialBuildTier:void 0},reducer(e,s){if((0,i.isEventContentsKind)(e,"messageEventContents")&&e.sender.type===t.UserType.USER){let{contents:i}=e.contents,{agentConfig:a,requestedStackBlueprint:r}=(0,n.unkind)(i);return s.stackBlueprint=r,s.didUseInitialPlanning=a?.agentMode===t.AgentMode.AGENT_MODE_INITIAL_PLANNING,s.initialBuildTier=a?.agentInitialBuildTier,!1}}},l={direction:"reverse",state:{stackBlueprint:void 0,approvedPlanEventId:void 0},reducer(e,t){if((0,i.isEventContentsKind)(e,"agentPlanEventContents")){let{contents:i}=e,{requiresApproval:s,stackBlueprint:a}=(0,n.unkind)(i.contents);if(!s||e.id===t.approvedPlanEventId)return t.stackBlueprint=a,!1}if((0,i.isEventContentsKind)(e,"approvePlanEventContents")){let{contents:i}=e,{planEventId:s}=(0,n.unkind)(i.contents);t.approvedPlanEventId=s}}};e.s(["useAgentStackBlueprint",()=>r])},112942,e=>{"use strict";var t=e.i(368964),i=e.i(82259);e.i(660670);var n=e.i(806240);let s={maxSteps:0,initialBuildMode:i.AgentInitialBuildMode.AGENT_INITIAL_BUILD_MODE_UNSPECIFIED,samplingRate:0,agentInitialBuildTier:i.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_UNSPECIFIED,headlessMode:!1,workspaceLessMode:!1},a={[t.ModelProfile.ModelProfileUnspecified]:i.ModelProfile.MODEL_PROFILE_UNSPECIFIED,[t.ModelProfile.ModelProfileStandard]:i.ModelProfile.MODEL_PROFILE_STANDARD,[t.ModelProfile.ModelProfileAdvanced]:i.ModelProfile.MODEL_PROFILE_ADVANCED},r={[t.AgentChatMode.Unspecified]:i.AgentMode.AGENT_MODE_UNSPECIFIED,[t.AgentChatMode.General]:i.AgentMode.AGENT_MODE_GENERAL,[t.AgentChatMode.Discussion]:i.AgentMode.AGENT_MODE_DISCUSSION,[t.AgentChatMode.InitialPlanning]:i.AgentMode.AGENT_MODE_INITIAL_PLANNING,[t.AgentChatMode.QuickEdit]:i.AgentMode.AGENT_MODE_QUICK_EDIT},o={[t.AutonomyLevel.Unspecified]:i.AutonomyLevel.AUTONOMY_LEVEL_UNSPECIFIED,[t.AutonomyLevel.Low]:i.AutonomyLevel.AUTONOMY_LEVEL_LOW,[t.AutonomyLevel.Medium]:i.AutonomyLevel.AUTONOMY_LEVEL_MEDIUM,[t.AutonomyLevel.High]:i.AutonomyLevel.AUTONOMY_LEVEL_HIGH,[t.AutonomyLevel.Max]:i.AutonomyLevel.AUTONOMY_LEVEL_MAX},l={[i.AutonomyLevel.AUTONOMY_LEVEL_UNSPECIFIED]:t.AutonomyLevel.Unspecified,[i.AutonomyLevel.AUTONOMY_LEVEL_LOW]:t.AutonomyLevel.Low,[i.AutonomyLevel.AUTONOMY_LEVEL_MEDIUM]:t.AutonomyLevel.Medium,[i.AutonomyLevel.AUTONOMY_LEVEL_HIGH]:t.AutonomyLevel.High,[i.AutonomyLevel.AUTONOMY_LEVEL_MAX]:t.AutonomyLevel.Max},d={[i.AgentMode.AGENT_MODE_UNSPECIFIED]:t.AgentChatMode.Unspecified,[i.AgentMode.AGENT_MODE_GENERAL]:t.AgentChatMode.General,[i.AgentMode.AGENT_MODE_DISCUSSION]:t.AgentChatMode.Discussion,[i.AgentMode.AGENT_MODE_INITIAL_PLANNING]:t.AgentChatMode.InitialPlanning,[i.AgentMode.AGENT_MODE_QUICK_EDIT]:t.AgentChatMode.QuickEdit},c={[i.ModelProfile.MODEL_PROFILE_UNSPECIFIED]:t.ModelProfile.ModelProfileUnspecified,[i.ModelProfile.MODEL_PROFILE_STANDARD]:t.ModelProfile.ModelProfileStandard,[i.ModelProfile.MODEL_PROFILE_ADVANCED]:t.ModelProfile.ModelProfileAdvanced};function u({modelProfile:e,chatMode:t,autonomyLevel:i,enableAutomatedTesting:n,imageGenerationEnabled:l,webSearchEnabled:d,thinkingEnabled:c,maxAutonomyEnabled:p},h={}){let m=Object.fromEntries(Object.entries(h).filter(([e,t])=>void 0!==t));return{...s,enableAutomatedTesting:n,imageGenerationEnabled:l,webSearchEnabled:d,thinkingEnabled:c,maxAutonomyEnabled:p,modelProfile:a[e],agentMode:r[t],autonomyLevel:o[i],...m}}function p({agentMode:e,modelProfile:t,autonomyLevel:n,enableAutomatedTesting:s,imageGenerationEnabled:a,webSearchEnabled:r,thinkingEnabled:o,maxAutonomyEnabled:u}){return{samplingRate:0,modelProfile:c[t??i.ModelProfile.MODEL_PROFILE_UNSPECIFIED],chatMode:d[e??i.AgentMode.AGENT_MODE_GENERAL],autonomyLevel:l[n??i.AutonomyLevel.AUTONOMY_LEVEL_UNSPECIFIED],enableAutomatedTesting:s??!1,imageGenerationEnabled:a??!1,webSearchEnabled:r??!1,thinkingEnabled:o??!1,maxAutonomyEnabled:u??!1}}let h={[n.ModelProfile.UNSPECIFIED]:t.ModelProfile.ModelProfileUnspecified,[n.ModelProfile.STANDARD]:t.ModelProfile.ModelProfileStandard,[n.ModelProfile.ADVANCED]:t.ModelProfile.ModelProfileAdvanced},m={[n.AutonomyLevel.UNSPECIFIED]:t.AutonomyLevel.Unspecified,[n.AutonomyLevel.LOW]:t.AutonomyLevel.Low,[n.AutonomyLevel.MEDIUM]:t.AutonomyLevel.Medium,[n.AutonomyLevel.HIGH]:t.AutonomyLevel.High,[n.AutonomyLevel.MAX]:t.AutonomyLevel.Max},g={[n.AgentMode.UNSPECIFIED]:t.AgentChatMode.Unspecified,[n.AgentMode.GENERAL]:t.AgentChatMode.General,[n.AgentMode.DISCUSSION]:t.AgentChatMode.Discussion,[n.AgentMode.INITIAL_PLANNING]:t.AgentChatMode.InitialPlanning,[n.AgentMode.QUICK_EDIT]:t.AgentChatMode.QuickEdit},f={[t.ModelProfile.ModelProfileUnspecified]:n.ModelProfile.UNSPECIFIED,[t.ModelProfile.ModelProfileStandard]:n.ModelProfile.STANDARD,[t.ModelProfile.ModelProfileAdvanced]:n.ModelProfile.ADVANCED},x={[t.AutonomyLevel.Unspecified]:n.AutonomyLevel.UNSPECIFIED,[t.AutonomyLevel.Low]:n.AutonomyLevel.LOW,[t.AutonomyLevel.Medium]:n.AutonomyLevel.MEDIUM,[t.AutonomyLevel.High]:n.AutonomyLevel.HIGH,[t.AutonomyLevel.Max]:n.AutonomyLevel.MAX},T={[t.AgentChatMode.General]:n.AgentMode.GENERAL,[t.AgentChatMode.Discussion]:n.AgentMode.DISCUSSION,[t.AgentChatMode.InitialPlanning]:n.AgentMode.INITIAL_PLANNING,[t.AgentChatMode.QuickEdit]:n.AgentMode.QUICK_EDIT,[t.AgentChatMode.Unspecified]:n.AgentMode.UNSPECIFIED};function y({modelProfile:e,autonomyLevel:i,enableAutomatedTesting:n,imageGenerationEnabled:s,webSearchEnabled:a,thinkingEnabled:r,agentMode:o}){return{modelProfile:h[e],autonomyLevel:m[i],chatMode:void 0!==o?g[o]:t.AgentChatMode.General,enableAutomatedTesting:n,imageGenerationEnabled:s,webSearchEnabled:a,thinkingEnabled:r}}function E({modelProfile:e,autonomyLevel:t,enableAutomatedTesting:i,imageGenerationEnabled:n,webSearchEnabled:s,thinkingEnabled:a,chatMode:r}){return{modelProfile:f[e],autonomyLevel:x[t],enableAutomatedTesting:i,imageGenerationEnabled:n,webSearchEnabled:s,thinkingEnabled:a,agentMode:T[r]}}e.s(["autonomyLevelMapFromAiChatEnum",0,l,"autonomyLevelMapFromGQLEnum",0,o,"convertAgentConfigFromChortToGQL",()=>y,"convertAgentConfigFromGQLToChort",()=>E,"convertAgentSettingsFromAiChatToGQL",()=>p,"convertAgentSettingsFromGQLToAiChat",()=>u])},576255,e=>{"use strict";var t,i=e.i(634759),n=e.i(629536),s=((t={}).DISABLED="disabled",t.DEFAULT_ON="defaultOn",t.DEFAULT_OFF="defaultOff",t.DEFAULT_ON_AFTER_INITIAL_PROMPT="defaultOnAfterInitialPrompt",t);let a={[i.StackBlueprint.STACK_BLUEPRINT_FULLSTACK_JS]:"defaultOn",[i.StackBlueprint.STACK_BLUEPRINT_BEST_EFFORT_FALLBACK]:"defaultOn",[i.StackBlueprint.STACK_BLUEPRINT_STREAMLIT]:"defaultOn",[i.StackBlueprint.STACK_BLUEPRINT_EXPO]:"defaultOnAfterInitialPrompt",[i.StackBlueprint.STACK_BLUEPRINT_GAMESTACK_JS]:"disabled",[i.StackBlueprint.STACK_BLUEPRINT_AGENT]:"disabled"};function r(e){return e?a[e]??"defaultOff":"defaultOff"}function o(e){return{automatedTesting:r(e?(0,n.getStackBlueprintFromStackOption)(e):void 0)}}function l(e,t,i){let{automatedTesting:n}=i;if("disabled"!==n){if(!t)switch(n){case"defaultOnAfterInitialPrompt":return;case"defaultOn":return!0;default:return!1}return e}}e.s(["AutomatedTestingConfig",()=>s,"applyAutomatedTestingCapability",()=>l,"getAutomatedTestingConfig",()=>r,"getStackCapabilities",()=>o])},354093,e=>{"use strict";var t=e.i(276385),i=e.i(368964),n=e.i(116235),s=e.i(480028),a=e.i(674347),r=e.i(993796);let o=[{value:i.AutonomyLevel.Low,label:"Low",icon:(0,t.jsx)(function(e){return(0,t.jsxs)(n.default,{...e,children:[(0,t.jsx)("rect",{width:"2.25",height:"6",x:"4.875",y:"15",fill:s.tokens.foregroundDefault,rx:"1.125"}),(0,t.jsx)("rect",{width:"2.25",height:"12",x:"10.875",y:"9",fill:s.tokens.outlineDefault,rx:"1.125"}),(0,t.jsx)("rect",{width:"2.25",height:"18",x:"16.875",y:"3",fill:s.tokens.outlineDefault,rx:"1.125"})]})},{size:16})},{value:i.AutonomyLevel.Medium,label:"Medium",icon:(0,t.jsx)(function(e){return(0,t.jsxs)(n.default,{...e,children:[(0,t.jsx)("rect",{width:"2.25",height:"6",x:"4.875",y:"15",fill:s.tokens.foregroundDefault,rx:"1.125"}),(0,t.jsx)("rect",{width:"2.25",height:"12",x:"10.875",y:"9",fill:s.tokens.foregroundDefault,rx:"1.125"}),(0,t.jsx)("rect",{width:"2.25",height:"18",x:"16.875",y:"3",fill:s.tokens.outlineDefault,rx:"1.125"})]})},{size:16})},{value:i.AutonomyLevel.High,label:"High",icon:(0,t.jsx)(function(e){return(0,t.jsxs)(n.default,{...e,children:[(0,t.jsx)("rect",{width:"2.25",height:"6",x:"4.875",y:"15",fill:s.tokens.foregroundDefault,rx:"1.125"}),(0,t.jsx)("rect",{width:"2.25",height:"12",x:"10.875",y:"9",fill:s.tokens.foregroundDefault,rx:"1.125"}),(0,t.jsx)("rect",{width:"2.25",height:"18",x:"16.875",y:"3",fill:s.tokens.foregroundDefault,rx:"1.125"})]})},{size:16})},{value:i.AutonomyLevel.Max,label:"Max",icon:(0,t.jsx)(a.default,{size:16}),colorway:"orange"}];function l(e){return e===i.AutonomyLevel.Low}function d(){let e=(0,r.useFlag)({controlName:"flag-slider-be-gone",default:!1}),t=(0,r.useFlag)({controlName:"flag-axe-medium-autonomy",default:!1});return e?"switches":t?"slider-without-medium":"slider-full"}e.s(["AUTONOMY_LEVEL_OPTIONS",0,o,"isLevelCompatibleWithDesignMockup",()=>l,"useAutonomyControlVariant",()=>d],354093)},76961,e=>{"use strict";var t=e.i(973245),i=e.i(304277);e.i(566901);let n={},s=t.gql`
    query getWebDesignMockup($replId: String!) {
  getRepl(id: $replId) {
    ... on Repl {
      id
      config {
        isWebDesignMockup
      }
    }
  }
}
    `;var a=e.i(207237),r=e.i(423111);function o(){var e;let t,{data:o,loading:l}=(e={variables:{replId:(0,a.default)()}},t={...n,...e},i.useQuery(s,t)),d=o?.getRepl?.__typename==="Repl"&&(o.getRepl.config?.isWebDesignMockup??!1);return(0,r.useInProgressMockupToAppGraduation)()?{isWebDesignMockup:!0,loading:!0}:{isWebDesignMockup:d,loading:l}}e.s(["useIsAgentWebDesignMockup",()=>o],76961)},16499,e=>{"use strict";var t=e.i(541793),i=e.i(852819);let n=(0,t.atom)(null);function s(){return(0,i.useSet)(n)}function a(){return(0,i.useValue)(n)}e.s(["useAppKeyboardState",()=>a,"useSetAppKeyboardState",()=>s])},690821,e=>{"use strict";var t=e.i(276385),i=e.i(330666),n=e.i(183035),s=e.i(656077),a=e.i(927600),r=e.i(602686),o=e.i(480028),l=e.i(446530),d=e.i(123850),c=e.i(613355),u=e.i(140487),p=e.i(136540),h=e.i(960178),m=e.i(625484);let{cssVars:g,styleTokens:f}=(0,d.createCssVarTokens)(["padding","backgroundColor","borderColor"]),x=(0,l.cssRecord)({root:[c.rcss.position.relative,c.rcss.border({width:1,style:"solid",color:f.borderColor}),c.rcss.pb(12),c.rcss.borderRadius(8),c.rcss.shadow(2),c.rcss.flex.column,{padding:f.padding,backgroundColor:f.backgroundColor,gap:f.padding}],closeIconButton:[c.rcss.position.absolute,c.rcss.top(f.padding),c.rcss.right(f.padding)],dot:[c.rcss.borderRadius("full"),c.rcss.width(o.tokens.space8),c.rcss.height(o.tokens.space8)]});function T({title:e,subtitle:i,icon:l,content:d,containerStyle:c,colorway:f="primary",totalSteps:T=1,currentStepIndex:E=0,onDismiss:_,onCurrentStepChange:A,cypressCloseData:v,compact:w=!0,hideCloseButton:b=!1,hideNavigation:C=!1,doneText:S="Done",hideBorder:I=!1}){let k=!1===f?void 0:f,j=E>=T-1;return(0,t.jsxs)(m.View,{css:x.root,style:{[g.padding]:w?o.tokens.space8:o.tokens.space16,[g.backgroundColor]:k?o.colormap[k].dimmest:o.tokens.backgroundDefault,[g.borderColor]:k?o.colormap[k].dimmer:o.tokens.backgroundHighest,border:I?"none":void 0,paddingRight:e||b?void 0:o.tokens.space32,...c},children:[b?null:(0,t.jsx)(p.IconButton,{alt:"Close",colorway:k,css:x.closeIconButton,onClick:_,dataCy:v,children:(0,t.jsx)(r.default,{})}),e?(0,t.jsxs)(m.View,{row:!0,gap:8,align:"center",children:[l?(0,t.jsx)(l,{}):null,(0,t.jsxs)(m.View,{row:!0,gap:8,align:"end",children:[(0,t.jsx)(h.Text,{variant:"subheadDefault",multiline:!1,children:e}),i?(0,t.jsx)(h.Text,{variant:"text",color:"dimmest",multiline:!1,css:{transform:"translateY(1.5px)"},children:i}):null]})]}):null,(0,t.jsx)(m.View,{children:"function"==typeof d?(0,t.jsx)(d,{}):(0,t.jsx)(h.Text,{children:d})}),T>1&&A&&!C?(0,t.jsxs)(m.View,{row:!0,align:"center",justify:"space-between",children:[(0,t.jsx)(u.Button,{css:{visibility:E<=0?"hidden":void 0},colorway:k,text:"Back",iconLeft:(0,t.jsx)(s.default,{}),onClick:()=>A(E-1)}),(0,t.jsx)(y,{colorway:k,total:T,current:E}),(0,t.jsx)(u.Button,{"data-autofocus":!0,colorway:j?"primary":k,text:j?S:"Next",iconLeft:j?(0,t.jsx)(n.default,{}):(0,t.jsx)(a.default,{}),onClick:()=>j?_():A(E+1)})]}):null]})}function y({total:e,current:n,colorway:s}){return(0,t.jsxs)(m.View,{children:[(0,t.jsx)(i.VisuallyHidden,{children:(0,t.jsx)("progress",{value:n+1,max:e,"aria-label":"Step"})}),(0,t.jsx)(m.View,{"aria-hidden":!0,row:!0,gap:8,children:Array(e).fill(0).map((e,i)=>(0,t.jsx)(m.View,{style:{backgroundColor:i===n?s?o.colormap[s].stronger:o.tokens.foregroundDimmest:s?o.colormap[s].dimmer:o.tokens.outlineDimmest},css:x.dot},i))})]})}e.s(["Tour",()=>T])},253876,13736,e=>{"use strict";function t(e,t){if(e.classList)e.classList.add(t);else(e.classList?t&&e.classList.contains(t):-1!==(" "+(e.className.baseVal||e.className)+" ").indexOf(" "+t+" "))||("string"==typeof e.className?e.className=e.className+" "+t:e.setAttribute("class",(e.className&&e.className.baseVal||"")+" "+t))}function i(e,t){return e.replace(RegExp("(^|\\s)"+t+"(?:\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/^\s*|\s*$/g,"")}function n(e,t){e.classList?e.classList.remove(t):"string"==typeof e.className?e.className=i(e.className,t):e.setAttribute("class",i(e.className&&e.className.baseVal||"",t))}e.s(["default",()=>t],253876),e.s(["default",()=>n],13736)},401262,977268,e=>{"use strict";e.i(221042);var t,i,n=e.i(221453),s=e.i(715463),a=e.i(940879),r=e.i(253876),o=e.i(13736),l=e.i(389959),d=e.i(351981),c=e.i(861644),u=function(e,t){return e&&t&&t.split(" ").forEach(function(t){return(0,o.default)(e,t)})},p=function(e){function t(){for(var t,i=arguments.length,n=Array(i),s=0;s<i;s++)n[s]=arguments[s];return(t=e.call.apply(e,[this].concat(n))||this).appliedClasses={appear:{},enter:{},exit:{}},t.onEnter=function(e,i){var n=t.resolveArguments(e,i),s=n[0],a=n[1];t.removeClasses(s,"exit"),t.addClass(s,a?"appear":"enter","base"),t.props.onEnter&&t.props.onEnter(e,i)},t.onEntering=function(e,i){var n=t.resolveArguments(e,i),s=n[0],a=n[1];t.addClass(s,a?"appear":"enter","active"),t.props.onEntering&&t.props.onEntering(e,i)},t.onEntered=function(e,i){var n=t.resolveArguments(e,i),s=n[0],a=n[1]?"appear":"enter";t.removeClasses(s,a),t.addClass(s,a,"done"),t.props.onEntered&&t.props.onEntered(e,i)},t.onExit=function(e){var i=t.resolveArguments(e)[0];t.removeClasses(i,"appear"),t.removeClasses(i,"enter"),t.addClass(i,"exit","base"),t.props.onExit&&t.props.onExit(e)},t.onExiting=function(e){var i=t.resolveArguments(e)[0];t.addClass(i,"exit","active"),t.props.onExiting&&t.props.onExiting(e)},t.onExited=function(e){var i=t.resolveArguments(e)[0];t.removeClasses(i,"exit"),t.addClass(i,"exit","done"),t.props.onExited&&t.props.onExited(e)},t.resolveArguments=function(e,i){return t.props.nodeRef?[t.props.nodeRef.current,e]:[e,i]},t.getClassNames=function(e){var i=t.props.classNames,n="string"==typeof i,s=n&&i?i+"-":"",a=n?""+s+e:i[e],r=n?a+"-active":i[e+"Active"],o=n?a+"-done":i[e+"Done"];return{baseClassName:a,activeClassName:r,doneClassName:o}},t}(0,a.default)(t,e);var i=t.prototype;return i.addClass=function(e,t,i){var n,s=this.getClassNames(t)[i+"ClassName"],a=this.getClassNames("enter").doneClassName;"appear"===t&&"done"===i&&a&&(s+=" "+a),"active"===i&&e&&(0,c.forceReflow)(e),s&&(this.appliedClasses[t][i]=s,n=s,e&&n&&n.split(" ").forEach(function(t){return(0,r.default)(e,t)}))},i.removeClasses=function(e,t){var i=this.appliedClasses[t],n=i.base,s=i.active,a=i.done;this.appliedClasses[t]={},n&&u(e,n),s&&u(e,s),a&&u(e,a)},i.render=function(){var e=this.props,t=(e.classNames,(0,s.default)(e,["classNames"]));return l.default.createElement(d.default,(0,n.default)({},t,{onEnter:this.onEnter,onEntered:this.onEntered,onEntering:this.onEntering,onExit:this.onExit,onExiting:this.onExiting,onExited:this.onExited}))},t}(l.default.Component);p.defaultProps={classNames:""},p.propTypes={},e.s(["CSSTransition",0,p],401262);var h=e.i(745383),m="out-in",g="in-out",f=function(e,t,i){return function(){var n;e.props[t]&&(n=e.props)[t].apply(n,arguments),i()}},x=((t={})[m]=function(e){var t=e.current,i=e.changeState;return l.default.cloneElement(t,{in:!1,onExited:f(t,"onExited",function(){i(d.ENTERING,null)})})},t[g]=function(e){var t=e.current,i=e.changeState,n=e.children;return[t,l.default.cloneElement(n,{in:!0,onEntered:f(n,"onEntered",function(){i(d.ENTERING)})})]},t),T=((i={})[m]=function(e){var t=e.children,i=e.changeState;return l.default.cloneElement(t,{in:!0,onEntered:f(t,"onEntered",function(){i(d.ENTERED,l.default.cloneElement(t,{in:!0}))})})},i[g]=function(e){var t=e.current,i=e.children,n=e.changeState;return[l.default.cloneElement(t,{in:!1,onExited:f(t,"onExited",function(){n(d.ENTERED,l.default.cloneElement(i,{in:!0}))})}),l.default.cloneElement(i,{in:!0})]},i),y=function(e){function t(){for(var t,i=arguments.length,n=Array(i),s=0;s<i;s++)n[s]=arguments[s];return(t=e.call.apply(e,[this].concat(n))||this).state={status:d.ENTERED,current:null},t.appeared=!1,t.changeState=function(e,i){void 0===i&&(i=t.state.current),t.setState({status:e,current:i})},t}(0,a.default)(t,e);var i=t.prototype;return i.componentDidMount=function(){this.appeared=!0},t.getDerivedStateFromProps=function(e,t){var i,n;return null==e.children?{current:null}:t.status===d.ENTERING&&e.mode===g?{status:d.ENTERING}:t.current&&!((i=t.current)===(n=e.children)||l.default.isValidElement(i)&&l.default.isValidElement(n)&&null!=i.key&&i.key===n.key)&&1?{status:d.EXITING}:{current:l.default.cloneElement(e.children,{in:!0})}},i.render=function(){var e,t=this.props,i=t.children,n=t.mode,s=this.state,a=s.status,r=s.current,o={children:i,current:r,changeState:this.changeState,status:a};switch(a){case d.ENTERING:e=T[n](o);break;case d.EXITING:e=x[n](o);break;case d.ENTERED:e=r}return l.default.createElement(h.default.Provider,{value:{isMounting:!this.appeared}},e)},t}(l.default.Component);y.propTypes={},y.defaultProps={mode:m},e.s(["SwitchTransition",0,y],977268)},277257,e=>{"use strict";var t=e.i(276385),i=e.i(116235);function n(e){return(0,t.jsxs)(i.default,{...e,children:[(0,t.jsx)("path",{d:"M19 9.25a.75.75 0 0 1 .75.75v2a7.75 7.75 0 0 1-7 7.713V22a.75.75 0 0 1-1.5 0v-2.287a7.75 7.75 0 0 1-6.99-7.328L4.25 12v-2a.75.75 0 0 1 1.5 0v2l.008.31A6.25 6.25 0 0 0 12 18.25l.31-.008a6.249 6.249 0 0 0 5.932-5.932l.008-.31v-2a.75.75 0 0 1 .75-.75Z"}),(0,t.jsx)("path",{fillRule:"evenodd",d:"M12 1.25A3.75 3.75 0 0 1 15.75 5v7a3.75 3.75 0 1 1-7.5 0V5A3.75 3.75 0 0 1 12 1.25Zm0 1.5A2.25 2.25 0 0 0 9.75 5v7a2.25 2.25 0 0 0 4.5 0V5A2.25 2.25 0 0 0 12 2.75Z",clipRule:"evenodd"})]})}e.s(["default",()=>n])},39043,e=>{"use strict";var t=e.i(276385),i=e.i(116235);function n(e){return(0,t.jsx)(i.default,{...e,children:(0,t.jsx)("path",{d:"M1.25 6V4A2.75 2.75 0 0 1 4 1.25h2a.75.75 0 0 1 0 1.5H4A1.25 1.25 0 0 0 2.75 4v2a.75.75 0 0 1-1.5 0ZM21.25 6V4a1.25 1.25 0 0 0-1.126-1.244L20 2.75h-2a.75.75 0 0 1 0-1.5h2A2.75 2.75 0 0 1 22.75 4v2a.75.75 0 0 1-1.5 0ZM21.25 20v-2a.75.75 0 0 1 1.5 0v2A2.75 2.75 0 0 1 20 22.75h-2a.75.75 0 0 1 0-1.5h2A1.25 1.25 0 0 0 21.25 20ZM1.25 20v-2a.75.75 0 0 1 1.5 0v2l.006.124A1.25 1.25 0 0 0 4 21.25h2a.75.75 0 0 1 0 1.5H4A2.75 2.75 0 0 1 1.25 20ZM13 7.25a.75.75 0 0 1 0 1.5H6a.75.75 0 0 1 0-1.5h7ZM18 11.25a.75.75 0 0 1 0 1.5H6a.75.75 0 0 1 0-1.5h12ZM17 15.25a.75.75 0 0 1 0 1.5h-6a.75.75 0 0 1 0-1.5h6Z"})})}e.s(["default",()=>n])},741871,e=>{e.v({agentSettingsButton:"AgentSettingsDropdown-module__OrojEq__agentSettingsButton",autonomyLevelButton:"AgentSettingsDropdown-module__OrojEq__autonomyLevelButton",autonomyLevelButtonGroup:"AgentSettingsDropdown-module__OrojEq__autonomyLevelButtonGroup",autonomyLevelDescriptionText:"AgentSettingsDropdown-module__OrojEq__autonomyLevelDescriptionText",buildModeBadge:"AgentSettingsDropdown-module__OrojEq__buildModeBadge",buttonContainer:"AgentSettingsDropdown-module__OrojEq__buttonContainer",disabled:"AgentSettingsDropdown-module__OrojEq__disabled",fastBadge:"AgentSettingsDropdown-module__OrojEq__fastBadge",highPowerModelInfoCard:"AgentSettingsDropdown-module__OrojEq__highPowerModelInfoCard",highPowerModelInfoDismiss:"AgentSettingsDropdown-module__OrojEq__highPowerModelInfoDismiss",learnMoreLink:"AgentSettingsDropdown-module__OrojEq__learnMoreLink",maxAutonomy:"AgentSettingsDropdown-module__OrojEq__maxAutonomy",maxAutonomyLevelIndicator:"AgentSettingsDropdown-module__OrojEq__maxAutonomyLevelIndicator",maxOption:"AgentSettingsDropdown-module__OrojEq__maxOption",modeCard:"AgentSettingsDropdown-module__OrojEq__modeCard",modeCardItemContainer:"AgentSettingsDropdown-module__OrojEq__modeCardItemContainer",modeCards:"AgentSettingsDropdown-module__OrojEq__modeCards",option:"AgentSettingsDropdown-module__OrojEq__option",optionText:"AgentSettingsDropdown-module__OrojEq__optionText",otherViewButton:"AgentSettingsDropdown-module__OrojEq__otherViewButton",radioButton:"AgentSettingsDropdown-module__OrojEq__radioButton",root:"AgentSettingsDropdown-module__OrojEq__root",selected:"AgentSettingsDropdown-module__OrojEq__selected",upsellIcon:"AgentSettingsDropdown-module__OrojEq__upsellIcon",viewContent:"AgentSettingsDropdown-module__OrojEq__viewContent",viewEnter:"AgentSettingsDropdown-module__OrojEq__viewEnter",viewEnterActive:"AgentSettingsDropdown-module__OrojEq__viewEnterActive",viewExit:"AgentSettingsDropdown-module__OrojEq__viewExit",viewExitActive:"AgentSettingsDropdown-module__OrojEq__viewExitActive"})},801704,e=>{e.v({bold:"slashCommand-module__9-6L-a__bold",emptyState:"slashCommand-module__9-6L-a__emptyState",footer:"slashCommand-module__9-6L-a__footer",limitText:"slashCommand-module__9-6L-a__limitText",listBox:"slashCommand-module__9-6L-a__listBox",listBoxItem:"slashCommand-module__9-6L-a__listBoxItem",popover:"slashCommand-module__9-6L-a__popover",popoverContent:"slashCommand-module__9-6L-a__popoverContent",removeButton:"slashCommand-module__9-6L-a__removeButton",searchInput:"slashCommand-module__9-6L-a__searchInput",searchInputWrapper:"slashCommand-module__9-6L-a__searchInputWrapper",selectedConnector:"slashCommand-module__9-6L-a__selectedConnector","slide-fade-in":"slashCommand-module__9-6L-a__slide-fade-in"})},131614,6013,164410,656381,825423,257378,e=>{"use strict";var t=e.i(276385),i=e.i(389959),n=e.i(654647),s=e.i(401262),a=e.i(977268),r=e.i(368964),o=e.i(629536),l=e.i(39043),d=e.i(442966),c=e.i(731145),u=e.i(183035),p=e.i(656077),h=e.i(927600),m=e.i(486898),g=e.i(602686),f=e.i(659042),x=e.i(408143),T=e.i(495891),y=e.i(399245),E=e.i(493166),_=e.i(674347),A=e.i(995691),v=e.i(546833),w=e.i(596139),b=e.i(576255),C=e.i(993796),S=e.i(187505),I=e.i(858248),k=e.i(709485);e.i(653863);var j=e.i(973519),L=e.i(952521),M=e.i(117807),N=e.i(76961),D=e.i(354093),P=e.i(480028),R=e.i(907371),O=e.i(173703),U=e.i(585225),B=e.i(140487),F=e.i(721321),V=e.i(136540),G=e.i(604963),K=e.i(112767),H=e.i(960178),z=e.i(751273),W=e.i(625484),$=e.i(947108),q=e.i(741871);let Q=(0,P.cvarsFrom)("AgentSettingsDropdown.module.css",["--transition-duration"]);function Z({disabled:e,agentSettings:n,isOpen:s,onOpenChange:a,buttonText:l,fastModeDisabledReason:d,isFreemiumUserV1RestrictedToFastMode:c=!1,isFreeUserRestrictedToLowAutonomy:u=!1}){let p=(0,U.useIsShadesSupported)(),h=(0,i.useRef)(null),{handleAutonomyLevelChange:g,isLoading:f}=function(e){let{isLoading:t,isDone:n,setAsDone:s}=(0,L.useMemoedDismissibleElement)("max-autonomy-warning-acknowledged"),a=(0,j.useGlobalModal)();return{handleAutonomyLevelChange:(0,i.useCallback)(t=>{t!==r.AutonomyLevel.Max||n?e.updateSettings({autonomyLevel:t,chatMode:r.AgentChatMode.General}):a.show("MaxAutonomyWarningModal",{onConfirm:()=>{s(),e.updateSettings({autonomyLevel:t})}})},[n,a,s,e]),isLoading:t||e.loading}}(n),{autonomyLevel:x,chatMode:y,modelProfile:E}=n.settings,_=y===r.AgentChatMode.QuickEdit,{isWebDesignMockup:A}=(0,N.useIsAgentWebDesignMockup)(),v=(0,C.useFlag)({controlName:"flag-quick-edit-use-experimental-anthropic-client",default:!1}),w=(0,D.useAutonomyControlVariant)(),S=(0,C.useFlag)({controlName:"flag-killswitch-highpower"}),R=(0,C.useFlag)({controlName:"flag-high-power-model-rollout",default:!1}),{stackBlueprint:O}=(0,M.useAgentStackBlueprint)(),F=(0,b.getAutomatedTestingConfig)(O)===b.AutomatedTestingConfig.DISABLED||A;return(0,i.useEffect)(()=>{E===r.ModelProfile.ModelProfileAdvanced&&S&&n.updateSettings({modelProfile:r.ModelProfile.ModelProfileStandard})},[E,n.updateSettings,S,n]),(0,t.jsxs)(G.PopoverTrigger,{isOpen:s,onOpenChange:e=>{a(e),e&&(0,I.track)(k.events.AGENT_MODEL_SELECTOR_SETTINGS_OPENED)},label:`${o.AGENT_NAME} Tools`,placement:"top start",buttonRef:h,children:[i=>(0,t.jsxs)(W.View,{clsx:q.default.buttonContainer,children:[l?(0,t.jsx)(B.Button,{...i,text:l,disabled:e,size:"small",clsx:q.default.agentSettingsButton,variant:"nofill",iconLeft:(0,t.jsx)(T.default,{})}):(0,t.jsx)(V.IconButton,{...i,alt:"Agent Tools",disabled:e,tooltipContents:"Agent Tools",tooltipPlacement:"top",size:24,clsx:q.default.agentSettingsButton,children:(0,t.jsx)(T.default,{})}),_||x!==r.AutonomyLevel.Max?null:(0,t.jsx)(m.default,{size:8,color:P.tokens.orangeDefault,clsx:q.default.maxAutonomyLevelIndicator})]}),(0,t.jsx)(Y,{settings:n.settings,updateSetting:(e,t,i)=>{let s=i??Object.values(t)[0];return(0,I.track)(k.events.AGENT_MODEL_SELECTOR_SETTING_TOGGLED,{setting:e,enabled:s}),n.updateSettings(t)},autonomyControlVariant:w,autonomousModeDescription:"slider-full"===w?`Control ${o.AGENT_NAME}'s level of autonomy`:`Use ${o.AGENT_NAME}'s full capabilities`,isShadesSupported:p,hasFlagFreeQuickEdits:v,fastModeDisabledReason:d,isFreemiumUserRestrictedToFastMode:c,isFreeUserRestrictedToLowAutonomy:u,isAppTestingUnavailable:F,isHighPowerModelUnavailable:S||_,isHighPowerModelToggleHidden:R,isFastModeEnabled:_,isWebDesignMockup:A,isLoading:f,onAutonomyLevelChange:g})]})}function X({isShadesSupported:e,children:i}){return e?(0,t.jsx)(O.ShadesSurface,{colorShade:"popup",elevate:"1x",p:8,gap:8,clsx:q.default.root,style:{[Q.transitionDuration]:"180ms"},children:i}):(0,t.jsx)(O.ShadesSurface,{p:8,gap:8,clsx:q.default.root,style:{[Q.transitionDuration]:"180ms"},children:i})}function Y({settings:e,updateSetting:n,autonomyControlVariant:r,isShadesSupported:l=!0,hasFlagFreeQuickEdits:d,fastModeDisabledReason:c,isFreemiumUserRestrictedToFastMode:u,isFreeUserRestrictedToLowAutonomy:p,isAppTestingUnavailable:m,isHighPowerModelUnavailable:g,isHighPowerModelToggleHidden:f,isFastModeEnabled:x,fastModeDescription:T,autonomousModeDescription:y,isWebDesignMockup:E,isLoading:_,onAutonomyLevelChange:A}){var v,w;let b,[S,I]=(0,i.useState)("main"),k=(0,i.useRef)(null),j=(0,C.useFlag)({controlName:"flag-james-cameron"}),L=(v=e,w=j,b=[],v.webSearchEnabled&&b.push("Web search"),v.imageGenerationEnabled&&b.push(w?"Media generation":"Image generation"),b.join(", ")),M=!u,N=(0,t.jsxs)(W.View,{row:!0,align:"center",gap:8,p:4,clsx:q.default.otherViewButton,justify:"space-between",onClick:()=>I("other"),children:[(0,t.jsx)(H.Text,{color:"default",children:"Other"}),(0,t.jsxs)(W.View,{row:!0,align:"center",gap:4,shrink:!0,children:[L?(0,t.jsx)(H.Text,{color:"dimmer",showTooltipOnTruncate:!0,multiline:!1,style:{flexShrink:1},children:L}):null,(0,t.jsx)(h.default,{color:P.tokens.foregroundDimmer,size:16})]})]});return(0,t.jsxs)(X,{isShadesSupported:l,children:[(0,t.jsx)(W.View,{row:!0,align:"center",gap:8,justify:"start",children:(0,t.jsxs)(H.Text,{variant:"small",color:"dimmer",children:[o.AGENT_NAME," Tools"]})}),(0,t.jsx)(a.SwitchTransition,{children:(0,t.jsx)(s.CSSTransition,{timeout:180,nodeRef:k,classNames:{enter:q.default.viewEnter,enterActive:q.default.viewEnterActive,exit:q.default.viewExit,exitActive:q.default.viewExitActive},children:(0,t.jsxs)(W.View,{innerRef:k,clsx:q.default.viewContent,grow:!0,shrink:!0,"data-view":S,children:["main"===S?(0,t.jsxs)(W.View,{grow:!0,gap:8*!!M,children:[(0,t.jsx)(J,{settings:e,updateSetting:n,autonomyControlVariant:r,isShadesSupported:l,hasFlagFreeQuickEdits:d,fastModeDisabledReason:c,isAppTestingUnavailable:m,isFreemiumUserRestrictedToFastMode:u,isFreeUserRestrictedToLowAutonomy:p,isFastModeEnabled:x,fastModeDescription:T,autonomousModeDescription:y,isWebDesignMockup:E,isLoading:_,onAutonomyLevelChange:A,isHighPowerModelUnavailable:g,isHighPowerModelToggleHidden:f}),M?N:null]}):null,"other"===S?(0,t.jsx)(eo,{settings:e,updateSetting:n,hasVideoTool:j,handleBack:()=>I("main")}):null]})},S)})]})}function J({settings:e,updateSetting:s,autonomyControlVariant:a,isShadesSupported:l,hasFlagFreeQuickEdits:d,isFastModeEnabled:c,fastModeDescription:u="Make lightweight changes, quickly",autonomousModeDescription:p=`Control ${o.AGENT_NAME}'s level of autonomy`,fastModeDisabledReason:h,isAppTestingUnavailable:m,isFreemiumUserRestrictedToFastMode:g,isFreeUserRestrictedToLowAutonomy:f,isWebDesignMockup:x,isLoading:T,onAutonomyLevelChange:y,isHighPowerModelUnavailable:E,isHighPowerModelToggleHidden:A}){let{trackClick:v}=(0,S.useTrackClick)(),{show:b}=(0,j.useGlobalModal)(),C=!c,I=(0,i.useCallback)(async e=>{if(!T){if(e===r.AgentChatMode.General&&g)return void await b("UpgradeEducationModal",{context:"agent_workspace_autonomous_mode_upsell",surface:"agent_chat",highlightedFeature:"autonomousBuildMode"});s("agent_chat_mode",{chatMode:e}),v({target:e===r.AgentChatMode.QuickEdit?"build_mode_fast_option":"build_mode_autonomous_option",productArea:"agent"})}},[T,g,b,s,v]),k=(0,i.useMemo)(()=>{let e=new Set;return T&&(e.add(r.AgentChatMode.QuickEdit),e.add(r.AgentChatMode.General)),h&&e.add(r.AgentChatMode.QuickEdit),e},[T,h]),L=(0,i.useCallback)(async e=>{g?await b("UpgradeEducationModal",{context:"agent_workspace_autonomous_mode_upsell",surface:"agent_chat",highlightedFeature:"autonomousBuildMode"}):y(e)},[g,b,y]);return(0,t.jsx)(W.View,{gap:8,children:(0,t.jsxs)(n.ListBox,{"aria-label":"Agent mode",selectionMode:"single",selectedKeys:new Set([c?r.AgentChatMode.QuickEdit:r.AgentChatMode.General]),clsx:q.default.modeCards,disabledKeys:k,onSelectionChange:e=>{let[t]=Array.from(e);t&&I(t)},children:[(0,t.jsx)(es,{mode:r.AgentChatMode.QuickEdit,isSelected:c,isDisabled:T||!!h,isShadesSupported:l,disabledTooltip:h,children:(0,t.jsx)(W.View,{px:8,py:10,gap:4,children:(0,t.jsxs)(W.View,{row:!0,align:"start",justify:"space-between",gap:8,children:[(0,t.jsxs)(W.View,{row:!0,align:"start",gap:8,children:[(0,t.jsx)(W.View,{clsx:q.default.radioButton,"data-selected":c,style:{color:P.tokens.accentPrimaryDefault}}),(0,t.jsxs)(W.View,{gap:4,children:[(0,t.jsx)(H.Text,{color:"default",children:"Fast"}),(0,t.jsx)(H.Text,{variant:"small",color:"dimmer",children:u}),d&&!h?(0,t.jsx)(H.Text,{variant:"small",color:"dimmest",children:"(Free for a limited time)"}):null]})]}),(0,t.jsx)(ee,{enabled:c})]})})}),(0,t.jsx)(es,{mode:r.AgentChatMode.General,isSelected:C,isDisabled:T,isShadesSupported:l,children:(0,t.jsxs)(W.View,{px:8,py:10,gap:8,children:[(0,t.jsxs)(W.View,{row:!0,align:"start",justify:"space-between",gap:8,children:[(0,t.jsxs)(W.View,{row:!0,align:"start",gap:8,children:[(0,t.jsx)(W.View,{clsx:q.default.radioButton,"data-selected":C,style:{color:P.tokens.accentPrimaryDefault}}),(0,t.jsxs)(W.View,{gap:4,children:[(0,t.jsxs)(W.View,{row:!0,align:"center",gap:4,children:[(0,t.jsx)(H.Text,{color:"default",children:"Autonomous"}),g&&!f?(0,t.jsx)($.default,{plan:w.corePlanName,size:"small",variant:"icon-text"}):null]}),(0,t.jsx)(H.Text,{variant:"small",color:"dimmer",children:p})]})]}),(0,t.jsx)(O.ShadesSurface,{p:4,clsx:q.default.buildModeBadge,style:{backgroundColor:C?P.tokens.backgroundHighest:"transparent"},elevate:!1,children:(0,t.jsx)(_.default,{size:16,color:P.tokens.foregroundDimmest})})]}),"slider-full"===a?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(W.View,{gap:4,children:[(0,t.jsx)(ed,{autonomyLevel:e.autonomyLevel,isDisabled:T||f,isActive:C,isWebDesignMockup:!!x,onChange:L}),x?(0,t.jsx)(H.Text,{variant:"small",color:"dimmest",children:"Convert your Design to an App to unlock more autonomy."}):(0,t.jsx)(ec,{autonomyLevel:e.autonomyLevel,hasMediumOption:!0})]}),(0,t.jsx)(ei,{isEnabled:e.enableAutomatedTesting,isUnavailable:m,isFastModeEnabled:c,isWebDesignMockup:x,handleChange:e=>s("agent_automated_testing_enabled",{enableAutomatedTesting:e})})]}):null,"switches"===a?(0,t.jsxs)(W.View,{gap:4,pl:24,children:[(0,t.jsx)(et,{isEnabled:!c&&(e.autonomyLevel===r.AutonomyLevel.High||e.autonomyLevel===r.AutonomyLevel.Max),isFastModeEnabled:c,handleChange:e=>s("agent_autonomy_level",{autonomyLevel:e?r.AutonomyLevel.High:r.AutonomyLevel.Low})}),(0,t.jsx)(H.Text,{variant:"small",color:"dimmest",children:"Review code changes and fixes issues found"}),(0,t.jsx)(ei,{isEnabled:e.enableAutomatedTesting,isUnavailable:m,isFastModeEnabled:c,isWebDesignMockup:x,handleChange:e=>s("agent_automated_testing_enabled",{enableAutomatedTesting:e})}),(0,t.jsx)(H.Text,{variant:"small",color:"dimmest",children:"Simulate user interactions to validate functionality"}),(0,t.jsx)(en,{isEnabled:!c&&e.autonomyLevel===r.AutonomyLevel.Max,isFastModeEnabled:c,handleChange:e=>y(e?r.AutonomyLevel.Max:r.AutonomyLevel.High)}),(0,t.jsx)(H.Text,{variant:"small",color:"dimmest",children:"Plans and completes new work independently"})]}):null,"slider-without-medium"===a?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(W.View,{gap:4,children:[(0,t.jsx)(ed,{autonomyLevel:e.autonomyLevel,hasMediumOption:!1,isDisabled:T||g||f,isActive:C,isWebDesignMockup:!!x,onChange:y}),x?(0,t.jsx)(H.Text,{variant:"small",color:"dimmest",children:"Convert your Design to an App to unlock more autonomy."}):(0,t.jsx)(ec,{autonomyLevel:e.autonomyLevel,hasMediumOption:!1})]}),(0,t.jsx)(ei,{isEnabled:e.enableAutomatedTesting,isUnavailable:m,isFastModeEnabled:c,isWebDesignMockup:x,handleChange:e=>s("agent_automated_testing_enabled",{enableAutomatedTesting:e})})]}):null,A?null:(0,t.jsx)(ea,{settings:e,updateSetting:s,isFastModeEnabled:c,isWebDesignMockup:x,isHighPowerModelUnavailable:E})]})})]})})}function ee({enabled:e}){return(0,U.useIsShadesSupported)()?(0,t.jsx)(O.ShadesSurface,{p:4,elevate:!!e&&"1x",colorShade:e?"warning":void 0,clsx:q.default.buildModeBadge,children:e?(0,t.jsx)(c.default,{size:16}):(0,t.jsx)(d.default,{size:16})}):(0,t.jsx)(O.ShadesSurface,{p:4,clsx:[q.default.buildModeBadge,q.default.fastBadge,{[q.default.selected]:e}],elevate:!1,children:e?(0,t.jsx)(c.default,{size:16}):(0,t.jsx)(d.default,{size:16})})}function et({isEnabled:e,isFastModeEnabled:i,handleChange:n}){let s;return i&&(s="Unavailable in Fast"),(0,t.jsxs)(W.View,{row:!0,align:"center",justify:"space-between",gap:8,children:[(0,t.jsxs)(W.View,{row:!0,align:"center",gap:8,grow:!0,children:[(0,t.jsx)(l.default,{size:16,color:P.tokens.foregroundDimmer}),(0,t.jsx)(H.Text,{children:"Code review"})]}),(0,t.jsx)(z.Tooltip,{tooltip:(0,t.jsx)(H.Text,{variant:"small",children:s}),isDisabled:!s,children:(0,t.jsx)(K.Switch,{isSelected:e,isDisabled:i,"aria-label":"Code review",onChange:n})})]})}function ei({isEnabled:e,isUnavailable:i,isFastModeEnabled:n,handleChange:s,isWebDesignMockup:a}){let r;return a&&(r="Unavailable in Design"),(0,t.jsxs)(W.View,{row:!0,align:"center",justify:"space-between",gap:8,children:[(0,t.jsxs)(W.View,{row:!0,align:"center",gap:8,grow:!0,children:[(0,t.jsx)(x.default,{size:16,color:P.tokens.foregroundDimmer}),(0,t.jsx)(H.Text,{children:"App testing"})]}),(0,t.jsx)(z.Tooltip,{tooltip:(0,t.jsx)(H.Text,{variant:"small",children:r}),isDisabled:!r,children:(0,t.jsx)(K.Switch,{isSelected:!i&&e,isDisabled:i||(n??!1),"aria-label":"App testing",onChange:s})})]})}function en({isEnabled:e,isFastModeEnabled:i,handleChange:n}){let s;i&&(s="Unavailable in Fast");let a=i?P.tokens.foregroundDimmer:P.tokens.orangeStronger;return(0,t.jsxs)(W.View,{row:!0,align:"center",justify:"space-between",gap:8,children:[(0,t.jsxs)(W.View,{row:!0,align:"center",gap:8,grow:!0,children:[(0,t.jsx)(_.default,{size:16,color:a}),(0,t.jsx)(H.Text,{style:{color:a},children:"Max autonomy"})]}),(0,t.jsx)(z.Tooltip,{tooltip:(0,t.jsx)(H.Text,{variant:"small",children:s}),isDisabled:!s,children:(0,t.jsx)(K.Switch,{isSelected:e,isDisabled:i,"aria-label":"Max autonomy",onChange:n,colorway:"orange"})})]})}function es({isShadesSupported:e,mode:i,isSelected:s,isDisabled:a,disabledTooltip:o,children:l}){let d=i===r.AgentChatMode.QuickEdit,c=(0,R.useCreateInteractive)({variant:"filledAndOutlined"}),u=e?(0,t.jsx)(O.ShadesSurface,{clsx:[v.shades.button("halfElevated")],"aria-disabled":a,colorShade:"default",elevate:"1x",br:8,border:a?"subtle":"regular",children:l}):(0,t.jsx)(O.ShadesSurface,{clsx:[c.clsx,q.default.modeCard,{[q.default.selected]:s,[q.default.disabled]:a}],style:c.style,elevate:!!s&&"1x",children:l});return(0,t.jsx)(n.ListBoxItem,{clsx:q.default.modeCardItemContainer,id:i,textValue:d?"Fast":"Autonomous",isDisabled:a,children:a&&o?(0,t.jsx)(z.Tooltip,{tooltip:(0,t.jsx)(H.Text,{variant:"small",children:o}),children:u}):u},i)}function ea({settings:e,updateSetting:i,isFastModeEnabled:n,isWebDesignMockup:s,isHighPowerModelUnavailable:a}){let o=e.modelProfile===r.ModelProfile.ModelProfileAdvanced,l=s||a||n,d=()=>s?"Unavailable in Design":n?"Unavailable in Fast":a?"Temporarily unavailable, please try again later":void 0;return(0,t.jsxs)(W.View,{row:!0,align:"center",justify:"space-between",gap:8,children:[(0,t.jsxs)(W.View,{row:!0,align:"center",gap:8,grow:!0,shrink:!0,children:[(0,t.jsx)(f.default,{size:16,color:P.tokens.foregroundDimmer}),(0,t.jsxs)(W.View,{grow:!0,shrink:!0,children:[(0,t.jsxs)(W.View,{row:!0,align:"center",gap:4,children:[(0,t.jsx)(H.Text,{color:"default",children:"High power model"}),(0,t.jsx)(eu,{disabledTooltipContent:d()})]}),(0,t.jsxs)(H.Text,{variant:"small",color:"dimmest",children:["Claude Opus 4.5 (",(0,t.jsx)("a",{href:"https://docs.replit.com/replitai/dynamic-intelligence#high-power-mode",target:"_blank",rel:"noreferrer noopener",clsx:q.default.learnMoreLink,children:"Learn more"}),")"]})]})]}),(0,t.jsx)(z.Tooltip,{tooltip:(0,t.jsx)(H.Text,{variant:"small",children:d()}),isDisabled:!l,children:(0,t.jsx)(K.Switch,{isSelected:o,isDisabled:l,"aria-label":"High power model",onChange:e=>{a||i("agent_high_power_models",{modelProfile:e?r.ModelProfile.ModelProfileAdvanced:r.ModelProfile.ModelProfileStandard},e)}})})]})}function er(){let e=(0,C.useFlag)({controlName:"flag-high-power-toggle-sunset-notice",default:!1}),{isLoading:i,isDone:n,setAsDone:s}=(0,L.useMemoedDismissibleElement)("agent-high-power-model-toggle-info");return!e||i||n?null:(0,t.jsx)(W.View,{clsx:q.default.highPowerModelInfoCard,children:(0,t.jsxs)(W.View,{row:!0,align:"start",gap:4,children:[(0,t.jsx)(f.default,{size:16,color:P.tokens.foregroundDimmer}),(0,t.jsxs)(W.View,{grow:!0,shrink:!0,gap:4,children:[(0,t.jsx)(H.Text,{variant:"small",color:"dimmer",children:"Looking for High Power Model?"}),(0,t.jsx)(H.Text,{variant:"small",color:"dimmest",children:"Agent now automatically leverages high power models wherever relevant, no longer requiring a manual toggle"})]}),(0,t.jsx)(V.IconButton,{alt:"Dismiss",size:24,onClick:s,clsx:q.default.highPowerModelInfoDismiss,children:(0,t.jsx)(g.default,{size:16,color:P.tokens.foregroundDimmest})})]})})}function eo({settings:e,updateSetting:i,hasVideoTool:n,handleBack:s}){let a=(0,t.jsx)(el,{icon:(0,t.jsx)(y.default,{}),title:"Web search",description:"Searches across the internet",control:(0,t.jsx)(K.Switch,{isSelected:e.webSearchEnabled,onChange:e=>i("agent_web_search_enabled",{webSearchEnabled:e}),"aria-label":"Web search"})}),r=(0,t.jsx)(el,{icon:(0,t.jsx)(E.default,{}),title:n?"Media generation":"Image generation",description:n?"Generates images and video with AI":"Generates images with AI",control:(0,t.jsx)(K.Switch,{isSelected:e.imageGenerationEnabled,onChange:e=>i("agent_image_generation_enabled",{imageGenerationEnabled:e}),"aria-label":n?"Media generation":"Image generation"})});return(0,t.jsxs)(W.View,{grow:!0,gap:8,children:[(0,t.jsxs)(W.View,{gap:8,children:[a,r]}),(0,t.jsx)(er,{}),(0,t.jsx)(W.View,{row:!0,align:"center",justify:"start",children:(0,t.jsx)(B.Button,{text:"Back",size:"small",onClick:s,iconLeft:(0,t.jsx)(p.default,{size:16})})})]})}function el({icon:e,title:n,titleJustify:s,description:a,control:r,disabled:o,tag:l,row:d=!0}){return(0,t.jsxs)(W.View,{row:!0,gap:8,clsx:[q.default.option,{[q.default.disabled]:o}],children:[(0,t.jsx)(W.View,{pt:3,children:(0,i.cloneElement)(e,{color:P.tokens.foregroundDimmest})}),(0,t.jsxs)(W.View,{row:d,align:d?"start":void 0,justify:"space-between",gap:8,grow:!0,shrink:!0,children:[(0,t.jsxs)(W.View,{grow:!0,shrink:!0,children:[(0,t.jsxs)(W.View,{row:!0,align:"center",gap:8,justify:s,children:[(0,t.jsx)(H.Text,{color:"default",children:n}),l||null]}),a?(0,t.jsx)(H.Text,{variant:"small",color:"dimmest",clsx:q.default.optionText,textWrap:"pretty",children:a}):null]}),r]})]})}function ed({autonomyLevel:e,hasMediumOption:i=!0,isDisabled:n,isActive:s=!0,isWebDesignMockup:a,onChange:o}){let l=i?D.AUTONOMY_LEVEL_OPTIONS:D.AUTONOMY_LEVEL_OPTIONS.filter(e=>e.value!==r.AutonomyLevel.Medium);return(0,t.jsx)(F.ButtonGroup,{name:"agent-autonomy-level",value:e,onChange:o,disabled:n,row:!0,stretch:!0,clsx:[q.default.autonomyLevelButtonGroup,{[q.default.disabled]:n,[q.default.active]:s}],children:l.map(i=>{let o=n||a&&!(0,D.isLevelCompatibleWithDesignMockup)(i.value),l=e===i.value,d=i.value===r.AutonomyLevel.Max;return(0,t.jsx)(F.ButtonGroupItem,{id:`agent-autonomy-level-${i.value}`,value:i.value,text:(0,t.jsx)(H.Text,{color:o?"dimmest":l?"default":"dimmer",children:i.label}),colorway:s?d?"orange":"blue":void 0,checked:l,disabled:o,clsx:[q.default.autonomyLevelButton,{[q.default.selected]:l,[q.default.maxOption]:d,[q.default.active]:s}]},i.value)})})}function ec({autonomyLevel:e,hasMediumOption:i=!0}){let n=e===r.AutonomyLevel.Max,s=n||e===r.AutonomyLevel.High,a=s||e===r.AutonomyLevel.Medium,o=a||e===r.AutonomyLevel.Low;return(0,t.jsxs)(W.View,{gap:4,children:[(0,t.jsxs)(H.Text,{clsx:[q.default.autonomyLevelDescriptionText,{[q.default.maxAutonomy]:n}],variant:"small",color:"dimmest",children:[e===r.AutonomyLevel.Low?"Iterative, human-in-the-loop building experience":null,e===r.AutonomyLevel.Medium?"Scoped, semi-autonomous building experience":null,e===r.AutonomyLevel.High?"Recommended building experience":null,e===r.AutonomyLevel.Max?"Long-running, hands-off building experience":null]}),(0,t.jsxs)(W.View,{row:!0,align:"center",gap:4,children:[o?(0,t.jsx)(u.default,{size:16}):(0,t.jsx)(g.default,{color:P.tokens.foregroundDimmest,size:16}),(0,t.jsx)(H.Text,{variant:"small",color:o?"default":"dimmest",children:"Generates and executes on task lists"})]}),i?(0,t.jsxs)(W.View,{row:!0,align:"center",gap:4,children:[a?(0,t.jsx)(u.default,{size:16}):(0,t.jsx)(g.default,{color:P.tokens.foregroundDimmest,size:16}),(0,t.jsx)(H.Text,{variant:"small",color:a?"default":"dimmest",children:"Reviews latest code changes and fixes issues found"})]}):null,(0,t.jsxs)(W.View,{row:!0,align:"center",gap:4,children:[s?(0,t.jsx)(u.default,{size:16}):(0,t.jsx)(g.default,{color:P.tokens.foregroundDimmest,size:16}),(0,t.jsx)(H.Text,{variant:"small",color:s?"default":"dimmest",children:i?"Expands review scope to entire app":"Reviews code changes and fixes issues found"})]}),(0,t.jsxs)(W.View,{row:!0,align:"center",gap:4,children:[n?(0,t.jsx)(u.default,{size:16}):(0,t.jsx)(g.default,{color:P.tokens.foregroundDimmest,size:16}),(0,t.jsx)(H.Text,{variant:"small",color:n?"default":"dimmest",children:"Plans and completes new work independently"})]})]})}function eu({disabledTooltipContent:e}){return e?(0,t.jsx)(z.Tooltip,{tooltip:(0,t.jsx)(H.Text,{variant:"small",children:e}),children:(0,t.jsx)(O.ShadesSurface,{p:4,clsx:q.default.upsellIcon,children:(0,t.jsx)(A.default,{color:P.tokens.foregroundDimmer,size:12})})}):null}e.s(["AgentSettingsDropdown",()=>Z,"AgentSettingsDropdownContent",()=>Y],131614);var ep=e.i(185296),eh=e.i(341190),em=e.i(415756),eg=e.i(753950),ef=e.i(179302);function ex(e){return ef.keymap.of([{key:"Backspace",run:t=>{let{state:i}=t,n=i.selection.main.head;for(let s of e(i.doc))if(n===s.to)return t.dispatch({changes:{from:s.from,to:s.to,insert:""},selection:{anchor:s.from}}),!0;return!1}},{key:"Delete",run:t=>{let{state:i}=t,n=i.selection.main.head;for(let s of e(i.doc))if(n===s.from)return t.dispatch({changes:{from:s.from,to:s.to,insert:""},selection:{anchor:s.from}}),!0;return!1}},{key:"Mod-Backspace",mac:"Alt-Backspace",run:t=>{let{state:i}=t,n=i.selection.main.head,s=e(i.doc),a=null;for(let e of s)e.to<=n&&(!a||e.to>a.to)&&(a=e);if(a){let e=i.doc.sliceString(a.to,n);return!/\w/.test(e)&&(t.dispatch({changes:{from:a.from,to:n,insert:""},selection:{anchor:a.from}}),!0)}return!1}},{key:"Mod-Delete",mac:"Alt-Delete",run:t=>{let{state:i}=t,n=i.selection.main.head,s=e(i.doc),a=null;for(let e of s)e.from>=n&&(!a||e.from<a.from)&&(a=e);if(a){let e=i.doc.sliceString(n,a.from);return!/\w/.test(e)&&(t.dispatch({changes:{from:n,to:a.to,insert:""},selection:{anchor:n}}),!0)}return!1}},{key:"ArrowLeft",run:t=>{let{state:i}=t,n=i.selection.main.head;for(let s of e(i.doc))if(n===s.to)return t.dispatch({selection:{anchor:s.from}}),!0;return!1}},{key:"ArrowRight",run:t=>{let{state:i}=t,n=i.selection.main.head;for(let s of e(i.doc))if(n===s.from)return t.dispatch({selection:{anchor:s.to}}),!0;return!1}}])}e.s(["createAtomicRangeKeymap",()=>ex],6013);var eT=e.i(928353),ey=e.i(752007),eE=e.i(827529),e_=e.i(870496),eA=e.i(951884),ev=e.i(346781),ew=e.i(815900),eb=e.i(882793),eC=e.i(58261),eS=e.i(968783),eI=e.i(973245),ek=e.i(755078),ej=e.i(304277);e.i(566901);let eL={},eM=eI.gql`
    query IsModelfarmEnabled($orgId: String!) {
  currentUser {
    id
    org(orgId: $orgId) {
      ... on Org {
        id
        settings {
          ... on OrgSettings {
            ...OrgAppSettingsData
          }
        }
      }
    }
  }
}
    ${ek.OrgAppSettingsDataFragmentDoc}`;function eN(){var e;let t,{orgId:i}=(0,eS.useCurrentUserStoredOrgContext)(),{data:n,loading:s,error:a}=(e={skip:!i,variables:{orgId:i??""}},t={...eL,...e},ej.useQuery(eM,t)),r="on"===(0,C.useFlag)({controlName:"flag-modelfarm-openrouter-blueprint",type:"string",default:"off"}),o="on"===(0,C.useFlag)({controlName:"flag-modelfarm-openai-blueprint",type:"string",default:"on"}),l="on"===(0,C.useFlag)({controlName:"flag-modelfarm-gemini-blueprint",type:"string",default:"off"}),d="on"===(0,C.useFlag)({controlName:"flag-modelfarm-anthropic-blueprint",type:"string",default:"off"});if(s||a)return{modelfarm:!1,openrouter:!1,openai:!1,anthropic:!1,gemini:!1};if(!i)return{modelfarm:!0,openrouter:r,openai:o,anthropic:d,gemini:l};let c=n?.currentUser?.org,u=c?.__typename==="Org"?c.settings:void 0,p=u?.__typename==="OrgSettings"&&u.modelfarmDisabled,h=u?.__typename==="OrgSettings"&&u.openrouterDisabled,m=u?.__typename==="OrgSettings"&&u.openaiDisabled,g=u?.__typename==="OrgSettings"&&u.anthropicDisabled,f=u?.__typename==="OrgSettings"&&u.geminiDisabled;return{modelfarm:!p,openrouter:r&&!h,openai:o&&!m,anthropic:d&&!g,gemini:l&&!f}}e.s(["useIsModelfarmEnabled",()=>eN],164410);var eD=e.i(441329),eP=e.i(443394),eR=e.i(607278),eO=e.i(624782),eU=e.i(801704);let eB=[{id:"blueprint-openai",displayName:"OpenAI",type:"blueprint"},{id:"blueprint-gemini",displayName:"Google Gemini",type:"blueprint"},{id:"blueprint-anthropic",displayName:"Anthropic",type:"blueprint"},{id:"blueprint-openrouter",displayName:"OpenRouter",type:"blueprint"}],eF=(e,i)=>{if("blueprint"===e.type)switch(e.id){case"blueprint-openai":return(0,t.jsx)(e_.default,{size:i});case"blueprint-gemini":return(0,t.jsx)(eE.default,{size:i});case"blueprint-anthropic":return(0,t.jsx)(ey.default,{size:i});case"blueprint-openrouter":return(0,t.jsx)(eA.default,{size:i});default:return null}return"iconPath"in e&&e.iconPath?(0,t.jsx)(ep.default,{src:e.iconPath,alt:e.displayName,width:i,height:i}):null},eV=(e,t)=>{"blueprint"===e.type?(0,I.track)(k.events.SLASH_COMMAND,{type:"modelfarm",action:t,displayName:e.displayName}):"blueprint"!==e.type&&(0,I.track)(k.events.SLASH_COMMAND,{type:"integration",action:t,connectorName:e.connectorName,connectorType:e.connectorType,displayName:e.displayName})};function eG(e){return"blueprint"!==e.type&&"connectorName"in e&&null!==e.connectorName&&void 0!==e.connectorName&&eb.MCP_CONNECTORS.has(e.connectorName)}function eK(e){return eG(e)?`${e.displayName} (MCP)`:e.displayName}let eH=({onSelect:e,onCancel:s,onCancelWithSpace:a,isEditingExisting:r=!1})=>{let{slashCommandConnectorItems:o,isSubscribed:l}=(0,eC.useConnectorContext)(),{orgId:d}=(0,eS.useCurrentUserStoredOrgContext)(),c=!!d,{show:u}=(0,j.useGlobalModal)(),p=(0,eP.getCurrentUrl)(),[h,m]=(0,i.useState)(""),g=(0,i.useRef)(null),f=(0,i.useRef)(null),x=eN(),T=(0,C.useFlag)({controlName:"flag-slash-ai",default:!1}),y=(0,C.useFlag)({controlName:"flag-free-plan",default:!1}),E=(0,i.useMemo)(()=>x.modelfarm&&T?eB.filter(e=>{switch(e.id){case"blueprint-openai":return x.openai;case"blueprint-gemini":return x.gemini;case"blueprint-anthropic":return x.anthropic;case"blueprint-openrouter":return x.openrouter;default:return!1}}):[],[x,T]),_=(0,i.useMemo)(()=>[...[...E].sort((e,t)=>e.displayName.localeCompare(t.displayName)),...[...o].sort((e,t)=>e.displayName.localeCompare(t.displayName))],[E,o]);(0,i.useEffect)(()=>{g.current&&g.current.focus()},[]);let A=(0,i.useMemo)(()=>new em.Fzf(_,{fuzzy:!1,selector:e=>e.displayName.toLowerCase()}),[_]),v=(0,i.useMemo)(()=>h?A.find(h.toLowerCase()).map(e=>e.item):_,[A,h,_]),b=(0,i.useMemo)(()=>[...v.filter(e=>"blueprint"===e.type),...v.filter(e=>"blueprint"!==e.type)],[v]),S=b[0]?.id??"",I=b.find(e=>"blueprint"!==e.type)?.id;return 0===_.length?null:(0,t.jsxs)(W.View,{className:eU.default.popover,children:[(0,t.jsxs)(W.View,{className:eU.default.popoverContent,children:[(0,t.jsx)(W.View,{p:8,children:(0,t.jsx)(eR.DecoratedInput,{ref:g,placeholder:"Search",value:h,onChange:e=>m(e.target.value),onKeyDown:t=>{if("Escape"===t.key){t.preventDefault(),s?.(h);return}if(("Backspace"===t.key||"Delete"===t.key)&&""===h)return void s?.(h);if(" "===t.key&&""===h&&!r){t.preventDefault(),a?.();return}if("ArrowDown"===t.key){t.preventDefault();let e=f.current?.querySelector('[role="option"]');e&&e.focus()}if("Enter"===t.key)if(t.preventDefault(),v.length>0){let t=v[0],i="blueprint"===t.type;if(!l&&!c&&!i){s?.(h),y?u("UpgradeEducationModal",{context:"agent_chat_slash_command",highlightedFeature:"connectors"}):u("MembershipPurchaseModal",{headingText:`Connect ${t.displayName}`,subHeadingText:`Upgrade to ${w.corePlanName} to use integrations and unlock the full power of Replit Agent.`,analyticsContext:{upgrade:{context:"agent_chat_slash_command"}},redirectPath:p});return}eV(t,"selected"),e(t)}else h&&s?.(h)},className:eU.default.searchInputWrapper,inputClassName:eU.default.searchInput,iconLeft:(0,t.jsx)(ev.default,{size:12})})}),(0,t.jsx)("div",{ref:f,role:"presentation",onKeyDown:e=>{if("Escape"===e.key&&(e.preventDefault(),s?.(h)),"ArrowUp"===e.key){let t=f.current?.querySelector('[role="option"]');if(t&&document.activeElement===t){e.preventDefault(),g.current?.focus();return}}("ArrowUp"===e.key||"ArrowDown"===e.key)&&e.preventDefault()},children:(0,t.jsx)(n.ListBox,{"aria-label":"Integrations",className:eU.default.listBox,items:b,selectionMode:"single",onSelectionChange:t=>{if("all"===t)return;let i=Array.from(t)[0];if(!i)return;let n=_.find(e=>e.id===i);if(n){eV(n,"selected");let t="blueprint"===n.type;if(!l&&!c&&!t){s?.(h),y?u("UpgradeEducationModal",{context:"agent_chat_slash_command",highlightedFeature:"connectors"}):u("MembershipPurchaseModal",{headingText:`Connect ${n.displayName}`,subHeadingText:`Upgrade to ${w.corePlanName} to use integrations and unlock the full power of Replit Agent.`,analyticsContext:{upgrade:{context:"agent_chat_slash_command"}},redirectPath:p});return}e(n)}},renderEmptyState:()=>(0,t.jsx)("div",{className:eU.default.emptyState,children:(0,t.jsx)(H.Text,{variant:"small",color:"dimmer",children:"No matching integrations"})}),children:e=>(0,t.jsxs)(t.Fragment,{children:[e.id===I?(0,t.jsx)(eh.Header,{children:(0,t.jsxs)(W.View,{row:!0,justify:"space-between",align:"center",pt:8,pl:8,pb:4,children:[(0,t.jsx)(H.Text,{color:"dimmer",className:eU.default.bold,variant:"small",children:"Connectors"}),l||c?null:(0,t.jsx)($.default,{plan:w.corePlanName,size:"small"})]})}):null,(0,t.jsxs)(n.ListBoxItem,{id:e.id,textValue:e.displayName,className:eU.default.listBoxItem,children:[(0,t.jsxs)(W.View,{row:!0,gap:8,align:"center",children:[eF(e,20),(0,t.jsx)(H.Text,{variant:"small",children:e.displayName}),eG(e)?(0,t.jsx)(z.Tooltip,{tooltip:"This is an MCP Server that Agent can use to access external data and tools while working.",children:(0,t.jsx)(eO.Pill,{text:"MCP",variant:"muted",compact:!0,colorway:"grey"})}):null]}),e.id===S&&l?(0,t.jsx)(H.Text,{variant:"small",color:"dimmest",children:"Enter"}):null]})]})},S)})]}),(0,t.jsx)(W.View,{className:eU.default.footer,onClick:()=>s?.(h),role:"button",tabIndex:0,onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),s?.(h))},children:(0,t.jsxs)(W.View,{row:!0,gap:4,justify:"space-between",align:"center",children:[(0,t.jsx)(H.Text,{className:eU.default.limitText,variant:"small",color:"dimmer",children:r?"Close":h?`Type '/${h}' on page`:"Type '/' on page"}),(0,t.jsx)(H.Text,{variant:"small",color:"dimmest",children:"esc"})]})})]})},ez=({item:e,onSelect:n,onRemove:s})=>{let[a,r]=(0,i.useState)(!1);return(0,t.jsxs)(G.PopoverTrigger,{isOpen:a,onOpenChange:r,label:"Select connector",children:[i=>(0,t.jsx)(B.BaseButton,{clsx:eU.default.selectedConnector,...i,onPress:()=>{i.onClick()},children:(0,t.jsxs)(W.View,{row:!0,gap:4,align:"center",children:[eF(e,16),(0,t.jsx)(H.Text,{variant:"small",children:e.displayName}),(0,t.jsx)("span",{className:eU.default.removeButton,onClick:t=>{t.stopPropagation(),s(),eV(e,"cancelled")},role:"button",tabIndex:0,"aria-label":"Remove",onKeyDown:t=>{("Enter"===t.key||" "===t.key)&&(t.preventDefault(),t.stopPropagation(),s(),eV(e,"cancelled"))},children:(0,t.jsx)(g.default,{size:12})})]})}),(0,t.jsx)(W.View,{p:0,children:(0,t.jsx)(eH,{onSelect:e=>{r(!1),n(e)},onCancel:e=>{r(!1)},isEditingExisting:!0})})]})},eW=({connectorId:e,onSelect:n,onRemove:s})=>{let{slashCommandConnectorItems:a}=(0,eC.useConnectorContext)(),r=eN(),o=(0,i.useMemo)(()=>{let t=[...r.modelfarm?eB.filter(e=>{switch(e.id){case"blueprint-openai":return r.openai;case"blueprint-gemini":return r.gemini;case"blueprint-anthropic":return r.anthropic;case"blueprint-openrouter":return r.openrouter;default:return!1}}):[],...a].find(t=>t.id===e);return t||{id:e,displayName:"Select an integration",type:"blueprint"}},[e,r,a]);return(0,t.jsx)(ez,{item:o,onSelect:n,onRemove:s})};class e$ extends ef.WidgetType{connectorId;view;from;to;constructor(e,t,i,n){super(),this.connectorId=e,this.view=t,this.from=i,this.to=n}eq(e){return e instanceof e$&&e.connectorId===this.connectorId&&e.from===this.from&&e.to===this.to}toDOM(){let e=document.createElement("span");e.setAttribute("aria-hidden","true"),e.style.display="inline-flex",e.style.verticalAlign="middle",e.style.lineHeight="1",e.style.userSelect="none",e.style.pointerEvents="auto";let i=(0,eT.createCodeMirrorElement)((0,t.jsx)(eW,{connectorId:this.connectorId,onSelect:e=>{let t=eK(e),i="blueprint"===e.type?`{{"replit-type": "blueprint", "name": ${JSON.stringify(t)}}}`:`{{"replit-type": "connector", "id": ${JSON.stringify(e.id)}, "name": ${JSON.stringify(t)}}}`;this.view.dispatch({changes:{from:this.from,to:this.to,insert:i},selection:eg.EditorSelection.cursor(this.from+i.length)}),window.requestAnimationFrame(()=>{this.view.focus()})},onRemove:()=>{let e=this.to<this.view.state.doc.length&&" "===this.view.state.doc.sliceString(this.to,this.to+1)?this.to+1:this.to;this.view.dispatch({changes:{from:this.from,to:e,insert:""}}),window.requestAnimationFrame(()=>{this.view.focus()})}}));return e.appendChild(i),e}ignoreEvent(){return!1}}let eq=new ef.MatchDecorator({regexp:/\{\{[\s\S]*?"replit-type"\s*:\s*"(connector|blueprint)"[\s\S]*?\}\}/g,decorate:(e,t,i,n,s)=>{try{let a,r=n[0],o=n[1];if("connector"===o){let e=r.match(ew.connectorIdJsonRegex);if(!e)return;a=e[1]}else{let e=r.match(ew.blueprintNameJsonRegex);if(!e)return;let t=e[1],i=eB.find(e=>e.displayName===t);if(!i)return;a=i.id}e(t,i,ef.Decoration.replace({widget:new e$(a,s,t,i)}))}catch(e){}}}),eQ=eg.StateEffect.define(),eZ=eg.StateField.define({create:()=>null,update(e,t){for(let e of t.effects)if(e.is(eQ))return e.value;return t.docChanged?null:e},provide:e=>ef.showTooltip.from(e)}),eX=ef.ViewPlugin.fromClass(class{view;showMenuTimeout;constructor(e){this.view=e,this.showMenuTimeout=null}destroy(){this.showMenuTimeout&&(clearTimeout(this.showMenuTimeout),this.showMenuTimeout=null)}clearPendingShow(){this.showMenuTimeout&&(clearTimeout(this.showMenuTimeout),this.showMenuTimeout=null)}update(e){if(e.docChanged){let{state:t}=e,i=!1,n=-1;if(e.changes.iterChanges((e,t,s,a,r)=>{1===r.length&&"/"===r.sliceString(0,1)&&(i=!0,n=s)}),i){let e=n>0?t.doc.sliceString(n-1,n):"";(0===n||" "===e||"\n"===e||"	"===e)&&(this.clearPendingShow(),this.showMenuTimeout=setTimeout(()=>{this.showMenuTimeout=null,this.showMenu()},200))}else this.clearPendingShow(),Promise.resolve().then(()=>this.removeMenu())}e.selectionSet&&this.view.state.field(eZ)&&(this.clearPendingShow(),Promise.resolve().then(()=>this.removeMenu()))}showMenu(){let{state:e}=this.view,i=e.selection.main.head,n=(0,eD.isInBonsaiWebviewWindow)();this.view.dispatch({effects:eQ.of({pos:i,above:n,strictSide:n,create:e=>({dom:(0,eT.createCodeMirrorElement)((0,t.jsx)(eH,{onSelect:e=>{this.replaceSlashWithConnector(e),this.view.dispatch({effects:eQ.of(null)}),window.requestAnimationFrame(()=>{this.view.focus()})},onCancel:e=>{e&&this.insertTextAtSlash(e),this.view.dispatch({effects:eQ.of(null)}),window.requestAnimationFrame(()=>{this.view.focus()})},onCancelWithSpace:()=>{this.addSpace(),this.view.dispatch({effects:eQ.of(null)}),window.requestAnimationFrame(()=>{this.view.focus()})}}))})})})}replaceSlashWithConnector(e){let{state:t,dispatch:i}=this.view,n=t.selection.main.head,s=eK(e),a="blueprint"===e.type?`{{"replit-type": "blueprint", "name": ${JSON.stringify(s)}}}`:`{{"replit-type": "connector", "id": ${JSON.stringify(e.id)}, "name": ${JSON.stringify(s)}}}`;i(t.update({changes:{from:n-1,to:n,insert:a+" "},selection:eg.EditorSelection.cursor(n-1+a.length+1)}))}insertTextAtSlash(e){let{state:t,dispatch:i}=this.view,n=t.selection.main.head;i(t.update({changes:{from:n,to:n,insert:e},selection:eg.EditorSelection.cursor(n+e.length)}))}addSpace(){let{state:e,dispatch:t}=this.view,i=e.selection.main.head;t(e.update({changes:{from:i,to:i,insert:" "},selection:eg.EditorSelection.cursor(i+1)}))}removeMenu(){let{dispatch:e}=this.view;e({effects:eQ.of(null)})}}),eY=ef.ViewPlugin.fromClass(class{decorations;constructor(e){this.decorations=eq.createDeco(e)}update(e){this.decorations=eq.updateDeco(e,this.decorations)}},{decorations:e=>e.decorations,provide:e=>ef.EditorView.atomicRanges.of(t=>t.plugin(e)?.decorations||ef.Decoration.none)}),eJ=ex(function(e){let t=[],i=e.toString();for(let e of i.matchAll(ew.connectorRegex))void 0!==e.index&&t.push({from:e.index,to:e.index+e[0].length});for(let e of i.matchAll(ew.blueprintRegex))void 0!==e.index&&t.push({from:e.index,to:e.index+e[0].length});return t.sort((e,t)=>e.from-t.from),t}),e0=ef.keymap.of([{key:"Escape",run:e=>!!e.state.field(eZ)&&(e.dispatch({effects:[eQ.of(null)]}),!0)}]),e1=[eZ,eX,eY,eJ,e0];e.s(["slashCommandExtension",0,e1],656381);let e2=ef.EditorView.contentAttributes.of({autocapitalize:"on"});e.s(["autocapitalizeExtension",0,e2],825423);let e5=ef.EditorView.contentAttributes.of({autocorrect:"on"});e.s(["autocorrectExtension",0,e5],257378)},112801,e=>{e.v({container:"FigmaUrlInput-module__dzOMQW__container",mediumFont:"FigmaUrlInput-module__dzOMQW__mediumFont"})},56641,e=>{e.v({animatedContainer:"FigmaUrlInputAnimated-module__1iGfba__animatedContainer","smooth-slide-down-and-fade-in":"FigmaUrlInputAnimated-module__1iGfba__smooth-slide-down-and-fade-in"})},564416,600572,e=>{"use strict";var t=e.i(276385),i=e.i(750854),n=e.i(389959),s=e.i(830675),a=e.i(460029),r=e.i(488566),o=e.i(753950),l=e.i(179302),d=e.i(266159),c=e.i(893255),u=e.i(210736),p=e.i(555970),h=e.i(738705),m=e.i(684481),g=e.i(221250),f=e.i(248327),x=e.i(966684),T=e.i(945698),y=e.i(442234),E=e.i(342965),_=e.i(703613),A=e.i(786962),v=e.i(993796),w=e.i(650587),b=e.i(98816),C=e.i(343252),S=e.i(441329),I=e.i(703774);let k=l.keymap.of([{key:"Shift-Enter",run:r.insertNewlineAndIndent,shift:r.insertNewlineAndIndent},{key:"ArrowDown",run:(0,a.moveCompletionSelection)(!0)},{key:"ArrowUp",run:(0,a.moveCompletionSelection)(!1)},{key:"PageDown",run:(0,a.moveCompletionSelection)(!0,"page")},{key:"PageUp",run:(0,a.moveCompletionSelection)(!1,"page")},{key:"Enter",run:a.acceptCompletion},{key:"Mod-z",run:r.undo,preventDefault:!0},{key:"Mod-y",run:r.redo,preventDefault:!0},{key:"Mod-Shift-z",run:r.redo,preventDefault:!0}]),j=l.keymap.of([{key:"Enter",run:r.insertNewlineAndIndent,shift:r.insertNewlineAndIndent}]),L=l.EditorView.domEventHandlers({drop:e=>!!e.dataTransfer?.files.length&&(e.preventDefault(),!0)}),M=(0,n.forwardRef)(function({elementRef:e,initialDoc:a,fontSize:r,readOnly:M,extensions:N,initializing:D,loading:P,onException:R,...O},U){let[B,F]=(0,n.useState)(null),[V,G]=(0,n.useState)(null),K=(0,n.useRef)(a),[H,z]=(0,n.useState)(0),W=(0,n.useRef)(H),$=(0,n.useCallback)(()=>{z(e=>{if(e-W.current>=5)throw Error("CodeMirror error refresh loop detected");return e+1})},[]);(0,n.useEffect)(()=>{let e=setTimeout(()=>{W.current=H},1e3);return()=>clearTimeout(e)},[H]),(0,n.useImperativeHandle)(U,()=>({view:B,dom:V}),[B,V]),(0,g.assertClientSide)();let q=(0,b.default)(R??g.defaultOnException),Q=function({fontSize:e,readOnly:t,extensions:n,initializing:s,loading:a}){let r=(0,i.useRouter)(),l=(0,w.useIsMobile)(),u=(0,S.isInBonsaiWebview)(r),b=(0,S.useIsInMobileWorkspace)(),C=(0,v.useFlag)({controlName:"flag-editor-root-level-tooltips",logFlagToAnalytics:!1}),M=(0,g.useMemoizedExtensions)(n),{values:N,isDarkColorScheme:D}=(0,I.useTheme)(),P=T.ThemeCompartment.use(N,D,e),R=[f.EditableCompartment.use(t,u,C,!1),x.HistoryCompartment.use(t),g.ExtensionsCompartment.use(M),P,y.LineWrappingCompartment.use(!0),p.InitializingCompartment.use(s),h.LoadingCompartment.use(a),m.IsMobileCompartment.use(b)];return[o.Prec.highest(A.EditorReactRoot),_.StateListenerPlugin,h.BindLoadingPlugin,c.HasHadUserInput,d.AnimatedRanges,l?j:k,E.DisableGrammarly,L,...R]}({fontSize:r,readOnly:M,extensions:N,initializing:D,loading:P});(0,n.useEffect)(()=>{if(!V)return;function e(e){if(q.current(e),(0,g.shouldRefreshForError)(e)){let t=e instanceof Error?e.message:void 0;s.addBreadcrumb({category:"codemirror",message:"Codemirror refresh called",data:{error:t},level:"error"}),$()}}let t=null;try{t=new l.EditorView({doc:K.current??void 0,parent:V,extensions:[l.EditorView.exceptionSink.of(e),...Q]})}catch(t){e(t)}return t&&F(t),()=>{if(t){F(null);try{t.destroy()}catch(t){e(t)}}}},[V,H]),(0,u.useObserveCodeMirrorResize)(B);let Z=(0,C.useMergeRefs)([G,e],{breadcrumb:"client/codemirror/react/ProseCodeMirror.tsx:353"});return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{ref:Z,...O}),(0,t.jsx)(A.EditorReactRootMount,{view:B})]})});e.s(["default",0,M],564416);var N=e.i(828043),D=e.i(6064),P=e.i(222878),R=e.i(89078),O=e.i(162914),U=e.i(858248),B=e.i(709485),F=e.i(480028),V=e.i(140487),G=e.i(607278),K=e.i(818503),H=e.i(624782),z=e.i(960178),W=e.i(625484),$=e.i(112801);let q="Invalid Figma URL. Please ensure link is a valid Figma frame for your connected account in the format https://www.figma.com/design/...";function Q({source:e,onCancel:i,onSubmit:s,title:a="Import Figma design",submitButtonText:r="Attach to prompt",showHelpText:o=!0,className:l,autoFocus:d=!0}){let[c,u]=(0,n.useState)(null),[p,h]=(0,n.useState)(""),m=(0,n.useRef)(null),g=(0,O.default)(p,500),f="workspace"===e,x=f?B.events.AGENT_USED:B.events.START_WITH_AI_USED,T=(0,n.useCallback)(()=>{(0,U.track)(x,{action:"attachment_import_from_figma_cancelled"}),i()},[i,x]);(0,n.useEffect)(()=>{if(g){let[e]=(0,N.isValidFigmaUrl)(g);u(e?null:q)}else u(null)},[g]);let y=(0,n.useCallback)(()=>{let e=p.trim();if(!e)return void u("Please enter a Figma URL");let[t,i]=(0,N.isValidFigmaUrl)(e);t&&i?(u(null),(0,U.track)(x,{action:"attachment_import_from_figma_attached",figma_url:e}),s(e)):u(q)},[p,s,x]),E=(0,n.useCallback)(e=>{"Enter"===e.key?(e.preventDefault(),y()):"Escape"===e.key&&(e.preventDefault(),T())},[y,T]);return(0,n.useEffect)(()=>{d&&m.current?.focus()},[d]),(0,t.jsxs)(W.View,{clsx:[$.default.container,l],children:[(0,t.jsxs)(W.View,{row:!0,gap:8,align:"center",children:[(0,t.jsx)(D.default,{size:20}),(0,t.jsx)(z.Header,{variant:"subheadDefault",level:3,children:a}),f?(0,t.jsx)(H.Pill,{text:"Beta",colorway:"primary",compact:!0}):null]}),(0,t.jsxs)(W.View,{gap:8,children:[(0,t.jsx)(K.Label,{htmlFor:"figmaUrl",className:$.default.mediumFont,children:"Figma frame URL"}),(0,t.jsx)(G.Input,{id:"figmaUrl",ref:m,placeholder:"https://www.figma.com/file/...",value:p,onChange:e=>h(e.target.value),onKeyDown:E,autoFocus:d}),c?(0,t.jsx)(W.View,{pb:8,py:4,children:(0,t.jsx)(R.default,{children:c})}):null,o?(0,t.jsxs)(W.View,{row:!0,gap:8,align:"center",children:[(0,t.jsx)(W.View,{shrink:!1,children:(0,t.jsx)(P.default,{color:F.tokens.foregroundDimmer})}),(0,t.jsx)(W.View,{grow:!0,shrink:!0,children:(0,t.jsxs)(z.Text,{color:"dimmer",variant:"small",multiline:!0,children:[(0,t.jsx)("span",{className:$.default.mediumFont,children:"How to find your frame URL:"})," ",'In Figma Design, right click on the frame you want to import, then click "Copy/Paste as" and finally "Copy link to selection".']})})]}):null,(0,t.jsxs)(W.View,{row:!0,gap:8,justify:"end",children:[(0,t.jsx)(V.Button,{text:"Cancel",variant:"outlined",onClick:T}),(0,t.jsx)(V.Button,{variant:"outlined",colorway:!p.trim()||c?"grey":"primary",text:r,disabled:!p.trim()||!!c,onClick:y})]})]})]})}var Z=e.i(56641);function X(e){return(0,t.jsx)(Q,{...e,className:Z.default.animatedContainer})}function Y({source:e,onCancel:i,onSubmit:n}){return(0,t.jsx)(X,{source:e,onCancel:i,onSubmit:n,title:"Import Figma design"})}e.s(["FigmaUrlInput",()=>Y],600572)},518056,e=>{"use strict";var t=e.i(276385),i=e.i(116235);function n(e){return(0,t.jsx)(i.default,{...e,children:(0,t.jsx)("path",{d:"M16.001 1.25a4.75 4.75 0 0 1 3.358 8.11v-.001l-8.408 8.58-.006.007a2.751 2.751 0 0 1-3.89-3.89l8.41-8.581a.75.75 0 0 1 1.071 1.05L8.122 15.11l-.006.006a1.25 1.25 0 1 0 1.769 1.767l8.408-8.58.006-.006a3.25 3.25 0 1 0-4.597-4.595L5.33 12.247l-.01.01a5.253 5.253 0 0 0 1.683 8.598 5.252 5.252 0 0 0 5.741-1.173l8.378-8.55a.75.75 0 0 1 1.071 1.05l-8.378 8.55-.001.002a6.75 6.75 0 1 1-9.546-9.546l8.37-8.541.005-.005c.89-.89 2.1-1.392 3.359-1.392Z"})})}e.s(["default",()=>n])},211408,e=>{"use strict";var t=e.i(276385),i=e.i(389959),n=e.i(445059);let s=(0,i.createContext)(null);function a({children:e,sessionId:i,uploadFiles:a,onError:r}){let o=(0,n.useAttachmentsImpl)({sessionId:i,uploadFiles:a,onError:r});return(0,t.jsx)(s.Provider,{value:o,children:e})}function r(){let e=(0,i.useContext)(s);if(!e)throw Error("useAiChatAttachments(must be used within an AiChatAttachmentsProvider");return e}e.s(["AiChatAttachmentsProvider",()=>a,"useAiChatAttachments",()=>r])},157918,e=>{"use strict";e.i(276385);var t=e.i(753950),i=e.i(179302);e.i(508987);var n=e.i(457103);e.i(703613);var s=e.i(700170),a=e.i(480028),r=e.i(446530),o=e.i(613355);e.i(960178);let l=t.Facet.define({combine:e=>e[0]??0}),d=new s.ReactCompartment(e=>l.of(e)),c="cm-empty-state-dom",u=i.EditorView.theme({[`.${c}`]:{backgroundColor:a.tokens.redDefault,opacity:"0.2"}}),p=t.StateField.define({create:e=>e.doc.length,update:(e,t)=>t.state.doc.length}),h=e=>Math.max(e.doc.length-e.facet(l),0),m=t.StateField.define({create:h,update:(e,t)=>(0,n.hasChanged)(t,"doc",l)?h(t.state):e,provide:e=>[p,u,(0,i.layer)({above:!1,update:t=>(0,n.hasChanged)(t,e),markers(n){let s=n.state.field(e);if(0===s)return[];let a=n.state.doc.length;return i.RectangleMarker.forRange(n,c,t.EditorSelection.range(a-s,a))}})]});(0,r.cssRecord)({charLimit:[o.rcss.color.redDefault]}),e.s(["MaxLength",0,d,"characterLimit",0,m])},683389,e=>{"use strict";var t=e.i(389959),i=e.i(753950),n=e.i(179302);e.i(508987);var s=e.i(457103),a=e.i(969932),r=e.i(546833),o=e.i(197649),l=e.i(480028),d=e.i(585225);let c="cm-placeholder-layer",u="cm-placeholder-dom",p=n.EditorView.theme({[`.${c}`]:{width:"100%",height:"100%",pointerEvents:"none"},[`.${u}`]:{position:"absolute",width:"100%",pointerEvents:"none",fontFamily:l.tokens.fontFamilyDefault}}),h=e=>0===e.doc.toString().trim().length,m=i.StateEffect.define(),g=i.StateField.define({create:h,update:(e,t)=>h(t.state)});function f(e={}){let{text:i="Type message",disableAnimation:l=!1}=e,h=(0,d.useIsShadesSupported)();return(0,t.useMemo)(()=>{let e;return[g,p,(0,n.layer)((e=Date.now(),{above:!1,class:c,update:function(t){let i=!1;return(0,a.forEachEffect)(t,m,()=>{i=!0,e=Date.now()}),i||(0,s.hasChanged)(t,g)},markers:function(t){if(!t.state.field(g))return[];let n=t.coordsAtPos(0);if(!n)return[];let s=t.dom.getBoundingClientRect(),a=n.left-s.left;return[function({top:e,left:t,height:i,animateTimestamp:n,text:s,disableAnimation:a,isShadesSupported:l}){return{draw(){let n=document.createElement("div");n.className=(0,o.default)(u,{[r.classes.placeholderText]:l}),n.style.width="100%",n.style.paddingTop=e+"px",n.style.paddingLeft=t+"px",n.style.height=i+"px";let d=s.length;return a?n.textContent=s:!function e(t=0){requestAnimationFrame(()=>{n.textContent=s.slice(0,t),t<d&&e(t+1)})}(),n},animateTimestamp:n,eq(e){return this.animateTimestamp===e.animateTimestamp}}}({top:n.top-s.top,left:a,height:n.bottom-n.top,animateTimestamp:e,text:i,disableAnimation:l,isShadesSupported:h})]}}))]},[i,l,h])}e.s(["animateTextEffect",0,m,"isEmpty",0,g,"usePlaceholder",()=>f])},900433,456594,e=>{"use strict";var t=e.i(848415),i=e.i(288148);function n({addAttachments:e}){let[{isOver:n},s]=(0,t.useDrop)(()=>({accept:[i.NativeTypes.FILE],drop:t=>{t.dirContent.then(t=>{e(t.filter(e=>".DS_Store"!==e.name).map(e=>({fileName:e.name,file:e})))})},collect:e=>({isOver:!0===e.isOver()})}));return{isDraggedOver:n,drop:s}}e.s(["useDropTarget",()=>n],900433);var s=e.i(276385),a=e.i(116235);function r(e){return(0,s.jsxs)(a.default,{...e,children:[(0,s.jsx)("path",{d:"M12.025 11.251a.636.636 0 0 1 .134.017.739.739 0 0 1 .098.03c.012.004.026.006.038.012.019.008.036.02.055.03.023.012.048.024.07.039a.754.754 0 0 1 .11.09l3 3a.75.75 0 0 1-1.06 1.061l-1.72-1.72V18a.75.75 0 0 1-1.5 0v-4.19l-1.72 1.72a.75.75 0 1 1-1.06-1.06l3-3 .056-.052c.01-.008.022-.015.033-.022a.74.74 0 0 1 .26-.122l.06-.014a.737.737 0 0 1 .121-.01l.025.001Z"}),(0,s.jsx)("path",{fillRule:"evenodd",d:"M14 1.25a3.152 3.152 0 0 1 2.234.926l3.586 3.586A3.156 3.156 0 0 1 20.75 8v12A2.75 2.75 0 0 1 18 22.75H6A2.75 2.75 0 0 1 3.25 20V4A2.75 2.75 0 0 1 6 1.25h8Zm-8 1.5A1.25 1.25 0 0 0 4.75 4v16A1.25 1.25 0 0 0 6 21.25h12A1.25 1.25 0 0 0 19.25 20V8.75H15A1.75 1.75 0 0 1 13.25 7V2.75H6ZM14.75 7a.25.25 0 0 0 .25.25h4.07a1.65 1.65 0 0 0-.306-.424l-3.591-3.59a1.648 1.648 0 0 0-.423-.306V7Z",clipRule:"evenodd"})]})}e.s(["default",()=>r],456594)},233758,e=>{"use strict";let t=`Describe your idea, '/' for integrations`;e.s(["PLACEHOLDER_TEXT_DESIGN",0,"Describe the idea you want to design","PLACEHOLDER_TEXT_DESKTOP",0,t,"PLACEHOLDER_TEXT_MOBILE",0,"Describe the idea you want to build","PLACEHOLDER_TEXT_ORG",0,"Describe your idea"])},959559,e=>{e.v({button:"AttachmentButton-module__Ewwhga__button",colorForegroundDimmer:"AttachmentButton-module__Ewwhga__colorForegroundDimmer"})},956515,482853,342469,908320,706510,934226,e=>{"use strict";var t=e.i(276385),i=e.i(389959),n=e.i(252204),s=e.i(6064),a=e.i(456594),r=e.i(518056),o=e.i(394572),l=e.i(709485),d=e.i(992785),c=e.i(82259),u=e.i(629536),p=e.i(179302),h=e.i(700170);e.i(925218);var m=e.i(641555),g=e.i(802088),f=e.i(233758),x=e.i(527321),T=e.i(650587),y=e.i(631936),E=e.i(828043);e.i(242933);var _=e.i(790164),A=e.i(858248),v=e.i(576255);function w(e,t,i,n=!1){let s={...t,...e},a="Design"===s.stackKey?s.stackKey:s.fastModeStackOverride??s.stackKey;"Auto"===a&&(a=s.agentMode===c.AgentMode.AGENT_MODE_INITIAL_PLANNING?void 0:"Modern web app");let r=s.themeId,o=s.themeConfig;a&&!x.STACKS_THAT_SUPPORT_APP_THEMES.has(a)&&(r=void 0,o=void 0);let l=s.customStackReplId;"Stack from existing App"!==a&&"OrgStackTemplate"!==a&&(l=void 0);let d=s.agentMode??c.AgentMode.AGENT_MODE_GENERAL;"Automation"===a&&(d=c.AgentMode.AGENT_MODE_INITIAL_PLANNING),"Expert Mode"===a&&(d=c.AgentMode.AGENT_MODE_GENERAL),"Design"===a&&(d=c.AgentMode.AGENT_MODE_GENERAL),"Animated Video"===a&&(d=c.AgentMode.AGENT_MODE_GENERAL),n&&(d=c.AgentMode.AGENT_MODE_GENERAL);let u=s.buildTier;"Modern web app"!==a&&(u=c.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_PRO),void 0===u&&"Modern web app"===a&&(u="paid"===i||"org"===i?c.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_PRO:c.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_LITE),u===c.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_PRO&&("free"===i||"anon"===i)&&"Modern web app"===a&&(u=c.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_LITE),void 0!==e.buildTier&&void 0===e.agentMode&&d===c.AgentMode.AGENT_MODE_INITIAL_PLANNING&&"Modern web app"===a&&(d=c.AgentMode.AGENT_MODE_GENERAL);let p=s.enableAutomatedTesting;u===c.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_LITE&&(p=void 0);let h=s.autonomyLevel;("Design"===a||"Animated Video"===a)&&(h=c.AutonomyLevel.AUTONOMY_LEVEL_LOW);let m="Design"===a?c.AgentInitialBuildMode.AGENT_INITIAL_BUILD_MODE_DESIGN:c.AgentInitialBuildMode.AGENT_INITIAL_BUILD_MODE_BUILD;return{...s,stackKey:a,themeId:r,themeConfig:o,customStackReplId:l,buildTier:u,agentMode:d,initialBuildMode:m,enableAutomatedTesting:p,autonomyLevel:h}}let b="Modern web app",C="Design";function S(e){return"Design"===e}class I{data;detectedUrls;settings;validatedSettings;classifier;userType;hadContentDuringSession=!1;userConfiguredSettings=new Set;lastClassifiedState;hasFigmaLinks(){return this.detectedUrls.current.some(e=>(0,E.isValidFigmaUrl)(e)[0])}constructor({classifier:e,initialSettings:t,userType:i}){this.classifier=e,this.userType=i??"anon",this.data=new _.ObservableState({prompt:"",attachments:[]}),this.detectedUrls=new _.ObservableState([]),this.lastClassifiedState=new _.ObservableState(null);const n={stackKey:C,buildTier:"paid"===this.userType||"org"===this.userType?c.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_PRO:c.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_LITE,...t};n.buildTier===c.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_LITE&&Object.assign(n,this.computeBuildTierCapabilityUpdates(c.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_LITE)),this.settings=new _.ObservableState(n),this.validatedSettings=w({},n,this.userType,this.hasFigmaLinks()),this.classifier&&this.classifier.result.subscribe({next:e=>this.handleClassificationResult(e)})}setPrompt=e=>{this.data.update(t=>({...t,prompt:e})),this.classify("prompt")};setAttachments=e=>{this.data.update(t=>({...t,attachments:e})),this.classify("attachments")};isEmpty(){let{prompt:e,attachments:t}=this.data.current;return!e.trim()&&0===t.length}classify(e){if(this.classifier){if(this.isEmpty()){if(this.classifier.reset(),this.lastClassifiedState.update(()=>null),this.userConfiguredSettings.delete("buildTier"),this.hadContentDuringSession&&!S(this.settings.current.stackKey)){let e="paid"===this.userType||"org"===this.userType?c.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_PRO:c.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_LITE,t=e===c.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_LITE?"Modern web app":void 0,i=this.computeStackCapabilityUpdates("Modern web app"),n="free"===this.userType||"anon"===this.userType?{buildTier:c.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_LITE,...this.computeBuildTierCapabilityUpdates(c.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_LITE)}:{};this.settings.update(s=>({...s,stackKey:"Modern web app",buildTier:e,fastModeStackOverride:t,paidStackFallbackMessage:null,...i,...n})),this.validatedSettings=w({stackKey:"Modern web app",buildTier:e,...i,...n},this.settings.current,this.userType,this.hasFigmaLinks())}return}this.hadContentDuringSession=!0,this.classifier.classify({...this.data.current,debounceType:e})}}handleClassificationResult(e){if(!e?.ok)return;let t=(0,u.getStackOptionFromBlueprint)(e.payload.stackType);if(!t)return;this.lastClassifiedState.update(()=>({stackKey:t,buildTier:e.payload.agentInitialBuildTier}));let i=this.settings.current.stackKey;if(!S(i)){i!==t&&(0,A.track)(l.events.APP_TYPE_AUTO_SELECTED_CLIENT,{appType:t,previousAppType:i,promptLength:this.data.current.prompt.length});let n=this.computeStackCapabilityUpdates(t),s=e.payload.agentInitialBuildTier,a="Modern web app"===t,r=s===c.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_LITE||s===c.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_PRO,o=this.userConfiguredSettings.has("buildTier"),d="paid"===this.userType||"org"===this.userType,u={stackKey:t,...n};if(a&&r&&!o&&d){let e=this.settings.current.buildTier===c.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_LITE,i=s===c.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_LITE;u.buildTier=s,u.fastModeStackOverride=i?"Modern web app":void 0,i?u.enableAutomatedTesting=void 0:e&&(this.userConfiguredSettings.delete("enableAutomatedTesting"),Object.assign(u,this.computeStackCapabilityUpdates(t)))}this.settings.update(e=>({...e,...u})),this.validatedSettings=w(u,this.settings.current,this.userType,this.hasFigmaLinks())}}computeStackCapabilityUpdates(e){let t=(0,v.getStackCapabilities)(e),i=this.settings.current,n={},s=(0,v.applyAutomatedTestingCapability)(i.enableAutomatedTesting,this.userConfiguredSettings.has("enableAutomatedTesting"),t);s!==i.enableAutomatedTesting&&(n.enableAutomatedTesting=s);let a=i.buildTier===c.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_LITE,r="Modern web app"!==e&&"Auto"!==e;return a&&r&&(n.buildTier=c.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_PRO,Object.assign(n,this.computeBuildTierCapabilityUpdates(c.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_PRO))),n}computeBuildTierCapabilityUpdates(e){let t={};return e===c.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_LITE?(t.fastModeStackOverride="Modern web app",t.enableAutomatedTesting=void 0):t.fastModeStackOverride=void 0,t}updateSettings=e=>{let t={},i={},n=!1;this.settings.update(s=>{for(let i of Object.keys(t=e(s)))"stackKey"!==i&&"prevTabSettings"!==i&&"fastModeStackOverride"!==i&&this.userConfiguredSettings.add(i);let a=S(s.stackKey)!==S(t.stackKey??s.stackKey);if(void 0!==t.buildTier&&(Object.assign(i,this.computeBuildTierCapabilityUpdates(t.buildTier)),s.buildTier===c.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_LITE&&t.buildTier!==c.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_LITE)){this.userConfiguredSettings.delete("enableAutomatedTesting");let e=t.stackKey??s.stackKey??b;Object.assign(i,this.computeStackCapabilityUpdates(e))}if(void 0!==t.stackKey&&Object.assign(i,this.computeStackCapabilityUpdates(t.stackKey)),!a)return{...s,...t,...i};let{prevTabSettings:r,...o}=s,l=S(t.stackKey),d=r??{...s,...t};if(!l){let e=this.classifier?.isEnabled(),t=this.lastClassifiedState.current;e&&t?(d={...d,stackKey:t.stackKey,buildTier:t.buildTier},Object.assign(i,this.computeBuildTierCapabilityUpdates(t.buildTier))):e&&!t&&(d={...d,stackKey:b}),n=!0}let u=d.stackKey;return u&&Object.assign(i,this.computeStackCapabilityUpdates(u)),{...d,...i,prevTabSettings:o}});let s=n&&"Auto"===t.stackKey?{...t,stackKey:this.settings.current.stackKey}:t;this.validatedSettings=w({...s,...i},this.settings.current,this.userType,this.hasFigmaLinks());let a=S(this.settings.current.stackKey)===S(t.stackKey??this.settings.current.stackKey)&&"stackKey"in t&&"Auto"!==t.stackKey&&"Design"!==t.stackKey,r="agentMode"in t&&t.agentMode===c.AgentMode.AGENT_MODE_INITIAL_PLANNING;(a||r)&&this.classifier?.disable()};getValidatedSettings=()=>{let e=this.validatedSettings,{prompt:t,attachments:i}=this.data.current,n=e.agentMode===c.AgentMode.AGENT_MODE_INITIAL_PLANNING;if(("paid"===this.userType||"org"===this.userType)&&!S(e.stackKey)&&!n&&0===i.length&&t.length<5){let{customStackReplId:t,...i}=e;return{...i,stackKey:"Modern web app",agentMode:c.AgentMode.AGENT_MODE_INITIAL_PLANNING,buildTier:c.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_PRO}}return e};setDetectedUrls=e=>{if(this.detectedUrls.update(()=>e),e.filter(e=>(0,E.isValidFigmaUrl)(e)[0]).length>0){let e=this.settings.current.stackKey;if(!x.STACKS_THAT_SUPPORT_FIGMA_LINKS.has(e??"Auto")||"Auto"===e)return void this.updateSettings(()=>({stackKey:"Modern web app"}))}this.validatedSettings=w({},this.settings.current,this.userType,this.hasFigmaLinks())};clearUserConfiguredBuildTier=()=>{this.userConfiguredSettings.delete("buildTier")};reset=()=>{this.data.update(()=>({prompt:"",attachments:[]})),this.detectedUrls.update(()=>[]),this.classifier?.reset(),this.lastClassifiedState.update(()=>null),this.hadContentDuringSession=!1,this.userConfiguredSettings.clear();let{stackKey:e,buildTier:t}=this.settings.current;this.settings.update(()=>({stackKey:S(e)?C:b,buildTier:t})),this.validatedSettings=w({},this.settings.current,this.userType,this.hasFigmaLinks())};destroy=()=>{this.classifier?.destroy()};awaitClassification=()=>this.classifier?Promise.race([this.classifier.awaitClassification(),new Promise(e=>setTimeout(e,4e3))]):Promise.resolve()}var k=e.i(596139);let j="buildDesignModePreference",L={REQUIRES_CORE:`Selected app type requires ${k.corePlanName}`,FALLBACK:e=>e?`'${e}' is available with ${k.corePlanName}. To continue with Free, build a web app instead.`:`Selected app type requires ${k.corePlanName}. To continue with Free, build a web app instead.`};e.s(["BUILD_DESIGN_MODE_PREFERENCE_STORAGE_KEY",0,j,"PREMIUM_STACK_SUPPORTING_TEXT",0,L],482853);var M=e.i(180703),N=e.i(424360),D=e.i(279606);class P{uploadFile;fileState=new Map;destroyed=!1;constructor({uploadFile:e}){this.uploadFile=e}async getFileUrls(e){if(this.destroyed)return new Map;let t=new Set(e.map(e=>e.path));for(let[e]of this.fileState)t.has(e)||this.fileState.delete(e);let i=[];for(let t of e){let e=t.path,n=this.fileState.get(e);if(n?.status==="uploaded"){if(!(n.response.payload.expires.getTime()<Date.now()))continue;this.fileState.set(e,{status:"unprocessed"})}n?.status!=="error"&&n?.status!=="uploading"&&(n||this.fileState.set(e,{status:"unprocessed"}),i.push(t))}if(0===i.length)return this.getUploadedUrls(e);for(let e of i)this.fileState.set(e.path,{status:"uploading"});let n=i.map(async e=>{let t=await this.uploadFile(e);this.destroyed||(t.ok?this.fileState.set(e.path,{status:"uploaded",response:t}):this.fileState.set(e.path,{status:"error",response:t}))});return await Promise.all(n),this.getUploadedUrls(e)}getUploadedUrls(e){let t=new Map;for(let i of e){let e=this.fileState.get(i.path);e?.status==="uploaded"&&t.set(i.path,e.response.payload.url)}return t}destroy(){this.destroyed=!0,this.fileState.clear()}}class R{state;debounceTimer=null;initialClassificationTimer=null;currentVersion=0;isDisabled=!1;isInitialClassificationInProgress=!1;isPeriodicClassificationInProgress=!1;hasInitialClassificationFired=!1;hasAnyClassificationCompleted=!1;lastPeriodicClassifiedPrompt="";classifyingVersion=null;minPromptLength;characterThreshold;periodicCharacterThreshold;initialCharacterThreshold;lastClassifiedPrompt="";lastClassificationHadAttachments=!1;debounce;maxTypingInterval;classifyFn;fileUploader;uploadFile;isClosed;rateLimitTokens;rateLimitLastRefill;latestPrompt="";latestAttachments=[];latestRunPromise=Promise.resolve();constructor({classifyFn:e,uploadFile:t,isClosed:i=()=>!1,minPromptLength:n=5,characterThreshold:s=2,periodicCharacterThreshold:a=7,initialCharacterThreshold:r=8,debounce:o={},maxTypingInterval:l=3e3}){this.classifyFn=e,this.uploadFile=t,this.isClosed=i,this.fileUploader=new P({uploadFile:t}),this.minPromptLength=n,this.characterThreshold=s,this.periodicCharacterThreshold=a,this.initialCharacterThreshold=r,this.debounce={prompt:o.prompt??300,attachments:o.attachments??100},this.maxTypingInterval=l,this.state=new _.ObservableState({result:null,isClassifying:!1,hasEverFailed:!1}),this.rateLimitTokens=30,this.rateLimitLastRefill=Date.now()}refillTokens(){let e=Date.now(),t=(e-this.rateLimitLastRefill)/1e3;this.rateLimitTokens=Math.min(30,this.rateLimitTokens+ +t),this.rateLimitLastRefill=e}tryConsumeToken(){return this.refillTokens(),this.rateLimitTokens>=1&&(this.rateLimitTokens-=1,!0)}classify({prompt:e,attachments:t,debounceType:i}){if(!this.isInitialClassificationInProgress&&!this.isPeriodicClassificationInProgress&&this.currentVersion++,null!==this.debounceTimer&&clearTimeout(this.debounceTimer),this.isDisabled)return;this.latestPrompt=e,this.latestAttachments=t;let n=this.debounce[i],s=e.trim(),a=s.length>=this.minPromptLength||t.length>0;!this.hasInitialClassificationFired&&!this.isInitialClassificationInProgress&&a&&s.length>=this.initialCharacterThreshold&&(null!==this.initialClassificationTimer&&(clearTimeout(this.initialClassificationTimer),this.initialClassificationTimer=null),this.hasInitialClassificationFired=!0,this.runInitialClassification()),this.hasAnyClassificationCompleted&&!this.isPeriodicClassificationInProgress&&Math.abs(s.length-this.lastPeriodicClassifiedPrompt.length)>=this.periodicCharacterThreshold&&a&&this.runPeriodicClassification(),this.debounceTimer=setTimeout(()=>{this.debounceTimer=null,this.currentVersion++,this.run(this.currentVersion,e,t,{isInitial:!1})},n),null!==this.initialClassificationTimer||this.hasInitialClassificationFired||(this.initialClassificationTimer=setTimeout(()=>{this.initialClassificationTimer=null,this.hasInitialClassificationFired=!0,null!==this.debounceTimer&&this.runInitialClassification()},this.maxTypingInterval))}async runInitialClassification(){this.isInitialClassificationInProgress=!0;let e=this.currentVersion;try{await this.run(e,this.latestPrompt,this.latestAttachments,{isInitial:!0})}finally{this.isInitialClassificationInProgress=!1}}async runPeriodicClassification(){this.lastPeriodicClassifiedPrompt=this.latestPrompt.trim(),this.isPeriodicClassificationInProgress=!0;let e=this.currentVersion;try{await this.run(e,this.latestPrompt,this.latestAttachments,{isInitial:!0})}finally{this.isPeriodicClassificationInProgress=!1}}run(e,t,i,{isInitial:n}){let s=async()=>{var s,a;let r;if(this.currentVersion!==e)return;let o=t.trim();if(0===i.length&&!this.lastClassificationHadAttachments&&(s=this.lastClassifiedPrompt,a=this.characterThreshold,!(!s||Math.abs(o.length-s.length)>=a))||o.length<this.minPromptLength&&0===i.length||!this.tryConsumeToken()||this.isClosed())return;let l=await this.fileUploader.getFileUrls(i);if(this.currentVersion!==e){this.classifyingVersion===e&&(this.classifyingVersion=null,this.state.update(e=>({...e,isClassifying:!1})));return}let d=[];for(let e of i){let t=l.get(e.path);t&&d.push({path:t,mimeType:e.mimeType})}if(!this.isClosed()){n||(this.classifyingVersion=e,this.state.update(e=>({...e,isClassifying:!0})));try{r=await this.classifyFn(t,d)}catch(e){n||(this.classifyingVersion=null,this.state.update(e=>({...e,isClassifying:!1})));return}if(this.currentVersion!==e){this.classifyingVersion===e&&(this.classifyingVersion=null,this.state.update(e=>({...e,isClassifying:!1})));return}if(!r.ok){n||(this.classifyingVersion=null,this.state.update(e=>({...e,isClassifying:!1,hasEverFailed:!0})));return}n||(this.lastClassifiedPrompt=o,this.lastClassificationHadAttachments=i.length>0),this.hasAnyClassificationCompleted||(this.hasAnyClassificationCompleted=!0,this.lastPeriodicClassifiedPrompt=o),n||(this.classifyingVersion=null),this.state.update(e=>({...e,result:r,isClassifying:!!n&&e.isClassifying}))}};return this.latestRunPromise=s(),this.latestRunPromise}isClassifying=new N.Multicast(e=>D.Observable.from(this.state).select(e=>e.isClassifying).subscribe(e));result=new N.Multicast(e=>D.Observable.from(this.state).select(e=>e.result).subscribe(e));hasEverFailed=new N.Multicast(e=>D.Observable.from(this.state).select(e=>e.hasEverFailed).subscribe(e));disable=()=>{this.isDisabled=!0,null!==this.debounceTimer&&(clearTimeout(this.debounceTimer),this.debounceTimer=null),null!==this.initialClassificationTimer&&(clearTimeout(this.initialClassificationTimer),this.initialClassificationTimer=null)};enable=()=>{this.isDisabled=!1};isEnabled=()=>!this.isDisabled;awaitClassification=()=>this.isDisabled?Promise.resolve():null!==this.debounceTimer?(clearTimeout(this.debounceTimer),this.debounceTimer=null,null!==this.initialClassificationTimer&&(clearTimeout(this.initialClassificationTimer),this.initialClassificationTimer=null),this.latestPrompt.trim().length>=this.minPromptLength||this.latestAttachments.length>0)?(this.currentVersion++,this.run(this.currentVersion,this.latestPrompt,this.latestAttachments,{isInitial:!1})):Promise.resolve():this.latestRunPromise;reset(){this.currentVersion++,null!==this.debounceTimer&&(clearTimeout(this.debounceTimer),this.debounceTimer=null),null!==this.initialClassificationTimer&&(clearTimeout(this.initialClassificationTimer),this.initialClassificationTimer=null),this.isDisabled=!1,this.isInitialClassificationInProgress=!1,this.isPeriodicClassificationInProgress=!1,this.hasInitialClassificationFired=!1,this.hasAnyClassificationCompleted=!1,this.lastPeriodicClassifiedPrompt="",this.classifyingVersion=null,this.lastClassifiedPrompt="",this.lastClassificationHadAttachments=!1,this.latestPrompt="",this.latestAttachments=[],this.rateLimitTokens=30,this.rateLimitLastRefill=Date.now(),this.latestRunPromise=Promise.resolve(),this.state.update(e=>({...e,result:null,isClassifying:!1,hasEverFailed:!1})),this.fileUploader.destroy(),this.fileUploader=new P({uploadFile:this.uploadFile})}destroy(){null!==this.debounceTimer&&(clearTimeout(this.debounceTimer),this.debounceTimer=null),null!==this.initialClassificationTimer&&(clearTimeout(this.initialClassificationTimer),this.initialClassificationTimer=null),this.fileUploader.destroy()}}e.s(["Classifier",()=>R],342469);let O=(0,i.createContext)({});function U({children:e,classifier:n,initialSettings:s={stackKey:"Modern web app"},userType:a,promptApiRef:r,forceDesignMode:o}){let l=function({classifier:e,initialSettings:t,userType:n,forceDesignMode:s}){let[a,r,o]=(0,M.default)(j,null),l=(0,i.useRef)({...t,stackKey:s?C:t?.stackKey??b}),d=(0,i.useRef)(n),c=(0,i.useRef)(s),u=(0,i.useMemo)(()=>new I({classifier:e,initialSettings:l.current,userType:d.current}),[e]),p=(0,i.useRef)(!1);return(0,i.useEffect)(()=>{if(!c.current&&!p.current)switch(a){case"Design":u.settings.current.stackKey!==C&&u.updateSettings(()=>({stackKey:C})),p.current=!0;break;case"Build":u.settings.current.stackKey===C&&u.updateSettings(()=>({stackKey:b})),p.current=!0}},[a,u]),(0,g.useObserver)((0,i.useMemo)(()=>u.settings.select(e=>e.stackKey),[u]),{next(e){o&&r("Design"===e?e:"Build")}}),u}({classifier:n,initialSettings:s,userType:a,forceDesignMode:o});return(0,i.useImperativeHandle)(r,()=>l,[l]),(0,t.jsx)(O.Provider,{value:l,children:e})}let B=()=>{let e=(0,i.useContext)(O);if(!e)throw Error("useAgentEntryPointProvider must be used within AgentEntryPointProvider");return e};e.s(["AgentInputProvider",()=>U,"useAgentInputContext",0,B],908320);let F=new h.ReactCompartment(e=>p.EditorView.updateListener.of(t=>{t.docChanged&&e(t.view.state.doc.toString())}));function V(e){let t=B();return(0,g.useObserver)(e,{next:t.setAttachments}),{cmExtension:F.use(t.setPrompt),isClassifying:t.classifier?.isClassifying,disable:t.classifier?.disable}}function G(e){let t=B();(0,i.useEffect)(()=>{t.setDetectedUrls(e)},[e,t])}function K(e,t){let i={};for(let n of t)i[n]=e[n];return i}function H(...e){let t=B(),i=e.join(",");return(0,m.useObservableMemo)(()=>t.settings.select(t=>K(t,e),d.default),[t,i],{default:K(t.settings.current,e)})}function z(){let e=B();return(0,i.useCallback)(()=>{let t=e.settings.current.stackKey;return{settings:e.getValidatedSettings(),usedAutoStackFallback:"Auto"===t}},[e])}function W(){let e=B(),[t,n]=(0,i.useState)(!1);return{awaitClassification:(0,i.useCallback)(async()=>{n(!0);try{await e.awaitClassification()}finally{n(!1)}},[e]),isAwaitingClassification:t}}function $(){let{updateSettings:e}=B();return e}function q(e){return S(e.stackKey)?"Design":"Auto"}function Q(){let{settings:e}=B();return(0,m.useObservableMemo)(()=>e.select(q),[e],{default:q(e.current)})}function Z(e){return e.stackKey&&"Auto"!==e.stackKey&&x.STACKS_THAT_SUPPORT_APP_THEMES.has(e.stackKey)&&e.stackKey?{supported:!0,stackKey:e.stackKey,themeId:e.themeId}:{supported:!1}}function X(e){return 0===e.prompt.trim().length&&0===e.attachments.length}function Y(){let{data:e}=B();return(0,m.useObservableMemo)(()=>e.select(X),[e],{default:X(e.current)})}function J(){let{settings:e}=B();return(0,m.useObservableMemo)(()=>e.select(Z,d.default),[e],{default:Z(e.current)})}function ee(){let{lastClassifiedState:e}=B();return(0,m.useObservableMemo)(()=>e.select(e=>e?.stackKey),[e],{default:e.current?.stackKey})}function et(){let e=B();return(0,m.useObservableMemo)(()=>e.data.select(t=>{let i=t.prompt.trim();return("paid"===e.userType||"org"===e.userType)&&i.length>=5}),[e.data,e.userType],{default:!1})}function ei(){let e,t=B(),n=Q(),{agentMode:s,buildTier:a,stackKey:r}=H("agentMode","buildTier","stackKey"),{hasFigmaLinks:o}=(0,y.useAgentInputFigmaContext)(),l=a===c.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_LITE,d=(0,i.useCallback)(e=>{if(e===c.AgentMode.AGENT_MODE_INITIAL_PLANNING)t.updateSettings(t=>({agentMode:e,stackKey:"Auto",prevChatModeSettings:{stackKey:t.stackKey&&"Auto"!==t.stackKey?t.stackKey:t.prevChatModeSettings?.stackKey,buildTier:t.buildTier??t.prevChatModeSettings?.buildTier},...l&&{buildTier:c.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_PRO}}));else{t.updateSettings(t=>({agentMode:e,stackKey:t.prevChatModeSettings?.stackKey??"Modern web app",...t.prevChatModeSettings?.buildTier&&{buildTier:t.prevChatModeSettings.buildTier},prevChatModeSettings:void 0})),t.clearUserConfiguredBuildTier(),t.classifier?.enable();let{prompt:i,attachments:n}=t.data.current;(i.trim()||n.length>0)&&t.classifier?.classify({prompt:i,attachments:n,debounceType:"prompt"})}},[t,l]),u=!1,p=s;return o?(u=!0,e="Figma imports are built directly without planning",p=c.AgentMode.AGENT_MODE_GENERAL):"Automation"===r?(u=!0,e="Agent stack requires planning mode",p=c.AgentMode.AGENT_MODE_INITIAL_PLANNING):"Animated Video"===r&&(u=!0,e="Video stack builds directly without planning",p=c.AgentMode.AGENT_MODE_GENERAL),{show:"Auto"===n,requiresPaid:"free"===t.userType||"anon"===t.userType,agentMode:p,updateMode:d,disabled:u,disabledTooltipText:e}}function en(){let e=B(),t=Q(),{stackKey:n}=H("stackKey"),{hasFigmaLinks:s}=(0,y.useAgentInputFigmaContext)(),a=(0,i.useCallback)(t=>{e.updateSettings(()=>({stackKey:t,paidStackFallbackMessage:null}))},[e]),r=(0,i.useCallback)(t=>{e.updateSettings(()=>({stackKey:"OrgStackTemplate",customStackReplId:t}))},[e]);return{show:"Auto"===t&&"anon"!==e.userType,stackKey:n,updateStack:a,setOrgTemplateStack:r,requiresPaid:"free"===e.userType||"anon"===e.userType,hasFigmaLinks:s}}function es(){let e=B(),{stackKey:t}=H("stackKey"),i=(0,x.useFreeStacks)(),n=!!(t&&"Auto"!==t&&!i.has(t)),s="free"===e.userType||"anon"===e.userType;return{isPremiumStackSelected:n,isBlockedByPlan:n&&s,selectedStackLabel:t?x.STACK_OPTIONS_MAP.get(t)?.label:void 0}}function ea(){let e=B(),{buildTier:t}=H("buildTier"),n=(0,i.useCallback)(t=>{e.updateSettings(()=>({buildTier:t}))},[e]),s="paid"===e.userType||"org"===e.userType?c.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_PRO:c.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_LITE;return{buildTier:t??s,updateBuildTier:n}}function er(){let e=B();return{selectedTab:Q(),updateTab:(0,i.useCallback)(t=>{e.updateSettings(()=>({stackKey:t}))},[e])}}function eo(){return B().userType}function el({stackKey:e,isMobile:t,userType:i}){let n=S(e);if("anon"===i)return n?u.PLACEHOLDER_TEXT_ANON_DESIGN:u.PLACEHOLDER_TEXT_ANON_APP;let s=t?f.PLACEHOLDER_TEXT_MOBILE:f.PLACEHOLDER_TEXT_DESKTOP;return"org"===i&&(s=f.PLACEHOLDER_TEXT_ORG),n&&(s=f.PLACEHOLDER_TEXT_DESIGN),s}function ed(){let e=(0,T.useIsMobile)(),{settings:t,userType:i}=B();return(0,m.useObservableMemo)(()=>t.select(t=>el({stackKey:t.stackKey,isMobile:e,userType:i})),[t,e,i],{default:el({stackKey:t.current.stackKey,isMobile:e,userType:i})})}e.s(["useAgentModeState",()=>ei,"useAppTheme",()=>J,"useAwaitClassification",()=>W,"useClassifiedStackKey",()=>ee,"useClassifyPrompt",()=>V,"useEnhancePromptButtonVisibility",()=>et,"useFastBuildType",()=>ea,"useGetValidatedSettings",()=>z,"useIsEmpty",()=>Y,"usePlaceholderText",()=>ed,"usePremiumStackState",()=>es,"usePromptSettings",()=>H,"useSelectedTab",()=>Q,"useStackSelectState",()=>en,"useSyncDetectedUrls",()=>G,"useTabs",()=>er,"useUpdatePromptSettings",()=>$,"useUserType",()=>eo],706510);var ec=e.i(441329);function eu({uploadFiles:e,fileUploadInputRef:i,dirUploadInputRef:n}){return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("input",{style:{display:"none"},ref:i,type:"file",onChange:t=>{let{files:i}=t.target;i&&e({files:Array.from(i)})},onClick:e=>{e.currentTarget.value=""},multiple:!0,accept:"*"}),(0,t.jsx)("input",{style:{display:"none"},ref:n,type:"file",onChange:t=>{let{files:i}=t.target;i&&e({files:Array.from(i)})},onClick:e=>{e.currentTarget.value=""},webkitdirectory:"true",mozdirectory:"true",msdirectory:"true",odirectory:"true",directory:"true",accept:"*"})]})}e.s(["UploadInputs",()=>eu],934226);var ep=e.i(197649),eh=e.i(480028),em=e.i(585225),eg=e.i(136540),ef=e.i(119274),ex=e.i(625484),eT=e.i(959559);function ey({source:e,disabled:d,disabledReason:c,fileUploadDisabled:u,fileUploadDisabledReason:p,status:h,addAttachments:m,onInteract:g,onFigmaImportClick:f,size:x=24}){let T=eo(),y=(0,em.useIsShadesSupported)(),E=(0,ec.useIsInBonsaiWebview)(),_="workspace"===e,v=_?l.events.AGENT_USED:l.events.START_WITH_AI_USED,w=(0,i.useRef)(null),b=(0,i.useRef)(null),C=()=>{(0,A.track)(v,{action:"attachment_import_from_figma_clicked"}),f?.()};return(0,t.jsxs)(ex.View,{children:[(0,t.jsxs)(ef.PopupMenu,{trigger:(0,t.jsx)(eg.IconButton,{alt:"Attach file",size:x,disabled:d||"loading"===h,tooltipContents:c||"Add attachment",tooltipPlacement:"top-start",clsx:(0,ep.default)(eT.default.button,{[eT.default.colorForegroundDimmer]:!y}),onClick:()=>{(0,A.track)(v,{action:"attachment_button_clicked"})},children:(0,t.jsx)(r.default,{})}),isDisabled:d||"loading"===h,placement:"top start",children:[(0,t.jsx)(ef.MenuHeader,{text:"Add attachments"}),(0,t.jsx)(ef.MenuItem,{label:"Upload a file",icon:(0,t.jsx)(a.default,{}),isDisabled:u,description:p,onAction:()=>{(0,A.track)(v,{action:"attachment_upload_file_clicked"}),g?.(),w.current?.click()}}),"anon"===T?null:(0,t.jsx)(t.Fragment,{children:_?(0,t.jsx)(()=>(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ef.Separator,{}),(0,t.jsx)(ef.MenuItem,{label:"Attach a Figma design",icon:(0,t.jsx)(s.default,{}),onAction:C})]}),{}):(0,t.jsx)(()=>(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ef.Separator,{}),(0,t.jsx)(ef.MenuHeader,{text:"Add a starting point"}),(0,t.jsx)(ef.MenuItem,{label:"Import a Figma design",icon:(0,t.jsx)(s.default,{}),onAction:C}),!E&&(0,t.jsx)(ef.MenuItem,{label:"Import an existing project",icon:(0,t.jsx)(o.default,{}),iconRight:(0,t.jsx)(n.default,{color:eh.tokens.foregroundDimmest}),href:"/import",target:"_blank",onAction:()=>{(0,A.track)(v,{action:"attachment_import_from_existing_project_clicked"})}})]}),{})})]}),(0,t.jsx)(eu,{fileUploadInputRef:w,dirUploadInputRef:b,uploadFiles:async e=>{let t=e.files.map(e=>({fileName:e.name,file:e}));await m(t)}})]})}e.s(["AttachmentButton",()=>ey],956515)},655335,e=>{e.v({colorLabel:"BrandingViewer-module__vxxTbW__colorLabel",colorSwatch:"BrandingViewer-module__vxxTbW__colorSwatch",colorsFontsTypographyGrid:"BrandingViewer-module__vxxTbW__colorsFontsTypographyGrid",image:"BrandingViewer-module__vxxTbW__image",imageBg:"BrandingViewer-module__vxxTbW__imageBg",imageCard:"BrandingViewer-module__vxxTbW__imageCard",jsonFallback:"BrandingViewer-module__vxxTbW__jsonFallback",modalScrollContainer:"BrandingViewer-module__vxxTbW__modalScrollContainer",monoText:"BrandingViewer-module__vxxTbW__monoText",monoTextBrandColor:"BrandingViewer-module__vxxTbW__monoTextBrandColor",ogImage:"BrandingViewer-module__vxxTbW__ogImage",typographyLabel:"BrandingViewer-module__vxxTbW__typographyLabel"})},628576,624714,709696,777110,e=>{"use strict";let t;var i=e.i(276385),n=e.i(389959),s=e.i(736266),a=e.i(539865);e.i(877212);var r=e.i(924908),o=e.i(629536),l=e.i(828043),d=e.i(183035),c=e.i(402099),u=e.i(116235);function p(e){return(0,i.jsx)(u.default,{...e,children:(0,i.jsx)("path",{fillRule:"evenodd",d:"M15.838.027A4.491 4.491 0 0 1 18.32 8.26a4.49 4.49 0 0 1-2.483 8.231h-.097a4.473 4.473 0 0 1-2.991-1.141v4.085c0 2.513-2.064 4.539-4.564 4.539-2.474 0-4.515-2.005-4.515-4.49 0-1.562.797-2.938 2.007-3.743a4.487 4.487 0 0 1 0-7.481A4.492 4.492 0 0 1 8.162.028h7.676ZM8.162 16.491a2.992 2.992 0 0 0-2.991 2.991c0 1.646 1.357 2.99 3.015 2.99 1.684 0 3.064-1.366 3.064-3.038V16.49H8.162Zm0-7.482a2.991 2.991 0 1 0 0 5.981h3.088V9.01H8.162Zm7.58 0a2.992 2.992 0 0 0 0 5.981h.096a2.99 2.99 0 1 0 0-5.981h-.097Zm-7.58-7.482a2.992 2.992 0 0 0 0 5.982h3.088V1.527H8.162ZM12.75 7.51h3.088a2.99 2.99 0 1 0 0-5.982H12.75V7.51Z",clipRule:"evenodd"})})}var h=e.i(399245),m=e.i(493166),g=e.i(416746),f=e.i(393428),x=e.i(820228),T=e.i(90319),y=e.i(631936),E=e.i(993796),_=e.i(187505),A=e.i(664152),v=e.i(185296),w=e.i(759317),b=e.i(308521),C=e.i(200260),S=e.i(173703),I=e.i(624782),k=e.i(960178),j=e.i(625484),L=e.i(579886),M=e.i(655335);function N({data:e}){return(0,i.jsxs)(j.View,{gap:20,p:8,children:[e.colorScheme?(0,i.jsx)(D,{title:"Theme",children:(0,i.jsx)(j.View,{align:"start",children:(0,i.jsx)(I.Pill,{colorway:"grey",iconLeft:"dark"===e.colorScheme?(0,i.jsx)(w.default,{}):(0,i.jsx)(b.default,{}),text:e.colorScheme,style:{textTransform:"capitalize"}})})}):null,e.images?.logo||e.images?.ogImage?(0,i.jsx)(D,{title:"Images",children:(0,i.jsxs)(j.View,{row:!0,gap:12,wrap:!0,children:[e.images.logo?(0,i.jsx)(S.ShadesSurface,{className:M.default.imageCard,children:(0,i.jsxs)(j.View,{align:"center",p:16,gap:12,children:[(0,i.jsx)(k.Text,{variant:"small",color:"dimmer",children:"Logo"}),(0,i.jsx)(j.View,{className:M.default.imageBg,p:8,children:(0,i.jsx)(v.default,{src:e.images.logo,alt:"Logo",width:100,height:60,className:M.default.image,unoptimized:!0})})]})}):null,e.images.ogImage?(0,i.jsx)(S.ShadesSurface,{className:M.default.imageCard,children:(0,i.jsxs)(j.View,{align:"center",p:16,gap:12,children:[(0,i.jsx)(k.Text,{variant:"small",color:"dimmer",children:"OG Image"}),(0,i.jsx)(v.default,{src:e.images.ogImage,alt:"OG",width:160,height:80,className:M.default.ogImage,unoptimized:!0})]})}):null]})}):null,(0,i.jsxs)(j.View,{gap:32,className:M.default.colorsFontsTypographyGrid,children:[e.colors&&Object.keys(e.colors).length>0?(0,i.jsx)(D,{title:"Colors",children:(0,i.jsx)(j.View,{gap:6,children:Object.entries(e.colors).filter(([e,t])=>t).map(([e,t])=>(0,i.jsxs)(j.View,{row:!0,gap:8,align:"center",children:[(0,i.jsxs)(k.Text,{variant:"small",color:"dimmer",className:M.default.colorLabel,children:[e.charAt(0).toUpperCase()+e.slice(1).replace(/([A-Z])/g," $1"),":"]}),(0,i.jsx)(k.Text,{variant:"small",className:M.default.monoText,children:t}),(0,i.jsx)(j.View,{className:M.default.colorSwatch,style:{backgroundColor:t}})]},e))})}):null,e.fonts&&e.fonts.length>0||e.typography?.fontFamilies?(0,i.jsx)(D,{title:"Fonts",children:(0,i.jsxs)(j.View,{gap:4,children:[e.fonts?.map((e,t)=>(0,i.jsxs)(j.View,{row:!0,gap:6,align:"center",children:[(0,i.jsx)(k.Text,{variant:"small",children:e.family}),e.role&&"string"==typeof e.role?(0,i.jsxs)(k.Text,{variant:"small",color:"dimmer",children:["(",e.role,")"]}):null]},t)),!e.fonts&&e.typography?.fontFamilies?Object.entries(e.typography.fontFamilies).map(([e,t])=>(0,i.jsxs)(j.View,{row:!0,gap:6,align:"center",children:[(0,i.jsx)(k.Text,{variant:"small",children:t}),(0,i.jsxs)(k.Text,{variant:"small",color:"dimmer",children:["(",e,")"]})]},e)):null]})}):null,e.typography?.fontSizes?(0,i.jsx)(D,{title:"Typography",children:(0,i.jsx)(j.View,{gap:4,children:Object.entries(e.typography.fontSizes).map(([e,t])=>(0,i.jsxs)(j.View,{row:!0,gap:6,align:"center",children:[(0,i.jsxs)(k.Text,{variant:"small",color:"dimmer",className:M.default.typographyLabel,children:[e,":"]}),(0,i.jsx)(k.Text,{variant:"small",clsx:[M.default.monoText,M.default.monoTextBrandColor],children:t})]},e))})}):null]}),e.spacing?(0,i.jsx)(D,{title:"Spacing",children:(0,i.jsxs)(j.View,{row:!0,gap:16,children:[e.spacing.baseUnit?(0,i.jsxs)(j.View,{row:!0,gap:6,align:"center",children:[(0,i.jsx)(k.Text,{variant:"small",color:"dimmer",children:"Base unit:"}),(0,i.jsx)(k.Text,{variant:"small",clsx:[M.default.monoText,M.default.monoTextBrandColor],children:e.spacing.baseUnit})]}):null,e.spacing.borderRadius?(0,i.jsxs)(j.View,{row:!0,gap:6,align:"center",children:[(0,i.jsx)(k.Text,{variant:"small",color:"dimmer",children:"Border radius:"}),(0,i.jsx)(k.Text,{variant:"small",clsx:[M.default.monoText,M.default.monoTextBrandColor],children:e.spacing.borderRadius})]}):null]})}):null,e.personality?(0,i.jsx)(D,{title:"Personality",children:(0,i.jsxs)(j.View,{gap:4,children:[e.personality.tone?(0,i.jsxs)(j.View,{row:!0,gap:6,children:[(0,i.jsx)(k.Text,{variant:"small",color:"dimmer",children:"Tone:"}),(0,i.jsx)(k.Text,{variant:"small",children:e.personality.tone})]}):null,e.personality.energy?(0,i.jsxs)(j.View,{row:!0,gap:6,children:[(0,i.jsx)(k.Text,{variant:"small",color:"dimmer",children:"Energy:"}),(0,i.jsx)(k.Text,{variant:"small",children:e.personality.energy})]}):null,e.personality.targetAudience?(0,i.jsxs)(j.View,{row:!0,gap:6,children:[(0,i.jsx)(k.Text,{variant:"small",color:"dimmer",children:"Audience:"}),(0,i.jsx)(k.Text,{variant:"small",children:e.personality.targetAudience})]}):null]})}):null]})}function D({title:e,children:t}){return(0,i.jsxs)(j.View,{gap:8,children:[(0,i.jsx)(k.Text,{variant:"subheadDefault",children:e}),t]})}function P({brandingData:e,url:t}){let s,a=(0,n.useMemo)(()=>{try{return new URL(t.startsWith("http")?t:`https://${t}`).hostname}catch{return t}},[t]);if(!e)return(0,i.jsx)(j.View,{gap:8,p:16,children:(0,i.jsx)(k.Text,{color:"dimmer",children:"No branding data available"})});if("string"==typeof e)try{s=JSON.parse(e)}catch{return(0,i.jsx)(j.View,{gap:8,p:16,children:(0,i.jsx)(k.Text,{color:"dimmer",children:"Failed to parse branding data"})})}else s=e;return(0,i.jsxs)(j.View,{children:[(0,i.jsx)(C.FileAttachmentModalHeader,{viewerIcon:(0,i.jsx)(f.default,{size:16}),viewerTitle:"Brand identity",fileName:a}),(0,i.jsx)(j.View,{className:M.default.modalScrollContainer,p:8,children:(0,i.jsx)(L.default,{sentryTag:"branding-viewer-crashed",fallback:()=>(0,i.jsxs)(j.View,{gap:12,p:16,children:[(0,i.jsx)(k.Text,{color:"dimmer",children:"Branding data"}),(0,i.jsx)(j.View,{p:12,className:M.default.jsonFallback,children:(0,i.jsx)(k.Text,{children:JSON.stringify(e,null,2)})})]}),children:(0,i.jsx)(N,{data:s})})})]})}var R=e.i(64256),O=e.i(445059),U=e.i(480028),B=e.i(446530),F=e.i(6338),V=e.i(613355),G=e.i(140487),K=e.i(739521),H=e.i(751273);async function z(e){if(e.startsWith("data:")){let t=e.match(/^data:([^;]+);/),i=t?t[1]:"application/octet-stream",n=await fetch(e),s=await n.blob(),r=a.default.extension(i);if(!r)throw Error(`Failed to get extension for mime type: ${i}`);return{mimeType:i,blob:s,extension:r}}{let t=await fetch(e);if(!t.ok)throw Error(`Failed to fetch image: ${t.status} ${t.statusText}`);let i=await t.blob(),n=t.headers.get("content-type")||i.type||"application/octet-stream",s=a.default.extension(n);if(!s)throw Error(`Failed to get extension for mime type: ${n}`);return{mimeType:n,blob:i,extension:s}}}let W=[V.rcss.border({color:U.tokens.outlineDimmer}),V.rcss.borderRadius("container"),V.rcss.overflow("hidden"),{cursor:"default",userSelect:"none"}],$=(0,B.cssRecord)({container:W,containerDisabled:[...W,{cursor:"default",userSelect:"none",pointerEvents:"none",opacity:.5}],header:[V.rcss.width("100%"),{height:24}],faviconContainer:[{width:16,height:16,borderRadius:4,backgroundColor:U.tokens.interactiveBackground}],favicon:[{width:12,height:12}],urlText:[V.rcss.truncate,V.rcss.maxWidth(2*C.SMALL_FILE_ATTACHMENT_WIDTH-20),{fontSize:U.tokens.fontSizeSmall}],option:[V.rcss.reset.button,V.rcss.align.center,V.rcss.justify.center,V.rcss.colWithGap(4),V.rcss.p(4),V.rcss.borderRadius("container"),V.rcss.border({color:U.tokens.outlineDefault}),V.rcss.width(C.SMALL_FILE_ATTACHMENT_WIDTH),V.rcss.height(C.SMALL_ATTACHMENT_HEIGHT),V.rcss.cursor.pointer,{transition:"background-color 0.2s ease, color 0.2s ease",":not(:disabled):hover":{backgroundColor:U.tokens.interactiveBackgroundActive},":not(:disabled):hover .option-text":{color:U.tokens.foregroundDefault},":not(:disabled):hover .option-icon":{color:U.tokens.foregroundDefault},":disabled":{cursor:"default"}}],loadingOption:[V.rcss.align.center,V.rcss.justify.center,V.rcss.p(8),V.rcss.borderRadius("container"),V.rcss.width(C.SMALL_FILE_ATTACHMENT_WIDTH),V.rcss.height(C.SMALL_ATTACHMENT_HEIGHT),F.loadingStyle.backgroundPulse(U.tokens.backgroundHighest,U.tokens.backgroundHigher)],icon:[{color:U.tokens.foregroundDimmer,transition:"color 0.2s ease"}],errorIcon:[{color:U.tokens.accentNegativeDefault,transition:"color 0.2s ease"}],successIcon:[{color:U.tokens.accentPositiveDefault,transition:"color 0.2s ease"}],optionText:[V.rcss.textAlign.center,{lineHeight:"1.3"}],brandingCard:[V.rcss.align.center,V.rcss.justify.center,V.rcss.colWithGap(4),V.rcss.p(8),V.rcss.borderRadius("container"),V.rcss.border({color:U.tokens.outlineDefault}),V.rcss.width(C.SMALL_FILE_ATTACHMENT_WIDTH),V.rcss.height(C.SMALL_ATTACHMENT_HEIGHT),V.rcss.cursor.pointer,{transition:"background-color 0.2s ease",":hover":{backgroundColor:U.tokens.interactiveBackgroundActive}}]});function q({source:e,url:t,addUrlAttachment:s,removeUrlAttachment:a,onError:u,isDisabled:p}){let T=(0,E.useFlag)({controlName:"flag-brand-fetch-agent-input"}),y=t.replace(/^https?:\/\//,""),v=(0,r.useYapper)(),{trackClick:w}=(0,_.useTrackClick)(),[b,L]=(0,n.useState)(!1),[M,N]=(0,n.useState)(!1),[D,B]=(0,n.useState)(!1),[F,V]=(0,n.useState)(null),[W,q]=(0,n.useState)(null),[Q,X]=(0,n.useState)(null),[Y,J]=(0,n.useState)(null),[ee,et]=(0,n.useState)(!1),[ei,en]=(0,n.useState)(null),[es,ea]=(0,n.useState)(null),[er,eo]=(0,n.useState)(null),[el,ed]=(0,n.useState)(!1),ec=(0,n.useRef)(null),eu=(0,n.useMemo)(()=>{try{let e=t.trim();return/^[a-zA-Z][a-zA-Z\d+\-.]*:\/\//.test(e)||(e="http://"+e),new URL(e).origin+"/"}catch{return null}},[t]),ep=(0,n.useMemo)(()=>(0,l.isValidFigmaUrl)(t)[0],[t]),eh=e=>{en(e),u(e)},em=e=>{ea(e),u(e)},eg=e=>{eo(e),u(e)};(0,n.useEffect)(()=>{if(ec.current){let{offsetWidth:e,scrollWidth:t}=ec.current;ed(t>e)}},[y]),(0,n.useEffect)(()=>{Q?(async()=>{try{let e=await Q.file.text(),t=JSON.parse(e);J(t)}catch{J(null)}})():J(null)},[Q]);let ef=async()=>{w({productArea:"agent",target:"url_content_button"}),N(!0),ea(null);let e=`content-${Date.now()}.md`,i=(0,O.getAttachedAssetsPath)(e);try{s({url:t,file:{path:i,mimeType:"text/markdown",file:new File([],e,{type:"text/markdown"}),isLoading:!0}});let n=await v.getUrlScrapedContent(t);if(n.ok){let a=n.payload,r=new Blob([a],{type:"text/markdown"}),o=new File([r],e,{type:"text/markdown"}),l={path:i,mimeType:"text/markdown",file:o,isLoading:!1};s({url:t,file:l}),q(l)}else a(i),em("Failed to get content. Check the URL or try again later.")}catch(e){a(i),em("Error getting text content. Please try again later.")}finally{N(!1)}},ex=async()=>{w({productArea:"agent",target:"url_screenshot_button"}),L(!0),en(null);let e=`screenshot-${Date.now()}.png`,i=(0,O.getAttachedAssetsPath)(e);try{s({url:t,file:{path:i,mimeType:"image/png",file:new File([],e,{type:"image/png"}),isLoading:!0}});let n=await v.getUrlScreenshot(t);if(n.ok){let a=n.payload,r=await fetch(a);if(!r.ok)throw Error(`Failed to fetch image: ${r.status} ${r.statusText}`);let o=await r.blob(),l=new File([o],e,{type:"image/png"}),d={path:i,mimeType:"image/png",file:l,isLoading:!1};s({url:t,file:d}),V(d)}else a(i),eh("Failed to take screenshot. Check the URL or try again later.")}catch(e){a(i),eh("Error taking screenshot. Please try again later.")}finally{L(!1)}},eT=async()=>{w({productArea:"agent",target:"url_branding_button"}),B(!0),eo(null);let e=`branding-${Date.now()}.json`,i=(0,O.getAttachedAssetsPath)(e);try{s({url:t,file:{path:i,mimeType:"application/json",file:new File([],e,{type:"application/json"}),isLoading:!0}});let n=await v.getUrlBranding(t);if(!n.ok){a(i),eg("Failed to extract branding. Check the URL or try again later.");return}let r=n.payload,o=JSON.parse(r);if("images"in o&&"object"==typeof o.images){let e=o.images;for(let[i,n]of Object.entries(e))try{let{blob:e,extension:a,mimeType:r}=await z(n),l=(0,O.getAttachedAssetsPath)(`${i}.${a}`),d=new File([e],`${i}.${a}`,{type:r}),c={path:l,mimeType:r,file:d,isLoading:!1};s({url:t,file:c}),o.images[i]=`File saved at: ${l}`}catch(e){A.logger.warn(`Failed to fetch image from crawl: ${n}`,{errorMessage:e.message})}}let l=new Blob([r],{type:"application/json"}),d={path:i,mimeType:"application/json",file:new File([l],"branding.json",{type:"application/json"}),isLoading:!1};X(d);let c=JSON.stringify(o,null,2),u=new Blob([c],{type:"application/json"}),p={path:i,mimeType:"application/json",file:new File([u],e,{type:"application/json"}),isLoading:!1};s({url:t,file:p})}catch(e){a(i),eg("Error extracting branding. Please try again later.")}finally{B(!1)}};return(0,i.jsxs)(S.ShadesSurface,{css:p?$.containerDisabled:$.container,children:[(0,i.jsxs)(S.ShadesSurface,{elevate:"2x",row:!0,gap:8,align:"center",css:$.header,px:8,py:0,children:[eu?(0,i.jsx)(j.View,{css:$.faviconContainer,align:"center",justify:"center",children:(0,i.jsx)("img",{css:$.favicon,src:`https://www.google.com/s2/favicons?domain=${eu}&sz=32`,alt:y})}):(0,i.jsx)(h.default,{color:U.tokens.foregroundDimmest,size:16}),ep?(0,i.jsx)(j.View,{children:(0,i.jsxs)(j.View,{gap:4,row:!0,align:"center",children:[(0,i.jsx)(k.Text,{multiline:!1,ref:ec,children:"Figma design"}),ep&&"workspace"===e?(0,i.jsx)(I.Pill,{text:"Beta",colorway:"primary",compact:!0}):null]})}):(0,i.jsx)(H.Tooltip,{tooltip:t,isDisabled:!el,placement:"top",children:(0,i.jsx)(k.Text,{multiline:!1,css:$.urlText,ref:ec,children:y})})]}),(0,i.jsxs)(j.View,{row:!0,gap:8,px:8,py:6,justify:"space-between",children:[ep?null:(0,i.jsxs)(i.Fragment,{children:[F?(0,i.jsx)(C.FileAttachment,{attachment:F,getAttachmentTypeDisclaimer:(0,R.getAttachmentTypeDisclaimer)({aiName:(0,o.getAgentName)({capitalizeFirstChar:!0})}),removeAttachment:()=>{a(F.path),V(null)},size:"small"},F.path):b?(0,i.jsx)(j.View,{css:$.loadingOption,children:(0,i.jsxs)(k.Text,{color:"dimmer",variant:"small",css:$.optionText,children:["Taking ",(0,i.jsx)("br",{})," screenshot..."]})}):(0,i.jsx)(H.Tooltip,{tooltip:ei,isDisabled:!ei,placement:"top",children:(0,i.jsxs)(G.BaseButton,{css:$.option,onPress:ex,isDisabled:p,children:[ei?(0,i.jsx)(x.default,{css:$.errorIcon,className:"option-icon",size:16}):(0,i.jsx)(m.default,{css:$.icon,className:"option-icon",size:16}),(0,i.jsx)(k.Text,{color:"dimmer",variant:"small",css:$.optionText,className:"option-text",children:"Take screenshot"})]})}),W?(0,i.jsx)(C.FileAttachment,{attachment:W,getAttachmentTypeDisclaimer:(0,R.getAttachmentTypeDisclaimer)({aiName:(0,o.getAgentName)({capitalizeFirstChar:!0})}),removeAttachment:()=>{a(W.path),q(null)},size:"small"},W.path):M?(0,i.jsx)(j.View,{css:$.loadingOption,children:(0,i.jsxs)(k.Text,{color:"dimmer",variant:"small",css:$.optionText,children:["Getting ",(0,i.jsx)("br",{})," content..."]})}):(0,i.jsx)(H.Tooltip,{tooltip:es,isDisabled:!es,placement:"top",children:(0,i.jsxs)(G.BaseButton,{css:$.option,onPress:ef,isDisabled:p,children:[es?(0,i.jsx)(x.default,{css:$.errorIcon,className:"option-icon",size:16}):(0,i.jsx)(c.default,{css:$.icon,className:"option-icon",size:16}),(0,i.jsx)(k.Text,{color:"dimmer",variant:"small",css:$.optionText,className:"option-text",children:"Get text content"})]})}),T&&(Q?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(G.BaseButton,{css:$.brandingCard,onPress:()=>et(!0),children:[(0,i.jsx)(d.default,{css:$.successIcon,size:16}),(0,i.jsx)(k.Text,{color:"dimmer",variant:"small",css:$.optionText,className:"option-text",children:"Brand identity"})]}),(0,i.jsx)(K.Modal,{isOpen:ee&&!!Y,onRequestClose:()=>et(!1),maxWidth:800,centered:!0,noPadding:!0,children:(0,i.jsx)(P,{brandingData:Y,url:t})})]}):D?(0,i.jsx)(j.View,{css:$.loadingOption,children:(0,i.jsxs)(k.Text,{color:"dimmer",variant:"small",css:$.optionText,children:["Extracting ",(0,i.jsx)("br",{})," branding..."]})}):(0,i.jsx)(H.Tooltip,{tooltip:er,isDisabled:!er,placement:"top",children:(0,i.jsxs)(G.BaseButton,{css:$.option,onPress:eT,isDisabled:p,children:[er?(0,i.jsx)(x.default,{css:$.errorIcon,className:"option-icon",size:16}):(0,i.jsx)(f.default,{css:$.icon,className:"option-icon",size:16}),(0,i.jsx)(k.Text,{color:"dimmer",variant:"small",css:$.optionText,className:"option-text",children:"Extract branding"})]})}))]}),(0,i.jsx)(Z,{url:t})]}),ep&&"workspace"===e?(0,i.jsxs)(j.View,{row:!0,gap:2,px:8,align:"center",style:{marginTop:-4,marginBottom:2,opacity:.5},children:[(0,i.jsx)(g.default,{size:12,color:U.tokens.foregroundDimmer}),(0,i.jsx)(k.Text,{multiline:!1,style:{fontSize:10},children:"Available for Dev/Full Figma seats"})]}):null]})}let Q=[V.rcss.viewStyle,$.option];function Z(e){let{url:t}=e,{showFigmaAuthModal:n,isFigmaAuthenticated:a,isLoadingFigmaAuthentication:r}=(0,y.useAgentInputFigmaContext)(),[o]=(0,l.isValidFigmaUrl)(t);if(!o)return null;let c={state:"unauthenticated",title:"Login with Figma",tooltip:"Login with Figma to import",icon:(0,i.jsx)(T.default,{css:$.icon,className:"option-icon",size:16}),isDisabled:!1,onPress:()=>{n({surface:"figma_attachment_card",trigger:"login_button_clicked"})}};return a&&(c={state:"authenticated",title:"Connected",tooltip:"You are connected to Figma",icon:(0,i.jsx)(d.default,{css:$.successIcon,className:"option-icon",size:16}),isDisabled:!0}),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(H.Tooltip,{tooltip:r?"Checking if you are authenticated with Figma":c.tooltip,placement:"top",children:r?(0,i.jsx)(j.View,{css:$.loadingOption,children:(0,i.jsxs)(k.Text,{color:"dimmer",variant:"small",css:$.optionText,children:["Checking ",(0,i.jsx)("br",{})," connection..."]})}):(0,i.jsxs)(G.BaseButton,{css:Q,onPress:c.onPress,isDisabled:c.isDisabled,children:[c.icon,(0,i.jsx)(k.Text,{color:"dimmer",variant:"small",css:$.optionText,className:"option-text",children:c.title})]})}),(0,i.jsxs)(s.Link,{css:Q,href:t,target:"_blank",rel:"noopener noreferrer",children:[(0,i.jsx)(p,{css:$.icon,className:"option-icon",size:16}),(0,i.jsx)(k.Text,{color:"dimmer",variant:"small",css:$.optionText,className:"option-text",children:"View in Figma"})]})]})}e.s(["default",()=>q],628576);var X=e.i(179302),Y=e.i(700170);let J=new Y.ReactCompartment(({addAttachments:e,onAutoAttachedLargePaste:t})=>X.EditorView.domEventHandlers({paste(i){if(!i.clipboardData)return!1;let n=i.clipboardData.items,s=!1;for(let t of n)if(0===t.type.indexOf("image")){i.preventDefault();let n=t.getAsFile();if(n){e([{fileName:n.name,file:n}]),s=!0;break}}if(s)return!0;let a=i.clipboardData.getData("text");if(a.length<2e3)return!1;i.preventDefault();let r=`Pasted-${a.slice(0,100).replace(/[^a-zA-Z0-9-]/g,"-").replace(/-+/g,"-")}-${Date.now()}.txt`,o=new File([a],r,{type:"text/plain"});return e([{fileName:r,file:o}]),t?.(o.size),!0}}));e.s(["HandlePasteCompartment",0,J],624714);var ee=e.i(131141),et=e.i(82259),ei=e.i(753950),en=e.i(319122),es=e.i(676566);let ea=["py","md"],er=es.default.filter(e=>!ea.includes(e)).map(e=>RegExp(`\\.${e.replace(".","")}$`)),eo=/(https?:\/\/)?[\w~@#$%&+=\-.]+\.[^\s]+/g,el=new Set(["sh","md"]);function ed(e){let t,i=[];for(;null!==(t=eo.exec(e));){let e=t[0];for(;e.length>0&&/[.,!?)]$/.test(e);)e=e.slice(0,-1);if(/@/.test(e)&&!/^https?:\/\//.test(e))continue;let n=/^https?:\/\//.test(e);if(!n){let t=((e.replace(/^https?:\/\//,"").split(/[/?#]/)[0]??"").split(":")[0]??"").toLowerCase(),i=t.lastIndexOf("."),n=i>=0?t.slice(i+1):"";if(el.has(n))continue}(n?(0,en.default)(e,{host_whitelist:[...er,...Array.from(el).map(e=>RegExp(`\\.${e}$`))]}):(0,en.default)(e,{host_whitelist:er}))&&i.push({url:e,start:t.index,end:t.index+e.length})}return i}et.UrlIntent.URL_SCREENSHOT,m.default,et.UrlIntent.URL_CRAWL_CONTENT,c.default,et.UrlIntent.URL_CRAWL_BRANDING,f.default;let ec=ei.StateField.define({create:e=>[],update:(e,t)=>(0,ee.produce)(e,e=>{for(let i of t.effects){if(i.is(eu)){let t=i.value;0>e.findIndex(e=>e===t)&&e.push(t)}i.is(ep)&&e.splice(0,e.length)}})}),eu=ei.StateEffect.define(),ep=ei.StateEffect.define(),eh=ei.StateField.define({create:()=>X.Decoration.none,update:(e,i)=>{let n=[];for(let{start:e,end:s,url:a}of ed(i.state.doc.toString())){let i=a.startsWith("http://")||a.startsWith("https://")?a:`https://${a}`,r=X.Decoration.mark({class:"cm-url-underline",tagName:"a",attributes:{style:`--favicon-url: url("https://www.google.com/s2/favicons?domain=${function(e){let t=ex.get(e);if(t)return t;let i=e;try{i=new URL(e).hostname}catch{i=e}return ex.set(e,i),i}(i)}&sz=32")`,href:i,target:"_blank",rel:"noreferrer noopener nofollow",title:`${(void 0===t&&(t=window?.navigator.userAgent.includes("Macintosh")),t)?"CMD":"CTRL"} + Click to open in a new tab`}});n.push(r.range(e,s))}return X.Decoration.set(n)},provide:e=>X.EditorView.decorations.from(e)}),em=X.EditorView.baseTheme({".cm-url-underline":{textDecoration:`underline 0.5px ${U.tokens.blueDefault}`,textUnderlineOffset:"2px","--favicon-url":"none","--icon-size":"16px","--gap":"4px","--padding-h":"2px",position:"relative",backgroundColor:`color-mix(in srgb, ${U.tokens.accentPrimaryDefault} 10%, ${U.tokens.interactiveBackground})`,padding:"2px var(--padding-h)",borderRadius:"4px",color:`${U.tokens.accentPrimaryDefault}`,paddingLeft:"calc(var(--icon-size) + (var(--padding-h) * 2))",transition:"all 0.2s"},".cm-url-underline:hover":{backgroundColor:`color-mix(in srgb, ${U.tokens.accentPrimaryDefault} 20%, ${U.tokens.interactiveBackground})`},".cm-url-underline::after":{content:"''",position:"absolute",top:"4px",left:"var(--padding-h)",width:"var(--icon-size)",height:"var(--icon-size)",backgroundImage:"var(--favicon-url)",backgroundSize:"contain",backgroundPosition:"center",backgroundRepeat:"no-repeat",borderRadius:"2px",pointerEvents:"none"},".cm-url-underline::selection":{color:`${U.tokens.foregroundDimmer}`}}),eg=X.EditorView.updateListener.of(e=>{if(e.docChanged){let t=ed(e.state.doc.toString()),i=e.view,n=i.state.field(ec),s=t.map(e=>e.url);if(!function(e,t){if(e.length!==t.length)return!1;let i=new Set(e);return t.every(e=>i.has(e))}(n,s)&&(i.dispatch({effects:ep.of(null)}),s.length>0))for(let e of s)i.dispatch({effects:eu.of(e)})}}),ef=X.EditorView.domEventHandlers({click(e){let t=e.target instanceof HTMLElement&&e.target.closest("a.cm-url-underline");if(!t)return!1;if(!(e.metaKey||e.ctrlKey))return e.preventDefault(),!0;e.preventDefault();let i=t.getAttribute("href");return i&&window.open(i,"_blank","noopener,noreferrer"),!0}}),ex=new Map,eT=[eh,em,ec,eg,ef],ey=[eh,em,ef];e.s(["AnonSafeUrlAttachmentExtensions",0,ey,"UrlAttachmentExtensions",0,eT,"clearDetectedUrlsEffect",0,ep,"detectedUrlsState",0,ec],709696);var eE=e.i(282453);let e_=new Y.ReactCompartment(e=>e?X.EditorView.updateListener.of(t=>{if(t.docChanged){let i=t.state.doc.toString();eE.default.set(e,i)}}):[]);e.s(["usePersistPromptDraft",0,(e,t)=>((0,n.useEffect)(()=>{if(!e||t?.state.doc.toString())return;let i=eE.default.get(e,"string");if(i){if(!t)return;t.dispatch({changes:{from:0,to:t.state.doc.length,insert:i}})}},[e,t]),{persistPromptDraftCompartment:e_.use(e),clearPersistedPromptDraft:()=>{e&&eE.default.remove(e)}})],777110)},986212,e=>{e.v({"agent-input-glow":"index-module__VnT05G__agent-input-glow",attachments:"index-module__VnT05G__attachments",autoHeight:"index-module__VnT05G__autoHeight",codemirror:"index-module__VnT05G__codemirror",outer:"index-module__VnT05G__outer",primaryButtonGroup:"index-module__VnT05G__primaryButtonGroup",surface:"index-module__VnT05G__surface",withDrawer:"index-module__VnT05G__withDrawer",wrapper:"index-module__VnT05G__wrapper"})},61511,245218,e=>{"use strict";var t=e.i(389959),i=e.i(179302),n=e.i(98816),s=e.i(441329),a=e.i(337761),r=e.i(683389),o=e.i(16499),l=e.i(480028),d=e.i(986212);function c({view:e,setPromptEditor:c}){let u=(0,t.useRef)(null),p=(0,s.useIsInMobileWorkspace)(),h=function(){try{return(0,o.useAppKeyboardState)()}catch{return null}}(),m=(0,t.useRef)(!1);(0,t.useEffect)(function(){h?.isShown&&(m.current=!0)},[h?.isShown]);let g=(0,n.default)(c);return(0,t.useEffect)(()=>{if(!e||!g.current)return;let t=g.current,n=null;return t({setValue(t,s){if(null!==n&&(cancelAnimationFrame(n),n=null),e.state.doc.toString()!==t||s?.animate)if(s?.animate){s.onStart?.();let i=e.contentDOM;i.style.color=l.tokens.foregroundDimmer,e.dispatch({changes:{from:0,to:e.state.doc.length}});let a=t.length,r=(o=0)=>{n=requestAnimationFrame(()=>{if(!e){i.style.color="",s.onComplete?.();return}e.dispatch({changes:{from:o,to:o,insert:t[o]},selection:{anchor:o+1}}),o<a-1?r(o+1):(n=null,i.style.color="",e.focus(),s.onComplete?.())})};a>0?r():(i.style.color="",s.onComplete?.())}else e.dispatch({changes:{from:0,to:e.state.doc.length,insert:t}}),requestAnimationFrame(()=>{let t=e.state.doc.lines,n=e.state.doc.line(t).from;e.dispatch({effects:i.EditorView.scrollIntoView(n,{y:"end"})})})},getValue:()=>e.state.doc.toString(),focus(t){p&&m.current||(t?.triggerNativeScroll&&e.contentDOM.focus(),e.focus(),e.dispatch({selection:{anchor:e.state.doc.length}}))},animatePlaceholder(){e.dispatch({effects:r.animateTextEffect.of(!0)}),(0,a.styleSet)(u,"border-color",l.tokens.accentPrimaryDefault),setTimeout(()=>{requestAnimationFrame(()=>{u.current?.style.removeProperty("border-color")})},60)},animateBorder(){let t=u.current;t&&(t.style.setProperty("animation",`${d.default["agent-input-glow"]} 1.5s`),t.addEventListener("animationend",()=>t.style.removeProperty("animation"),{once:!0}),p&&m.current||e.focus())},get isFocused(){return e.hasFocus}}),()=>{null!==n&&cancelAnimationFrame(n),t(null)}},[e,g,p]),u}e.s(["useSetPromptEditor",()=>c],61511);var u=e.i(993796);function p(){return(0,u.useFlag)({controlName:"flag-url-context-feature-killswitch"})}e.s(["useUrlContextFeatureKillswitch",()=>p],245218)},507681,e=>{"use strict";var t=e.i(276385),i=e.i(389959),n=e.i(277257),s=e.i(993796),a=e.i(973245),r=e.i(951262);let o={},l=a.gql`
    mutation CreateVoiceTranscriptionToken($input: CreateVoiceTranscriptionTokenInput!) {
  createVoiceTranscriptionToken(input: $input) {
    __typename
    ... on CreateVoiceTranscriptionTokenResult {
      token
    }
    ... on UnauthorizedError {
      message
    }
    ... on NotFoundError {
      message
    }
    ... on UserError {
      message
    }
  }
}
    `;var d=e.i(222342);let c=`
class PCMProcessor extends AudioWorkletProcessor {
  constructor(options) {
    super();
    this.targetSampleRate = options.processorOptions.targetSampleRate;
    this.sourceSampleRate = options.processorOptions.sourceSampleRate;
    this.resampleBuffer = [];
    this.resampleRatio = this.sourceSampleRate / this.targetSampleRate;
    this.fractionalOffset = 0; // Track fractional sample position across blocks
  }

  // Convert Float32 samples to PCM16 bytes
  floatTo16BitPCM(float32Array) {
    const buffer = new ArrayBuffer(float32Array.length * 2);
    const view = new DataView(buffer);

    for (let i = 0; i < float32Array.length; i++) {
      let s = Math.max(-1, Math.min(1, float32Array[i]));
      s = s < 0 ? s * 0x8000 : s * 0x7FFF;
      view.setInt16(i * 2, s, true);
    }

    return new Uint8Array(buffer);
  }

  // Simple linear interpolation resampling with fractional offset tracking
  resample(inputSamples) {
    if (this.resampleRatio === 1) {
      return inputSamples;
    }

    // Start reading from the fractional position carried over from previous block
    let inputPos = this.fractionalOffset;
    const output = [];

    // Generate output samples until we run out of input
    while (inputPos < inputSamples.length - 1) {
      const srcIndexFloor = Math.floor(inputPos);
      const srcIndexCeil = srcIndexFloor + 1;
      const fraction = inputPos - srcIndexFloor;

      const sample = inputSamples[srcIndexFloor] * (1 - fraction) +
                     inputSamples[srcIndexCeil] * fraction;
      output.push(sample);

      inputPos += this.resampleRatio;
    }

    // Save fractional offset for next block (subtract the input length to get position within next block)
    // When upsampling (ratio < 1), inputPos may be < inputSamples.length, resulting in negative offset.
    // Clamp to 0 to prevent negative array indices on the next block.
    this.fractionalOffset = Math.max(0, inputPos - inputSamples.length);

    return new Float32Array(output);
  }

  process(inputs, outputs, parameters) {
    const input = inputs[0];
    if (input && input[0] && input[0].length > 0) {
      const resampled = this.resample(input[0]);
      const pcm16 = this.floatTo16BitPCM(resampled);
      this.port.postMessage(pcm16, [pcm16.buffer]);
    }
    return true;
  }
}

registerProcessor('pcm-processor', PCMProcessor);
`;class u{static workletBlobUrl=null;static preloadPromise=null;audioContext=null;workletNode=null;stream=null;source=null;gainNode=null;recording=!1;onAudioData=()=>{};get isRecording(){return this.recording}static async preloadWorklet(){return this.preloadPromise||(this.preloadPromise=(async()=>{try{if(!this.workletBlobUrl){let e=new Blob([c],{type:"application/javascript"});this.workletBlobUrl=URL.createObjectURL(e)}let e=new AudioContext({sampleRate:24e3});await e.audioWorklet.addModule(this.workletBlobUrl),await e.close()}catch(e){}})()),this.preloadPromise}static getWorkletBlobUrl(){if(!this.workletBlobUrl){let e=new Blob([c],{type:"application/javascript"});this.workletBlobUrl=URL.createObjectURL(e)}return this.workletBlobUrl}async start(){if(this.recording)throw Error("Already recording");try{this.stream=await navigator.mediaDevices.getUserMedia({audio:{sampleRate:{ideal:24e3},channelCount:1,echoCancellation:!0,noiseSuppression:!0}}),this.audioContext=new AudioContext({sampleRate:24e3});let e=this.audioContext.sampleRate,t=u.getWorkletBlobUrl();await this.audioContext.audioWorklet.addModule(t),this.workletNode=new AudioWorkletNode(this.audioContext,"pcm-processor",{processorOptions:{sourceSampleRate:e,targetSampleRate:24e3}}),this.workletNode.port.onmessage=e=>{this.recording&&this.onAudioData&&this.onAudioData(e.data)},this.gainNode=this.audioContext.createGain(),this.gainNode.gain.value=0,this.source=this.audioContext.createMediaStreamSource(this.stream),this.source.connect(this.workletNode),this.workletNode.connect(this.gainNode),this.gainNode.connect(this.audioContext.destination),this.recording=!0}catch(e){throw this.stop(),e}}stop(){this.recording=!1,this.source&&(this.source.disconnect(),this.source=null),this.workletNode&&(this.workletNode.disconnect(),this.workletNode.port.onmessage=null,this.workletNode=null),this.gainNode&&(this.gainNode.disconnect(),this.gainNode=null),this.stream&&(this.stream.getTracks().forEach(e=>e.stop()),this.stream=null),this.audioContext&&"closed"!==this.audioContext.state&&(this.audioContext.close(),this.audioContext=null)}}e.i(221042);var p=e.i(17886);e.i(242933);var h=e.i(99145),m=e.i(365669);let g={SESSION_UPDATED:"session.updated",INPUT_AUDIO_BUFFER_SPEECH_STARTED:"input_audio_buffer.speech_started",INPUT_AUDIO_BUFFER_SPEECH_STOPPED:"input_audio_buffer.speech_stopped",CONVERSATION_ITEM_CREATED:"conversation.item.created",RESPONSE_AUDIO_TRANSCRIPT_DELTA:"response.audio_transcript.delta",RESPONSE_AUDIO_TRANSCRIPT_DONE:"response.audio_transcript.done",ERROR:"error"};function f(e){return"object"==typeof e&&null!==e&&"string"==typeof e.type&&Object.values(g).includes(e.type)}class x{wsUrl;token;ws=null;connected=!1;connecting=!1;initialized=!1;listeners=new Map;constructor(e={}){this.wsUrl=e.url||m.publicEnv.NEXT_PUBLIC_TRANSCRIPTION_WS_URL||this.getDefaultWebSocketUrl(),this.token=e.token}getDefaultWebSocketUrl(){return(0,p.isEnvProduction)()?"wss://production-ai-modelproxy2.replit.com/voice":"wss://staging-ai-modelproxy2.replit.com/voice"}get isConnected(){return this.connected&&this.initialized}getListenerList(e){let t=this.listeners.get(e);return t||(t=new h.ListenerList,this.listeners.set(e,t)),t}sendSessionConfiguration(){this.ws?.send(JSON.stringify({type:"session.update",session:{type:"transcription",audio:{input:{transcription:{model:"gpt-4o-transcribe",language:"en"},turn_detection:{type:"server_vad",threshold:.5,prefix_padding_ms:250,silence_duration_ms:350}}}}}))}handleMessage(e,t,i){try{let n=JSON.parse(e.data);if(!f(n))return;if(n.type===g.SESSION_UPDATED){this.initialized=!0,this.getListenerList(n.type).notify(n),t();return}if(n.type===g.ERROR&&!this.initialized){let e=n.error?.message||"WebSocket connection error";this.disconnect(),i(Error(e));return}this.getListenerList(n.type).notify(n)}catch(e){}}handleError(e){let t={type:g.ERROR,error:{message:"WebSocket connection error",type:"connection_error"}};this.getListenerList(g.ERROR).notify(t),e(Error("WebSocket connection error"))}handleClose(e){this.connected=!1,!this.initialized&&e&&e(Error("WebSocket closed before initialization")),this.initialized=!1}async connect(){if(this.connected)throw Error("Already connected");if(this.connecting)throw Error("Connection already in progress");return this.connecting=!0,new Promise((e,t)=>{let i=setTimeout(()=>{this.initialized||(this.disconnect(),t(Error("Connection timeout: server did not respond")))},1e4),n=()=>{clearTimeout(i),this.connecting=!1},s=this.wsUrl;if(this.token){let e=s.includes("?")?"&":"?";s=`${s}${e}token=${encodeURIComponent(this.token)}`}this.ws=new WebSocket(s),this.ws.addEventListener("open",()=>{this.sendSessionConfiguration(),this.connected=!0}),this.ws.addEventListener("message",i=>{this.handleMessage(i,()=>{n(),e()},e=>{n(),t(e)})}),this.ws.addEventListener("error",()=>{n(),this.handleError(t)}),this.ws.addEventListener("close",()=>{n(),this.handleClose(t)})})}disconnect(){for(let e of(this.ws&&(this.ws.close(),this.ws=null),this.connected=!1,this.initialized=!1,this.listeners.values()))e.clear();this.listeners.clear()}sendAudio(e){if(!this.connected||!this.initialized||!this.ws)throw Error("WebSocket not connected or initialized");let t=new Uint8Array(e);this.ws.send(JSON.stringify({type:"input_audio_buffer.append",audio:function(e){let t=new Uint8Array(e),i="";for(let e=0;e<t.length;e+=8192)i+=String.fromCharCode(...t.subarray(e,e+8192));return btoa(i)}(t.buffer)}))}on(e,t){return this.getListenerList(e).add(t)}}class T{audioProcessor=null;ws=null;callbacks;state={isRecording:!1,isSpeaking:!1,error:null};cancelFlag=!1;isOperating=!1;audioBuffer=[];isWebSocketReady=!1;wsDisposers=[];constructor(e){this.callbacks=e}updateState(e){this.state={...this.state,...e},this.callbacks.onStateChange(this.state)}handleTranscriptionDelta=e=>{f(e)&&e.type===g.RESPONSE_AUDIO_TRANSCRIPT_DELTA&&e.delta&&this.callbacks.onTextDelta(e.delta)};handleSpeechStarted=()=>{this.updateState({isSpeaking:!0})};handleSpeechStopped=()=>{this.updateState({isSpeaking:!1})};handleError=e=>{let t="An error occurred during transcription";f(e)&&e.type===g.ERROR&&e.error?.message&&(t=e.error.message),this.updateState({error:t,isRecording:!1,isSpeaking:!1}),this.cleanup()};cleanup(){this.wsDisposers.forEach(e=>e()),this.wsDisposers=[],this.audioProcessor?.stop(),this.audioProcessor=null,this.ws?.disconnect(),this.ws=null,this.audioBuffer=[],this.isWebSocketReady=!1}setupWebSocket(e){let t=new x({token:e});return this.ws=t,this.wsDisposers.push(t.on(g.RESPONSE_AUDIO_TRANSCRIPT_DELTA,this.handleTranscriptionDelta),t.on(g.INPUT_AUDIO_BUFFER_SPEECH_STARTED,this.handleSpeechStarted),t.on(g.INPUT_AUDIO_BUFFER_SPEECH_STOPPED,this.handleSpeechStopped),t.on(g.ERROR,this.handleError)),t}setupAudioProcessor(){let e=new u;return this.audioProcessor=e,e.onAudioData=e=>{this.isWebSocketReady&&this.ws?.isConnected?this.ws.sendAudio(e):(this.audioBuffer.push(e),this.audioBuffer.length>100&&this.audioBuffer.shift())},e}handleStartRecordingError(e){let t=e instanceof Error?e.message:"Failed to start recording";this.updateState({isRecording:!1,isSpeaking:!1,error:t}),this.cleanup(),this.isOperating=!1}async connectWebSocket(e){await e.connect(),this.ws=e}async startAudioCapture(e){await e.start(),this.audioProcessor=e}flushAudioBuffer(){if(this.ws?.isConnected){for(let e of this.audioBuffer)this.ws.sendAudio(e);this.audioBuffer=[]}}async startRecording(){let e;this.cancelFlag=!1,this.audioBuffer=[],this.isWebSocketReady=!1,this.updateState({isRecording:!0,isSpeaking:!1,error:null});try{e=await this.callbacks.tokenFetcher()}catch(e){this.handleStartRecordingError(e);return}if(!e)return void this.handleStartRecordingError(Error("Failed to obtain authentication token"));if(this.cancelFlag){this.cleanup(),this.isOperating=!1;return}let t=this.setupWebSocket(e),i=this.setupAudioProcessor(),n=await Promise.allSettled([this.connectWebSocket(t),this.startAudioCapture(i)]);if(this.cancelFlag){this.cleanup(),this.isOperating=!1;return}let s=n[0],a=n[1];"rejected"===s.status?this.handleStartRecordingError(s.reason):"rejected"===a.status?this.handleStartRecordingError(a.reason):(this.isWebSocketReady=!0,this.flushAudioBuffer(),this.isOperating=!1)}stopRecording(){this.cancelFlag=!0,this.cleanup(),this.updateState({isRecording:!1,isSpeaking:!1,error:null}),this.isOperating=!1}async toggle(){(!this.isOperating||this.state.isRecording)&&(this.isOperating=!0,this.state.isRecording?this.stopRecording():await this.startRecording())}destroy(){this.cleanup()}getState(){return this.state}}var y=e.i(136540);function E(e){let{view:a,isDisabled:c,status:p,replId:h,isPaidUser:m}=e,g=(0,i.useRef)(null),f=(0,s.useFlag)({controlName:"flag-phantom-power",default:!1}),{state:x,toggleRecording:E,isSupported:_}=function(e){let t,{view:n,replId:s,enabled:a=!0,buttonContainerRef:c}=e,[p]=(t={...o,...void 0},r.useMutation(l,t)),{showError:h}=(0,d.default)(),[m,g]=(0,i.useState)({isRecording:!1,isSpeaking:!1,error:null}),f=(0,i.useRef)(0),x=(0,i.useRef)(null),y=(0,i.useRef)(null),E=(0,i.useMemo)(()=>!("u"<typeof AudioContext)&&"AudioContext"in window&&"audioWorklet"in AudioContext.prototype&&!!navigator.mediaDevices?.getUserMedia,[]);(0,i.useEffect)(()=>{a&&E&&u.preloadWorklet().catch(()=>{})},[a,E]),(0,i.useEffect)(()=>{y.current=null},[s]);let _=(0,i.useCallback)(async e=>{let t,i=e?.silent??!1;if(y.current)return y.current;try{t=(await p({variables:{input:{replId:s||void 0}}})).data}catch(t){let e=t instanceof Error?t.message:"Failed to authenticate";return i||h(e),""}let n=t?.createVoiceTranscriptionToken;return n?"UnauthorizedError"===n.__typename?(i||h(n.message),""):"NotFoundError"===n.__typename?(i||h("Repl not found"),""):"UserError"===n.__typename?(i||h(n.message),""):"CreateVoiceTranscriptionTokenResult"===n.__typename?(y.current=n.token,n.token):(i||h("Unexpected response type"),""):(i||h("No response from server"),"")},[p,s,h]);(0,i.useEffect)(()=>{a&&E&&_({silent:!0}).catch(()=>{})},[a,E,_]);let A=(0,i.useCallback)(e=>{if(!n||!e)return;let t=f.current,i=function(e){let{text:t,charBefore:i}=e;if(!i)return t;let n=t,s=[".",",","!","?",";",":"];if(n.startsWith(" ")&&s.includes(n[1])&&(n=n.slice(1)),1===n.length&&s.includes(n[0])&&i===n[0])return"";if(![".","!","?"].includes(i)&&n.length>0){let e=n[0];e===e.toUpperCase()&&e!==e.toLowerCase()&&(n=e.toLowerCase()+n.slice(1))}return" "===i||"\n"===i||n.startsWith(" ")||s.includes(n[0])||(n=" "+n),n}({text:e,charBefore:t>0?n.state.doc.sliceString(t-1,t):""});n.dispatch({changes:{from:t,to:t,insert:i},selection:{anchor:t+i.length}}),f.current=t+i.length},[n]);return(0,i.useEffect)(()=>{let e=new T({onStateChange:e=>{g(e),e.isRecording&&n&&(f.current=n.state.selection.main.from),!e.isRecording&&y.current&&(y.current=null)},onTextDelta:A,tokenFetcher:_});return x.current=e,()=>{e.destroy(),y.current=null}},[n,A,_]),(0,i.useEffect)(()=>{if(!n||!m.isRecording)return;let e=e=>{if("Shift"!==e.key&&"Control"!==e.key&&"Alt"!==e.key&&"Meta"!==e.key){if("Escape"===e.key){e.preventDefault(),x.current?.toggle();return}(1===e.key.length||"Backspace"===e.key||"Delete"===e.key||"Enter"===e.key)&&x.current?.toggle()}};return n.dom.addEventListener("keydown",e),()=>{n.dom.removeEventListener("keydown",e)}},[n,m.isRecording]),(0,i.useEffect)(()=>{if(!n||!m.isRecording)return;let e=e=>{let t=e.target;n.dom.contains(t)||c?.current?.contains(t)||x.current?.toggle()};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[n,m.isRecording,c]),{state:m,toggleRecording:(0,i.useCallback)(async()=>{await x.current?.toggle()},[]),isSupported:E}}({view:a,replId:h,enabled:f&&!0===m,buttonContainerRef:g});if(!f||!m||!_)return null;let A="Start voice input";return x.error?A=x.error:x.isRecording&&(A=x.isSpeaking?"Speaking... Click to stop":"Listening... Click to stop"),(0,t.jsx)("div",{ref:g,children:(0,t.jsx)(y.IconButton,{alt:A,tooltipContents:A,tooltipPlacement:"top-start",disabled:c||"loading"===p,filled:x.isRecording,colorway:"red",onClick:E,children:(0,t.jsx)(n.default,{})})})}e.s(["VoiceInputButton",()=>E],507681)}]);

//# debugId=cfa16032-4eea-4c43-5e14-36fe1072159d
//# sourceMappingURL=acc617c1d15288ca.js.map