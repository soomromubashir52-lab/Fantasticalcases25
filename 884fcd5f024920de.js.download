;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="1fc4b3fc-4a23-4c70-3e86-505862ea3640")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,933138,(e,t,r)=>{!function(){"use strict";var e={864:function(e){var t,r="object"==typeof Reflect?Reflect:null,i=r&&"function"==typeof r.apply?r.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};t=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var n=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,e.exports.once=function(e,t){return new Promise(function(r,i){var n,o,s;function l(r){e.removeListener(t,a),i(r)}function a(){"function"==typeof e.removeListener&&e.removeListener("error",l),r([].slice.call(arguments))}m(e,t,a,{once:!0}),"error"!==t&&(n=e,o=l,s={once:!0},"function"==typeof n.on&&m(n,"error",o,s))})},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var s=10;function l(e){if("function"!=typeof e)throw TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function a(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function h(e,t,r,i){if(l(r),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),o=e._events),s=o[t]),void 0===s)s=o[t]=r,++e._eventsCount;else if("function"==typeof s?s=o[t]=i?[r,s]:[s,r]:i?s.unshift(r):s.push(r),(n=a(e))>0&&s.length>n&&!s.warned){s.warned=!0;var n,o,s,h=Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");h.name="MaxListenersExceededWarning",h.emitter=e,h.type=t,h.count=s.length,console&&console.warn&&console.warn(h)}return e}function c(){if(!this.fired)return(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0==arguments.length)?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(e,t,r){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},n=c.bind(i);return n.listener=r,i.wrapFn=n,n}function u(e,t,r){var i=e._events;if(void 0===i)return[];var n=i[t];return void 0===n?[]:"function"==typeof n?r?[n.listener||n]:[n]:r?function(e){for(var t=Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(n):d(n,n.length)}function f(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function d(e,t){for(var r=Array(t),i=0;i<t;++i)r[i]=e[i];return r}function m(e,t,r,i){if("function"==typeof e.on)i.once?e.once(t,r):e.on(t,r);else if("function"==typeof e.addEventListener)e.addEventListener(t,function n(o){i.once&&e.removeEventListener(t,n),r(o)});else throw TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||n(e))throw RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");s=e}}),o.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||n(e))throw RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return a(this)},o.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,o=this._events;if(void 0!==o)n=n&&void 0===o.error;else if(!n)return!1;if(n){if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var s,l=Error("Unhandled error."+(s?" ("+s.message+")":""));throw l.context=s,l}var a=o[e];if(void 0===a)return!1;if("function"==typeof a)i(a,this,t);else for(var h=a.length,c=d(a,h),r=0;r<h;++r)i(c[r],this,t);return!0},o.prototype.addListener=function(e,t){return h(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return h(this,e,t,!0)},o.prototype.once=function(e,t){return l(t),this.on(e,p(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return l(t),this.prependListener(e,p(this,e,t)),this},o.prototype.removeListener=function(e,t){var r,i,n,o,s;if(l(t),void 0===(i=this._events)||void 0===(r=i[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(n=-1,o=r.length-1;o>=0;o--)if(r[o]===t||r[o].listener===t){s=r[o].listener,n=o;break}if(n<0)return this;0===n?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,n),1===r.length&&(i[e]=r[0]),void 0!==i.removeListener&&this.emit("removeListener",e,s||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,r,i;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0==arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0==arguments.length){var n,o=Object.keys(r);for(i=0;i<o.length;++i)"removeListener"!==(n=o[i])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},o.prototype.listeners=function(e){return u(this,e,!0)},o.prototype.rawListeners=function(e){return u(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):f.call(e,t)},o.prototype.listenerCount=f,o.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}}},r={};function i(t){var n=r[t];if(void 0!==n)return n.exports;var o=r[t]={exports:{}},s=!0;try{e[t](o,o.exports,i),s=!1}finally{s&&delete r[t]}return o.exports}i.ab="/ROOT/node_modules/.pnpm/next@16.1.6_@babel+core@7.21.4_@opentelemetry+api@1.9.0_babel-plugin-macros@3.1.0_react_4a6390a124a4cc69b521374d5faad242/node_modules/next/dist/compiled/events/",t.exports=i(864)}()},353579,e=>{"use strict";var t=e.i(434989);e.i(221042);var r=e.i(966983);let i={spock:"https://zipper.spock.platform.replit.com",janeway:"https://zipper.janeway.platform.replit.com",sisko:"https://zipper.sisko.platform.replit.com",picard:"https://zipper.picard.platform.replit.com",kirk:"https://zipper.kirk.platform.replit.com",worf:"https://zipper.worf.platform.replit.com",pike:"https://zipper.pike.platform.replit.com",riker:"https://zipper.riker.platform.replit.com",wesley:"https://zipper.wesley.platform.replit.com",archer:"https://zipper.archer.platform.replit.com","infra-staging":"https://zipper.infra-staging.platform-infra-staging.replit.com",mark:"https://zipper.mark.platform-replit.replit.com","bain-us-central1":"https://zipper.bain-us-central1.platform.replit.com","duolingo-usc1":"https://zipper.duolingo-usc1.platform.replit.com","ukg-usc1":"https://zipper.ukg-usc1.platform-ukg.replit.com","vend-euw1":"https://zipper.vend-euw1.platform-vend.replit.com","youlend-euw1":"https://zipper.youlend-euw1.platform-youlend.replit.com","amex-usc1":"https://zipper.amex-usc1.platform-amex.replit.com","msci-usc1":"https://zipper.msci-usc1.platform-msci.replit.com"};function n(e){let i=e.split(".");if(4!==i.length)throw Error("Invalid token: should have exactly 4 parts: "+e);let n=i[2].replace(/-/g,"+").replace(/_/g,"/");for(;n.length%4;)n+="=";let o=window.atob(n);if(o.length<64)throw Error("Invalid token: signed part is too short: "+o.length);let s=o.substring(0,o.length-64);return r.api.token.ReplToken.decode(t.Buffer.from(s,"base64"))}function o(e){let t=i[e];if(!t)throw Error(`Unknown cluster: ${e}`);return t}e.s(["getZipperUrl",()=>o,"parseToken",()=>n],353579)},240913,e=>{"use strict";var t=e.i(193060);let r=(0,t.toRelativeFsPath)("."),i=(0,t.toRelativeFsPath)(".env");(0,t.toRelativeFsPath)(".lesson"),(0,t.toRelativeFsPath)(".tutorial"),e.s(["DOT_ENV",0,i,"ROOT_PATH",0,r])},469546,(e,t,r)=>{var i;i=function(e){e.version="1.2.2";var t=function(){for(var e=0,t=Array(256),r=0;256!=r;++r)e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=r)?-0x12477ce0^e>>>1:e>>>1)?-0x12477ce0^e>>>1:e>>>1)?-0x12477ce0^e>>>1:e>>>1)?-0x12477ce0^e>>>1:e>>>1)?-0x12477ce0^e>>>1:e>>>1)?-0x12477ce0^e>>>1:e>>>1)?-0x12477ce0^e>>>1:e>>>1)?-0x12477ce0^e>>>1:e>>>1,t[r]=e;return"u">typeof Int32Array?new Int32Array(t):t}(),r=function(e){var t=0,r=0,i=0,n="u">typeof Int32Array?new Int32Array(4096):Array(4096);for(i=0;256!=i;++i)n[i]=e[i];for(i=0;256!=i;++i)for(r=e[i],t=256+i;t<4096;t+=256)r=n[t]=r>>>8^e[255&r];var o=[];for(i=1;16!=i;++i)o[i-1]="u">typeof Int32Array?n.subarray(256*i,256*i+256):n.slice(256*i,256*i+256);return o}(t),i=r[0],n=r[1],o=r[2],s=r[3],l=r[4],a=r[5],h=r[6],c=r[7],p=r[8],u=r[9],f=r[10],d=r[11],m=r[12],g=r[13],y=r[14];e.table=t,e.bstr=function(e,r){for(var i=-1^r,n=0,o=e.length;n<o;)i=i>>>8^t[(i^e.charCodeAt(n++))&255];return~i},e.buf=function(e,r){for(var v=-1^r,E=e.length-15,C=0;C<E;)v=y[e[C++]^255&v]^g[e[C++]^v>>8&255]^m[e[C++]^v>>16&255]^d[e[C++]^v>>>24]^f[e[C++]]^u[e[C++]]^p[e[C++]]^c[e[C++]]^h[e[C++]]^a[e[C++]]^l[e[C++]]^s[e[C++]]^o[e[C++]]^n[e[C++]]^i[e[C++]]^t[e[C++]];for(E+=15;C<E;)v=v>>>8^t[(v^e[C++])&255];return~v},e.str=function(e,r){for(var i=-1^r,n=0,o=e.length,s=0,l=0;n<o;)(s=e.charCodeAt(n++))<128?i=i>>>8^t[(i^s)&255]:s<2048?i=(i=i>>>8^t[(i^(192|s>>6&31))&255])>>>8^t[(i^(128|63&s))&255]:s>=55296&&s<57344?(s=(1023&s)+64,l=1023&e.charCodeAt(n++),i=(i=(i=(i=i>>>8^t[(i^(240|s>>8&7))&255])>>>8^t[(i^(128|s>>2&63))&255])>>>8^t[(i^(128|l>>6&15|(3&s)<<4))&255])>>>8^t[(i^(128|63&l))&255]):i=(i=(i=i>>>8^t[(i^(224|s>>12&15))&255])>>>8^t[(i^(128|s>>6&63))&255])>>>8^t[(i^(128|63&s))&255];return~i}},"u"<typeof DO_NOT_EXPORT_CRC?i(r):i({})},435575,e=>{"use strict";var t=e.i(716499),r=e.i(980768),i=e.i(529131);function n(e,n){(0,i.default)(2,arguments);var o=(0,t.default)(n);return(0,r.default)(e,1e3*o)}e.s(["addSeconds",()=>n],435575)},494065,e=>{"use strict";var t=e.i(968069);let r=/^(\.npm$|\.npm\/|__pycache__|\.cache|\.breakpoints|\.git$|\.git\/|\.upm$|\.upm\/|node_modules$|node_modules\/|_test_runner|\.local)/;function i(e){return r.test(e)}function n(e){return e.startsWith(".")&&!t.default.includes(e)}e.s(["ignoredDirs",0,[".git",".upm",".cache","__pycache__","node_modules","venv",".pythonlibs",".local"],"isDotFile",()=>n,"isHiddenFile",()=>i])},880581,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.uniToStrPos=r.strPosToUni=void 0,r.strPosToUni=(e,t=e.length)=>{let r=0,i=0;for(;i<t;i++){let t=e.charCodeAt(i);t>=55296&&t<=57343&&(r++,i++)}if(i!==t)throw Error("Invalid offset - splits unicode bytes");return i-r},r.uniToStrPos=(e,t)=>{let r=0;for(;t>0;t--){let t=e.charCodeAt(r);r+=t>=55296&&t<=57343?2:1}return r}},118074,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});let i=e.r(880581),n=e=>{if(!Array.isArray(e))throw Error("Op must be an array of components");let t=null;for(let r=0;r<e.length;r++){let i=e[r];switch(typeof i){case"object":if(!("number"==typeof i.d&&i.d>0))throw Error("Object components must be deletes of size > 0");break;case"string":if(!(i.length>0))throw Error("Inserts cannot be empty");break;case"number":if(!(i>0))throw Error("Skip components must be >0");if("number"==typeof t)throw Error("Adjacent skip components should be combined")}t=i}if("number"==typeof t)throw Error("Op has a trailing skip")},o=e=>{let t=[],r=s(t);for(let t=0;t<e.length;t++)r(e[t]);return h(t)},s=e=>t=>{t&&0!==t.d&&(0===e.length?e.push(t):typeof t==typeof e[e.length-1]?"object"==typeof t?e[e.length-1].d+=t.d:e[e.length-1]+=t:e.push(t))},l=e=>"number"==typeof e?e:"string"==typeof e?i.strPosToUni(e):e.d,a=e=>{let t=0,r=0;return{take:(n,o)=>{let s;if(t===e.length)return -1===n?null:n;let l=e[t];if("number"==typeof l)if(-1===n||l-r<=n)return s=l-r,++t,r=0,s;else return r+=n,n;if("string"==typeof l)if(-1===n||"i"===o||i.strPosToUni(l.slice(r))<=n)return s=l.slice(r),++t,r=0,s;else{let e=r+i.uniToStrPos(l.slice(r),n);return s=l.slice(r,e),r=e,s}return -1===n||"d"===o||l.d-r<=n?(s={d:l.d-r},++t,r=0,s):(r+=n,{d:n})},peek:()=>e[t]}},h=e=>(e.length>0&&"number"==typeof e[e.length-1]&&e.pop(),e);function c(e,t,r){let o;if("left"!==r&&"right"!==r)throw Error("side ("+r+") must be 'left' or 'right'");n(e),n(t);let c=[],p=s(c),{take:u,peek:f}=a(e);for(let e=0;e<t.length;e++){let n,o,s=t[e];switch(typeof s){case"number":for(n=s;n>0;)p(o=u(n,"i")),"string"!=typeof o&&(n-=l(o));break;case"string":"left"===r&&"string"==typeof f()&&p(u(-1)),p(i.strPosToUni(s));break;case"object":for(n=s.d;n>0;)switch(typeof(o=u(n,"i"))){case"number":n-=o;break;case"string":p(o);break;case"object":n-=o.d}}}for(;o=u(-1);)p(o);return h(c)}function p(e,t){let r;n(e),n(t);let o=[],c=s(o),{take:p}=a(e);for(let e=0;e<t.length;e++){let r,n,o=t[e];switch(typeof o){case"number":for(r=o;r>0;)c(n=p(r,"d")),"object"!=typeof n&&(r-=l(n));break;case"string":c(o);break;case"object":for(r=o.d;r>0;)switch(typeof(n=p(r,"d"))){case"number":c({d:n}),r-=n;break;case"string":r-=i.strPosToUni(n);break;case"object":c(n)}}}for(;r=p(-1);)c(r);return h(o)}let u=(e,t)=>{let r=0;for(let n=0;n<t.length&&e>r;n++){let o=t[n];switch(typeof o){case"number":r+=o;break;case"string":let s=i.strPosToUni(o);r+=s,e+=s;break;case"object":e-=Math.min(o.d,e-r)}}return e},f=(e,t)=>"number"==typeof e?u(e,t):e.map(e=>u(e,t));r.default=function(e){return{name:"text-unicode",uri:"http://sharejs.org/types/text-unicode",trim:h,normalize:o,checkOp:n,create(t=""){if("string"!=typeof t)throw Error("Initial data must be a string");return e.create(t)},apply(t,r){n(r);let i=e.builder(t);for(let e=0;e<r.length;e++){let t=r[e];switch(typeof t){case"number":i.skip(t);break;case"string":i.append(t);break;case"object":i.del(t.d)}}return i.build()},transform:c,compose:p,transformPosition:u,transformSelection:f}}},753221,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});let i=e.r(880581);function n(e,t){return{get:e,getLength:()=>e().length,insert:(r,n,o)=>t([i.strPosToUni(e(),r),n],o),remove:(r,n,o)=>t([i.strPosToUni(e(),r),{d:n}],o),_onOp(e){for(var t=0,r=0,i=0;i<e.length;i++){var n=e[i];switch(typeof n){case"number":t+=n,r+=n;break;case"string":this.onInsert&&this.onInsert(t,n),t+=n.length;break;case"object":this.onRemove&&this.onRemove(t,n.d),r+=n.d}}},onInsert:null,onRemove:null}}r.default=n,n.provides={text:!0}},402238,(e,t,r)=>{"use strict";var i=e.e&&e.e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.type=void 0;let n=e.r(880581),o=i(e.r(118074)),s=i(e.r(753221));r.type=Object.assign(Object.assign({},o.default({create:e=>e,toString:e=>e,builder(e){if("string"!=typeof e)throw Error("Invalid document snapshot: "+e);let t=[];return{skip(r){let i=n.uniToStrPos(e,r);if(i>e.length)throw Error("The op is too long for this document");t.push(e.slice(0,i)),e=e.slice(i)},append(e){t.push(e)},del(t){e=e.slice(n.uniToStrPos(e,t))},build:()=>t.join("")+e}}})),{api:s.default});var l=e.r(118074);Object.defineProperty(r,"makeType",{enumerable:!0,get:function(){return l.default}})},629712,798680,e=>{"use strict";e.i(221042);var t=e.i(830675),r=e.i(790155),i=e.i(960933),n=e.i(862927),o=e.i(469546),s=e.i(435575),l=e.i(753950),a=e.i(328751),h=e.i(966983),c=e.i(644920),p=e.i(968263),u=e.i(995683),f=e.i(193060),d=e.i(205104),m=e.i(353579),g=e.i(494065),y=e.i(240913),v=e.i(933138),E=e.i(223808),C=e.i(402238),w=e.i(827444),F=e.i(709485),b=e.i(272391);function T(e){return e.map(e=>"object"==typeof e?{delete:e.d}:"number"==typeof e?{skip:e}:{insert:e})}function k(e){return e.map(e=>{if("delete"in e&&e.delete)return{d:e.delete};if("skip"in e&&e.skip)return e.skip;if("insert"in e&&"string"==typeof e.insert)return e.insert;throw Error("Unexpected op type")})}function O(e,t){let r=[],i=t,n=0,o=0,s=0,l=0,a=e=>{let r=e-o;if(e<o)throw Error("expected changeset to be ordered");for(let e=o+s;e<o+r+s;e++){let r=t.charCodeAt(e);r>=55296&&r<=57343?(l++,e++):13===r&&10===t.charCodeAt(e+1)&&(s++,e++)}o+=r};return e.iterChanges((e,t,h,c,p)=>{if(e>0){let t=o+s,i=t-l;a(e);let h=o+s,c=h-l;r.push(c-i),n+=h-t}if(e!==t){let e=o+s,h=e-l;a(t);let c=o+s,p=c-l;r.push({d:p-h}),i=i.slice(0,n)+i.slice(n+(c-e))}if(p.length){let e=p.sliceString(0);r.push(e),i=i.slice(0,n)+e+i.slice(n),n+=e.length}}),{op:r,docAfter:i}}function D(e,t){let r,i=[],n=t,o=0,s=0,a=0,h=0,c=e=>{for(let r=s+a;r<s+e+a;r++){let e=t.charCodeAt(r);e>=55296&&e<=57343?(a++,r++):13===e&&10===t.charCodeAt(r+1)&&(h++,r++)}s+=e};for(let l of e)if("string"==typeof l){let e=l;n=n.slice(0,o)+e+n.slice(o),o+=e.length;let c=s+a;if(e.endsWith("\r")&&"\n"===t.slice(c,c+1)&&0===(e=e.slice(0,-1)).length)continue;let p=R(e),u=c-h;r?.to===u?r.insert=r.insert?r.insert.append(p):p:(r={from:c-h,insert:p},i.push(r))}else if("number"==typeof l){let e=a;c(l),o+=l+(a-e)}else if("d"in l){let e=s+a,p=h;c(l.d);let u=s+a,f=u-e;n=n.slice(0,o)+n.slice(o+f);let d=e-p,m=u-h;if("\r\n"===t.slice(e-1,e+1)&&(m-=1)-(d+=1)<=0)continue;r?.to===d?r.to=m:(r={from:d,to:m},i.push(r))}if(s+a!==t.length){let e=t.slice(s+a);h+=e.split("\r\n").length-1}return{changes:l.ChangeSet.of(i,t.length-h),docAfter:n}}let x=/\r\n?|\n/;function S(e){return e.replaceAll("\r\n","\n").replaceAll("\r","\n")}function R(e){return l.Text.of(e.split(x))}e.s(["asCodeMirrorText",()=>R,"changeSetToOp",()=>O,"fromProtocolOp",()=>k,"opToChangeSet",()=>D,"toCodeMirrorString",()=>S,"toProtocolOp",()=>T],798680);var _=e.i(569910),P=e.i(903381);function L(e,t){for(let r of t)switch(r){case P.FsErrors.NotFound:if(e.includes("no such file")||e.includes("file does not exist"))return P.FsErrors.NotFound;break;case P.FsErrors.AlreadyExists:if(e.includes("file exist"))return P.FsErrors.AlreadyExists;break;case P.FsErrors.NotDirectory:if(e.includes("not a directory"))return P.FsErrors.NotDirectory;break;case P.FsErrors.IsDirectory:if(e.includes("is a directory"))return P.FsErrors.IsDirectory;break;case P.FsErrors.InvalidPath:if(e.includes("absolute paths are not supported"))return P.FsErrors.InvalidPath;break;case P.FsErrors.DiskQuotaExceeded:if(e.includes("disk quota exceeded"))return P.FsErrors.DiskQuotaExceeded;break;case P.FsErrors.PermissionDenied:if(e.includes("permission denied"))return P.FsErrors.PermissionDenied;break;case P.FsErrors.FileSystemUnavailable:if(e.includes("input/output error"))return P.FsErrors.FileSystemUnavailable;break;case P.FsErrors.NotReadable:if(e.includes("could not read the uploaded file"))return P.FsErrors.NotReadable;break;default:(0,_.default)(r)}return null}class N extends v.EventEmitter{linkedFile;channel;destroy;metadata;pending;inflight;inflightOpsPromise;version;serverContent;localContent;pendingCursors;flushedCursorIds;user;debounceSend;debounceCommit;commitPromise;isReconnecting;shouldTrackDataLoss;replId;uncommittedOps;hasUncommittedMultiplayerOps;committedVersion;committedContent;flushFailed;bufferedReconnectingOps;didEditOffline;reconnectTrackedData;timeDisconnected;logger;track;dataloss;constructor(e,t,r,i,n,o){super(),this.shouldTrackDataLoss=!1,this.replId="",this.linkedFile=e,this.channel=null,this.inflight=[],this.inflightOpsPromise=null,this.uncommittedOps=[],this.hasUncommittedMultiplayerOps=!1,this.committedVersion=-1,this.isReconnecting=!1,this.bufferedReconnectingOps=[],this.didEditOffline=!1,this.pending=[],this.metadata={},this.version=-1,this.serverContent="",this.localContent="",this.committedContent="",this.flushedCursorIds=[],this.pendingCursors=[],this.user=null,this.flushFailed=0,this.debounceSend=(0,E.default)(()=>this.sendOp(),20,{maxWait:60});const s=(0,E.default)(()=>this.commitToDisk(),1e3,{maxWait:3e3}),l=()=>{if(!this.channel)throw Error("Tryna commit while offline");if(this.isReconnecting)throw Error("Committing while reconnecting");return s()};l.cancel=s.cancel,l.flush=s.flush,this.debounceCommit=l,this.commitPromise=null,this.timeDisconnected=null;let a=!1;this.destroy=()=>{a=!0},this.logger=i,this.track=o,this.dataloss=n,r.then(()=>{a||(this.destroy=t.openChannel({service:"ot",name:`ot:${e}`},({channel:t,context:r})=>(this.shouldTrackDataLoss=!window.navigator.userAgent.includes("Firefox"),this.replId=r.repl.id,this.dataloss&&this.shouldTrackDataLoss&&this.dataloss.ensureTrackedFile({replId:this.replId,filePath:e.toString()}),this.user=r.currentUser?{name:r.currentUser.username,id:r.currentUser.id}:null,this.channel=t,t.onCommand(e=>{switch(e.body){case"ot":{if(!e.ot||null==e.ot.op||null==e.ot.spookyVersion||null==e.ot.crc32)return void this.onError("missing data in ot packet",{originalError:null,op:e.ot?.op,spookyVersion:e.ot?.spookyVersion,crc32:e.ot?.crc32});if(-1===this.version)return;let t={crc32:e.ot.crc32,op:k(e.ot.op),version:e.ot.spookyVersion,userId:e.ot.userId??0};return this.handlePacket(t,{overrideReconnectingBuffer:!1})}case"otstatus":return this.handleStatus(e.otstatus);case"error":if(e.ref)return;return this.onError("Unknown protocol error OT channel",{originalError:e.error||"no error"});case"otNewCursor":return this.handleNewCursor(e.otNewCursor);case"otDeleteCursor":return this.handleDeleteCursor(e.otDeleteCursor)}}),()=>{this.channel=null,this.isReconnecting=!0,this.debounceSend.cancel(),this.debounceCommit.cancel(),this.timeDisconnected||(this.timeDisconnected=Date.now())})))})}writeChanges=(e,t)=>{if(!this.channel&&!this.isReconnecting)throw Error("Trying to send changes before ever coming online");this.isReconnecting&&(this.didEditOffline=!0);let{op:r,docAfter:i}=O(e,this.localContent);if(.1>Math.random()){let t=S(C.type.apply(this.localContent,r)),n=e.apply(R(this.localContent));(t!==n.sliceString(0)||t!==S(i))&&this.onError("changeset to op mismatch",{originalError:null,changes:e,otContent:t,changeSetContent:n,docAfter:i})}let n=t?.author==="ghostwriter"?{author:h.api.OTPacket.Author.GHOSTWRITER}:{};this.metadata={...this.metadata,...n};try{this.pending=C.type.compose(this.pending,r)}catch(e){throw b.default.wrap(e).setExtras({op:r,pending:this.pending})}this.localContent=i,0!==this.pending.length?this.emit("fileDirty"):this.commitPromise&&this.emit("commitStart"),this.debounceSend()};updateCursors=e=>{this.pendingCursors=e,this.debounceSend()};isClean=()=>this.committedVersion===this.version&&0===this.inflight.length&&0===this.pending.length;async commitToDisk(){if(!this.channel)throw Error("Tryna commit while offline");if("open"!==this.channel.status)return;if(this.isReconnecting)throw Error("Committing while reconnecting");if(this.isClean())return;if(this.commitPromise)return void this.debounceCommit();let e=()=>void 0;if(this.commitPromise=new Promise(t=>e=t),this.inflightOpsPromise&&(await this.inflightOpsPromise).channelClosed){this.commitPromise=null,e();return}if(this.pending.length>0){if(this.debounceSend(),this.debounceSend.flush(),!this.inflightOpsPromise){this.commitPromise=null,e(),this.onError("expected inflight promise",{originalError:null});return}if((await this.inflightOpsPromise).channelClosed){this.commitPromise=null,e();return}}this.emit("commitStart");let t=this.version,r=this.serverContent,i=await this.channel.request({flush:{consistency:h.api.Flush.Consistency.Disk}});if(i.channelClosed){this.flushFailed=0,this.commitPromise=null,e();return}if("ok"!==i.body){this.commitPromise=null,e();let t=i.error||i.toString();return L(t,[P.FsErrors.NotFound,P.FsErrors.AlreadyExists,P.FsErrors.NotDirectory,P.FsErrors.IsDirectory,P.FsErrors.DiskQuotaExceeded])?void this.onError("unable to flush",{originalError:t}):(this.flushFailed++,void setTimeout(()=>{this.isReconnecting||this.channel&&"open"===this.channel.status&&this.debounceCommit()},Math.min(Math.random()*(2**this.flushFailed-1)*1e3,1024e3)))}if(this.dataloss&&this.shouldTrackDataLoss){let e=this.uncommittedOps[this.uncommittedOps.length-1];e&&this.dataloss.storeOp({replId:this.replId,filePath:this.linkedFile.toString(),op:{crc32:e.crc32,version:e.version},opType:"latestFlushedOp",logger:this.logger,isReconnecting:this.isReconnecting})}return this.uncommittedOps=[],this.hasUncommittedMultiplayerOps=!1,this.committedVersion=t,this.committedContent=r,this.flushFailed=0,this.emit("commitComplete",t),this.isClean()&&this.emit("fileClean"),this.commitPromise=null,e(),i}onError=(e,t)=>{if(t.originalError){let e="string"==typeof t.originalError?t.originalError:t.originalError.message,r=L(e,[P.FsErrors.NotFound,P.FsErrors.IsDirectory,P.FsErrors.DiskQuotaExceeded,P.FsErrors.InvalidPath,P.FsErrors.PermissionDenied,P.FsErrors.FileSystemUnavailable]);if(r)return void this.emit("fsError",r,e)}this.destroy();let r=Error("OT Error: "+e);this.emit("error",r,{...t,filePath:this.linkedFile,version:this.version})};sendOp=()=>{if(this.channel&&"open"===this.channel.status&&!this.isReconnecting&&!(this.inflight.length>0)){if(0!==this.pending.length){let e=T(this.pending);this.inflight=this.pending,this.pending=[],this.inflightOpsPromise=this.channel.request({ot:{spookyVersion:this.version,op:e,...this.metadata}}),this.metadata={},this.inflightOpsPromise.then(t=>{t.error&&this.onError("error accepting packet",{originalError:t.error,op:e})})}if(0!==this.pendingCursors.length){for(let e of this.flushedCursorIds)this.channel.send({otDeleteCursor:{id:e}});for(let e of(this.flushedCursorIds=[],this.pendingCursors)){let t=Number(Math.random().toString().split(".")[1]).toString(36);this.flushedCursorIds.push(t),this.channel.send({otNewCursor:{id:t,user:this.user,...e}})}this.pendingCursors=[]}}};handlePacket=({op:e,version:t,crc32:r,userId:i},{overrideReconnectingBuffer:n})=>{let s,l;if(this.isReconnecting&&!n)return void this.bufferedReconnectingOps.push({crc32:r,op:e,version:t,userId:i});if(-1===this.version)return void this.onError("Got packet while version is still -1, expected version to be set in handleStatus",{originalError:null});if(this.version++,t!==this.version){let r={originalError:null,expectedVersion:this.version,receivedVersion:t,incomingOp:e};this.logger.error("OT Error: invalid server version",(0,w.flattenExtra)({details:r})),this.onError("invalid server version",r);return}try{this.serverContent=C.type.apply(this.serverContent,e)}catch(t){this.onError("unable to apply updated content",{originalError:t,incomingOp:e});return}let a=o.str(this.serverContent)>>>0;if(a!==r){let i={originalError:null,incomingVersion:t,server:r,client:a,incomingOp:e};this.logger.error("OT Error: crc32 mismatch",(0,w.flattenExtra)({details:i})),this.onError("crc32 mismatch",i);return}if(this.uncommittedOps.push({version:t,crc32:r,op:e,userId:i}),this.dataloss&&this.shouldTrackDataLoss&&this.dataloss.storeOp({replId:this.replId,filePath:this.linkedFile.toString(),opType:"latestOp",op:{version:t,crc32:r},logger:this.logger,isReconnecting:this.isReconnecting}),JSON.stringify(e)===JSON.stringify(this.inflight)){this.dataloss&&this.shouldTrackDataLoss&&this.dataloss.storeOp({replId:this.replId,filePath:this.linkedFile.toString(),opType:"latestOwnOp",op:{version:t,crc32:r},logger:this.logger,isReconnecting:this.isReconnecting}),this.debounceCommit(),this.inflight=[],this.inflightOpsPromise=null,this.debounceSend(),this.debounceSend.flush();return}if(this.commitPromise||this.emit("fileDirty"),this.debounceCommit(),this.hasUncommittedMultiplayerOps=!0,this.inflight.length){let t=C.type.transform(this.inflight,e,"right");e=C.type.transform(e,this.inflight,"left"),this.inflight=t}if(this.pending.length){let t=C.type.transform(this.pending,e,"right");e=C.type.transform(e,this.pending,"left"),this.pending=t}try{({changes:s,docAfter:l}=D(e,this.localContent))}catch(t){this.onError("unable to apply updated op",{originalError:t,incomingOp:e});return}if(.1>Math.random()){let t=S(C.type.apply(this.localContent,e)),r=s.apply(R(this.localContent));(t!==r.sliceString(0)||t!==S(l))&&this.onError("op to changeset mismatch",{originalError:null,op:e,otContent:t,changeSetContent:r,docAfter:l})}this.localContent=l,this.emit("changes",s,i)};handleNewCursor=e=>{this.emit("cursor",e)};handleDeleteCursor=({id:e})=>{this.emit("removeCursor",e)};handleStatus=async e=>{if(!this.channel||"open"!==this.channel.status)return;if(e.linkedFile)return null==e.contents?void this.onError("expected status contents, got null or undefined",{originalError:null}):null==e.cursors?void this.onError("expected status cursors, got null or undefined",{originalError:null}):null==e.version?void this.onError("expected status version, got null or undefined",{originalError:null}):this.isReconnecting?void this.handleReconnect(e.contents,e.version):(this.dataloss&&this.shouldTrackDataLoss&&this.dataloss.checkAndTrack({serverContent:e.contents,serverVersion:e.version,replId:this.replId,filePath:this.linkedFile.toString(),fetchOps:this.fetchOps,logger:this.logger}),this.serverContent=e.contents,this.localContent=this.serverContent,this.version=e.version,this.emit("firstConnect"),this.emit("changes",l.ChangeSet.of({from:0,insert:this.serverContent},0)),e.cursors.forEach(this.handleNewCursor),this.emit("fileDirty"),void this.debounceCommit());let t=await this.channel.request({otLinkFile:{file:{path:this.linkedFile.toString()}}});if(t.channelClosed)return;if(t.error)return void this.onError("link file error "+t.error.replace(this.linkedFile.toString(),"$FILENAME"),{originalError:t.error});if(!t.otLinkFileResponse)return void this.onError("unexpected link file response: "+JSON.stringify(t.toJSON()),{originalError:null});let r=t.otLinkFileResponse.version,i=u.default.from(t.otLinkFileResponse.linkedFile?.content??"").toString();this.isReconnecting?this.handleReconnect(i,r):(this.dataloss&&this.shouldTrackDataLoss&&this.dataloss.checkAndTrack({serverContent:i,serverVersion:r,replId:this.replId,filePath:this.linkedFile.toString(),fetchOps:this.fetchOps,logger:this.logger}),this.serverContent=i,this.localContent=this.serverContent,this.version=r,this.committedVersion=r,this.committedContent=this.serverContent,this.emit("firstConnect"),this.emit("changes",l.ChangeSet.of({from:0,insert:this.serverContent},0)))};handleReconnect=async(e,t)=>{if(!this.timeDisconnected)throw Error("wat");let r=Date.now()-this.timeDisconnected,i={case:"other",remoteContent:e,localContent:this.localContent},n=i=>{this.reconnectTrackedData={...i,serverVersion:t,ourVersion:this.version,ourCommittedVersion:this.committedVersion,areContentsEqual:this.serverContent===e,areCommittedContentsEqual:this.committedContent===e,didReceiveOpsWhileReconnecting:!!this.bufferedReconnectingOps.length,didEditOffline:this.didEditOffline,hasPendingOps:!!this.pending.length,hasUncommittedMultiplayerOps:this.hasUncommittedMultiplayerOps,disconnectDuration:r};let n={};("has_inflight"===i.case||"same_version_different_content"===i.case||"multiplayer"===i.case)&&.1>Math.random()&&(n={hasAdditionalLogs:!0,localContent:String(this.localContent),ourContent:String(this.serverContent),ourCommittedContent:String(this.committedContent),ourInflight:JSON.stringify(this.inflight),ourPending:JSON.stringify(this.pending),serverContent:String(e)}),this.logger.info("OT Client: Reconnect",(0,w.flattenExtra)({...this.reconnectTrackedData,...n})),this.track&&this.track(F.events.FILE_RECONNECTED_STATUS2,this.reconnectTrackedData)},o=(e,t)=>{n({case:e,originCase:t,prompted:!1}),this.isReconnecting=!1,this.bufferedReconnectingOps=[],this.didEditOffline=!1,this.timeDisconnected=null,this.debounceSend(),this.debounceCommit(),this.emit("transparentReconnect",{case:e,originCase:t})},s=r=>{if(i.remoteContent===i.localContent){this.version=t,this.committedVersion=t,this.localContent=e,this.committedContent=e,this.serverContent=e,this.inflight=[],this.pending=[],o("unprompted_because_identical",r);return}n({case:r,prompted:!0}),i.case=r,this.emit("promptUserReconnect",i)};if(this.inflight.length){if(t===this.version&&this.serverContent===e){this.pending=C.type.compose(this.inflight,this.pending),this.inflight=[],this.inflightOpsPromise=null,o("has_inflight_happy_path_ops_unreached");return}let r=!1,i=this.serverContent;try{i=C.type.apply(i,this.inflight)}catch(e){r=!0}if(!r&&this.version+1===t&&i===e){this.inflight=[],this.inflightOpsPromise=null,this.serverContent=e,this.version=t,o("has_inflight_happy_path_ops_reached");return}s("has_inflight");return}if(this.hasUncommittedMultiplayerOps)return void s("multiplayer");if(this.version===t)return e===this.serverContent?void o("happy_path"):void s("same_version_different_content");if(this.committedVersion===t){let r=e;try{for(let{op:e}of this.uncommittedOps)r=C.type.apply(r,e)}catch(e){s("same_committed_version_unable_to_apply_ops");return}if(r===this.serverContent){let r=[];for(let{op:e}of this.uncommittedOps)r=C.type.compose(r,e);this.pending=C.type.compose(r,this.pending),this.uncommittedOps=[],this.version=t,this.serverContent=e,o("happy_path_uncommitted");return}s("same_committed_version_different_content_fixed");return}if(this.version<t){let r=await this.fetchOps(this.version+1,t),i=!1,n=this.serverContent;try{for(let{op:e}of r)n=C.type.apply(n,e)}catch(e){i=!0}if(!i&&n===e){for(let e of r)this.handlePacket(e,{overrideReconnectingBuffer:!0});for(let e of this.bufferedReconnectingOps)this.handlePacket(e,{overrideReconnectingBuffer:!0});o("happy_path_server_ahead");return}let l=await this.fetchOps(this.committedVersion+1,t),a=!1,h=this.committedContent;try{for(let{op:e}of l)h=C.type.apply(h,e)}catch(e){a=!0}return a||h!==e?void s("uncommitted_server_ahead"):void s("happy_path_uncommitted_server_ahead")}s("other")};flush=async()=>{await this.commitPromise,this.debounceCommit(),this.debounceCommit.flush(),await this.commitPromise};isFileSaved=()=>!0;fetchOps=async(e,t)=>{if(!this.channel)throw Error("No channel, cannot fetchOps");let r=await this.channel.request({otFetchRequest:{versionFrom:e,versionTo:t}});if(r.channelClosed)throw Error("Channel closed while requesting");if(r.error)throw Error("Fetch ops returned an error: "+r.error);if(!r.otFetchResponse)throw Error("Expected otFetchResponse");if(!r.otFetchResponse.packets)throw Error("Expected otFetchResponse.packets");return r.otFetchResponse.packets.map(({crc32:e,op:t,version:r,userId:i,committed:n,author:o})=>{if(null==e)throw Error("Expected crc32 in packet");if(null==t)throw Error("Expected op in packet");if(null==r)throw Error("Expected version in packet");return{crc32:e,version:r,op:k(t),userId:i,timestamp:n?1e3*n.seconds:0,author:o}})};fetchChanges=async(e,t,r)=>{let i=await this.fetchOps(e,t),n=r;return i.map(({op:e,version:t,userId:r,timestamp:i,crc32:o})=>{let{changes:s,docAfter:l}=D(e,n),a=s.invert(R(n));return n=l,{changes:s,invertedChanges:a,userId:r,version:t,timestamp:i,crc32:o}})};transformSelection=async({indexStart:e,indexEnd:t,versionFrom:r,versionTo:i})=>{if(!this.channel)throw Error("No channel, cannot transformSelection");let n=await this.channel.request({otTransformSelectionRequest:{indexStart:e,indexEnd:t,versionFrom:r,versionTo:i}});if(!n.otTransformSelectionResponse)throw Error("Expected otTransformSelectionResponse");return{indexStart:n.otTransformSelectionResponse.indexStart??0,indexEnd:n.otTransformSelectionResponse.indexEnd??0,version:n.otTransformSelectionResponse.version??0}};getLocalContent=()=>S(this.localContent);getRawLocalContent=()=>this.localContent}var M=e.i(837399);function I({container:e,dataloss:i,track:n}){let s,{enqueue:m,flush:v}=function(e=1e4){let t=[];return{enqueue:function(r,...i){if(t.length>=e)throw Error("fs: We retried too many things during a closed channel.");return new Promise(e=>{t.push(e)}).then(()=>r(...i))},flush:function(){t.splice(0,t.length).forEach(e=>e())}}}(),E=!1,C=null,w=null,F=null,b=0,T=new Map,k=new Map,O=new Map,D=[],x=new Map,S=new Set;e.openChannel({service:"fsevents"},({channel:e})=>{C=e,e.onCommand(e=>{let r;if("fileEvent"!==e.body)return;if(!e.fileEvent)throw Error("Expected fileEvent");let{fileEvent:{file:i,dest:n,op:o}}=e;if(!i)return;let{path:s}=i;if(null===s||null===o||void 0===s||void 0===o)return;let l=(0,f.toRelativeFsPath)(s);if(U(),T.get(l)||i.type===h.api.File.Type.DIRECTORY)r=P.FileType.Directory;else{let e=Array.from(T.keys()).find(e=>(0,f.isChildOf)(e,l)),t=e&&T.get(e)?.children.find(e=>e.filename===(0,f.getFsBaseName)(l));r=t?t.type:P.FileType.File}switch(o){case h.api.FileEvent.Op.Create:B({eventType:P.ChangeEventType.Create,node:{path:l,type:r}});break;case h.api.FileEvent.Op.Modify:if(r===P.FileType.Directory){t.withScope(e=>{e.setTag("service","fs"),e.setExtra("path-str",s),e.setExtra("op",o),e.setExtra("file-type",r),t.captureException(Error("Unexpected modify directory event"))});break}B({eventType:P.ChangeEventType.Modify,node:{path:l,type:r}});break;case h.api.FileEvent.Op.Remove:B({eventType:P.ChangeEventType.Delete,node:{path:l,type:r}});break;case h.api.FileEvent.Op.Move:{if(null==n||null==n.path)throw Error("Expected dest path");let{path:e}=n;B({eventType:P.ChangeEventType.Move,node:{path:l,type:r},to:(0,f.toRelativeFsPath)(e)})}}});let r=[...new Set([...T.keys(),...k.keys(),...O.keys()])];return r.length&&e.send({subscribeFile:{files:r.map(e=>({path:e.toString()}))}}),()=>{C=null}});let R=new Promise(e=>s=e);e.openChannel({service:e=>e.repl.authorizations.editFileContents.isAuthorized?"gcsfiles":"files"},({channel:e})=>{for(let t of(s(e),v(),[...T.keys()].sort()))K.readDir(t).then(e=>{let r=T.get(t);if(!r)return;if(e.error)return void B({eventType:P.ChangeEventType.Delete,node:{path:t,type:P.FileType.Directory}});let{children:i}=e,{children:n}=r;for(let e of n.filter(e=>!i.some(t=>t.filename===e.filename&&t.type===e.type)))B({eventType:P.ChangeEventType.Delete,node:{path:(0,f.joinFsPath)(t,e.filename),type:e.type}});for(let e of i.filter(e=>!n.some(t=>t.filename===e.filename&&t.type===e.type)))B({eventType:P.ChangeEventType.Create,node:{path:(0,f.joinFsPath)(t,e.filename),type:e.type}})});for(let e of O.keys())K.readFile(e,{fromDisk:!0}).then(t=>{let r=O.get(e);!r||(t.error?B({eventType:P.ChangeEventType.Delete,node:{path:e,type:P.FileType.File}}):t.content.toBuffer().equals(r.latestContent.toBuffer())||B({eventType:P.ChangeEventType.Modify,node:{path:e,type:P.FileType.File}}))});return()=>{R=new Promise(e=>s=e)}});let _=(0,p.default)();_.promise.catch(e=>e);let M=(0,c.default)(async()=>{let e=await _.promise,t=await e.request({fsSnapshot:{}});return t.channelClosed?{success:!1,error:"channel closed"}:t.error?{success:!1,error:t.error}:{error:null,success:!0}},{wait:5e3,maxWait:1e4});e.openChannel({service:"snapshot",skip:e=>!e.repl.authorizations.editFileContents.isAuthorized},({channel:e})=>(_.resolve(e),()=>{_.isFulfilled&&(_=(0,p.default)()).promise.catch(e=>e)}));let I=P.FsStatus.Clean,A=[],j=0;async function U(){j++,z();let e=await K.persist();e.error&&r.logger.error("Failed to persist, something very bad has probably happened",{originalError:e.error}),j--,z()}async function z(){let e=0===j&&0===$.length&&Array.from(k.values()).every(e=>e.otClient.isClean());e!==(I===P.FsStatus.Clean)&&(I=e?P.FsStatus.Clean:P.FsStatus.Syncing,A.forEach(e=>{e(I,{hasUserChanged:E})}))}let $=[];function V(e){E=!0,$.push(e),z(),e.then(()=>{let t=$.indexOf(e);t>-1&&$.splice(t,1),U()})}async function q(e,r){let i=async()=>{let r,n=await R;if("open"!==n.status)return m(i);try{r=await n.request(e)}catch(e){return t.captureException(Error(`Send request failed with error: ${e}`)),m(i)}return r.channelClosed?m(i):r},n=i();return r.isMutative&&V(n),n}function B(e){F=null;let r=(0,f.getParentFsPath)(e.node.path),i=T.get(r),n=(0,f.getFsBaseName)(e.node.path);if(!n)throw Error("Expected filename");let o=null;if(e.eventType===P.ChangeEventType.Move){let t=(0,f.getParentFsPath)(e.to);o=T.get(t)}if(i||o)switch(e.eventType){case P.ChangeEventType.Create:{if(!i)break;let t=[...i.children.filter(e=>e.filename!==n),{type:e.node.type,filename:n}];for(let{onChange:e}of i.listeners)e(t);i.children=t;break}case P.ChangeEventType.Move:{let t=(0,f.getFsBaseName)(e.to);if(i&&i===o){let r=[...i.children.filter(e=>e.filename!==n&&e.filename!==t),{type:e.node.type,filename:t}];for(let{onChange:e}of i.listeners)e(r);i.children=r;break}if(i){let e=i.children.filter(e=>e.filename!==n);for(let{onChange:t}of i.listeners)t(e);i.children=e}if(o){let r=[...o.children.filter(e=>e.filename!==n&&e.filename!==t),{type:e.node.type,filename:t}];for(let{onChange:e}of o.listeners)e(r);o.children=r}break}case P.ChangeEventType.Delete:{if(!i)break;let e=i.children.filter(e=>e.filename!==n);for(let{onChange:t}of i.listeners)t(e);i.children=e;break}case P.ChangeEventType.Modify:break;default:throw Error("unknown event")}switch(e.eventType){case P.ChangeEventType.Move:case P.ChangeEventType.Delete:{for(let t of[k.get(e.node.path),O.get(e.node.path),T.get(e.node.path)])if(t)for(let{onMoveOrDelete:r,dispose:i}of t.listeners)r&&r(e),i();if(e.node.type===P.FileType.File)break;let t=[...new Set([...T.keys(),...O.keys(),...k.keys()])].map(e=>{let t=k.get(e)||O.get(e)||T.get(e);if(!t)throw Error("expected node");return t}),r=[];for(let i of t.sort()){if(!(0,f.isDescendantOf)(e.node.path,i.path))continue;let t=r.slice(-1)[0];if(t&&(0,f.isDescendantOf)(t,i.path))continue;let n={eventType:P.ChangeEventType.Delete,node:{path:i.path,type:i.type}};e.eventType===P.ChangeEventType.Move&&(n={...n,eventType:P.ChangeEventType.Move,to:(0,f.moveDescendantFsPath)(e.node.path,e.to,i.path)}),r.push(i.path),B(n)}break}case P.ChangeEventType.Create:case P.ChangeEventType.Modify:if(!O.has(e.node.path))break;K.readFile(e.node.path,{fromDisk:!0}).then(t=>{let r=O.get(e.node.path);if(r){if(t.error)return void B({eventType:P.ChangeEventType.Delete,node:{path:e.node.path,type:P.FileType.File}});for(let{onChange:e}of(r.latestContent=t.content,r.listeners))e&&e(t.content)}}).catch(e=>{e.message="File read after modify error: "+e.message,t.captureException(e)})}}function Q(e){for(let t of D)t(e)}async function W(){let{output:r,error:i}=await e.execImmediately("rg","--hidden","--files",...g.ignoredDirs.flatMap(e=>["--glob",`!${e}`]));return!i&&r?F={error:null,files:r.split("\n").filter(e=>!(!e||(0,g.isHiddenFile)(e)))}:"exit status 1"===i?F={error:null,files:[]}:(t.captureException(Error(`Find file command failed with error: ${i}`)),{error:i,files:null})}let H=async(e,t,r,i=!1)=>{if(!i&&e===y.DOT_ENV)return{error:P.FsErrors.InvalidPath};let n=await R;async function s(e){let t=await n.request(e);if(t.channelClosed)throw Error("channelClosed");if(t.error)throw Error(t.error);return t}let l={eventType:P.ChangeEventType.Create,node:{path:e,type:P.FileType.File}};try{let i,n,l=t.size,{transfer:a}=await s({transferStart:{path:e.toString(),size:l}});if(!a)throw Error("Failed to start a transfer (no transfer id)");r(l,0);let h=0,c=0;for(;h<l;){try{i=t.slice(h,h+524288),n=await i.arrayBuffer()}catch{throw new P.FileReadError}let e=new Uint8Array(n);await s({transferChunk:{id:a.id,content:e}}),c=o.buf(e,c),h+=i.size,r(l,h)}await s({transferComplete:{id:a.id,crc32:c}})}catch(n){if("channelClosed"===n.message)return m(K.transferFile,e,t,r);let i=L(n.message,[P.FsErrors.NotDirectory,P.FsErrors.AlreadyExists,P.FsErrors.DiskQuotaExceeded,P.FsErrors.NotReadable]);if(i===P.FsErrors.DiskQuotaExceeded&&Q(l),i===P.FsErrors.AlreadyExists&&(i=P.FsErrors.IsDirectory),i)return{error:i};throw n}return B(l),{error:null}};function J(t){let r=new N(t,e,Promise.all([...$].map(e=>e.catch(()=>{}))).then(()=>void 0),e.logger,i,n);return r.on("commitComplete",U),r.on("fileDirty",z),r.on("fileClean",z),r.on("commitStart",z),r}let K={getStatus:()=>I,onStatusChange:e=>(A.push(e),()=>{let t=A.indexOf(e);t>-1&&A.splice(t,1)}),watchDir(e,t){let r=!1,i=()=>{r=!0;let t=T.get(e);t&&(t.listeners=t.listeners.filter(e=>e.dispose!==i),0===t.listeners.length&&T.delete(e))};return K.readDir(e).then(n=>{if(r)return;if(n.error){let e=Error(n.error);e.code=n.error,t.onError(e),i();return}let o=T.get(e);!o&&(o={path:e,type:P.FileType.Directory,children:n.children,listeners:[]},T.set(e,o),C&&C.send({subscribeFile:{files:[{path:e.toString()}]}})),o.listeners.push({...t,dispose:i}),t.onChange(n.children)}).catch(e=>{i(),t.onError(e)}),i},watchPathStat(e,t){let r=0,i=!1,n=(o,s,l)=>{if(s===P.FileType.File)return()=>{};let[a,...h]=l,c=a===e;if(c&&0!==h.length)throw Error("Invariant: child is target but has more children");let p=null,u=K.watchDir(o,{onChange:o=>{let s=o.find(e=>e.filename===(0,f.getFsBaseName)(a));if(!s){i||(t.onNewStat({exists:!1}),i=!0),p&&(p.dispose(),p=null);return}if(p&&s.type!==p.node.type&&(p.dispose(),p=null),!p){if(c){let n=++r;K.stat(e).then(e=>{n!==r||e.exists&&(t.onNewStat(e),i=!1,p={node:s,dispose:()=>{}})});return}p={node:s,dispose:n(a,s.type,h)}}},onError:t.onError});return()=>{p?.dispose(),u()}},[o,...s]=(0,f.splitFsPaths)(e);return n(o,P.FileType.Directory,s)},watchFilePath(e,t){let r,i=(e,r)=>{if(0===r.length){let r=K.watchFile((0,f.toRelativeFsPath)(e),t);return()=>{r()}}{let t,n=r[0],o=!1,s=K.watchDir((0,f.toRelativeFsPath)(e),{onChange(s){let l=s.find(e=>e.filename.toString()===n);if(!o&&l){t=i(`${e}/${n}`,r.slice(1)),o=!0;return}o=!1},onMoveOrDelete(){t?.()},onError(){}});return()=>{t?.(),s()}}},n=e.toString().split("/"),o=!1,s=K.watchDir((0,f.toRelativeFsPath)(""),{onChange(e){let t=e.find(e=>e.filename.toString()===n[0]);if(!o&&t){r=i(n[0],n.slice(1)),o=!0;return}o=!1},onError(){}});return()=>{r?.(),s()}},async writeFile(e,t){let r,i;r="string"==typeof t?u.default.from(t).toBuffer():t.toBuffer();let n=await q({write:{path:e.toString(),content:r}},{isMutative:!0}),o=T.get((0,f.getParentFsPath)(e))?.children.some(t=>t.filename===(0,f.getFsBaseName)(e));if(i=O.has(e)||k.has(e)||o?{eventType:P.ChangeEventType.Modify,node:{path:e,type:P.FileType.File}}:{eventType:P.ChangeEventType.Create,node:{path:e,type:P.FileType.File}},n.error){let e=L(n.error,[P.FsErrors.NotDirectory,P.FsErrors.AlreadyExists,P.FsErrors.DiskQuotaExceeded]);if(e===P.FsErrors.DiskQuotaExceeded&&Q(i),e===P.FsErrors.AlreadyExists&&(e=P.FsErrors.IsDirectory),!e)throw Error(n.error);return{error:e}}return B(i),{error:null}},async transferFile(...e){let t=H(...e);return V(t),t},async readFile(e,{fromDisk:t}={fromDisk:!1}){if(!t){let t=k.get(e);if(t&&t.otClient.getRawLocalContent()&&!t.otClient.isReconnecting)return{content:u.default.from(t.otClient.getRawLocalContent()),error:null}}let r=await q({read:{path:e.toString()}},{isMutative:!1});if(r.error){let e=L(r.error,[P.FsErrors.NotFound,P.FsErrors.IsDirectory]);if(!e)throw Error(r.error);return{error:e}}if(!r.file||!r.file.path||!r.file.content)throw Error("Expected file");return{content:u.default.from(r.file.content),error:null}},async createDir(e){let t=await q({mkdir:{path:e.toString()}},{isMutative:!0}),r={eventType:P.ChangeEventType.Create,node:{path:e,type:P.FileType.Directory}};if(t.error){let e=L(t.error,[P.FsErrors.NotDirectory,P.FsErrors.DiskQuotaExceeded]);if(e===P.FsErrors.DiskQuotaExceeded&&Q(r),!e)throw Error(t.error);return{error:e}}return B(r),{error:null}},async moveDir(e,t){let r=await q({move:{oldPath:e.toString(),newPath:t.toString()}},{isMutative:!0}),i={eventType:P.ChangeEventType.Move,node:{path:e,type:P.FileType.Directory},to:t};if(r.error){let e=L(r.error,[P.FsErrors.NotFound,P.FsErrors.AlreadyExists,P.FsErrors.NotDirectory,P.FsErrors.DiskQuotaExceeded]);if(e===P.FsErrors.DiskQuotaExceeded&&Q(i),!e)throw Error(r.error);return{error:e}}return B(i),{error:null}},async moveFile(e,t){let r=await q({move:{oldPath:e.toString(),newPath:t.toString()}},{isMutative:!0}),i={eventType:P.ChangeEventType.Move,node:{path:e,type:P.FileType.File},to:t};if(r.error){let e=L(r.error,[P.FsErrors.NotFound,P.FsErrors.AlreadyExists,P.FsErrors.NotDirectory,P.FsErrors.DiskQuotaExceeded]);if(e===P.FsErrors.DiskQuotaExceeded&&Q(i),!e)throw Error(r.error);return{error:e}}return B(i),{error:null}},async copyFile(e,t){let r=await K.readFile(e);return r.error?r:K.writeFile(t,r.content)},async copyDirFromRemote(e,t,r){await this.deleteDir(e);let i=await r.readDir(e);if(i.error)return i;let n=await this.readDir(t);if(n.error===P.FsErrors.NotFound)await this.createDir(e);else if(n.error===P.FsErrors.NotDirectory)return n;for(let n of i.children){let i=(0,f.joinFsPath)(e,n.filename);if(n.type===P.FileType.File){let e=await r.readFile(i);if(e.error)return e;let o=await this.writeFile((0,f.joinFsPath)(t,n.filename),e.content);if(o.error)return o}else if(n.type===P.FileType.Directory){let e=await this.copyDirFromRemote(i,(0,f.joinFsPath)(t,n.filename),r);if(e.error)return e}}return{error:null}},async copyFileFromRemote(e,t,r){let i=await r.readFile(e);if(i.error)return i;let n=await this.writeFile(t,i.content);return n.error?n:{error:null}},async deleteFile(e){let t=await q({remove:{path:e.toString()}},{isMutative:!0});if(t.error){let e=L(t.error,[P.FsErrors.NotFound]);if(!e)throw Error(t.error);return{error:e}}return B({eventType:P.ChangeEventType.Delete,node:{path:e,type:P.FileType.File}}),{error:null}},async deleteDir(e){let t=await q({remove:{path:e.toString()}},{isMutative:!0});if(t.error){let e=L(t.error,[P.FsErrors.NotFound]);if(!e)throw Error(t.error);return{error:e}}return B({eventType:P.ChangeEventType.Delete,node:{path:e,type:P.FileType.Directory}}),{error:null}},async readDir(e){let t=await q({readdir:{path:e.toString()}},{isMutative:!1});if(t.error){let e=L(t.error,[P.FsErrors.NotFound,P.FsErrors.NotDirectory,P.FsErrors.FileSystemUnavailable]);if(!e)throw Error(t.error);return{error:e}}if(!t.files?.files)throw Error("Expected filesChannel");return{children:t.files.files.map(e=>{if(!e.path)throw Error("Expected path");return{filename:(0,f.getFsBaseName)((0,f.toRelativeFsPath)(e.path)),type:e.type===h.api.File.Type.DIRECTORY?P.FileType.Directory:P.FileType.File}}),error:null}},async stat(e){let t=await q({stat:{path:e.toString()}},{isMutative:!1});if(t.error)throw Error(t.error);if(!t.statRes)throw Error("expected stat result");return t.statRes.exists?t.statRes.type===h.api.File.Type.DIRECTORY?{exists:!0,type:P.FileType.Directory,lastModified:new Date(1e3*t.statRes.modTime)}:{exists:!0,type:P.FileType.File,lastModified:new Date(1e3*t.statRes.modTime),byteLength:Number(t.statRes.size)}:{exists:!1}},watchTextFile(e,t){if(!(0,f.isAbsolutePath)(e)&&(0,f.isRoot)((0,f.toRelativeFsPath)(e)))throw Error("Cannot watch root directory");let r=k.get(e);if(r||(r={path:e,type:P.FileType.File,listeners:[],otClient:J(e)},k.set(e,r)),!r)throw Error("Expected watchedOtFile");let i=!1,n=!1,o=()=>{},s=[],h=p=>{if(o(),!r)throw Error("Expected watchedOtFile");let u=e=>t.onFlush?.(e);r.otClient.on("commitComplete",u);let f=()=>t.onStatusChange?.(P.FileStatus.Dirty);r.otClient.on("fileDirty",f);let d=()=>t.onStatusChange?.(P.FileStatus.Clean);r.otClient.on("fileClean",d);let m=()=>t.onStatusChange?.(P.FileStatus.Syncing);r.otClient.on("commitStart",m);let g=e=>t.onCursor?.(e);r.otClient.on("cursor",g);let y=e=>t.onRemoveCursor?.(e);r.otClient.on("removeCursor",y);let v=e=>t.onFileSavedChanged?.(e);r.otClient.on("fileSavedChanged",v);let C=async t=>{if(!r)throw Error("Expected watchedOtFile");let{otClient:i}=r;i.destroy();let n=J(e);await new Promise((e,t)=>{n.once("changes",()=>e()),n.once("error",e=>t(e))});let o=i.getLocalContent(),l=n.getLocalContent(),h="local"===t?(0,a.changeSetFromDiff)(l,o):null,c="remote"===t?(0,a.changeSetFromDiff)(o,l):null;if(!r)throw Error("Expected watchedOtFile");for(let{reregister:e}of(r.otClient=n,r.listeners))e(c);for(h&&n.writeChanges(h);s.length>0;)s.pop()?.({isDisposed:!1});await this.flush()},w=e=>t.onReconnectFail?.(C,e);r.otClient.on("promptUserReconnect",w),r.listeners[0].reregister===h&&r.otClient.on("promptUserReconnect",()=>{if(k.has(e)){if(!r)throw Error("Expected watchedOtFile");r.listeners.some(e=>e.onReconnectFail)||C("remote")}});let F=(e,r)=>{t.onError&&t.onError(e,r),c()};r.otClient.on("error",F);let b=(r,i)=>{if(r===P.FsErrors.DiskQuotaExceeded&&Q({eventType:P.ChangeEventType.Modify,node:{path:e,type:P.FileType.File}}),t.onError){let e=Error(i);e.code=r,t.onError(e)}c()};r.otClient.on("fsError",b);let T=(e,i)=>{if(!r)throw Error("Expected watchedOtFile");E=!0;let n=l.ChangeSet.of(e,r.otClient.getLocalContent().length,"\n");for(let{onChange:e}of(r.otClient.writeChanges(n,i),r.listeners))e&&e!==t.onChange&&e({changes:n,changeSource:P.ChangeSource.Local,version:r.otClient.version,latestContent:r.otClient.getLocalContent()})},O=async()=>r?.otClient.isReconnecting?new Promise((e,t)=>{r?s.push(e):t(Error("Expected watchedOtFile"))}):{isDisposed:i},D=()=>{for(;s.length>0;)s.pop()?.({isDisposed:!1})};r.otClient.on("transparentReconnect",D);let x=async(...e)=>{if(!r)throw Error("Expected watchedOtFile");try{let{isDisposed:e}=await O();if(e)return{isDisposed:!0,result:null}}catch(e){if(i)return{isDisposed:!0,result:null};throw e}return{isDisposed:!1,result:await r.otClient.fetchChanges(...e)}},S=async(...e)=>{if(!r)throw Error("Expected watchedOtFile");let{isDisposed:t}=await O();if(t)throw Error("File was disposed");return r.otClient.transformSelection(...e)},R=e=>{if(!r)throw Error("Expected watchedOtFile");r.otClient.updateCursors(e)};-1!==r.otClient.version&&setTimeout(()=>{if(!n){if(!r)throw Error("Expected watchedOtFile");n=!0,t.onReady?.({initialContent:r.otClient.getLocalContent(),writeChange:T,updateSelections:R,fetchChanges:x,transformSelection:S,version:r.otClient.version})}}),p&&t.onChange?.({changes:p,changeSource:P.ChangeSource.Container,version:r.otClient.version,latestContent:r.otClient.getLocalContent(),userId:0});let _=(e,i)=>{if(!r)throw Error("Expected watchedOtFile");if(!n){n=!0,t.onReady?.({initialContent:r.otClient.getLocalContent(),writeChange:T,updateSelections:R,fetchChanges:x,transformSelection:S,version:r.otClient.version});return}t.onChange?.({changes:e,changeSource:P.ChangeSource.Container,version:r.otClient.version,latestContent:r.otClient.getLocalContent(),userId:i})};r.otClient.on("changes",_),o=()=>{if(!r)throw Error("Expected watchedOtFile");r.otClient.removeListener("commitComplete",u),r.otClient.removeListener("fileDirty",f),r.otClient.removeListener("fileClean",d),r.otClient.removeListener("commitStart",m),r.otClient.removeListener("error",F),r.otClient.removeListener("fsError",b),r.otClient.removeListener("changes",_),r.otClient.removeListener("cursor",g),r.otClient.removeListener("removeCursor",y),r.otClient.removeListener("promptUserReconnect",w),r.otClient.removeListener("transparentReconnect",D),r.otClient.removeListener("fileSavedChanged",v)},z()},c=()=>{for(;s.length>0;)s.pop()?.({isDisposed:!0});if(!i&&k.has(e)){if(i=!0,n=!0,o(),!r)throw Error("Expected watchedOtFile");r.listeners=r.listeners.filter(e=>e.dispose!==c),0===r.listeners.length&&(r.otClient.destroy(),k.delete(e))}};return r.listeners.push({...t,dispose:c,reregister:h}),h(null),c},watchFile(e,t){if(!(0,f.isAbsolutePath)(e)&&(0,f.isRoot)((0,f.toRelativeFsPath)(e)))throw Error("Cannot watch root directory");let r=!1,i=()=>{r=!0;let t=O.get(e);t&&(t.listeners=t.listeners.filter(e=>e.dispose!==i),0===t.listeners.length&&O.delete(e))};return K.readFile(e).then(n=>{if(r)return;if(n.error){let e=Error(n.error);e.code=n.error,t.onError&&t.onError(e),i();return}let o=O.get(e);if(!o&&(o={path:e,type:P.FileType.File,listeners:[],latestContent:n.content},O.set(e,o),C&&C.send({subscribeFile:{files:[{path:e.toString()}]}})),!o)throw Error("Expected watched file");o.listeners.push({...t,dispose:i}),t.onChange(n.content)}),i},async listFiles(){if(F&&e.performance.now()-b<1e4)return F;w||(w=W(),b=e.performance.now());let t=await w;return w=null,t},async flush(e,t=P.FlushSource.UNKNOWN){let r=async e=>{let r=e.path,i=x.get(r);if(i)for(let r of i)await r(e.otClient.getLocalContent(),t)},i=e=>{let r=e.path;for(let e of S)e(r,t)},n=[],o=e=>{null===e.otClient.channel||e.otClient.isReconnecting||n.push(e.otClient.flush())};if(void 0===e){for(let e of k.values())await r(e);for(let e of k.values())o(e)}else{for(let t of e){let e=k.get(t);void 0!==e&&await r(e)}for(let t of e){let e=k.get(t);void 0!==e&&o(e)}}try{if(await Promise.all(n.concat($)),void 0===e)for(let e of k.values())i(e);else for(let t of e){let e=k.get(t);void 0!==e&&i(e)}}catch(e){}},registerOnBeforeFlush(e,t){let r=x.get(e)??new Set;return r.add(t),x.set(e,r),()=>x.get(e)?.delete(t)},registerOnFlushSuccess:e=>(S.add(e),()=>{S.delete(e)}),persist(e){let t=M();return e&&e.skipDebounce&&M.flush(),t},getOTVersion(e){if("SYNTHETIC_FILE_PATH.sql"===e)return 123;let t=k.get(e);if(!t)throw Error(`No file with path ${e} found.`);return t.otClient.version},isFileOrDirSaved(e){if((0,d.isOTFile)(e)){let t=k.get(e);return!t||t.otClient.isFileSaved()}return!0},onDiskQuotaExceeded:e=>(D.push(e),()=>{D=D.filter(t=>t!==e)})};return K}let A=i.Type.Object({cluster:i.Type.String(),sourceRepl:i.Type.String(),zipperToken:i.Type.String(),expirySeconds:i.Type.Number()});async function j({replId:e,getCaptcha:t}){let{isEmbed:r,hCaptchaSiteKey:i,recaptchaToken:o,captcha:l}=await t(),a=await fetch(`/data/repls/${e}/get_zipper_token`,{credentials:"same-origin",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"},method:"post",body:JSON.stringify({captcha:l,isEmbed:r,hCaptchaSiteKey:i,recaptchaToken:o,asViewer:!0})});if(!a.ok)throw Error(`Failed to get zipper token: ${a.status} ${a.statusText}`);let h=await a.json();if(!n.Value.Check(A,h))throw(0,M.validationErrors)(A,h);let{cluster:c,sourceRepl:p,zipperToken:u,expirySeconds:f}=h,d=(0,s.addSeconds)(new Date,f-10);return{sourceReplId:p,baseUrl:(0,m.getZipperUrl)(c),token:u,exp:d}}function U({replId:e,getCaptcha:t}){let r;async function i(){return(!r||(await r).exp.getTime()<=new Date().getTime())&&(r=j({replId:e,getCaptcha:t})),await r}let n={watchDir:(e,t)=>(n.readDir(e).then(e=>{if(e.error){let r=Error(e.error);r.code=e.error,t.onError&&t.onError(r);return}return t.onChange(e.children)}),()=>{}),watchFile:(e,t)=>(n.readFile(e).then(e=>{if(e.error){let r=Error(e.error);r.code=e.error,t.onError&&t.onError(r);return}return t.onChange(e.content)}),()=>{}),async stat(e){let t=await n.readFile(e);if(t.error)switch(t.error){case P.FsErrors.NotFound:return{exists:!1};case P.FsErrors.IsDirectory:return{exists:!0,type:P.FileType.Directory,lastModified:new Date}}return{exists:!0,type:P.FileType.File,byteLength:t.content.length,lastModified:new Date}},async readDir(e){let{sourceReplId:t,baseUrl:r,token:n}=await i(),o=await fetch(`${r}/repls/${t}/files/dir?path=${e}`,{...n&&{headers:{Authorization:`Bearer ${n}`}}});if(o.ok)return{children:await o.json()??[],error:null};{let e=await o.text();if(404===o.status&&"file not found"===e)return{error:P.FsErrors.NotFound};if(400===o.status&&"file is not a directory"===e)return{error:P.FsErrors.NotDirectory};throw Error(`Error when trying to read dir through zipper, status: ${o.status}, body: ${e}`)}},async readFile(e,t){let{sourceReplId:r,baseUrl:n,token:o}=await i(),s=await fetch(`${n}/repls/${r}/files/file?path=${encodeURIComponent(e)}`,{...o&&{headers:{Authorization:`Bearer ${o}`}}});if(s.ok)return{content:new u.default(await s.arrayBuffer()),error:null};{let e=await s.text();if(404===s.status&&"file not found"===e)return{error:P.FsErrors.NotFound};if(400===s.status&&"file is a directory"===e)return{error:P.FsErrors.IsDirectory};throw Error(`Error when trying to read file through zipper, status: ${s.status}, body: ${e}`)}}};return n}e.s(["createZipperFsService",()=>U,"default",()=>I,"getZipperToken",()=>j],629712)}]);

//# debugId=1fc4b3fc-4a23-4c70-3e86-505862ea3640
//# sourceMappingURL=a0f4389a6a9dc139.js.map