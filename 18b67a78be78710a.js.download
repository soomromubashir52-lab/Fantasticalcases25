;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="c4af53a4-99d8-4158-889c-3dbd9dc33f51")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,74032,e=>{e.v({"fade-in":"LoadingState-module___WZova__fade-in",header:"LoadingState-module___WZova__header",loadingAnimation:"LoadingState-module___WZova__loadingAnimation",root:"LoadingState-module___WZova__root"})},695337,e=>{e.v({surface:"KeyboardShortcutsModal-module__Tz_71q__surface"})},918218,e=>{e.v({right:"ExpandAgentButton-module__Sr5bZG__right",root:"ExpandAgentButton-module__Sr5bZG__root",show:"ExpandAgentButton-module__Sr5bZG__show"})},576779,e=>{e.v({animationWrapper:"FigmaImport-module__p8csWa__animationWrapper",overlay:"FigmaImport-module__p8csWa__overlay",progressBarContainer:"FigmaImport-module__p8csWa__progressBarContainer",progressBarFill:"FigmaImport-module__p8csWa__progressBarFill",progressBarTrack:"FigmaImport-module__p8csWa__progressBarTrack"})},963786,e=>{e.v({validationIcon:"EditReplForm-module__DnkOSa__validationIcon",validationText:"EditReplForm-module__DnkOSa__validationText"})},111724,e=>{e.v({measureBar:"FreemiumUsagePopover-module___B9tOa__measureBar",usageCard:"FreemiumUsagePopover-module___B9tOa__usageCard"})},680189,e=>{e.v({flippedIcon:"workspaceTour-module__-kv3kW__flippedIcon",iconSurface:"workspaceTour-module__-kv3kW__iconSurface"})},823931,e=>{e.v({exportButton:"ExportVideoMenu-module__Gud0Iq__exportButton",menu:"ExportVideoMenu-module__Gud0Iq__menu",nameInput:"ExportVideoMenu-module__Gud0Iq__nameInput",progressButton:"ExportVideoMenu-module__Gud0Iq__progressButton",progressButtonFill:"ExportVideoMenu-module__Gud0Iq__progressButtonFill",progressButtonText:"ExportVideoMenu-module__Gud0Iq__progressButtonText"})},980713,e=>{e.v({baseButton:"Deploy-module__8ZcrnG__baseButton",baseButtonLoading:"Deploy-module__8ZcrnG__baseButtonLoading",deployIconDot:"Deploy-module__8ZcrnG__deployIconDot",deployIconDotWrapper:"Deploy-module__8ZcrnG__deployIconDotWrapper",deployIconWithStatus:"Deploy-module__8ZcrnG__deployIconWithStatus",openPaneButton:"Deploy-module__8ZcrnG__openPaneButton",pulse:"Deploy-module__8ZcrnG__pulse",roundedButton:"Deploy-module__8ZcrnG__roundedButton",roundedButtonLoading:"Deploy-module__8ZcrnG__roundedButtonLoading"})},60166,e=>{e.v({root:"RunStatusButton-module__27k_5G__root"})},700283,e=>{e.v({flipped:"FiletreeButton-module__3d0q-a__flipped"})},787108,e=>{e.v({container:"InboxButton-module__ExH6bq__container",indicator:"InboxButton-module__ExH6bq__indicator"})},317941,e=>{e.v({avatar:"index-module__PnN-4a__avatar",inviteDialog:"index-module__PnN-4a__inviteDialog",remainingCountButton:"index-module__PnN-4a__remainingCountButton",stacked:"index-module__PnN-4a__stacked"})},384132,e=>{e.v({emptySpacer:"NavMenu-module__rNmZaG__emptySpacer",menu:"NavMenu-module__rNmZaG__menu",repl:"NavMenu-module__rNmZaG__repl",usage:"NavMenu-module__rNmZaG__usage"})},342571,e=>{e.v({desktopAppWindowsOs:"index-module__IZzwWa__desktopAppWindowsOs",desktopDragRegion:"index-module__IZzwWa__desktopDragRegion",left:"index-module__IZzwWa__left",logoContainer:"index-module__IZzwWa__logoContainer",planningHeader:"index-module__IZzwWa__planningHeader",planningHeaderLeft:"index-module__IZzwWa__planningHeaderLeft",planningTimeline:"index-module__IZzwWa__planningTimeline",right:"index-module__IZzwWa__right"})},375032,e=>{e.v({"fade-out":"Border-module__AS8LXG__fade-out",pulse:"Border-module__AS8LXG__pulse",root:"Border-module__AS8LXG__root"})},794149,e=>{e.v({errorMessage:"ErrorBoundary-module__cE2Qsa__errorMessage"})},231927,e=>{e.v({container:"index-module__4PIZ9q__container",interactionBlanket:"index-module__4PIZ9q__interactionBlanket",root:"index-module__4PIZ9q__root"})},33171,e=>{e.v({closeButton:"Tab-module__U4WksG__closeButton",tab:"Tab-module__U4WksG__tab",tabButton:"Tab-module__U4WksG__tabButton",title:"Tab-module__U4WksG__title"})},13891,e=>{e.v({desktopAppWindowsOs:"index-module__QGsN1W__desktopAppWindowsOs",dragArea:"index-module__QGsN1W__dragArea",dropPreview:"index-module__QGsN1W__dropPreview",newTab:"index-module__QGsN1W__newTab",newTabIconButton:"index-module__QGsN1W__newTabIconButton",newTabTextButton:"index-module__QGsN1W__newTabTextButton",tabBar:"index-module__QGsN1W__tabBar",tabs:"index-module__QGsN1W__tabs"})},248611,e=>{e.v({surface:"index-module__3SVBeW__surface"})},357210,e=>{e.v({grip:"ResizeHandle-module__D5nG1G__grip",root:"ResizeHandle-module__D5nG1G__root",stacked:"ResizeHandle-module__D5nG1G__stacked"})},224373,e=>{e.v({grip:"ResizeHandle-module__nCKbhG__grip",left:"ResizeHandle-module__nCKbhG__left",right:"ResizeHandle-module__nCKbhG__right",root:"ResizeHandle-module__nCKbhG__root"})},861781,e=>{e.v({root:"index-module__mWTpga__root",subrepl:"index-module__mWTpga__subrepl"})},798406,e=>{e.v({feedbackText:"FeedbackCard-module__aqvHNW__feedbackText",feedbackTextCollapsed:"FeedbackCard-module__aqvHNW__feedbackTextCollapsed",feedbackTextFaded:"FeedbackCard-module__aqvHNW__feedbackTextFaded",showButton:"FeedbackCard-module__aqvHNW__showButton"})},124803,e=>{e.v({emptyState:"InboxContent-module__Ms4b9G__emptyState","filter-enter":"InboxContent-module__Ms4b9G__filter-enter",filterContainer:"InboxContent-module__Ms4b9G__filterContainer",itemsContainer:"InboxContent-module__Ms4b9G__itemsContainer",loadingShimmer:"InboxContent-module__Ms4b9G__loadingShimmer",modalImage:"InboxContent-module__Ms4b9G__modalImage",screenshotThumbnail:"InboxContent-module__Ms4b9G__screenshotThumbnail",screenshotThumbnailButton:"InboxContent-module__Ms4b9G__screenshotThumbnailButton",scrollableContent:"InboxContent-module__Ms4b9G__scrollableContent",shimmer:"InboxContent-module__Ms4b9G__shimmer",thumbnailShimmer:"InboxContent-module__Ms4b9G__thumbnailShimmer"})},491694,e=>{e.v({root:"Search-module__fSv4Tq__root"})},943124,e=>{e.v({root:"index-module__0C7YZG__root"})},437535,e=>{e.v({blue:"SubreplBorder-module__wye73q__blue",green:"SubreplBorder-module__wye73q__green",grey:"SubreplBorder-module__wye73q__grey",overlay:"SubreplBorder-module__wye73q__overlay",red:"SubreplBorder-module__wye73q__red",yellow:"SubreplBorder-module__wye73q__yellow"})},928807,e=>{e.v({actions:"SubreplHeaderActions-module__cQWV6W__actions",overlay:"SubreplHeaderActions-module__cQWV6W__overlay"})},125822,e=>{e.v({left:"TaskSidebarCollapsed-module__fnUura__left",right:"TaskSidebarCollapsed-module__fnUura__right",toggleButton:"TaskSidebarCollapsed-module__fnUura__toggleButton"})},298924,e=>{e.v({clickable:"TaskList-module__muOYDW__clickable",scrollContainer:"TaskList-module__muOYDW__scrollContainer"})},670690,e=>{e.v({toggleButton:"TaskSidebarExpandedLeft-module__Iibw4q__toggleButton"})},2865,e=>{e.v({toggleButton:"TaskSidebarExpandedRight-module__7cZbrq__toggleButton"})},910248,e=>{e.v({root:"index-module__Y_LQXa__root"})},755181,e=>{e.v({contentContainer:"Workspace-module__bV5fda__contentContainer",desktopApp:"Workspace-module__bV5fda__desktopApp"})},838720,e=>{e.v({emailVerificationWrapper:"replEnvironmentDesktop-module__rxGmJG__emailVerificationWrapper",surface:"replEnvironmentDesktop-module__rxGmJG__surface"})},453926,e=>{"use strict";let t,n,i;var r,a,s,o,l,u,d,c,p,h,m,f,g,x=e.i(276385),y=e.i(750854),v=e.i(389959),w=e.i(973245),b=e.i(552207),j=e.i(304277),S=e.i(566901);let k={},C=w.gql`
    query ReplEnvironmentDesktop($replId: String!, $environment: KeybindingsEnvironmentEnum!, $platform: KeybindingsPlatformEnum!) {
  getRepl(id: $replId) {
    ... on Repl {
      id
      ...ReplEnvironmentDesktopRepl
    }
    ... on ReplOrgPermissionDeniedError {
      replId
      orgId
      ownerUsername
      ownerImage
    }
    ... on Error {
      message
    }
  }
  currentUser {
    id
    isVerified
    ...ReplEnvironmentDesktopCurrentUser
    keybindings(environment: $environment, platform: $platform) {
      keybindings
    }
  }
}
    ${b.ReplEnvironmentDesktopReplFragmentDoc}
${b.ReplEnvironmentDesktopCurrentUserFragmentDoc}`;var T=e.i(82464),E=e.i(664152),I=e.i(911185),P=e.i(872734),A=e.i(480028),R=e.i(173703),D=e.i(660614),V=e.i(625484),_=e.i(219577),M=e.i(751299),F=e.i(74032);let O=(0,A.cvarsFrom)("LoadingState.module.css",["--header-height"]);function L(e){return(0,x.jsxs)(R.ShadesSurface,{style:{[O.headerHeight]:_.APP_HEADER_HEIGHT+"px"},clsx:F.default.root,elevate:!1,children:[(0,x.jsx)(R.ShadesSurface,{row:!0,clsx:F.default.header,justify:"space-between",px:6,elevate:!1,children:(0,x.jsxs)(V.View,{row:!0,align:"center",children:[(0,x.jsx)(P.default,{}),(0,x.jsx)(M.NavMenu,{children:(0,x.jsx)(x.Fragment,{})})]})}),(0,x.jsx)(V.View,{grow:!0,shrink:!0,align:"center",justify:"center",clsx:F.default.loadingAnimation,children:e.animation?(0,x.jsx)(D.default,{height:100}):null})]})}var B=e.i(952914),U=e.i(951262);let N={},G=w.gql`
    mutation SaveReplLayoutState($input: SetReplLayoutStateInput!) {
  setReplLayoutState(input: $input) {
    ... on Repl {
      id
      layoutState
    }
  }
}
    `;e.i(877212);var $=e.i(204203),z=e.i(787182),W=e.i(921521),H=e.i(993796),q=e.i(125674),K=e.i(207873),Y=e.i(441329),X=e.i(956111),Q=e.i(400081),Z=e.i(42783),J=e.i(541793),ee=e.i(161322),et=e.i(871579),en=e.i(813707),ei=e.i(858248),er=e.i(709485),ea=e.i(971131);let es=(0,J.atom)(!1),eo=(0,J.atom)(null,(e,t,n)=>{e(es)?(0,ea.flushSync)(()=>{t(el,null),t(es,!1)}):(n&&t(el,n),t(es,!0))}),el=(0,J.atom)(null),eu=(0,J.atom)([]);var ed=e.i(814563),ec=e.i(223808);e.i(242933);var ep=e.i(424360);e.i(925218);var eh=e.i(372988),em=e.i(960933);let ef=em.Type.String();em.Type.String();let eg=em.Type.Object({width:em.Type.Number(),height:em.Type.Number()}),ex=em.Type.Object({x:em.Type.Number(),y:em.Type.Number()}),ey=em.Type.Intersect([ex,eg]),ev=em.Type.Object({top:em.Type.Number(),bottom:em.Type.Number(),left:em.Type.Number(),right:em.Type.Number()}),ew=em.Type.Object({id:em.Type.String(),type:em.Type.Literal("paneGroup"),panes:em.Type.Array(ef),percent:em.Type.Number(),activeIndex:em.Type.Number()}),eb=em.Type.Object({id:em.Type.String(),type:em.Type.Literal("floatingPaneGroup"),panes:em.Type.Array(ef),activeIndex:em.Type.Number(),rect:ey}),ej=em.Type.Recursive(e=>em.Type.Object({type:em.Type.Literal("split"),stacked:em.Type.Boolean(),children:em.Type.Array(em.Type.Union([ew,e])),percent:em.Type.Number()}));em.Type.Union([ew,ej]);let eS=em.Type.Object({tiling:em.Type.Union([ej,ew,em.Type.Null()]),floating:em.Type.Array(eb)});em.Type.Union([em.Type.Literal("left"),em.Type.Literal("right")]),em.Type.Object({inset:em.Type.Optional(ev),size:eg,gap:em.Type.Number(),headerHeight:em.Type.Number()});let ek=em.Type.Union([em.Type.Literal("above"),em.Type.Literal("below"),em.Type.Literal("leftOf"),em.Type.Literal("rightOf")]);function eC(e,t){let n,i;if(function({x:e,y:t},n){return e>n.x&&e<n.x+n.width&&t>n.y&&t<n.y+n.height}(e,(n=.5*t.width,{width:n,height:i=.5*t.height,x:t.x+(t.width-n)/2,y:t.y+(t.height-i)/2})))return{dropLocation:"middle",previewRect:t};let r={x:t.x+t.width/2,y:t.y+t.height/2},a=.3*t.width,s=r.x-a/2;if(e.x>=s&&e.x<=s+a){let n=e.y<=r.y?"above":"below",i=t.height/2;return{dropLocation:n,previewRect:{x:t.x,y:"above"===n?t.y:t.y+i,width:t.width,height:i}}}let o=e.x<=r.x?"leftOf":"rightOf",l=t.width/2;return{dropLocation:o,previewRect:{x:"leftOf"===o?t.x:t.x+l,y:t.y,width:l,height:t.height}}}em.Type.Union([ek,em.Type.Literal("replace")]),em.Type.Union([em.Type.Literal("up"),em.Type.Literal("left"),em.Type.Literal("right"),em.Type.Literal("down")]);let eT={height:0,width:0};function eE(e){if(e.length<1)throw Error("Expected a path with a parent");return e.slice(0,-1)}function eI(e){return"floatingPaneGroup"!==e.type}function eP(e,t){let[n,...i]=t;if("floating"===n){if(!e.floating)return null;let t=i[0];if("number"!=typeof t)throw Error("Expected floatingIndex");let n=e.floating[t];if(!n)throw Error("Expected paneGroup");return n}if("tiling"!==n)throw Error("Expected tiling path");let{tiling:r}=e;if(!r)return null;let a=r,s=i.length,o=0;for(let e of i){if("paneGroup"===a.type)break;if("number"!=typeof e)throw Error("Expected number");o++,a=a.children[e]}return s===o?a:null}function eA(e,t){let n=e.floating.find(e=>e.panes.includes(t));if(n)return{index:n.panes.indexOf(t),paneGroup:n,paneGroupPath:["floating",e.floating.indexOf(n)],floating:!0};let{tiling:i}=e;if(!i)return null;let r=[{paneGroupPath:["tiling"],parent:null,grandparent:null,node:i}];for(;r.length;){let e=r.shift();if(!e)throw Error("Expected item");if("split"===e.node.type)for(let t of e.node.children)r.push({grandparent:e.parent,parent:e.node,node:t,paneGroupPath:[...e.paneGroupPath,e.node.children.indexOf(t)]});else if(e.node.panes.includes(t))return{paneGroupPath:e.paneGroupPath,paneGroup:e.node,parent:e.parent,grandparent:e.grandparent,index:e.node.panes.indexOf(t),floating:!1}}return null}function eR({tiling:e},t){return e?function e(t,n,i){if("paneGroup"===t.type)return{paneGroup:t,path:i};let r=0,a=t.children.length-1;return"topRight"!==n||t.stacked?"bottomRight"===n?r=a:"bottomLeft"===n&&t.stacked&&(r=a):r=a,e(t.children[r],n,[...i,r])}(e,t,["tiling"]):null}function eD({tiling:e,floating:t},n){let i=[...t];for(e&&i.push(e);i.length;){let e=i.shift();if(!e)throw Error("Expected item");if("split"===e.type)i.push(...e.children);else if(e.id===n)return e}return null}function eV({tiling:e},t){if(null===e)return null;let n=[[e,["tiling"]]];for(;n.length;){let e=n.shift();if(!e)throw Error("Expected item");let[i,r]=e;if("split"===i.type){if(i.children.some(e=>"paneGroup"===e.type&&e.id===t))return{node:i,path:r};i.children.forEach((e,t)=>{n.push([e,[...r,t]])})}}return null}function e_(e,t){let n=eA(e,t);if(n?.paneGroup.type==="paneGroup"){let t=eV(e,n.paneGroup.id);if(t){let{children:e}=t.node,i=e.indexOf(n.paneGroup);return i<e.length-1?e[i+1]:e[i-1]}}return null}function eM({relativeTo:e,rects:t,direction:n}){let i=t.get(e);if(!i)throw Error("Expected relativeTo rect to be included in rects");let r=null;for(let[a,s]of t){if(a===e)continue;let t=function({from:e,other:t,direction:n}){switch(n){case"above":return e.y-t.y;case"below":return t.y-e.y;case"rightOf":return t.x-e.x;case"leftOf":return e.x-t.x}}({from:i,other:s,direction:n});if(("leftOf"===n||"above"===n)&&t<=0||("rightOf"===n||"below"===n)&&t<0)continue;let o=function(e,t,n){let[i,r]="x"===n?[[e.x,e.x+e.width],[t.x,t.x+t.width]]:[[e.y,e.y+e.height],[t.y,t.y+t.height]],a=Math.max(i[0],r[0]);return Math.min(i[1],r[1])-a}(i,s,"leftOf"===n||"rightOf"===n?"y":"x");!(o<=0)&&(!r||r.distance>t||r.distance===t&&r.overlap<o)&&(r={key:a,rect:s,distance:t,overlap:o})}return r?.key||null}e.s(["getParentPath",()=>eE,"isTiledNode",()=>eI],319105);let eF={top:0,bottom:0,left:0,right:0};function eO(e,{inside:t,minVisibleX:n,minVisibleY:i}){let r=-e.width+n,a=t.width-n,s=t.height-i;return{x:Math.min(Math.max(r,e.x),a),y:Math.min(Math.max(0,e.y),s)}}function eL(e,t){let n=void 0===t.activeIndex?0:t.activeIndex;if(t.isFloating)return void e.floating.push({id:t.id,type:"floatingPaneGroup",panes:t.panes,activeIndex:n,rect:t.rect});let i=null;if(Array.isArray(t.relativeTo))i=t.relativeTo;else{let n=eA(e,t.relativeTo);if(!n)throw Error("Expected pane");i=n.paneGroupPath}if(null===i)throw Error("Expected relativeTo");if("tiling"!==i[0])throw Error("Expected tiling path");let{placement:r,panes:a,percent:s}=t,o="above"===r||"below"===r,l="rightOf"===r||"below"===r;if(!e.tiling&&1===i.length){e.tiling={id:t.id,type:"paneGroup",percent:100,panes:a,activeIndex:n};return}if(!e.tiling)throw Error("Expected tiling");let u=eP(e,i);if(!u||!eI(u))throw Error("Expected tiled node");if(1===i.length&&"replace"===r){e.tiling={id:t.id,type:"paneGroup",percent:100,panes:a,activeIndex:n};return}if(1===i.length&&"paneGroup"===e.tiling.type){let i=[e.tiling];e.tiling={type:"split",percent:100,stacked:o,children:i},eB({id:t.id,insertIndex:+!!l,panes:a,children:i,percent:s,activeIndex:n});return}if(1===i.length&&"split"===e.tiling.type){if(!!e.tiling.stacked==!!o)return void eB({id:t.id,panes:a,percent:s,activeIndex:n,insertIndex:l?e.tiling.children.length:0,children:e.tiling.children});let i={id:t.id,panes:a,type:"paneGroup",percent:void 0===s?50:s,activeIndex:n},r=l?[u,i]:[i,u];return u.percent=100-i.percent,void(e.tiling={type:"split",stacked:o,children:r,percent:100})}if(0===i.length)throw Error("Expected relativeTo length");let d=eP(e,eE(i));if(d?.type!=="split")throw Error("Expected split parent");if("replace"===r){let e=d.children.indexOf(u);d.children.splice(e,1,{id:t.id,panes:a,percent:u.percent,type:"paneGroup",activeIndex:n});return}if(!!d.stacked==!!o){let e=d.children.indexOf(u);eB({id:t.id,panes:a,percent:s,activeIndex:n,insertIndex:l?e+1:e,children:d.children});return}if(!!d.stacked!=!!o){let e={id:t.id,panes:a,type:"paneGroup",percent:void 0===s?50:s,activeIndex:n},i=l?[u,e]:[e,u],r=u.percent;u.percent=100-e.percent;let c=d.children.indexOf(u);d.children[c]={type:"split",stacked:o,children:i,percent:r};return}}function eB({id:e,percent:t,children:n,panes:i,insertIndex:r,activeIndex:a}){if(void 0!==t){let s=(100-t)/100;n.forEach(e=>{e.percent=e.percent*s}),n.splice(r,0,{id:e,panes:i,type:"paneGroup",percent:t,activeIndex:a});return}let s=n.reduce((e,t)=>e+t.percent,0)/n.length,o=100/(100+s);n.forEach(e=>{e.percent=e.percent*o}),n.splice(r,0,{id:e,panes:i,type:"paneGroup",percent:s*o,activeIndex:a})}function eU(e,t){let n=eD(e,t.paneGroupId);if(!n)throw Error("Expected paneGroup");!function(e,t){let{index:n,paneIds:i,activate:r=!0}=t;if(void 0!==n&&n>e.panes.length)throw Error("Invalid index");let a=void 0===n?e.panes.length:n;e.panes.splice(a,0,...i),r&&(e.activeIndex=a)}(n,t)}function eN(e,t){e.panes.splice(t,1),0===e.activeIndex||t>e.activeIndex||(e.activeIndex=e.activeIndex-1)}function eG(e,t){let n=eA(e,t);if(!n)throw Error("Expected pane");if(n.floating){if(1===n.paneGroup.panes.length){let t=n.paneGroupPath[1];if("number"!=typeof t)throw Error("Expected floatingIndex");e$(e,["floating",t])}else eN(n.paneGroup,n.index);return}let{paneGroup:i,paneGroupPath:r,parent:a}=n;if(!i)throw Error("paneGroup eith paneId not found: "+t);let s=i.panes.indexOf(t);if(-1===s)throw Error("Expected paneIndex");if(!a&&1===i.panes.length){e.tiling=null;return}i.panes.length>1?eN(i,s):e$(e,r)}function e$(e,t){let[n,...i]=t;if("tiling"===n&&0===i.length){e.tiling=null;return}if("floating"===n&&0===i.length){e.floating=[];return}let r=eP(e,t);if(!r)throw Error("Expected node");if("floatingPaneGroup"===r.type){let t=e.floating.indexOf(r);if(-1===t)throw Error("Expected paneGroupIndex");e.floating.splice(t,1);return}let a=eE(t),s=eP(e,a);if(s?.type!=="split")throw Error("Expected split");let o=s.children.indexOf(r);if(-1===o)throw Error("Expected paneGroupIndex");let{children:l}=s;if(l.splice(o,1),l.length>1){let e=100/l.reduce((e,t)=>e+=t.percent,0);l.forEach(t=>{t.percent=t.percent*e});return}let[u]=l,d=a.length>1?eP(e,eE(a)):null;if(!d){u.percent=100,e.tiling=u;return}if("split"!==d.type)throw Error("Expected split");let c=d.children.indexOf(s);if(-1===c)throw Error("Expected parentIndex");u.percent=s.percent,d.children[c]=u}function ez(e,{paneGroupPath:t,rect:n}){let i=eP(e,t);if(i?.type!=="paneGroup")throw Error("Expected paneGroup");e$(e,t),eL(e,{id:i.id,isFloating:!0,panes:i.panes,rect:n,activeIndex:i.activeIndex})}function eW(e,t){let n="floatingIndex"in t?e.floating[t.floatingIndex]:eP(e,t.paneGroupPath);if(!n||!("panes"in n))throw Error("Expected paneGroup");eG(e,t.paneId);let i=void 0===t.index?n.panes.length:t.index;n.panes.splice(i,0,t.paneId),t.activate?n.activeIndex=i:n.activeIndex>=i&&n.activeIndex++}function eH(e,{leftPath:t,percent:n,snapPercent:i=0}){let r=eP(e,t);if(!r||!eI(r))throw Error("Expected leftNode");let a=eP(e,eE(t));if(a?.type!=="split")throw Error("Expected splitNode");let s=a.children.indexOf(r);if(-1===s)throw Error("Expected leftNodeIndex");let o=s+1,l=a.children[o];if(!l)throw Error("Expected rightNode");if(n<=i){if(r.percent=0,n<0&&s>0){let e=Math.abs(n),t=s-1;for(;e>0;){let n=a.children[t];if(n.percent>e){n.percent-=e;break}if(e-=n.percent,n.percent=0,0===t)break;t--}}let e=a.children.reduce((e,t)=>t===l?e:e+t.percent,0);l.percent=100-e;return}let u=r.percent+l.percent,d=a.children.slice(s).reduce((e,t)=>e+t.percent,0);if(n>u-i){if(r.percent=Math.min(d,Math.max(u,n)),l.percent=0,n>u&&o<a.children.length-1){let e=n-u,t=o+1;for(;e>0;){let n=a.children[t];if(n.percent>e){n.percent-=e;break}if(e-=n.percent,n.percent=0,t===a.children.length-1)break;t++}}return}let c=r.percent-n;l.percent=l.percent+c,r.percent=n}e.i(319105);var eq=e.i(131141);let eK=(0,J.atom)([]),eY=(0,J.atom)([]),eX=(0,J.atom)([]),eQ={x:0,y:0,width:0,height:0},eZ={type:"commands",data:{autoFocus:!1}},eJ=(0,ed.atomFamily)(e=>(0,J.atom)({paneId:e,type:"tile",rectAtom:(0,J.atom)({...eQ}),dataAtom:(0,J.atom)({...eZ}),isHidden:!1,isCommitted:!1,highlight:!1})),e0=(0,J.atom)(e=>e(eK).map(t=>e(eJ(t)))),e1=(0,J.atom)(e=>e(e0).filter(e=>!e.isHidden)),e2=(0,J.atom)(e=>e(e0).filter(e=>e.isHidden)),e5=(0,J.atom)(e=>e(eX).map(t=>e(e8(t)))),e4=(0,ed.atomFamily)(e=>(0,J.atom)({handleId:e,rect:eQ,stacked:!1,parentPath:["tiling"],leftPath:["tiling"],rightPath:["tiling"]})),e8=(0,ed.atomFamily)(e=>(0,J.atom)({id:e,rectAtom:(0,J.atom)({...eQ}),panes:[],path:["tiling"],activeIndex:0})),e3=(0,J.atom)(()=>34),e6=(0,J.atom)({x:0,y:0,width:0,height:0});e.i(282890);var e9=e.i(66718);let e7=(0,J.atom)(null),te=(0,J.atom)(null,(e,t,n)=>{n!==e(e7)&&t(e7,n)}),tt=(0,J.atom)(null,(e,t,n)=>{let i=eJ(n);e(i).isCommitted||t(i,e=>(0,eq.produce)(e,e=>{e.isCommitted=!0}))}),tn=(0,J.atom)(e=>{let t=e(e7);if(!t)return null;let n=e(eJ(t)),i=e(n.dataAtom);return"markdown"===i.type?i.data.path:(0,e9.isFilePane)(i)&&i.data.path||null});var ti=e.i(992785),tr=e.i(568817);em.Type.Object({width:em.Type.Number({minimum:0}),isOpen:em.Type.Boolean(),activeContent:em.Type.Union([em.Type.Literal("filetree"),em.Type.Literal("inbox")])});let ta=(0,J.atom)({width:260,isOpen:!1,activeContent:"filetree"}),ts=(0,J.atom)(e=>e(ta).isOpen),to=(0,J.atom)(e=>e(ta).activeContent),tl=(0,J.atom)(e=>{let t=e(ta);return t.isOpen?t.width:0}),tu=(0,J.atom)(!0),td=(0,J.atom)(!1),tc=(0,J.atom)({tiling:null,floating:[]}),tp=(0,J.atom)(e=>e(e0).filter(t=>(0,e9.isFilePane)(e(t.dataAtom)))),th=(0,J.atom)(e=>{for(let t of e(e0))if(!t.isCommitted&&(0,e9.isFilePane)(e(t.dataAtom)))return t.paneId;return null}),tm=(0,J.atom)(e=>{for(let t of e(e0))if(!t.isCommitted&&!(0,e9.isFilePane)(e(t.dataAtom)))return t.paneId;return null}),tf=(0,J.atom)(e=>{let t=[];for(let n of e(e1))t.push([n.paneId,e(n.dataAtom)]);return t}),tg=(0,J.atom)([]),tx=(0,J.atom)(e=>{let t=[];for(let n of e(e2))t.push([n.paneId,e(n.dataAtom)]);return t}),ty=(0,J.atom)(e=>{let t=[];for(let n of e(e0))t.push([n.paneId,e(n.dataAtom)]);return t}),tv=(0,J.atom)(e=>e(ty).length),tw=(0,J.atom)(e=>{let t=e(e6);return!!(t.width&&t.height)}),tb=(0,J.atom)(null),tj=(0,J.atom)(null,(e,t,n)=>{let i=e(e0).find(t=>{let i=e(t.dataAtom);return(0,e9.isFilePane)(i)?n===(0,e9.getFilePathForPane)(i):"markdown"===i.type&&n===i.data.path});i&&(t(te,i.paneId),t(tt,i.paneId))}),tS=(0,J.atom)(null);em.Type.Object({width:em.Type.Number({minimum:0}),isOpen:em.Type.Boolean()});let tk=(0,J.atom)({width:280,isOpen:!0}),tC=(0,J.atom)(e=>{let t=e(tk);return t?.isOpen??!1}),tT=(0,J.atom)(e=>{let t=e(tk);return t?t.isOpen?t.width:46:0});function tE({x:e,y:t},n){return e>n.x&&e<n.x+n.width&&t>n.y&&t<n.y+n.height}function tI(e,t){let n=function({rect:e,point:t}){let n=e.height>e.width?e.width/e.height:1,i=e.width>e.height?e.height/e.width:1,r=(t.x-e.x)*i,a=(e.x+e.width-t.x)*i,s=(t.y-e.y)*n,o=Math.min(r,a,s,(e.y+e.height-t.y)*n);return o===r?"left":o===a?"right":o===s?"top":"bottom"}({point:e,rect:t}),i={x:t.x,y:t.y,width:t.width,height:t.height},r="below";return"top"===n?(i.height=t.height/2,r="above"):"bottom"===n?(i.height=t.height/2,i.y=t.y+t.height/2,r="below"):"left"===n?(i.width=t.width/2,i.x=t.x,r="leftOf"):"right"===n&&(i.width=t.width/2,i.x=t.x+t.width/2,r="rightOf"),{placement:r,rect:i}}function tP(e){return"handle:"+e.leftPath.join(":")}function tA(e){return(0,q.default)(()=>(0,ed.selectAtom)(e,({width:e,height:t})=>({width:e,height:t}),(e,t)=>e.height===t.height&&e.width===t.width),[e])}function tR(e){return(0,q.default)(()=>(0,ed.selectAtom)(e,({x:e,y:t})=>({x:e,y:t}),(e,t)=>e.x===t.x&&e.y===t.y),[e])}let tD=em.Type.Object({type:em.Type.Literal("centered")}),tV=em.Type.Object({type:em.Type.Literal("sidebar"),width:em.Type.Number({minimum:300})}),t_=(0,J.atom)("leftSidebar"),tM=(0,J.atom)(e=>"leftSidebar"===e(t_)?"agent-filetree":"filetree-agent");em.Type.Union([tV,tD]);let tF=(0,J.atom)({type:"sidebar",width:450});(0,ed.selectAtom)(tF,e=>null!==e);let tO=(0,ed.selectAtom)(tF,e=>"centered"===e.type),tL=(0,J.atom)(void 0),tB=(0,J.atom)(void 0),tU=(0,J.atom)(null,(e,t,n)=>{t(tL,n?.taskId),t(tB,n?.subreplId),t(tQ,e(tc))}),tN={overlay:_.SIDEBAR_Z_INDEX+20,gutterActive:_.SIDEBAR_Z_INDEX+19,maximizedTooltip:_.SIDEBAR_Z_INDEX+18,maximizedPane:_.SIDEBAR_Z_INDEX+17,maximizedHeader:_.SIDEBAR_Z_INDEX+16,filetreeDragLayer:17,subreplBorder:18,detachPreview:16,draggingPane:15,draggingHeader:14,floatingPaneActive:11,floatingHeaderActive:10,floatingPane:9,floatingHeader:8,dropPreview:7,gutterHovered:6,tiledPaneActive:5,tiledHeaderActive:4,tiledPane:3,tiledHeader:2,taskSidebar:2,gutter:1,hiddenPane:0},tG=(0,J.atom)(e=>8*!!e(tB)),t$=(0,J.atom)(e=>{let t=e(e6),n=e(tM),i=e(tk)?e(tT):0,r=e(tG),a=t.width-i;return{x:"agent-filetree"===n?i+r:r,y:r,width:a-2*r,height:t.height-2*r}}),tz=(0,J.atom)(e=>{let t=e(t$),n=e(e6).width-t.x-t.width;return{top:t.y,right:n,height:_.APP_HEADER_HEIGHT,zIndex:tN.tiledPane}});(0,J.atom)(!0);let tW=(0,J.atom)(6),tH=(0,J.atom)(0),tq=(0,J.atom)(e=>{let t=e(ta),n=e(tW),i=n+e(tH),r=e(tM),a=e(tF),s=t.isOpen?t.width+2*n:n,o=n+("sidebar"===a.type?a.width:450)+("sidebar"===a.type&&0===a.width?0:n),l=e(tk),u=e(tT),d=l?u:0,c=e(tG);return"agent-filetree"===r?{top:i+c,bottom:n+c,left:d+o+c,right:s+c}:{top:i+c,bottom:n+c,left:s+c,right:o+d+c}}),tK=(0,J.atom)(e=>{let t=e(e3),n=e(tW),i=e(e6);return{headerHeight:t,inset:e(tq),gap:n,size:{width:i.width,height:i.height}}}),tY=(0,J.atom)(null,(e,t,n)=>{t(e6,n),t(tQ,e(tc))});function tX(e,t){return(0,ti.default)(e,t)}let tQ=(0,J.atom)(null,(e,t,n)=>{let i=e(eK),r=e(eY),a=e(eX),s=new Set(i),o=new Set(r),l=new Set(a),{tiles:u,floating:d,gutters:c,headers:p}=function(e,{size:t,gap:n,headerHeight:i,inset:r=eF}){let a=[],s=[],o=[],l=[],u=null,d={x:r.left,y:r.top,width:t.width-(r.left+r.right),height:t.height-(r.top+r.bottom)},{tiling:c}=e;if(c?.type==="paneGroup"){let e={x:d.x,y:d.y+i,width:d.width,height:d.height-i},t={x:e.x,y:e.y-i,width:e.width,height:i};l.push({id:c.id,rect:t,panes:c.panes,activeIndex:c.activeIndex,path:["tiling"]}),s.push(...c.panes.map((t,n)=>({paneId:t,rect:e,active:n===c.activeIndex})))}else c&&c.children.forEach((t,r)=>(function t(r,a,d,c){let p,h=a.children.indexOf(r),m=a.children.length,f=a.stacked?d.height:d.width,{width:g,height:x}=function(){let{width:e,height:t}=d,s=r.percent/100;return a.stacked?t=(f-(n*(m-1)+i*m))*s+i:e=(f-n*(m-1))*s,{width:e,height:t}}(),{x:y,y:v}=function(){let{x:e,y:t}=d;if(0===h)return{x:e,y:t};if(!u)throw Error("Expected previousRect");return a.stacked?t=u.y+u.height+n:e=u.x+u.width+n,{x:e,y:t}}(),w={x:y,y:v,height:x,width:g};if(u=w,"paneGroup"===r.type){let e={x:w.x,y:w.y+i,width:w.width,height:w.height-i},t={x:e.x,y:e.y-i,width:e.width,height:i};l.push({id:r.id,rect:t,panes:r.panes,activeIndex:r.activeIndex,path:c}),s.push(...r.panes.map((t,n)=>({paneId:t,rect:e,active:n===r.activeIndex})))}else r.children.forEach((e,n)=>t(e,r,w,[...c,n]));if(0===h)return;let b={x:w.x-(a.stacked?0:n),y:w.y-(a.stacked?n:0),width:a.stacked?w.width:n,height:a.stacked?n:w.height},j=eE(c),S=[...j,h-1],k=eP(e,S);if(!k||!eI(k))throw Error("Expected leftNode");0===k.percent?p="left":0===r.percent&&(p="right"),o.push({parentPath:j,leftPath:S,rightPath:c,stacked:a.stacked,rect:b,snapped:p})})(t,c,d,["tiling",r]));let p={x:d.x-r.left,y:d.y-r.top,width:d.width+r.left+r.right,height:d.height+r.top+r.bottom};return e.floating.forEach((e,t)=>{let n=eO(e.rect,{inside:p,minVisibleX:2*i,minVisibleY:i}),r={height:i,width:e.rect.width,x:n.x,y:n.y},s={x:n.x,y:n.y+i,width:e.rect.width,height:Math.max(e.rect.height-i,0)};l.push({id:e.id,rect:r,panes:e.panes,activeIndex:e.activeIndex,path:["floating",t]}),a.push(...e.panes.map((t,n)=>({paneId:t,rect:s,active:n===e.activeIndex})))}),{tiles:s,gutters:o,headers:l,floating:a}}(n,e(tK)),h=c.map(tP);tX(r,h)||t(eY,h);let m=[...u,...d].map(e=>e.paneId);tX(i,m)||t(eK,(0,tr.default)(m,{existing:i,getKey:e=>e}));let f=[];function g({paneId:n,rect:i,type:r,isHidden:a}){s.delete(n);let o=eJ(n),l=e(o);tX(e(l.rectAtom),i)||t(l.rectAtom,i);let u=(0,eq.produce)(l,e=>{e.paneId=n,e.type=r,e.isHidden=a});tX(l,u)||t(o,u)}p.forEach(n=>{l.delete(n.id);let i=e8(n.id),r=e(i);f.push(n.id),tX(e(r.rectAtom),n.rect)||t(r.rectAtom,n.rect);let a=(0,eq.produce)(r,e=>{e.panes=n.panes,e.activeIndex=n.activeIndex,e.path=n.path});tX(r,a)||t(i,a)}),tX(a,f)||t(eX,f),u.forEach(({paneId:e,rect:t,active:n})=>{g({paneId:e,rect:t,isHidden:!n,type:"tile"})}),d.forEach(({paneId:e,rect:t,active:n})=>{g({paneId:e,rect:t,isHidden:!n,type:"floating"})}),c.forEach(n=>{let i={handleId:tP(n),rect:n.rect,parentPath:n.parentPath,leftPath:n.leftPath,rightPath:n.rightPath,stacked:n.stacked,snapped:n.snapped};o.delete(i.handleId);let r=e4(i.handleId);tX(e(r),i)||t(r,i)}),s.forEach(eJ.remove),o.forEach(e4.remove),l.forEach(e8.remove);let x=e(e7);x&&s.has(x)&&t(e7,null),t(tc,n)});var tZ=e.i(869226),tJ=e.i(719518),t0=e.i(15053),t1=e.i(173738),t2=e.i(282453);let t5=(0,J.atom)(null),t4=(0,J.atom)(null,(e,t,n)=>{for(let e of(t2.default.set(t9(n.popupId),Date.now()+6048e5),t2.default.set(t6(n.popupId),n.state),t2.default.keys().filter(e=>e.startsWith(t3)))){let t=t2.default.get(e);if("number"==typeof t&&t<Date.now()){let t=e.split(":")[1];t2.default.remove(t9(t)),t2.default.remove(t6(t))}}}),t8=(0,J.atom)(e=>!!e(t5)),t3="popup-id-ttl:";function t6(e){return`popup-id-data:${e}`}function t9(e){return`${t3}${e}`}let t7=(0,J.atom)(e=>{let t=e(tc),n={};e(e0).forEach(t=>{n[t.paneId]=e(t.dataAtom)});let i=e(tF),r=i?.type==="sidebar"?{width:i.width}:void 0,a=e(ta),s=e(tk);return{layout:t,data:n,agent:r,filetree:a.isOpen?{width:a.width,isOpen:!0,activeContent:a.activeContent}:void 0,...s&&{taskSidebar:{width:s.width,isOpen:s.isOpen}}}}),ne=(0,J.atom)(null),nt=(0,J.atom)(null),nn=(0,J.atom)(null);async function ni(e,t){let n;try{n=await t1.apolloClient?.mutate({mutation:G,variables:{input:{replId:e,state:t}}})}catch(e){return{success:!1,retry:!0}}return n?.data?.setReplLayoutState.__typename==="Repl"?{success:!0,retry:void 0}:{success:!1,retry:!1}}let nr=(0,J.atom)(null,async(e,t,n)=>{let i=e(nt);if(i&&!i.retry||i&&Date.now()-i.timestamp<6e4||!e(tw))return;let r=e(t7),a=n.replId,s=e(ne);if(!n.force&&(0,ti.default)(s,r))return;let o=e(t5);if(o){t(t4,{popupId:o,state:r}),t(ne,r);return}let l=(0,t0.v4)();t(nn,l);let u=await ni(a,r);if(e(nn)===l){if(t(nn,null),u.retry)return void t(nt,{timestamp:Date.now(),retry:!0});if(!u.success)return void t(nt,{timestamp:Date.now(),retry:!1});t(ne,r)}}),na=(0,J.atom)(null,(e,t,{data:n,layout:i,type:r})=>{Object.entries(n).forEach(([n,i])=>{let r=eJ(n);t(r,(0,eq.produce)(e(r),e=>{e.isCommitted=!0})),t(e(r).dataAtom,i)}),t(tc,i),t(tQ,i),t(tS,r),t(ne,e(t7))}),ns=(0,J.atom)(!1),no=(0,J.atom)(e=>e(ns)?e(e7):null),nl=(0,J.atom)(null,(e,t,n)=>{t(te,n),t(ns,!0)}),nu=(0,J.atom)(null,(e,t,n)=>{t(ns,!0);let i=eD(e(tc),n.paneGroupId);if(!i){let e=Error("Expected paneGroup");throw t(tb,{error:e,tags:{layoutstate:!0},origin:"Layout: state/maximize/maximizePaneGroupAtom"}),e}let r=i.panes[i.activeIndex];if(!r){let e=Error("Expected paneId");throw t(tb,{error:e,tags:{layoutstate:!0},origin:"Layout: state/maximize/maximizePaneGroupAtom"}),e}t(te,r)}),nd=(0,J.atom)(null,(e,t)=>{e(t8)||t(ns,!1)}),nc=(0,J.atom)(null,(e,t,n)=>{e(no)===n?t(nd):t(nl,n)}),np=(0,J.atom)(null,(e,t,n)=>{let i=eD(e(tc),n.paneGroupId);if(!i){let e=Error("Expected paneGroup");throw t(tb,{error:e,tags:{layoutstate:!0},origin:"Layout: state/maximize/toggleMaximizePaneGroupAtom"}),e}let r=i.panes[i.activeIndex];if(!r){let e=Error("Expected paneId");throw t(tb,{error:e,tags:{layoutstate:!0},origin:"Layout: state/maximize/toggleMaximizePaneGroupAtom"}),e}t(nc,r)}),nh=(0,J.atom)(e=>{let t=e(e6),n=t.width+t.x,i=-t.x,r=e(tW);return{x:i,width:n,y:r,height:t.height-r}}),nm=(0,J.atom)(e=>{let t=e(e3),{x:n,y:i,width:r}=e(nh);return{x:n,y:i,width:r,height:t}}),nf=(0,J.atom)(e=>{let t=e(e3),{x:n,y:i,width:r,height:a}=e(nh);return{x:n,y:i+t,width:r,height:a-t}});var ng=e.i(408880);let nx=(0,J.atom)(null,(e,t,n)=>{let i=eD(e(tc),n);if(!i)return null;t(te,i.panes[i.activeIndex])}),ny=(0,J.atom)(null,(e,t,n)=>{let i=e(tc),r=eA(i,n);if(!r)throw Error("Expected pane");let a=!r.paneGroup.panes.some(e=>e!==n),s=n===e(e7),o=e_(i,n),l=(0,eq.produce)(i,e=>{try{eG(e,n)}catch(e){throw t(tb,{error:e,tags:{layoutstate:!0},origin:"Layout: state/removePane/removePaneAtom"}),e}});if(t(tQ,l),a&&e(ns)&&!e(t8)&&t(ns,!1),s&&(a||t(nx,r.paneGroup.id),a&&o)){do"split"===o.type&&(o=o.children[0]);while("paneGroup"!==o.type)t(nx,o.id)}}),nv=(0,J.atom)(null,(e,t,n)=>{let i=e(tc),r=eA(i,n),a=r?.paneGroup.panes.filter(e=>e!==n);if(!a?.length)return;let s=(0,eq.produce)(i,e=>{try{for(let t of a)eG(e,t)}catch(e){throw t(tb,{error:e,tags:{layoutstate:!0},origin:"Layout: state/removePane/removePaneAtom"}),e}});t(tQ,s)}),nw=(0,J.atom)(null,(e,t,n)=>{let i=e(tc),r=eA(i,n);r&&t(tQ,(0,eq.produce)(i,e=>{let t=!1;for(let i of r.paneGroup.panes)t&&eG(e,i),i===n&&(t=!0)}))}),nb=(0,J.atom)(null,(e,t,n)=>{let i=e(tc),r=eD(i,n.paneGroupId);if(!r){let e=Error("Expected pane group");throw t(tb,{error:e,tags:{layoutstate:!0},origin:"Layout: state/splits/removePaneGroupAtom"}),e}let a=(0,eq.produce)(i,e=>{try{r.panes.forEach(t=>{eG(e,t)})}catch(e){throw t(tb,{error:e,tags:{layoutstate:!0},origin:"Layout: state/splits/removePaneGroupAtom"}),e}});e(ns)&&!e(t8)&&t(ns,!1),t(tQ,a)}),nj=(0,J.atom)(null,(e,t,n)=>{let i=e(tc),r=eA(i,n.paneId);if(!r){let e=Error("Expected relativeToPane");throw t(tb,{error:e,tags:{layoutstate:!0},origin:"Layout: state/splits/splitPaneAtom"}),e}let a=(0,t0.v4)();t(e(eJ(a)).dataAtom,{type:"commands",data:{autoFocus:!!n.autoFocus}});let s=(0,eq.produce)(i,e=>{try{eL(e,{id:(0,t0.v4)(),isFloating:!1,placement:n.placement,relativeTo:r.paneGroupPath,panes:[a]})}catch(e){throw t(tb,{error:e,tags:{layoutstate:!0},origin:"Layout: state/splits/splitPaneAtom"}),e}});t(tQ,s),t(te,a)}),nS=(0,J.atom)(null,(e,t,n)=>{let i=e(tc),r=(0,t0.v4)();t(e(eJ(r)).dataAtom,n.pane),(0,e9.isToolPane)(n.pane)&&t(tt,r);let a=(0,eq.produce)(i,e=>{try{eL(e,{id:(0,t0.v4)(),isFloating:!1,placement:n.placement,relativeTo:n.relativeTo,panes:[r],percent:n.percent})}catch(e){throw t(tb,{error:e,tags:{layoutstate:!0},origin:"Layout: state/splits/insertSplitPaneAtom"}),e}});return t(tQ,a),r}),nk=(0,J.atom)(null,(e,t,n)=>{let i=e(tc);t(tQ,(0,eq.produce)(i,e=>{eH(e,{leftPath:n.leftPath,percent:n.percent})}))});var nC=e.i(965863);let nT=(0,J.atom)(null,(e,t,n)=>{if(0===n.panes.length){let e=Error("Expect at least one pane");throw t(tb,{error:e,origin:"Layout: state/insertPaneGroup/insertPaneGroupAtom"}),e}let i=e(tc),r=n.panes.map(()=>(0,t0.v4)()),a=(0,eq.produce)(i,e=>{try{eL(e,{id:(0,t0.v4)(),panes:r,relativeTo:n.relativeTo||["tiling"],placement:n.placement,percent:n.percent})}catch(e){throw t(tb,{error:e,tags:{layoutstate:!0},origin:"Layout: state/insertPaneGroup/insertPaneGroupAtom"}),e}});if(t(tQ,a),n.panes.forEach((n,i)=>{let a=r[i];t(e(eJ(a)).dataAtom,n),(0,e9.isToolPane)(n)&&t(tt,a);let s=(0,e9.isSingleton)(n.type)?e(e0).find(t=>e(t.dataAtom).type===n.type&&t.paneId!==a):null;s&&t(ny,s.paneId)}),n.commit)for(let e of r)t(tt,e);return n.makeActive&&t(te,r[0]),r}),nE={top:"above",left:"leftOf",right:"rightOf",bottom:"below"},nI=(0,J.atom)(null,(e,t,{pane:n,edge:i})=>{t(nS,{pane:n,relativeTo:["tiling"],placement:nE[i]})}),nP=(0,J.atom)(null,(e,t,n)=>{let i=e(tc),r=(0,t0.v4)(),a=(0,t0.v4)(),s=(0,eq.produce)(i,e=>{try{eL(e,{id:a,panes:[r],isFloating:!0,rect:n.rect})}catch(e){throw t(tb,{error:e,tags:{layoutstate:!0},origin:"Layout: state/insertPaneGroup/insertFloatingPaneGroupAtom"}),e}});return t(tQ,s),t(e(eJ(r)).dataAtom,n.pane),(0,e9.isToolPane)(n.pane)&&t(tt,r),n.makeActive&&(t(te,r),n.makeModal&&t(nC.modalPaneGroupIdAtom,a)),r}),nA=(0,J.atom)(null,(e,t,{paneId:n,activate:i})=>{let r=e(tc);if("tile"===e(eJ(n)).type?t(tQ,(0,eq.produce)(r,e=>{try{!function(e,t){let n=eA(e,t.paneId);if(!n)return;let{paneGroupPath:i,paneGroup:r}=n;for(let a of(r.activeIndex=n.index,i.map((e,t)=>i.slice(0,t+1)))){let n=eP(e,a);if(!n)throw Error("Expected node");if("floatingPaneGroup"===n.type)throw Error("Expected tiled pane");if(1===a.length)continue;let i=a[a.length-1];if("number"!=typeof i)throw Error("Expected number");let r=eP(e,eE(a));if(r?.type!=="split")throw Error("Expected split");let s=r.stacked?t.minPercentVertical:t.minPercentHorizontal;if(n.percent>=s)continue;let o=i===r.children.length-1,l=o?[...a.slice(0,-1),i-1]:a;eH(e,{leftPath:l,percent:o?r.children[i-1].percent-(s-n.percent):s})}}(e,{paneId:n,minPercentHorizontal:30,minPercentVertical:20})}catch(e){throw t(tb,{error:e,origin:"Layout: revealPaneAtom/revealTiledPane"}),e}})):t(tQ,(0,eq.produce)(r,e=>{try{!function(e,t){let n=eA(e,t.paneId);if(!n)return;let{paneGroup:i}=n;if("floatingPaneGroup"!==i.type)throw Error("Expected floatingPaneGroup");i.activeIndex=n.index,i.rect.width=Math.max(i.rect.width,t.minWidth),i.rect.height=Math.max(i.rect.height,t.minHeight)}(e,{paneId:n,minWidth:200,minHeight:140})}catch(e){throw t(tb,{error:e,origin:"Layout: revealPaneAtom/revealFloatingPane"}),e}})),!i){let t=eA(r,n),i=e(e7);if(!t)throw Error("Expected pane");if(!i)return;let a=eA(r,i);if(!a)throw Error("Expected active pane");if(a.paneGroup.id!==t.paneGroup.id)return}t(te,n)}),nR=(0,J.atom)(null),nD=(0,J.atom)(null,(e,t,n)=>{if(0===n.panes.length)return[];let i=e(tc),r=n.panes.map(()=>(0,t0.v4)()),a=(0,eq.produce)(i,e=>{try{eU(e,{paneIds:r,activate:n.activate,paneGroupId:n.paneGroupId,index:n.index})}catch(e){throw t(tb,{error:e,tags:{layoutstate:!0},origin:"Layout: state/tabs/insertPanesAtom"}),e}});if(t(tQ,a),n.panes.forEach((i,a)=>{let s=r[a];t(e(eJ(s)).dataAtom,i);let o=(0,e9.isSingleton)(i.type)?e(e0).find(t=>e(t.dataAtom).type===i.type&&t.paneId!==s):null;o&&t(ny,o.paneId),(n.commit||(0,e9.isToolPane)(i))&&t(tt,s)}),n.activate){let[e]=r;t(nA,{paneId:e,activate:!0})}return r}),nV=(0,J.atom)(null,(e,t,{pane:n,activate:i,commit:r,placement:a})=>{if("agentChat"===n.type){let t=e(nR);t?.openAgent(n.data?.sessionId);return}let s=e(tc);if(!s.tiling){let e=t(nS,{pane:n,relativeTo:["tiling"],placement:"replace"});return i&&t(te,e),e}if("after"===a.type){let e=eA(s,a.paneId);if(e){let[r]=t(nD,{panes:[n],paneGroupId:e.paneGroup.id,index:e.index+1,activate:i});return i&&t(te,r),r}}if("secondary"===a.type&&a.relativeTo){let r=e_(s,a.relativeTo);if(r){if("paneGroup"===r.type){let[e]=t(nD,{panes:[n],paneGroupId:r.id,activate:i});return i&&t(te,e),e}let e=t(nS,{pane:n,relativeTo:a.relativeTo,placement:"rightOf"});return i&&t(te,e),e}let o=eA(s,a.relativeTo);if(o?.paneGroup.type==="floatingPaneGroup"){let r=e(eJ(a.relativeTo)),s=e(r.rectAtom);return t(nP,{rect:{x:s.x+s.width,y:s.y,width:s.width,height:s.height},pane:n,makeActive:i})}}let o=t(nS,{pane:n,relativeTo:["tiling"],placement:"rightOf"});return i&&t(te,o),r&&t(tt,o),o});var n_=e.i(903381);let nM=(0,J.atom)(null,(e,t,n)=>{t(e(eJ(n.paneId)).dataAtom,n.pane),(n.makeActive||n.reveal)&&t(nA,{paneId:n.paneId,activate:n.makeActive??!1}),(n.commit||(0,e9.isToolPane)(n.pane))&&t(tt,n.paneId)});var nF=((r={}).EXACT="EXACT",r.FUZZY="FUZZY",r.NONE="NONE",r);function nO(e,t){return e?.ports||t?.ports?e?.ports&&!t?.ports||!e?.ports&&t?.ports?"FUZZY":e?.ports&&t?.ports&&e.ports.port!==t.ports.port?"NONE":e?.ports&&t?.ports&&e.ports.port===t.ports.port?e.ports.path===t.ports.path?"EXACT":"FUZZY":"NONE":"EXACT"}let nL=(0,J.atom)(null,(e,t,n)=>{let i=e(tc),r=eA(i,n);if(!r){let e=Error("Expected selectedPane");throw t(tb,{error:e,tags:{layoutstate:!0},origin:"Layout: state/tabs/selectTabAtom"}),e}for(let e of(t(e8(r.paneGroup.id),e=>(0,eq.produce)(e,e=>{e.activeIndex=r.index})),r.paneGroup.panes))t(eJ(e),e=>(0,eq.produce)(e,e=>{e.isHidden=e.paneId!==n}));t(tc,(0,eq.produce)(i,e=>{try{!function(e,t){let n=eA(e,t);if(!n?.paneGroup)throw Error("Expected pane group");let{paneGroup:i}=n,r=i.panes.indexOf(t);if(-1===r)throw Error("Expected index");i.activeIndex=r}(e,n)}catch(e){throw t(tb,{error:e,tags:{layoutstate:!0},origin:"Layout: state/tabs/selectTabAtom"}),e}}));let{width:a}=e(e(eJ(n)).rectAtom);0===a?t(nA,{paneId:n,activate:!0}):t(te,n)}),nB=(0,J.atom)(null,(e,t,n)=>{let i=e(tc),r=eR(i,"topRight"),a=eR(i,"topLeft");if(!r||!a||!i.tiling){let e=t(nS,{pane:n,relativeTo:["tiling"],placement:"replace"});t(tt,e);return}if("paneGroup"===i.tiling.type){let e=t(nS,{pane:n,relativeTo:["tiling"],placement:"rightOf"});t(tt,e);return}if("split"===i.tiling.type&&2===i.tiling.children.length&&"paneGroup"===i.tiling.children[1].type){let{stacked:e}=i.tiling,a=t(nS,{pane:n,relativeTo:r.path,placement:e?"rightOf":"above"});t(tt,a);return}t(nD,{panes:[n],paneGroupId:r.paneGroup.id,commit:!0})}),nU=(0,J.atom)(null,(e,t,n)=>{if(!e(e0).find(t=>{let i=e(t.dataAtom);return"webview"===i.type&&nO(n,i.data)!==nF.NONE}))return void t(nB,{type:"webview",data:n})}),nN=(0,J.atom)(null,(e,t,n)=>{let i=e(tc),r=(0,eq.produce)(i,e=>{let i=eA(e,n.paneId);if(!i){let e=Error("Expected pane");throw t(tb,{error:e,tags:{layoutstate:!0},origin:"Layout: state/tabs/movePaneAtom"}),e}let r=eD(e,n.toPaneGroupId);if(!r){let e=Error("Expected toPaneGroup");throw t(tb,{error:e,tags:{layoutstate:!0},origin:"Layout: state/tabs/movePaneAtom"}),e}let a=1===i.paneGroup.panes.length,s=!r.panes.includes(n.paneId);if(!a||s)try{eG(e,n.paneId),eU(e,{paneIds:[n.paneId],paneGroupId:n.toPaneGroupId,index:n.index}),s&&t(tt,n.paneId)}catch(e){throw t(tb,{error:e,tags:{layoutstate:!0},origin:"Layout: state/tabs/movePaneAtom"}),e}});t(tQ,r)}),nG=(0,J.atom)(null,(e,t,n)=>{let i=e(e7);if(!i)return;let r=e(tc),a=eA(r,i);if(!a)return;let s=a.paneGroup,o=eM({relativeTo:i,rects:new Map(e(e0).filter(e=>!e.isHidden).map(t=>[t.paneId,e(t.rectAtom)])),direction:n}),l=o?eA(r,o):null;if(l)return void t(nN,{paneId:i,toPaneGroupId:l.paneGroup.id});let u=s.panes.find(e=>e!==i);u&&t(tQ,(0,eq.produce)(r,e=>{eG(e,i),eL(e,{id:(0,t0.v4)(),relativeTo:u,panes:[i],placement:n})}))}),n$=(0,J.atom)(!1),nz=(0,J.atom)(null,(e,t,n)=>{let i=e(tp).map(t=>({paneId:t.paneId,path:(0,e9.getFilePathForPane)(e(t.dataAtom))})).filter(e=>n===e.path),r=[],a=e(tc),s=(0,eq.produce)(a,e=>{for(let{paneId:n}of i){let i=eA(e,n);if(!i){let e=Error("Expected pane");throw t(tb,{error:e,tags:{layoutstate:!0},origin:"Layout: state/tabs/removePanesForFileAtom"}),e}i.floating||1!==i.paneGroup.panes.length?eG(e,n):r.push(n)}});for(let e of r)t(nM,{paneId:e,pane:{type:"commands",data:{autoFocus:!1}}});t(tQ,s)}),nW=(0,J.atom)(null,(e,t,n)=>{let{path:i}=n.node;if(n.eventType===n_.ChangeEventType.Delete)return void t(nz,i);let r=e(tp).filter(t=>(0,e9.getFilePathForPane)(e(t.dataAtom))===i),a={type:(0,e9.getPaneTypeForFile)({path:n.to}),data:{path:n.to}};for(let{paneId:e}of r)t(nM,{paneId:e,pane:a})}),nH=(0,J.atom)(null,(e,t,n)=>{let i=e(e7),r=e(tc);if(i){let e=eA(r,i);if(e)return void t(nD,{panes:n,paneGroupId:e?.paneGroup.id,activate:!0,index:e.index+n.length})}let a=eR(r,"topLeft");if(a)return void t(nD,{activate:!0,paneGroupId:a.paneGroup.id,index:a.paneGroup.activeIndex+n.length,panes:n});let s=r.floating.length?r.floating[0]:null;s?t(nD,{activate:!0,paneGroupId:s.id,index:s.activeIndex+n.length,panes:n}):t(nT,{panes:n,placement:"leftOf",makeActive:!0,relativeTo:["tiling"]})}),nq=(0,J.atom)(null,(e,t)=>{t(nH,[{type:"commands",data:{autoFocus:!0}}])}),nK=(0,J.atom)(null,(e,t)=>{let n=e(e7);return!!n&&(t(ny,n),!0)}),nY=(0,J.atom)(null,(e,t,n)=>{let i=e(e7);if(!i)return;let r=function(e,{paneId:t,dir:n}){let i=eA(e,t);if(!i)return;let{index:r,paneGroup:{panes:a}}=i;return"previous"===n?a[0===r?a.length-1:r-1]:a[r===a.length-1?0:r+1]}(e(tc),{paneId:i,dir:n});r&&t(nL,r)}),nX=(0,J.atom)(null,(e,t,n)=>{let{paneId:i,pane:r}=n;t(nM,{paneId:i,pane:r});let a=(0,e9.isSingleton)(r.type)?e(e0).find(t=>e(t.dataAtom).type===r.type&&t.paneId!==i):null;if(!a)return;let s=eA(e(tc),a.paneId);s?.floating||s?.paneGroup.panes.length!==1?t(ny,a.paneId):t(nM,{paneId:a.paneId,pane:{type:"commands",data:{autoFocus:!1}}})}),nQ=(0,J.atom)(null,(e,t,n)=>{let i=e(e(eJ(n.b)).dataAtom);t(nM,{paneId:n.a,pane:i});let r=eA(e(tc),n.b);r?.floating||r?.paneGroup.panes.length!==1?t(ny,n.b):t(nX,{paneId:n.b,pane:{type:"commands",data:{autoFocus:!1}}})}),nZ=(0,J.atom)(null,(e,t,n)=>{let i=eJ(n);t(i,e=>(0,eq.produce)(e,e=>{e.highlight=!0})),setTimeout(()=>{t(i,e=>(0,eq.produce)(e,e=>{e.highlight=!1}))},200)}),nJ=(0,J.atom)(null,(e,t,n)=>{if("agentChat"===n.pane.type){let t=e(nR);t?.openAgent(n.pane.data?.sessionId);return}let i=e(tc),{activate:r=!0,update:a=!0}=n,s=i=>(i.paneId===e(e7)&&t(nZ,i.paneId),(r||n.reveal)&&t(nL,i.paneId),a&&t(nM,{paneId:i.paneId,pane:n.pane,makeActive:r,reveal:n.reveal}),i.paneId);if("diff"===n.pane.type){let t=e(e0).find(t=>{let i=e(t.dataAtom);return(0,ng.default)(i,n.pane)});if(t)return s(t)}if("webview"===n.pane.type){let t=e(e0).filter(t=>"webview"===e(t.dataAtom).type),i=t.find(t=>{let i=e(t.dataAtom);return"webview"===i.type&&"webview"===n.pane.type&&nO(i.data,n.pane.data)!==nF.NONE});if(i)return s(i);if(t.length>0)return s(t[0])}let o=e(e0).find(t=>e(t.dataAtom).type===n.pane.type);if((0,e9.isSingleton)(n.pane.type)&&o)return s(o);let l=eR(i,"topRight");if(!l)return t(nT,{panes:[n.pane],placement:"rightOf",relativeTo:["tiling"],makeActive:r,commit:n.commit})[0];let u=l.paneGroup.panes.find(t=>{let n=e(eJ(t));if(n.isHidden)return!1;let i=e(n.dataAtom);return!n.isCommitted&&!(0,e9.isFilePaneType)(i.type)});if(u)return t(nM,{paneId:u,pane:n.pane,makeActive:r,reveal:n.reveal}),u;let d=!!n.commit||r,c=t(nD,{panes:[n.pane],paneGroupId:l.paneGroup.id,activate:d,commit:n.commit});return n.reveal&&t(nA,{paneId:c[0],activate:d}),c[0]});var n0=e.i(151386);let n1=(0,J.atom)(!1),n2=(0,J.atom)(!1),n5=(0,v.createContext)(null);function n4({children:e,savedLayoutState:t,popupId:n,initialPane:i,agentCenteredLayout:r=!1,agentLayoutVariation:a,agentPosition:s="leftSidebar",hasReplPortal:o=!1}){let l,u,d,c=(0,n0.useFilePaneFlag)(),p=(l=(0,y.useRouter)(),u=(0,Y.isInBonsaiWebview)(l),d=(0,Y.doesBonsaiWebviewSupportFeature)(l,"workspace2"),u&&!d?6:_.APP_HEADER_HEIGHT),h=(0,W.default)(),[m]=(0,v.useState)(()=>{var e,l;let u=(0,J.createStore)();if(u.set(t_,s),u.set(n2,c),u.set(n1,h),u.set(tH,h?p:0),h||u.set(e6,{width:window.innerWidth,height:window.innerHeight,x:0,y:0}),n&&(u.set(t5,n),u.set(ns,!0)),t?.filetree){let n=(e=t.filetree.width,Math.min(Math.round(.4*window.innerWidth),e)),i="activeContent"in t.filetree?t.filetree.activeContent:null;u.set(ta,{width:n,isOpen:n>0,activeContent:"inbox"===i?"inbox":"filetree"})}if(r)u.set(tF,{type:"centered"});else{let e=t?.agent?.width??null;u.set(tF,{type:"sidebar",width:null===e?450:Math.min(Math.round(.5*window.innerWidth),e)})}if(o&&t?.taskSidebar){let e=(l=t.taskSidebar.width,Math.min(Math.round(.3*window.innerWidth),l));u.set(tk,{width:e,isOpen:t.taskSidebar.isOpen??!1})}else o||u.set(tk,null);let d=t??function({variation:e}){let t=(0,t0.v4)();return{data:{[t]:{type:"split-with-console"===e?"runnerOutput":"split-with-automations"===e?"automations":"webview"}},layout:{floating:[],tiling:{type:"paneGroup",panes:[t],activeIndex:0,id:(0,t0.v4)(),percent:100}},type:"default"}}({variation:a});return u.set(na,d),null!=i&&(u.get(e1).some(e=>u.get(e.dataAtom).type===i?.type)||u.set(nJ,{pane:i,commit:!0})),u});return(0,x.jsx)(n5.Provider,{value:m,children:e})}function n8(){let e=(0,v.useContext)(n5);if(!e)throw Error("Expected store in context");return e}function n3(e){return(0,ee.useAtomValue)(e,{store:n8()})}function n6(e){return(0,eh.useCreateObservableAtom)(e,n8())}let n9=e=>(0,ee.useSetAtom)(e,{store:n8()});function n7(e){return(0,tJ.useAtomCallback)((0,v.useCallback)(t=>t(e),[e]),{store:n8()})}var ie=e.i(446530),it=e.i(123850);let ii=(0,J.atom)(null),{cssVars:ir,styleTokens:ia}=(0,it.createCssVarTokens)(["backgroundColor","borderRadius","zIndex","border","opacity","visibility","width","height","x","y","innerScale","innerOpacity"]),is=(0,ed.selectAtom)(ii,e=>({[ir.border]:e?.type==="detachPreview"&&e.progress<.98?`1px dashed ${A.tokens.foregroundDefault}`:`1px solid ${A.tokens.accentPrimaryDefault}`}),ti.default),io=(0,ed.selectAtom)(ii,e=>e?.rect,ti.default),il=(0,ed.selectAtom)(io,e=>e?{[ir.width]:e.width+"px",[ir.height]:e.height+"px"}:null,ti.default),iu=(0,ed.selectAtom)(io,e=>e?{[ir.x]:e.x+"px",[ir.y]:e.y+"px"}:null,ti.default),id=(0,ed.selectAtom)(ii,e=>e?"detachPreview"===e.type?{[ir.zIndex]:tN.detachPreview.toString(),[ir.borderRadius]:"100%",[ir.backgroundColor]:"transparent"}:{[ir.zIndex]:tN.dropPreview.toString(),[ir.borderRadius]:"8px",[ir.backgroundColor]:A.tokens.accentPrimaryDimmer}:null,ti.default),ic=(0,ed.selectAtom)(ii,e=>e?"detachPreview"===e.type?{[ir.opacity]:(.5*e.progress).toString(),[ir.visibility]:"visible"}:{[ir.opacity]:"0.2",[ir.visibility]:"visible"}:{[ir.opacity]:"0",[ir.visibility]:"hidden"},ti.default),ip=(0,ed.selectAtom)(ii,e=>({[ir.innerOpacity]:e?.type==="detachPreview"?"0.5":"0"}),ti.default),ih=(0,ed.selectAtom)(ii,e=>({[ir.innerScale]:e?.type==="detachPreview"?e.progress.toString():"1"}),ti.default),im=(0,ie.cssRecord)({root:[{position:"absolute",pointerEvents:"none",opacity:ia.opacity,width:ia.width,height:ia.height,transform:`translate(${ia.x}, ${ia.y})`,backgroundColor:ia.backgroundColor,borderRadius:ia.borderRadius,border:ia.border,zIndex:ia.zIndex,visibility:ia.visibility,transition:"transform 140ms, width 140ms, height 140ms, border-radius 140ms, opacity 140ms ease-out 200ms","@media (prefers-reduced-motion: reduce)":{transitionDuration:"0ms"}}],inner:[{width:"100%",height:"100%",borderRadius:"100%",background:`radial-gradient(transparent, ${A.tokens.backgroundHighest})`,opacity:ia.innerOpacity,transform:`scale(${ia.innerScale})`}]}),ig=(0,v.memo)(function(){let e=(0,v.useRef)(null);(0,tZ.useStyleSet)(e,n6(iu)),(0,tZ.useStyleSet)(e,n6(il)),(0,tZ.useStyleSet)(e,n6(is)),(0,tZ.useStyleSet)(e,n6(id)),(0,tZ.useStyleSet)(e,n6(ic));let t=(0,v.useRef)(null);return(0,tZ.useStyleSet)(t,n6(ip)),(0,tZ.useStyleSet)(t,n6(ih)),(0,x.jsx)("div",{ref:e,css:im.root,children:(0,x.jsx)("div",{ref:t,css:im.inner})})}),ix=(0,J.atom)(e=>{let t=e(ta),n=e(e6),i=e(tW),r=e(tG),a=e(e3)+i+r,{width:s,isOpen:o}=t,l={y:a,width:s,isOpen:o,opacity:+!!o,height:n.height-a-r};return"agent-filetree"===e(tM)?{x:o?n.width-s-i-r:n.width,...l}:{x:o?i+r:-(s+i),...l}}),iy=(0,J.atom)(e=>{let t=e(ta),n=e(tW);return t.isOpen?{isOpen:!0,width:n}:{isOpen:!1,width:n}}),iv=(0,J.atom)(e=>{let t=e(ix),n=e(tM),i=e(tF),r=e(tW),a="sidebar"===i.type?i.width:450;switch(n){case"filetree-agent":return{left:t.isOpen?t.width+2*r:r,right:r+a+r};case"agent-filetree":return{right:t.isOpen?t.width+2*r:r,left:r+a+r}}return{right:r,left:t.isOpen?t.width+r:r}}),iw=(0,J.atom)(null,(e,t)=>{t(ii,{type:"dropPreview",rect:e(ij)})}),ib=(0,J.atom)(null,(e,t,n)=>{t(ii,null),t(n$,!1),t(nT,{panes:n.panes,placement:"leftOf",makeActive:!0,relativeTo:["tiling"]})}),ij=(0,J.atom)(e=>{if(e(t8))return e(nh);let t=e(tH),n=e(e6),i=e(tW),r=e(e3),a=e(iv),s=r+t+i;return{x:a.left,y:s,width:n.width-a.left-a.right,height:n.height-s-i}}),iS={},ik=w.gql`
    query FiletypeAssociations {
  currentUser {
    id
    filetypeAssociations
  }
}
    `,iC=w.gql`
    mutation SetFiletypeAssociation($input: FiletypeAssociationInput!) {
  setFiletypeAssociation(input: $input) {
    ... on UserFiletypeAssociations {
      associations
    }
    ... on UnauthorizedError {
      message
    }
    ... on UserError {
      message
    }
    ... on Error {
      message
    }
  }
}
    `,iT=(0,J.atom)({}),iE=(0,J.atom)(null),iI=(0,J.atom)(null,(e,t,n)=>{(0,ti.default)(n,e(iT))||t(iT,n)}),iP=(0,J.atom)(null,async(e,t,n)=>{let i=e(iT);t(iI,(0,eq.produce)(i,e=>{n.newAssociation?e[n.fileExtension]={extensionId:n.newAssociation.extensionId,fileHandlerId:n.newAssociation.fileHandlerId}:delete e[n.fileExtension]}));try{let e=await t1.apolloClient?.mutate({mutation:iC,variables:{input:n}});if(e?.data?.setFiletypeAssociation?.__typename!=="UserFiletypeAssociations")throw Error("Failed to set Filetype Association: "+e?.data?.setFiletypeAssociation?.message)}catch(e){t(iT,i)}}),iA=1920/1020,iR=(0,J.atom)(null,(e,t,n,i={location:"bottomRight"})=>{let r,a,s,o,l=e(e0).find(t=>e(t.dataAtom).type===n.type);if(l){t(nM,{paneId:l.paneId,pane:n,reveal:!0}),i.commit&&t(tt,l.paneId);return}let u=e(e6),d=e(e3),c=t(nP,{pane:n,rect:"bottomRight"===i.location?(r=Math.min(600,u.width),{width:r,height:a=Math.min(600/iA+d,u.height),x:u.width-r,y:u.height-a}):(o=Math.min((s=Math.min(600,u.width))/iA+d,u.height),{width:s,height:o,x:(u.width-s)/2,y:(u.height-o)/2})});i.commit&&t(tt,c)}),iD=(0,J.atom)(null,(e,t,n)=>{e(e0).filter(t=>e(t.dataAtom).type===n).forEach(e=>t(ny,e.paneId))}),iV=(0,J.atom)(null),i_=(0,J.atom)(null,(e,t,n)=>{if("end"===n.type)return void t(iV,null);if("update"===n.type){let i=e(iV);if(!i){let e=Error("Expected tilingResize");throw t(tb,{error:e,tags:{layoutstate:!0},origin:"Layout: state/resizeTiling"}),e}let{stacked:r,leftPath:a,startPercent:s,resizeDistance:o,initialLayout:l,snapPercent:u}=i,d=s+(r?n.moveDelta.y:n.moveDelta.x)/o*100,c=e(e6);d/100*c.width<240&&(d=240/c.width*100),t(tQ,(0,eq.produce)(l,e=>{eH(e,{leftPath:a,percent:d,snapPercent:u})}));return}let i=e(tc),r=n.stacked?window.innerHeight:window.innerWidth,a=eP(i,n.leftPath);if(!a||!eI(a)){let e=Error("Expected left node");throw t(tb,{error:e,tags:{layoutstate:!0},origin:"Layout: state/resizeTiling"}),e}let s=eE(n.leftPath),o=a.percent,l=null;try{l=function({layout:e,splitPath:t,tilingOptions:n}){let i=function(e,{splitPath:t}){let n=eP(e,t);if(!n||"split"!==n.type)throw Error("Expected split node");let i=100,r=eE(t);for(;r.length;){let t=eP(e,r);if(!t)break;r=eE(r),"split"===t.type&&t.stacked===n.stacked&&(i*=t.percent/100)}return i}(e,{splitPath:t}),r=eP(e,t);if(r?.type!=="split")throw Error("Expected split node");let{size:a,gap:s,headerHeight:o,inset:l={top:0,bottom:0,left:0,right:0}}=n,u=r.children.length,d=r.stacked?s*(u-1)+o*u:s*(u-1);return i/100*((r.stacked?a.height-(l.top+l.bottom):a.width-(l.left+l.right))-d)}({splitPath:s,layout:i,tilingOptions:e(tK)})}catch(e){throw t(tb,{error:e,tags:{layoutstate:!0},origin:"Layout: state/resizeTiling"}),e}if(null===l)throw Error("Expected resizeDistance");t(iV,{stacked:n.stacked,leftPath:n.leftPath,startPercent:o,resizeDistance:l,snapPercent:30/r*100,initialLayout:i})});function iM(e){return(0,q.default)(()=>e4(e),[e])}function iF(e){let t=iM(e);return(0,q.default)(()=>(0,ed.selectAtom)(t,({rect:e})=>e),[t])}function iO(e){return(0,q.default)(()=>(0,J.atom)(t=>{let n=t(iV);return!!n&&e===tP({leftPath:n.leftPath})}),[e])}function iL(e){let t=iM(e);return(0,q.default)(()=>(0,ed.selectAtom)(t,({stacked:e})=>e),[t])}let iB=["above","rightOf","leftOf","below","middle"],iU=(0,J.atom)(null),iN=(0,ed.selectAtom)(iU,e=>null!==e),iG=(0,J.atom)(null,(e,t,n)=>{t(iU,n),requestAnimationFrame(()=>{t(iU,null)})}),i$=(0,J.atom)(null),iz=(0,J.atom)(e=>{let t=e(i$);if(!t)return null;let n=eD(e(tc),t.paneGroupId);return n&&n.panes[n.activeIndex]||null}),iW=(0,ed.selectAtom)(i$,e=>e?.dropPoints),iH=(0,J.atom)(null,(e,t,n)=>{if(e(ns))return;let i=e(e6),r=eD(e(tc),n.paneGroupId);if(!r){let e=Error("Expected paneGroup");throw t(tb,{error:e,origin:"Layout: state/paneGroupDragAndDrop/dragStartAtom"}),e}let a=e(eJ(r.panes[r.activeIndex])),s=e(a.rectAtom),o=e(e3),l={x:s.x,y:s.y-o,width:s.width,height:s.height+o},u=n.mouse.x-(i.x+s.x),d=e(tW),c=new Map(e(eX).filter(e=>e!==r.id).map(e=>[e,{snappiness:400}]));t(iG,{panes:new Map(e(eK).filter(e=>e!==a.paneId).map(e=>[e,{snappiness:400}])),headers:c}),t(i$,{startType:a.type,startPoint:{x:n.mouse.x-i.x,y:n.mouse.y-i.y},paneGroupId:n.paneGroupId,transformOriginX:Math.round(u)+"px",scale:1,fromRect:l,movedAtAll:!1,dropPoints:"floating"===a.type?(({container:e,sidebarWidths:t,gap:n})=>{let i=e.width-t.left-t.right,r=e.width-100-i/2,a=(e.height-n)/2-100;return{middle:{rect:{x:0,y:0,width:0,height:0},paneId:null,visible:!1},above:{visible:!1,rect:{x:r,y:0,width:200,height:100}},below:{visible:!1,rect:{x:r,y:e.height-100-n,width:200,height:100}},leftOf:{visible:!1,rect:{x:t.left+n,y:a,width:100,height:200}},rightOf:{visible:!1,rect:{x:e.width-100-n,y:a,width:100,height:200}}}})({container:i,sidebarWidths:e(iv),gap:d}):null})}),iq=(0,J.atom)(null,(e,t,n)=>{if(e(ns))return;let i=e(i$);if(!i)return void t(ii,null);let{delta:r}=n,{paneGroupId:a,fromRect:s}=i,o=e(tc),l=eD(e(tc),a);if(!l){let e=Error("Expected paneGroup");throw t(tb,{error:e,origin:"Layout: state/paneGroupDragAndDrop/dragUpdateAtom"}),e}let u=l.panes[l.activeIndex],d=eA(o,u);if(!d){let e=Error("Expected pane");throw t(tb,{error:e,tags:{layoutstate:!0},origin:"Layout: state/paneGroupDragAndDrop/dragUpdateAtom"}),e}let c=eJ(u),p=e8(d.paneGroup.id),h=e(e3),m=Math.max(Math.abs(r.x),Math.abs(r.y)),f=m>=50,g=m>0;if(f&&!d.floating){let{rectAtom:i}=e(c),a=e(i),s=(0,eq.produce)(o,e=>{try{ez(e,{paneGroupPath:d.paneGroupPath,rect:{x:a.x+r.x,y:a.y-h+r.y,width:a.width,height:a.height+h}})}catch(e){throw t(tb,{error:e,tags:{layoutstate:!0},origin:"Layout: state/paneGroupDragAndDrop/dragUpdateAtom"}),e}});t(iG,{headers:new Map(e(eX).filter(e=>e!==d.paneGroup.id).map(e=>[e,{snappiness:400}])),panes:new Map(e(eK).filter(e=>e!==u).map(e=>[e,{snappiness:400}]))}),t(tQ,s),t(iY,n.mouse);return}let x=e(p),y=e(c);l.id===e(nC.modalPaneGroupIdAtom)&&t(nC.modalPaneGroupIdAtom,null);let{x:v,y:w}="floating"===i.startType?eO({x:s.x+r.x,y:s.y+r.y,width:s.width,height:s.height},{inside:e(e6),minVisibleX:2*h,minVisibleY:h}):{x:s.x+r.x,y:s.y+r.y};if(t(x.rectAtom,e=>(0,eq.produce)(e,e=>{e.x=v,e.y=w})),t(y.rectAtom,e=>(0,eq.produce)(e,e=>{e.x=v,e.y=w+h})),!f&&!d.floating){let{startPoint:e}=i,n=1-.7*(1-Math.sqrt(1-Math.pow(m/50,2)));t(ii,{type:"detachPreview",rect:{x:e.x-50,y:e.y-50,width:100,height:100},progress:m/50}),t(i$,(0,eq.produce)(i,e=>{e.scale=n,e.movedAtAll=e.movedAtAll||g}));return}let b=e(tW);if(i.dropPoints)return void t(i$,t=>(0,eq.produce)(t,t=>{t?.dropPoints&&function(e,{container:t,gap:n,sidebarWidths:i,headerHeight:r,paneRects:a,mouse:s}){let o={x:s.x-t.x,y:s.y-t.y},l=null,u=null;if(a.length){for(let[e,t]of a)if(tE(s,{x:t.x-n/2,y:t.y-n/2-r,width:t.width+n,height:t.height+n+r})){l=e,u=t;break}if(e.middle.visible=!!u,u){let t={width:Math.min(100,u.width),height:Math.min(100,u.height)};e.middle.paneId=l,e.middle.rect={x:u.x+u.width/2-t.width/2,y:u.y-r+(u.height+r)/2-t.height/2-n,width:t.width,height:t.height+r/2}}}else{let r={x:t.x+i.left+n,y:t.y,width:t.width-n-i.left-i.right-n,height:t.height},a={width:Math.min(100,r.width),height:Math.min(100,r.height)};e.middle.rect={x:r.x+r.width/2-a.width/2,y:r.height/2-a.height/2,width:a.width,height:a.height},e.middle.visible=!0}let d=null;for(let t of iB){let{rect:n}=e[t];if(tE(o,n)){d=t;break}}for(let t of iB)e[t].visible=!d||t===d}(t.dropPoints,{paneRects:e(iK),container:e(e6),sidebarWidths:e(iv),headerHeight:e(e3),gap:b,mouse:n.mouse})}));if(!d.floating)throw Error("Expected floating pane");t(iY,n.mouse)}),iK=(0,J.atom)(e=>e(e0).filter(e=>"tile"===e.type&&!e.isHidden).map(t=>[t.paneId,e(t.rectAtom)])),iY=(0,J.atom)(null,(e,t,n)=>{let i=e(e3),r=e(e6),a=e(iK),s=e(tW),{drop:o,dropPreview:l}=function({views:e,mouse:t,container:n,headerHeight:i,sidebarWidths:r,gap:a}){let s={x:Math.min(Math.max(t.x-n.x,1),n.width-1),y:Math.min(Math.max(t.y-n.y,1),n.height-1)};for(let[t,n]of e){let e={x:n.x,y:n.y-i,width:n.width,height:i};if(tE(s,{x:e.x-a/2,y:e.y-a/2,width:e.width+a,height:i+a/2}))return{dropPreview:e,drop:{type:"insert",paneId:t}};let r={x:n.x,y:n.y-i,width:n.width,height:n.height+i};if(!tE(s,{x:r.x-a/2,y:r.y-a/2,width:r.width+a,height:r.height+a}))continue;let o=tI(s,r);return{dropPreview:o.rect,drop:{type:"split",relativeTo:t,placement:o.placement}}}let o=tI(s,{x:r.left,y:0,width:n.width-r.left-r.right,height:n.height});return{dropPreview:o.rect,drop:{type:"split",relativeTo:["tiling"],placement:o.placement}}}({views:a,container:r,mouse:n,headerHeight:i,sidebarWidths:e(iv),gap:s});t(ii,{type:"dropPreview",rect:l}),t(i$,e=>(0,eq.produce)(e,e=>{e&&(e.drop=o,e.movedAtAll=!0)}))}),iX=(0,J.atom)(null,(e,t,{delta:n})=>{if(e(ns))return;t(ii,null);let i=e(i$);if(!i)return;let{paneGroupId:r,drop:a,fromRect:s}=i,o=e(tc),l=eD(e(tc),r);if(!l){let e=Error("Expected paneGroup");throw t(tb,{error:e,origin:"Layout: state/paneGroupDragAndDrop/dragEndAtom"}),e}let u=l.panes[l.activeIndex],d=eA(o,u);if(!d){let e=Error("Expected pane");throw t(tb,{error:e,tags:{layoutstate:!0},origin:"Layout: state/paneGroupDragAndDrop/dragEndAtom"}),e}let c=(0,eq.produce)(o,r=>{if(!a&&d.floating&&"floating"===i.startType){let t=eP(r,d.paneGroupPath);if(t?.type!=="floatingPaneGroup")return;let i=e(e3),{x:a,y:o}=eO({x:s.x+n.x,y:s.y+n.y,width:s.width,height:s.height},{inside:e(e6),minVisibleX:2*i,minVisibleY:i});t.rect.x=a,t.rect.y=o;return}if(!a)return;if(d.paneGroup.panes.forEach(e=>{t(tt,e)}),"split"===a.type){if(null===r.tiling){let e=(0,t0.v4)();try{eL(r,{id:(0,t0.v4)(),panes:[e],placement:"leftOf",relativeTo:["tiling"]})}catch(e){throw t(tb,{error:e,tags:{layoutstate:!0},origin:"Layout: state/paneGroupDragAndDrop/dragEndAtom"}),e}}try{!function(e,{from:t,to:n,placement:i}){let r=eA(e,t);if(!r)throw Error("Expected fromPane");let{panes:a,activeIndex:s}=r.paneGroup;e$(e,r.paneGroupPath),eL(e,{id:r.paneGroup.id,relativeTo:n,panes:a,placement:i,activeIndex:s})}(r,{from:u,to:a.relativeTo,placement:a.placement})}catch(e){throw t(tb,{error:e,tags:{layoutstate:!0},origin:"Layout: state/paneGroupDragAndDrop/dragEndAtom"}),e}return}let o=eA(r,a.paneId);d.paneGroup.panes.forEach(e=>{eW(r,{paneId:e,paneGroupPath:o?.paneGroupPath||["tiling"],activate:!1})})});t(i$,null),t(tQ,c),a?.type==="insert"&&t(nL,u)}),iQ=(0,J.atom)(e=>{let t=e(tF);switch(t.type){case"sidebar":return 0===t.width;case"centered":return!1}}),iZ=(0,J.atom)(e=>{let t=e(tF);switch(t.type){case"sidebar":return e(iQ)?"collapsed":"sidebar";case"centered":return t.type}}),iJ=(0,J.atom)(e=>{let t=e(tF),n=e(e3),i=e(e6),r=e(tM),a=e(tG),s=n+e(tW)+a,o=i.height-s-a,l=e(tk),u=e(tT);switch(t.type){case"sidebar":{let n=e(tW),d={width:t.width,height:o,y:s},c=l?u+n:n;switch(r){case"filetree-agent":return{x:i.width-t.width-c-a,...d};case"agent-filetree":return{x:c+a,...d};default:return{x:0,y:0,width:0,height:0}}}case"centered":return{x:a,y:s,width:i.width-2*a,height:o}}});function i0(e){let{rect:t,insets:n,agentFiltreeOrder:i,gap:r,paneGroupId:a,topLeftPaneGroup:s,topRightPaneGroup:o,sidebar:l,agent:u,agentRect:d,container:c}=e,{x:p,width:h}=t;if(n.left>0&&s?.id===a&&(p=n.left,"filetree-agent"===i?l.isOpen&&l.x+l.width+r>=n.left&&(p=t.x):"agent-filetree"===i&&u?.type==="sidebar"&&d.x+d.width>n.left&&(p=t.x),h=t.width-(p-t.x)),n.right>0&&o?.id===a){if("agent-filetree"===i){let e=c.width-(l.x+l.width),t=l.isOpen?e+l.width+r:0;t<=n.right&&(h-=n.right-(t-r))}else if("filetree-agent"===i&&u?.type==="sidebar"){let e=u.width+r+r;e<=n.right&&(h-=n.right-e)}}return{x:p,width:h}}let i1=(0,J.atom)({left:0,right:0}),i2=(0,J.atom)(null,(e,t,n,i)=>{t(i1,e=>({...e,[n]:i})),t(tQ,e(tc))}),i5=(0,J.atom)(e=>{let t=e(tc),n=e(nu),i={topLeft:eR(t,"topLeft")?.paneGroup,topRight:eR(t,"topRight")?.paneGroup};if(!i.topLeft||!i.topRight)return{left:0,right:0,leftPaneWidth:0,rightPaneWidth:0};if(n===i.topLeft||n===i.topRight){let{width:t}=e(nf);return{left:t,right:t,leftPaneWidth:t,rightPaneWidth:t}}let r={left:e(e8(i.topLeft.id)),right:e(e8(i.topRight.id))},a={left:e(r.left.rectAtom),right:e(r.right.rectAtom)},s={insets:e(i1),agentFiltreeOrder:e(tM),gap:e(tW),topLeftPaneGroup:i.topLeft,topRightPaneGroup:i.topRight,sidebar:e(ix),agent:e(tF),agentRect:e(iJ),container:e(e6)},o={left:i0({...s,rect:a.left,paneGroupId:i.topLeft.id}),right:i0({...s,rect:a.right,paneGroupId:i.topRight.id})};return{leftPaneWidth:a.left.width,left:o.left.width,rightPaneWidth:a.right.width,right:o.right.width}});function i4(e){let t=i7(e);return(0,q.default)(()=>(0,J.atom)(n=>{if(n(t))return n(nm);let i=n(tc),r=n(e8(e)),a=n(r.rectAtom),s={topLeft:eR(i,"topLeft")?.paneGroup,topRight:eR(i,"topRight")?.paneGroup},o=n(tW),l=i0({rect:a,insets:n(i1),agentFiltreeOrder:n(tM),gap:o,paneGroupId:e,topLeftPaneGroup:s.topLeft||null,topRightPaneGroup:s.topRight||null,sidebar:n(ix),agent:n(tF),agentRect:n(iJ),container:n(e6)});if("floating"===r.path[0]){let e=a.y-o,t=a.height+o+1;return{...a,...l,y:e,height:t}}return{...a,...l}}),[t,e])}function i8(e){let t=i3(e),n=i4(e);return(0,q.default)(()=>{let i=(0,J.atom)(i=>{let r=i(n),a=i(t)||i(iU)?.headers?.get(e)?.dropState?"transform":"top-left";return{x:r.x,y:r.y,positioning:a}});return(0,ed.selectAtom)(i,e=>e,ti.default)},[t,e,n])}function i3(e){return(0,q.default)(()=>(0,J.atom)(t=>{let n=t(i$);return n&&e===n.paneGroupId?n:null}),[e])}function i6(e){let t=i3(e);return(0,q.default)(()=>(0,ed.selectAtom)(t,e=>e?.scale??1),[t])}function i9(e){return(0,q.default)(()=>(0,ed.selectAtom)(tc,t=>eD(t,e)),[e])}function i7(e){let t=i9(e);return(0,q.default)(()=>(0,J.atom)(e=>{if(e(t8))return!0;if(!e(ns))return!1;let n=e(t);if(!n)return!1;let i=e(e7);return!!i&&n.panes.includes(i)}),[t])}function re(e){let t=e8(e);return(0,q.default)(()=>(0,ed.selectAtom)(t,e=>"floating"===e.path[0]),[t])}var rt=e.i(205104),rn=e.i(780671);let ri=(0,J.atom)(null,(e,t,n)=>{let{path:i}=n,r=e(tc),a={...n};if(!a.opener){let t=e(iT),n=(0,rn.getFileExtension)(i);if(n){let i=t[n];if(i){let t=e(tg).find(e=>e.extension.extensionId===i.extensionId);t&&(a.opener={paneType:"extension",extensionFileHandler:t,supports:()=>!0})}}}if(a.newPane)return void t(nI,{pane:rr(a),edge:a.newPaneEdge??"left"});let s=eR(r,"topLeft");if(!s)return void t(nS,{pane:rr(a),relativeTo:["tiling"],placement:"replace"});let o=e(e0).find(t=>{let n=e(t.dataAtom);return(0,e9.isFilePane)(n)?i===(0,e9.getFilePathForPane)(n):!!(a.opener?.paneType==="extension"&&(0,e9.isExtensionPane)(n))&&n.data.filePath===i&&a.opener.extensionFileHandler.extension.installationId===n.data.installationId||("markdown"===n.type||"csvPreview"===n.type)&&i===n.data.path});if(o&&!a.newTab){let n=e(o.dataAtom);if((0,e9.isFilePane)(n)||"markdown"===n.type||"csvPreview"===n.type){t(nL,o.paneId),t(nM,{paneId:o.paneId,pane:rr({opener:{paneType:n.type},...a})});return}if((0,e9.isExtensionPane)(n))return void t(nL,o.paneId)}let l=s.paneGroup,u=eR(r,"topRight");if(u&&(l=u.paneGroup),a.newTab)return void t(nD,{panes:[rr(a)],paneGroupId:l.id,activate:!0,commit:!0,index:l.activeIndex+1});let d=e(e0).find(t=>{if(t.isCommitted)return!1;let n=e(t.dataAtom);return(0,e9.isFilePane)(n)||"markdown"===n.type||"csvPreview"===n.type});if(d){t(nM,{paneId:d.paneId,pane:rr(a)}),t(nL,d.paneId);return}let c=e(tp).find(t=>{let n=e(t.dataAtom);return"codeEditor"===n.type&&""===(0,e9.getFilePathForPane)(n)});if(c){t(nM,{paneId:c.paneId,pane:rr(a)}),t(nL,c.paneId);return}let p=l.panes.find(t=>{let n=e(eJ(t));return"commands"===e(n.dataAtom).type});if(p){t(nM,{paneId:p,pane:rr(a)}),t(eJ(p),e=>(0,eq.produce)(e,e=>{e.isCommitted=!1})),t(nL,p);return}t(nD,{panes:[rr(a)],paneGroupId:l.id,activate:!0})});function rr({path:e,col:t,line:n,opener:i}){if(!i?.paneType&&(0,rt.isMarkdownFile)(e.toLowerCase()))return{type:"markdown",data:{path:e}};if(!i?.paneType&&(0,rt.isCsvFile)(e.toLowerCase()))return{type:"csvPreview",data:{path:e}};let r=i?.paneType||(0,e9.getPaneTypeForFile)({path:e});if("codeEditor"===r)return{type:"codeEditor",data:{path:e,col:t,line:n}};if("extension"===r){let{extensionFileHandler:t}=i;return{type:"extension",data:{filePath:e,extensionId:t.extension.extensionId,installationId:t.extension.installationId,name:t.extension.manifest.name,baseUrl:t.extension.baseUrl,path:t.handler}}}return"markdown"===r?{type:"markdown",data:{path:e}}:{type:r,data:{path:e}}}let ra=(0,J.atom)(null,(e,t,{paths:n})=>{let i=n.map(e=>{let t=e.match(/(.+?)(:(\d+))?(:(\d+))?$/);if(!t)return!1;let[n,i,r]=[t[1],void 0!==t[3]&&parseInt(t[3],10),void 0!==t[5]&&parseInt(t[5],10)];return{type:(0,e9.getPaneTypeForFile)({path:n}),data:{path:n,line:i,col:r}}}).filter(Boolean),r=i.length-1,a=e(e7);i.forEach(async(e,n)=>{t(nV,{pane:e,activate:r===n,placement:{type:"secondary",relativeTo:a}})})}),rs=(0,J.atom)(null,(e,t,{urls:n})=>{let i=n.map(e=>{let t;try{t=new URL(e)}catch(e){return!1}return"0.0.0.0"===t.hostname||"localhost"===t.hostname?{ports:{type:"local",path:t.pathname,port:parseInt(t.port,10)}}:(window.open(e,"_blank"),!1)}).filter(Boolean);if(0!==i.length)for(let e of i)t(nU,e)}),ro=(0,J.atom)(null,(e,t,n)=>{if(e(ns))return;let i=e(e6),{pageX:r,pageY:a,over:s}=n,o=e(eJ(s)),{previewRect:l}=eC({x:r-i.x,y:a-i.y},e(o.rectAtom));t(n$,!0),t(ii,{type:"dropPreview",rect:l})}),rl=(0,J.atom)(null,(e,t,n)=>{if(e(ns))return;let i=e(e6),{pageX:r,pageY:a,over:s}=n,o=e(eJ(s)),{dropLocation:l}=eC({x:r-i.x,y:a-i.y},e(o.rectAtom));t(ii,null),t(n$,!1);let u=e(tc);if("newPaneGroup"===n.type){if("middle"===l){let e=eA(u,o.paneId);if(!e)return;t(nD,{panes:n.panes,paneGroupId:e.paneGroup.id,activate:!0,index:e.index+1});return}t(nT,{panes:n.panes,placement:l,makeActive:!0,relativeTo:o.paneId});return}let d=s;if("middle"===l){if(d===n.paneId)return;let e=eA(u,o.paneId);if(!e)return;t(nN,{paneId:n.paneId,toPaneGroupId:e.paneGroup.id,index:e.index+1});return}if(d===n.paneId){let e=eA(u,n.paneId);if(!e){let e=Error("Expected pane");throw t(tb,{error:e,tags:{layoutstate:!0},origin:"Layout: state/paneDragAndDrop/expectedPane"}),e}if(e.floating)throw Error("Expected paneGroup");let i=e.paneGroup.panes.find(e=>e!==n.paneId);if(!i)return;d=i}let c=(0,eq.produce)(u,e=>{try{eG(e,n.paneId),eL(e,{id:(0,t0.v4)(),panes:[n.paneId],relativeTo:d,placement:l}),t(tt,n.paneId)}catch(e){throw t(tb,{error:e,tags:{layoutstate:!0},origin:"Layout: state/paneDragAndDrop/updatedLayout"}),e}});t(tQ,c)});function ru(e){let t=(0,q.default)(()=>(0,J.atom)(t=>!!t(t8)||!!t(ns)&&t(e7)===e),[e]);return(0,q.default)(()=>(0,J.atom)(n=>{if(n(t))return n(nf);let i=n(eJ(e));return n(i.rectAtom)}),[e,t])}function rd(e){return(0,q.default)(()=>(0,J.atom)(t=>{let n=t(i$);return n&&e===t(iz)?n:null}),[e])}function rc(e){let t=rd(e);return(0,q.default)(()=>(0,ed.selectAtom)(t,e=>e?.scale??1),[t])}function rp(e){return(0,q.default)(()=>(0,J.atom)(t=>t(t(eJ(e)).dataAtom)),[e])}function rh(e){return(0,q.default)(()=>(0,J.atom)(t=>!!t(tO)||t(eJ(e)).isHidden),[e])}function rm(e){return(0,q.default)(()=>(0,ed.selectAtom)(eJ(e),e=>"floating"===e.type),[e])}let rf=(0,J.atom)(null),rg=(0,J.atom)(e=>{let t=e(rf);if(!t)return null;if("sidebar"===t.target)return{target:"sidebar"};let n=eA(e(tc),t.paneId);if(!n)return null;let{paneGroup:i}=n;return{target:"pane",paneGroupId:i.id,activeIndex:i.activeIndex,panes:i.panes.map(t=>{let n=e(eJ(t));return[n.paneId,e(n.dataAtom)]})}}),rx=(0,J.atom)(e=>{let t=e(rg);if(!t)return null;if("sidebar"===t.target)return{target:"sidebar"};let{paneGroupId:n,activeIndex:i,panes:r}=t;return{target:"pane",paneId:r[i][0],paneGroupId:n}}),ry=(0,J.atom)(e=>{let t=e(rf);if(!t||"sidebar"===t.target)return null;if(e(no)===t.paneId)return e(nf);let n=e(eJ(t.paneId)),i=e(n.rectAtom),r=e(e3);return{x:Math.round(i.x),y:Math.round(i.y-r),width:Math.round(i.width),height:Math.round(i.height+r)}}),rv=(0,J.atom)(null,(e,t,n)=>{let i=e(e7),r=n??i;if(r){t(rf,{target:"pane",paneId:r}),r!==i&&t(te,r);return}let a=eR(e(tc),"topLeft"),s=a?a.paneGroup.panes[a.paneGroup.activeIndex]:null;if(s)return void t(rf,{target:"pane",paneId:s})}),rw=(0,J.atom)(null,(e,t)=>{let n=e(rf);n&&(t(rf,null),"sidebar"!==n.target&&t(nA,{paneId:n.paneId,activate:!0}))}),rb=(0,J.atom)(null,(e,t)=>{if(e(rg))return void t(rw);let n=e(e7);if(n)return void t(rv,n);let i=eR(e(tc),"topLeft"),r=i?i.paneGroup.panes[i.paneGroup.activeIndex]:null;if(r)return void t(rv,r)}),rj=(0,J.atom)(e=>null!==e(rf)),rS=(0,J.atom)(null,(e,t)=>{t(rf,null)}),rk=(0,J.atom)(null,(e,t,n)=>{let i=e(e7);if(!i||e(no))return;let r=eM({relativeTo:i,rects:new Map(e(e0).filter(e=>!e.isHidden).map(t=>[t.paneId,e(t.rectAtom)])),direction:n});!r||(t(e7,r),e(rf)&&t(rf,{target:"pane",paneId:r}))}),rC=(0,J.atom)(null,(e,t,n)=>{let i=e(rg);null===i||"sidebar"!==i.target&&t(tQ,(0,eq.produce)(e(tc),e=>{!function(e,{paneGroupId:t,direction:n}){var i,r;let a,s=eD(e,t),o=eV(e,t);if(s?.type!=="paneGroup"||!o)return;let l=o.node.children.indexOf(s);if(-1===l)throw Error("Expected index");let u=[...o.path,l],d="down"===n||"right"===n,c=0===l,p=l===o.node.children.length-1,h=o.node.stacked===("up"===n||"down"===n),m=o.path.length>2;if(h&&!((p&&d||c&&!d)&&m))return function(e,t,n){let i=e.indexOf(t);if(-1===i)throw Error("Expected item to be in array");if(1===e.length)return;let r=i===e.length-1;if("forward"===n&&r){e.pop(),e.unshift(t);return}if("back"===n&&0===i){e.shift(),e.push(t);return}let a="forward"===n?1:-1;e[i]=e[i+a],e[i+a]=t}(o.node.children,s,d?"forward":"back");let f=(a=eV(e,s.id))?function e(t,{path:n,forwards:i,vertical:r}){let a=eP(t,n);if(a?.type!=="split")return null;let s=eE(n);if(0===s.length)return null;let o=eP(t,s);if(o?.type!=="split")return null;if(o.stacked!==r)return e(t,{path:s,forwards:i,vertical:r});let l=o.children.indexOf(a),u=0===l;if(!(l===o.children.length-1&&i||u&&!i)){let e=l+(i?1:-1),t=o.children[e],n=o.children[l];return t?{other:n,node:t,parent:o,path:[...s,e]}:null}if(1===s.length){let e=u&&!i?o.children.length-1:0;return{parent:o,other:o.children[l],path:[...s,e],node:o.children[e]}}return e(t,{path:s,forwards:i,vertical:r})}(e,{path:a.path,forwards:"down"===n||"right"===n,vertical:"up"===n||"down"===n}):null;if(!f)return;let g=u.slice(0,f.path.length+("paneGroup"===f.node.type?2:1));if("tiling"!==g[0])throw Error("Expected tiling path");let x=eP(e,g);if(!x||"floatingPaneGroup"===x.type)throw Error("Expected adjacentNode");if("split"!==f.other.type)throw Error("Expected split");let y=function(e,t){let n=e.indexOf(t),i=0;for(let{percent:t}of e.slice(0,n))i+=t;return{start:i,end:i+t.percent}}(f.other.children,x);if("paneGroup"===f.node.type){let t=(i={start:0,end:100},r=!f.parent.stacked,y.start-i.start<i.end-y.end?r?"above":"rightOf":r?"below":"leftOf");e$(e,[...o.path,l]),eL(e,{placement:t,id:s.id,panes:s.panes,activeIndex:s.activeIndex,percent:s.percent,relativeTo:f.path});return}let{index:v,placement:w}=function(e,t){let{children:n,stacked:i}=e,r="above",a=0,s=0,o=0,l=0;for(let e of n){let n={start:o,end:o+e.percent},u=Math.max(0,Math.min(t.end,n.end)-Math.max(t.start,n.start));u>l&&(l=u,a=s,r=t.start-n.start<n.end-t.end?i?"above":"rightOf":i?"below":"leftOf"),o+=e.percent,s++}return{placement:r,index:a}}(f.node,y);e$(e,[...o.path,l]),eL(e,{placement:w,id:s.id,panes:s.panes,activeIndex:s.activeIndex,percent:s.percent,relativeTo:[...f.path,v]})}(e,{paneGroupId:i.paneGroupId,direction:n.direction})}))}),rT={width:120,height:120},rE=(0,J.atom)(null),rI=(0,J.atom)(null,(e,t,n)=>{let i=e(tc);if("end"===n.type){t(rE,null),t(tQ,i);return}if("update"===n.type){let r=e(rE);if(!r){let e=Error("Expected floatingResizeState");throw t(tb,{error:e,tags:{layoutstate:!0},origin:"Layout: state/resizeFloating"}),e}let a=e(e3),s=function(e,{edge:t,delta:n,minSize:i=eT}){let r={...e},{height:a,width:s}=i;if("top"===t||"topLeft"===t||"topRight"===t){let t=e.height-n.y;r.height=Math.max(t,a),t<a?r.y=e.y+e.height-a:r.y=e.y+n.y}else("bottom"===t||"bottomLeft"===t||"bottomRight"===t)&&(r.height=Math.max(e.height+n.y,a));if("right"===t||"bottomRight"===t||"topRight"===t)r.width=Math.max(e.width+n.x,s);else if("left"===t||"bottomLeft"===t||"topLeft"===t){let t=e.width-n.x;r.width=Math.max(t,s),t<s?r.x=e.x+e.width-s:r.x=e.x+n.x}return r}(r.rectStart,{delta:n.moveDelta,edge:r.edge,minSize:rT}),{paneId:o}=r,l=(0,eq.produce)(i,e=>{let n=e.floating.find(e=>e.panes.includes(o));if(!n){let e=Error("Expected floating");throw t(tb,{error:e,tags:{layoutstate:!0},origin:"Layout: state/resizeFloating"}),e}let{rect:i}=n;i.x=s.x,i.y=s.y-a,i.width=s.width,i.height=s.height+a});t(tQ,l);return}let r=e(e0).find(e=>e.paneId===n.paneId);if(!r){let e=Error("Expected pane");throw t(tb,{error:e,tags:{layoutstate:!0},origin:"Layout: state/resizeFloating"}),e}t(te,n.paneId),t(rE,{paneId:n.paneId,edge:n.edge,rectStart:e(r.rectAtom)})}),rP=(0,J.atom)(null,(e,t,n)=>{t(iG,{headers:new Map(e(eX).map(e=>[e,{snappiness:400}])),panes:new Map(e(eK).map(e=>[e,{snappiness:400}]))}),t(ta,e=>(0,eq.produce)(e,e=>{e.activeContent===n&&e.isOpen?e.isOpen=!1:(e.isOpen=!0,e.activeContent=n,0===e.width&&(e.width=260))})),t(tQ,e(tc))}),rA=(0,J.atom)(null,(e,t)=>{t(iG,{headers:new Map(e(eX).map(e=>[e,{snappiness:400}])),panes:new Map(e(eK).map(e=>[e,{snappiness:400}]))}),t(ta,e=>(0,eq.produce)(e,e=>{e.isOpen=!1})),t(tQ,e(tc))}),rR=(0,J.atom)(null,(e,t)=>{let n=e(ta);n.isOpen?t(rA):t(rP,n.activeContent)}),rD=(0,J.atom)(null),rV=(0,J.atom)(null,(e,t)=>{let n=e(ta);t(rD,{startWidth:n.width,startIsOpen:n.isOpen})}),r_=(0,J.atom)(e=>!!e(rD)),rM=(0,J.atom)(null,(e,t,n)=>{let i=e(rD);if(!i)return;let r=n*("agent-filetree"===e(tM)?-1:1),a=.4*e(e6).width,s=Math.min(Math.max(i.startWidth+r,0),a),o=r>0;0===s&&o?s=230:!o&&s<230&&230-s>10&&(s=0),t(ta,e=>(0,eq.produce)(e,e=>{e.width=s,0===s?e.isOpen=!1:e.isOpen=i.startIsOpen})),i.startIsOpen&&t(tQ,e(tc))}),rF=(0,J.atom)(null,(e,t)=>{let n=e(ta),i=e(rD);n.isOpen||t(ta,e=>(0,eq.produce)(e,e=>{e.width=i?.startWidth??230})),t(rD,null)}),rO=(0,J.atom)(null,(e,t,n)=>{let i=e(tk);i&&(t(iG,{headers:new Map(e(eX).map(e=>[e,{snappiness:400}])),panes:new Map(e(eK).map(e=>[e,{snappiness:400}]))}),t(tk,(0,eq.produce)(i,e=>{let t=n??!i.isOpen;e.isOpen=t,t&&e.width<=46&&(e.width=200)})),t(tQ,e(tc)))}),rL=(0,J.atom)(null,(e,t)=>{e(tk)&&t(rO,!1)}),rB=(0,J.atom)(null),rU=(0,J.atom)(null,(e,t)=>{let n=e(tk);n&&t(rB,{startWidth:e(tT),startIsOpen:n.isOpen})});(0,J.atom)(e=>!!e(rB));let rN=(0,J.atom)(null,(e,t,n)=>{var i,r,a;let s=e(tk);if(!s)return;let o=e(rB);if(!o)return;let l=n*("agent-filetree"===e(tM)?1:-1),u=.3*e(e6).width,d=Math.min(Math.max(o.startWidth+l,0),u);i=d,r=o.startIsOpen,!(l>0)&&i<200&&r&&200-i>50&&(d=46);let c=o.startIsOpen;46===d?c=!1:(a=d,!o.startIsOpen&&a>=180&&(c=!0,d=Math.max(d,200))),t(tk,(0,eq.produce)(s,e=>{e.width=d,e.isOpen=c})),t(tQ,e(tc))}),rG=(0,J.atom)(null,(e,t)=>{let n=e(tk);n&&(n.isOpen?n.width<200&&t(tk,(0,eq.produce)(n,e=>{e.width=200})):t(tk,(0,eq.produce)(n,e=>{e.width=Math.max(n.width,200)})),t(rB,null))}),r$=(0,J.atom)(e=>{let t=e(tk);if(!t)return{x:0,y:0,width:0,height:0,isOpen:!1,opacity:0};let n=e(e6),i=e(e3)+e(tW),r=e(tM),a=e(tT),{isOpen:s}=t,o={y:i,width:a,isOpen:s,opacity:1,height:n.height-i};return"agent-filetree"===r?{x:0,...o}:{x:n.width-a,...o}}),rz=(0,J.atom)(e=>{let t=e(tk),n=e(tW);return{isOpen:t?.isOpen??!1,width:n}}),rW=(0,J.atom)(null,(e,t,n)=>{let i=e(tc),{rectAtom:r,type:a}=e(eJ(n)),s=e(r),o=eA(i,n);if(!o){let e=Error("Expected pane");throw t(tb,{error:e,tags:{layoutstate:!0},origin:"Layout: state/toggleFloating"}),e}if("tile"===a)return void t(tQ,(0,eq.produce)(i,e=>{ez(e,{paneGroupPath:o.paneGroupPath,rect:{x:s.x-16,y:s.y-16,width:s.width,height:s.height}})}));o.paneGroup.id===e(nC.modalPaneGroupIdAtom)&&t(nC.modalPaneGroupIdAtom,null);let l=e(e0).filter(e=>"tile"===e.type&&!e.isHidden),u=e(e3),d={x:s.x+s.width/2,y:s.y+s.height/2},c=l.find(t=>{let n=e(t.rectAtom);return tE(d,{x:n.x,y:n.y-u,width:n.width,height:n.height+u})});c?(t(tQ,(0,eq.produce)(i,e=>{let t=eA(e,c.paneId);o.paneGroup.panes.forEach(n=>{eW(e,{paneId:n,paneGroupPath:t?.paneGroupPath||["tiling"],activate:!1})})})),t(nL,o.paneGroup.panes[o.paneGroup.activeIndex])):t(tQ,(0,eq.produce)(i,e=>{!function(e,{paneGroupPath:t,placement:n,to:i}){let r=eP(e,t);if(r?.type!=="floatingPaneGroup")throw Error("Expected floatingPaneGroup");if(e$(e,t),null===i){e.tiling={id:r.id,panes:r.panes,percent:100,type:"paneGroup",activeIndex:r.activeIndex};return}eL(e,{id:r.id,relativeTo:i,panes:r.panes,activeIndex:r.activeIndex,placement:n})}(e,{paneGroupPath:o.paneGroupPath,to:["tiling"],placement:"leftOf"})}))}),rH=(0,J.atom)(null),rq=(0,J.atom)(e=>{let t=e(rH);return t&&e(e0).find(n=>{let i=e(n.dataAtom);return"videoPlayer"===i.type&&i.data.embedUrl===t?.embedUrl})||null}),rK=(0,J.atom)(e=>{let t=e(rq);return t&&!t.isHidden?t:null}),rY=(0,J.atom)(null,(e,t,n)=>{t(rH,n);let i="videoPlayer";n?t(iR,{type:i,data:{title:n.title??"Tutorial",embedUrl:n.embedUrl}},{commit:!0,location:"center"}):t(iD,i)}),rX=(0,J.atom)(null,(e,t)=>{let n=e(rq);if(n?.isHidden){t(nL,n.paneId),t(tt,n.paneId);return}let i=e(rH);i&&t(rY,i)}),rQ=(0,J.atom)(e=>e(e0).find(t=>"tutorial"===e(t.dataAtom).type)||null),rZ=(0,J.atom)(null,(e,t)=>{let n=e(rQ);n?.isHidden?t(nL,n.paneId):t(nT,{panes:[{type:"tutorial"}],placement:"leftOf",percent:25,relativeTo:["tiling"],makeActive:!1,commit:!0})}),rJ=(0,J.atom)(null),r0=(0,ed.selectAtom)(rJ,Boolean),r1=(0,J.atom)(null,(e,t,n)=>{switch(n.type){case"start":{let n=e(tF);if("sidebar"!==n.type)return;t(rJ,{startWidth:n.width});break}case"update":{let i=e(rJ);if(!i)return;let r=e(tM),a=i.startWidth+n.moveDelta.x*("filetree-agent"===r?-1:1),s=.5*e(e6).width;t(tF,e=>(0,eq.produce)(e,e=>{"sidebar"===e.type&&(a<300?e.width=300-a>150?0:300:a>s?e.width=s:e.width=a)})),t(tQ,e(tc));break}case"end":{let n=e(tF);if("sidebar"!==n.type)return;let i=e(rJ);t(rJ,null),n.width>0&&n.width<300&&i&&t(r2,{type:"sidebar",...{width:n.width}.width>i.startWidth?{width:450}:{width:300}})}}}),r2=(0,J.atom)(null,(e,t,n)=>{t(iG,{headers:new Map(e(eX).map(e=>[e,{snappiness:400}])),panes:new Map(e(eK).map(e=>[e,{snappiness:400}]))}),t(tF,n),t(tQ,e(tc))}),r5=(0,J.atom)(null,(e,t,n)=>{t(r2,{type:"sidebar",width:450*!!n})}),r4=(0,ed.selectAtom)(tF,e=>"sidebar"===e.type&&0===e.width),r8=(0,J.atom)(null,(e,t,n)=>{t(r2,"centered"===n?{type:n}:{type:"sidebar",width:450})}),r3=(0,J.atom)(e=>!!(e(i$)||e(rE)||e(iV)||e(n$)||e(r_)||e(r0))),r6=(0,J.atom)(null,(e,t,n)=>{t(t_,n),t(tQ,e(tc))}),r9=(0,J.atom)(null,(e,t,n)=>{setTimeout(()=>{t(r7,!1)},400),t(r8,n)}),r7=(0,J.atom)(!1),ae=(0,J.atom)(null,(e,t,n)=>{let i=e(tc),r=e(e7)===n.to,a=(0,eq.produce)(i,e=>{try{eG(e,n.from);let t=eA(e,n.to);t&&(eU(e,{paneIds:[n.from],activate:r,paneGroupId:t.paneGroup.id,index:t.index}),eG(e,n.to))}catch(e){throw t(tb,{error:e,tags:{layoutstate:!0},origin:"Layout: state/removePane/removePaneAtom"}),e}});t(tQ,a)});var at=e.i(98816);let an=(0,J.atom)(e=>{if(e(rj)||e(es))return null;let t=e(e7);if(!t)return null;let n=e(eJ(t)),i=e(n.dataAtom),r=n.paneId+i.type;return(0,e9.isFilePane)(i)&&(r+=i.data.path),r});var ai=e.i(116235);function ar(e){return(0,x.jsxs)(ai.default,{...e,children:[(0,x.jsx)("path",{d:"M15.056 6.25c.467 0 .882 0 1.207.035.319.036.717.12 1.024.428.307.307.392.705.428 1.024.036.325.035.74.035 1.207v6.667l-.003.474c-.003.15-.01.289-.023.412-.027.241-.095.587-.368.86-.272.272-.618.34-.859.367-.123.013-.263.02-.412.023l-.474.003H8.39c-.33 0-.64.001-.886-.026-.241-.027-.587-.095-.86-.368-.272-.272-.34-.618-.367-.859a4.719 4.719 0 0 1-.023-.412l-.003-.474V8.39c0-.329-.001-.64.026-.886.027-.241.095-.587.368-.86.272-.272.618-.34.859-.367.246-.027.557-.026.886-.026h6.667Z"}),(0,x.jsx)("path",{fillRule:"evenodd",d:"M16 2.25c1.995 0 3.542.231 4.53 1.22.989.988 1.22 2.535 1.22 4.53v9c0 1.541-.247 2.808-1.095 3.655-.847.848-2.114 1.095-3.655 1.095H7c-1.542 0-2.808-.247-3.655-1.095C2.497 19.808 2.25 18.541 2.25 17V7c0-1.542.247-2.808 1.095-3.655C4.192 2.497 5.458 2.25 7 2.25h9Zm-9 1.5c-1.458 0-2.192.253-2.595.655C4.003 4.808 3.75 5.542 3.75 7v10c0 1.459.253 2.192.655 2.595.403.402 1.137.655 2.595.655h10c1.459 0 2.192-.253 2.595-.655.402-.403.655-1.136.655-2.595V8c0-2.005-.269-2.958-.78-3.47-.512-.511-1.465-.78-3.47-.78H7Z",clipRule:"evenodd"})]})}var aa=e.i(122129),as=e.i(596608),ao=e.i(834903);function al(e){return(0,x.jsx)(ai.default,{...e,children:(0,x.jsx)("path",{fillRule:"evenodd",d:"M16 2.25c1.995 0 3.542.231 4.53 1.22.989.988 1.22 2.535 1.22 4.53v9c0 1.541-.247 2.808-1.095 3.655-.847.848-2.114 1.095-3.655 1.095H7c-1.542 0-2.808-.247-3.655-1.095C2.497 19.808 2.25 18.541 2.25 17V7c0-1.542.247-2.808 1.095-3.655C4.192 2.497 5.458 2.25 7 2.25h9ZM3.75 17c0 1.459.253 2.192.655 2.595.403.402 1.137.655 2.595.655h10c1.459 0 2.192-.253 2.595-.655.402-.403.655-1.136.655-2.595v-4.75H3.75V17Z",clipRule:"evenodd"})})}var au=e.i(613355);let ad=(0,J.atom)(null,(e,t,n)=>{if(null===n){t(ii,null),t(i$,e=>e?(0,eq.produce)(e,e=>{e.drop=null}):e);return}t(i$,e=>e?(0,eq.produce)(e,e=>{!function(e,t){if("edge"===t.type||"emptyLayout"===t.type){e.drop={type:"split",relativeTo:["tiling"],placement:"edge"===t.type?t.position:"replace"};return}let n=t.paneId;if("middle"===t.position){e.drop={type:"insert",paneId:n};return}e.drop={type:"split",relativeTo:n,placement:t.position}}(e,n)}):e);let i=e(e6),r=e(e3),a=e(tl),s=e(tW);if("pane"===n.type){let i=e(eJ(n.paneId)),a=e(i.rectAtom);t(ii,{type:"dropPreview",rect:{x:a.x,y:a.y-r,width:a.width,height:a.height+r}});return}if("emptyLayout"===n.type)return void t(ii,{type:"dropPreview",rect:function({container:e,sidebarWidth:t,gap:n,location:i}){let r={x:t+n,y:0,width:e.width-t-2*n,height:e.height-n},{x:a,y:s,width:o,height:l}=r;switch(i){case"middle":return r;case"leftOf":return{x:a,y:s,width:o/2,height:l};case"rightOf":return{x:a+o/2,y:s,width:o/2,height:l};case"above":return{x:a,y:s,width:o,height:l/2};case"below":return{x:a,y:s+l/2,width:o,height:l/2}}}({container:i,sidebarWidth:a,location:n.position,gap:s})});let{tiling:o}=e(tc);t(ii,{type:"dropPreview",rect:function(e,{container:t,sidebarWidth:n,position:i,gap:r}){let a={x:n+r,y:0,width:t.width-n-2*r,height:t.height-r};if(e?.type!=="split"){switch(i){case"above":case"below":a.height=a.height/2,"below"===i&&(a.y+=a.height);break;case"rightOf":case"leftOf":a.width=a.width/2,"rightOf"===i&&(a.x+=a.width)}return a}if(e.stacked){switch(i){case"above":a.height=a.height*(e.children[0].percent/100)/2;break;case"below":a.height=a.height*(e.children[e.children.length-1].percent/100)/2,a.y=t.height-a.height;break;case"leftOf":a.width=a.width/2;break;case"rightOf":a.width=a.width/2,a.x=t.width-a.width-r}return a}switch(i){case"above":a.height=a.height/2;break;case"below":a.height=a.height/2,a.y=t.height-a.height-r;break;case"leftOf":a.width=a.width*(e.children[0].percent/100)/2;break;case"rightOf":a.width=a.width*(e.children[e.children.length-1].percent/100)/2,a.x=t.width-a.width}return a}(o,{container:i,sidebarWidth:a,position:n.position,gap:s})})}),{cssVars:ac,styleTokens:ap}=(0,it.createCssVarTokens)(["opacity","width","height","transform","pointerEvents"]),ah=(0,ie.cssRecord)({dropPoint:[au.rcss.center,au.rcss.top(0),au.rcss.left(0),au.rcss.position.absolute,{zIndex:tN.overlay,cursor:"grabbing",width:ap.width,height:ap.height,transform:ap.transform,opacity:`var(${ac.opacity}, 0)`,pointerEvents:ap.pointerEvents,transition:"opacity 200ms ease-out 200ms","&:hover":{color:A.tokens.accentPrimaryStronger}}]}),am={above:(0,x.jsx)(al,{}),below:(0,x.jsx)(aa.default,{}),leftOf:(0,x.jsx)(as.default,{}),rightOf:(0,x.jsx)(ao.default,{}),middle:(0,x.jsx)(ar,{})};function af(e){let t=(0,v.useRef)(null),n=(0,v.useMemo)(()=>(0,ed.selectAtom)(iW,t=>t?.[e]),[e]),i=(0,v.useMemo)(()=>(0,ed.selectAtom)(n,e=>e?{[ac.transform]:`translate(${e.rect.x}px, ${e.rect.y}px)`}:null,ti.default),[n]);(0,tZ.useStyleSet)(t,n6(i));let r=(0,v.useMemo)(()=>(0,ed.selectAtom)(n,e=>e?{[ac.width]:e.rect.width+"px",[ac.height]:e.rect.height+"px"}:null,ti.default),[n]);(0,tZ.useStyleSet)(t,n6(r));let a=(0,v.useMemo)(()=>(0,ed.selectAtom)(n,e=>({[ac.opacity]:e?.visible?"1":"0",[ac.pointerEvents]:e?.visible?"all":"none"}),ti.default),[n]);return(0,tZ.useStyleSet)(t,n6(a)),t}function ag(){let e=af("middle"),t=n9(ad),n=n7((0,v.useMemo)(()=>(0,ed.selectAtom)(iW,e=>e?.middle.paneId??null),[]));return(0,x.jsx)(V.View,{css:ah.dropPoint,innerRef:e,onMouseEnter:()=>{let e=n(),i="middle";t(e?{type:"pane",position:i,paneId:e}:{type:"emptyLayout",position:i})},onMouseLeave:()=>t(null),children:(0,x.jsx)(ar,{size:32})})}function ax({position:e}){let t=af(e),n=n9(ad);return(0,x.jsx)(V.View,{css:ah.dropPoint,innerRef:t,onMouseEnter:()=>n({type:"edge",position:e}),onMouseLeave:()=>n(null),children:(0,v.cloneElement)(am[e],{size:32})})}let ay=(0,v.memo)(function(){return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(ax,{position:"above"}),(0,x.jsx)(ax,{position:"below"}),(0,x.jsx)(ax,{position:"leftOf"}),(0,x.jsx)(ax,{position:"rightOf"}),(0,x.jsx)(ag,{})]})}),av=(0,J.atom)(null);function aw(e){return n3((0,q.default)(()=>(0,J.atom)(t=>{let n=t(eJ(e));return t(n.dataAtom)}),[e]))}function ab(){let e=n8();return(0,v.useCallback)(t=>{let n=e.get(eJ(t));return{pane:e.get(n.dataAtom),isCommitted:n.isCommitted}},[e])}function aj(){let e=n9(te),t=n9(tt);return(0,q.default)(()=>(n,i)=>{i?.commit&&t(n),e(n)},[t,e])}function aS(){return n9(nJ)}let ak=(0,J.atom)(null,(e,t)=>{t(n$,!1)});function aC(){return n9(ri)}function aT(){return{maximizePane:n9(nl),maximizePaneGroup:n9(nu),restoreMaximizedPaneGroup:n9(nd),toggleMaximizePane:n9(nc),toggleMaximizedPaneGroup:n9(np)}}function aE(e){let t,n,i,r,{activeIndexAtom:a,pathAtom:s,panesAtom:o}=(t=e8(e),n=(0,q.default)(()=>(0,J.atom)(e=>e(t).activeIndex),[t]),i=(0,q.default)(()=>(0,ed.selectAtom)(t,e=>e.path,ti.default),[t]),{activeIndexAtom:n,pathAtom:i,panesAtom:(0,q.default)(()=>(0,ed.selectAtom)(t,e=>e.panes,ti.default),[t]),activeFileAtom:(0,q.default)(()=>(0,J.atom)(e=>{let n=e(t),i=e(eJ(n.panes[n.activeIndex])),r=e(i.dataAtom);return(0,e9.isFilePane)(r)?(0,e9.getFilePathForPane)(r):null}),[t])});return{activeIndex:n6(a),path:n6(s),panes:n6(o),activeTabPaneId:n6((r=e8(e),(0,q.default)(()=>(0,J.atom)(e=>{let t=e(r);return e(eJ(t.panes[t.activeIndex])).paneId}),[r])))}}function aI(e){let t,n,i,r,a,s,o,l,u,d,c=ru(e),p=tA(c),h=tR(c),m=rc(e),f=(t=rd(e),(0,q.default)(()=>(0,J.atom)(n=>{let i=n(t);if(i)return i.transformOriginX??"0px";let r=n(iU)?.panes?.get(e)?.dropState;return r?.transformOrginX??"0x"}),[t,e])),g=(n=ru(e),(0,q.default)(()=>(0,J.atom)(e=>{let t=e(n),i=e(e6);return{x:Math.round(i.x+t.x),y:Math.round(i.y+t.y)}}),[n])),x=rh(e),y=(0,q.default)(()=>(0,J.atom)(t=>{let n=t(eJ(e));if(n.isHidden)return tN.hiddenPane;let i=e===t(e7);return t(no)===e?tN.maximizedPane:e===t(iz)||t(iU)?.panes?.get(e)?.dropState?tN.draggingPane:"floating"===n.type?i?tN.floatingPaneActive:tN.floatingPane:i?tN.tiledPaneActive:tN.tiledPane}),[e]),v=(0,q.default)(()=>(0,J.atom)(t=>{let n=t(iU);return n?.panes?.get(e)??!1}),[e]),w=(i=rp(e),(0,q.default)(()=>(0,ed.selectAtom)(i,e=>e.type),[i])),b=rm(e),j=(0,q.default)(()=>(0,J.atom)(t=>{let n=eA(t(tc),e)?.paneGroup;return!!n&&n.id===t(nC.modalPaneGroupIdAtom)}),[e]),S=(0,q.default)(()=>(0,J.atom)(t=>t(e7)===e),[e]),k=(0,q.default)(()=>(0,J.atom)(t=>t(e7)===e),[e]),C=(0,q.default)(()=>(0,ed.selectAtom)(eJ(e),e=>e.isCommitted),[e]),T=rp(e),E=(r=rm(e),a=rd(e),(0,q.default)(()=>(0,J.atom)(e=>e(ns)?null:e(a)?"dragging":e(r)?"floating":"tiled"),[r,a])),I=(s=rd(e),(0,q.default)(()=>(0,J.atom)(t=>!!t(s)||!!t(iU)?.panes?.get(e)?.dropState),[s,e])),P=(o=rd(e),(0,q.default)(()=>(0,ed.selectAtom)(o,e=>e?.movedAtAll??!1),[o])),A=(0,q.default)(()=>(0,J.atom)(t=>{let n=t(tc);if(n.tiling?.type!=="paneGroup")return!1;let i=eA(t(tc),e)?.paneGroup;return!!i&&1===i.panes.length}),[e]),R=(l=ru(e),u=rc(e),d=rh(e),(0,q.default)(()=>(0,J.atom)(e=>{let t=e(d);return{...e(l),scale:e(u),opacity:+!t}}),[l,u,d])),D=(0,q.default)(()=>(0,J.atom)(t=>t(no)===e),[e]);return{properties:n6(R),size:n6(p),position:n6(h),scale:n6(m),paneType:n6(w),transformOriginXAtom:n6(f),viewportInset:n6(g),zIndex:n6(y),disableInteractions:n6(r3),getTransitionEnabled:n7(v),data:n6(T),isFloating:n6(b),isModal:n6(j),isActive:n6(S),isActivePane:n6(k),isCommitted:n6(C),isHidden:n6(x),isBeingDragged:n6(I),hasMovedWhileDragging:n6(P),headerHeight:n6(e3),border:n6(E),isOnlyPane:n6(A),isMaximized:n6(D)}}function aP(e){let t,n,i,r,a,s,o,l,u,d=tA(i4(e)),c=i8(e),p=i6(e),h=(n=i3(e),(0,q.default)(()=>(0,J.atom)(t=>{let i=t(n);if(i)return i.transformOriginX??"0px";let r=t(iU)?.headers?.get(e)?.dropState;return r?.transformOrginX??"0x"}),[n,e])),m=(i=i3(e),r=i7(e),a=re(e),t=i9(e),s=(0,q.default)(()=>(0,J.atom)(e=>{let n=e(e7);if(!n)return!1;let i=e(t);return!!i&&i.panes.includes(n)}),[t]),(0,q.default)(()=>(0,J.atom)(t=>t(r)?tN.maximizedHeader:t(i)||t(iU)?.headers?.get(e)?.dropState?tN.draggingHeader:t(a)?t(s)?tN.floatingHeaderActive:tN.floatingHeader:tN.tiledHeader),[i,r,a,s,e])),f=(0,q.default)(()=>(0,J.atom)(t=>{let n=t(iU);return n?.headers?.get(e)??!1}),[e]),g=i7(e),x=re(e),y=(0,q.default)(()=>(0,J.atom)(t=>t(nC.modalPaneGroupIdAtom)===e),[e]),v=(0,q.default)(()=>(0,J.atom)(t=>t(i$)?.paneGroupId===e),[e]);return{properties:n6((o=i4(e),l=i6(e),u=i8(e),(0,q.default)(()=>(0,J.atom)(e=>{let t=e(tO);return{...e(o),scale:e(l),positioning:e(u).positioning,opacity:+!t}}),[o,l,u]))),size:n6(d),position:n6(c),scale:n6(p),transformOriginX:n6(h),zIndex:n6(m),getTransitionEnabled:n7(f),isMaximized:n6(g),isFloating:n6(x),isModal:n6(y),isBeingDragged:n6(v)}}function aA(){let e,t=n6(ix),n=n6(iy),i=n6(ts),r=n6(to),a=n9(rR),s=n9(rP),o=n9(rA);return{view:t,resizeHandleView:n,isOpen:i,activeContent:r,toggle:a,toggleContent:s,closeSidebar:o,resize:(e=n9(rV),{start:e,update:n9(rM),end:n9(rF)}),getTransitionEnabled:n7(iN)}}function aR(){let e,t=n3(tk),n=(0,eh.useCreateObservableAtom)(r$,n8()),i=(0,eh.useCreateObservableAtom)(rz,n8()),r=n6(tC),a=n9(rO),s=n9(rL);return{view:n,resizeHandleView:i,isOpen:r,isEnabled:null!==t,toggle:a,close:s,resize:(e=n9(rU),{start:e,update:n9(rN),end:n9(rG)}),getTransitionEnabled:n7(iN)}}function aD(){let e=n6(iJ),t=n6(tW),n=n6(iZ),i=n9(r1),r=n9(r5),a=n7(iN),s=n9(nR),o=n6(tM),l=n9(r6);return{rect:e,gutter:t,displayState:n,collapsedWidth:0,getTransitionEnabled:a,resizeSidebar:i,toggle:r,setChatRef:s,agentFiletreeOrder:o,setAgentPosition:l,headerHeight:n6(e3),isCollapsed:n6(r4)}}let aV=(0,ed.selectAtom)(tc,({tiling:e})=>e?.type==="paneGroup"&&1===e.panes.length);var a_=e.i(106020),aM=e.i(292849),aF=e.i(827456),aO=e.i(259493);function aL({currentPaneId:e,type:t}){let n=(0,aF.usePaneUIContext)(),i=n9(nQ),r=n9(nL),a=(0,nC.useGetPanes)(),s=(0,aO.useGetPaneBindings)(),o=e?"Move existing tab here":"Jump to existing tab";return(0,v.useCallback)(async({searchQuery:l})=>{let u=a(),d=e?u.filter(([t])=>t!==e):u;if(!d.length||!l&&"files"===t)return[];let c=new Map,p=[];for(let[e,t]of d)(0,e9.isFilePane)(t)&&t.data.path&&p.push(t.data.path);for(let e of(await (0,aM.filterFiles)(l,p)))c.set(e.path,{score:e.score,ranges:e.ranges});let h=[];for(let[a,l]of d){let u=(0,e9.isToolPane)(l);if("tools"===t&&!u||"tools"===t&&"commands"===l.type||"files"===t&&u)continue;let d=(0,e9.isFilePane)(l)?l.data.path:null,p=d?c.get(d):null;if("deployments"===l.type){let e=s(a);if(e?.type==="deployments"){let t=e.getTabs();if(t){h.push({match:a_.fzfMatchLabel,data:{type:"context",label:n.getTitle(l),icon:(0,x.jsx)(n.Icon,{pane:l})},commands:()=>t.map(t=>({match:a_.fzfMatchLabel,data:{key:a+t.id,type:"action",label:t.label,icon:(0,x.jsx)(t.Icon,{size:16}),run:()=>{r(a),e.setTab(t.id)}}}))});continue}}}let m=d&&p?()=>({score:p.score,render:(0,aM.createFileMatchRender)({path:d,ranges:p.ranges,description:o})}):a_.fzfMatchLabel,f=n.getTitle(l),g=n.Icon({pane:l});h.push({match:m,data:{key:a,type:"action",label:f,icon:g,run:()=>e?i({a:e,b:a}):r(a),description:o}})}return h},[e,a,n,r,i,s,o,t])}var aB=e.i(333980),aU=e.i(927989),aN=e.i(794633),aG=e.i(32109),a$=e.i(384401),az=e.i(888330);let aW="Search";function aH(){let e=(0,ee.useSetAtom)(eo);return(0,v.useCallback)(t=>{e(t)},[e])}var aq=e.i(262206),aK=e.i(739521),aY=e.i(980338);let aX={id:"toggleGlobalCommandBarCommand",name:"Toggle Commandbar",description:"Opens or closes the command bar",default:(0,aq.defaultKeyCombo)({cmdOrCtrl:!0,key:"k"})};function aQ(e,{enabled:t}={enabled:!0}){let n=(0,ee.useSetAtom)(eu);(0,v.useEffect)(()=>{if(t&&null!==e)return n(t=>[...t,e]),()=>{n(t=>t.filter(t=>t!==e))}},[n,e,t])}let aZ=(0,ie.cssRecord)({surface:[au.rcss.maxHeight("70vh"),au.rcss.borderRadius(8),au.rcss.overflowY("auto")]}),aJ=(0,v.memo)(function(){var e;let t,n,i,r,a,s,o,l,u,d,c=(0,ee.useAtomValue)(es),p=aH(),h=(t=aS(),e=(0,v.useCallback)(e=>{(0,ei.track)(er.events.TOOL_OPENED,{source:"Command Bar",tool:e.pane.type}),t(e)},[t]),n=(0,aF.usePaneUIContext)(),i=(0,aN.useToolPanes)(),r=(0,nC.useGetPanes)(),a=(0,v.useCallback)(()=>{let t=r().map(([e,t])=>t.type),a=[];for(let r of i){if((0,e9.isSingleton)(r.type)&&t.includes(r.type))continue;let i=n.getTitle(r),s=n.Icon({pane:r});a.push({match:(0,aB.matchToolPane)({pane:r,aliases:aU.paneAliases.get(r.type)}),data:{key:"extension"===r.type?`extension-${r.data.installationId}-${r.data.path}`:void 0,type:"action",label:i,description:n.getDescription(r,{short:!0}),icon:s,run(){e({pane:r})}}})}return a},[i,e,r,n]),s=aL({type:"tools"}),o=(0,a$.useKeyCombo)("toggleGlobalCommandBarCommand"),l=(0,q.default)(()=>({type:"context",icon:(0,x.jsx)(et.default,{}),label:"",description:aW,keyboardShortcut:o}),[o]),u=(0,q.default)(()=>(0,J.atom)(e=>{let t=e(eu),n={data:{type:"context",label:az.toolsCommandLabel,icon:(0,x.jsx)(en.default,{})},commands:async({searchQuery:e})=>[...await s({searchQuery:e}),...a()]};return{data:l,commands:()=>[...t,n]}}),[a,l,s]),d=(0,q.default)(()=>(0,J.atom)(e=>{let t=e(u),n=e(el);return n?[t,n]:t}),[u]),(0,ee.useAtomValue)(d)),m=(0,a$.useKeyCombo)(aX.id);return(0,x.jsx)(aK.Modal,{hideCloseButton:!0,isOpen:c,onRequestClose:p,noPadding:!0,skipTransition:!0,topPadding:8,children:(0,x.jsx)(R.ShadesSurface,{css:aZ.surface,elevate:!1,children:(0,x.jsx)(aY.CommandBar,{keyboardShortcut:m,onAction:()=>p(),command:h,autoFocus:!0})})})});var a0=e.i(692043);let a1=w.gql`
    query ExtensionStore($replId: String!, $userId: Int) {
  extensionList(includeNonBlessed: true, userId: $userId) {
    ...TopLevelExtension
    installation(replId: $replId) {
      ...TopLevelExtensionInstallation
    }
  }
}
    ${a0.TopLevelExtensionFragmentDoc}
${a0.TopLevelExtensionInstallationFragmentDoc}`;var a2=e.i(787527),a5=e.i(40916),a4=e.i(123515),a8=e.i(761201),a3=e.i(253344),a6=e.i(47503),a9=e.i(207237),a7=e.i(902379),se=e.i(140487),st=e.i(960178);let sn=(0,ie.cssRecord)({container:au.rcss.colWithGap(24)});function si({fileExtension:e,onCancel:t,onConfirm:n}){return(0,x.jsxs)(V.View,{css:sn.container,children:[(0,x.jsx)(st.Header,{level:1,variant:"headerDefault",children:"Make this extension default?"}),(0,x.jsxs)(st.Text,{children:["Do you want to use this extension to open ",e," files by default? You can always use another file opener by right clicking on the file and opening it with something else"]}),(0,x.jsxs)(V.View,{row:!0,gap:12,justify:"end",children:[(0,x.jsx)(se.Button,{onClick:()=>t(),text:"Cancel"}),(0,x.jsx)(se.Button,{colorway:"positive",onClick:()=>n(),text:"Yes, use this extension by default"})]})]})}var sr=e.i(222342);function sa(){let e=(0,nC.useGetActivePaneId)(),t=n7(tf),n=n7(tx),i=n7(t7),r=n9(nV),a=n9(nA),s=n9(nM),o=n7(th),l=n7(tm),u=n7(ns);return(0,v.useCallback)(d=>{let{pane:c,activate:p,updateOnReveal:h=!0}=d,m=e(),f=(0,e9.isFilePane)(c)?o():l();f||(f=function({panes:e,pane:t}){if((0,e9.isFilePane)(t)){let{path:n}=t.data;return e.find(([,e])=>(0,e9.isFilePane)(e)&&e.data.path===n)?.[0]??null}if((0,e9.isExtensionPane)(t))return e.find(([,e])=>!!(0,e9.isExtensionPane)(e)&&e.data.installationId===t.data.installationId&&e.data.path===t.data.path&&e.data.filePath===t.data.filePath)?.[0]??null;if("diff"===t.type){let n=e.find(([e,n])=>"diff"===n.type&&(0,ti.default)(n.data,t.data));return n?.[0]??null}return(0,e9.isSingleton)(t.type)?e.find(([,e])=>e.type===t.type)?.[0]??null:null}({panes:[...t(),...n()],pane:c}));let g=u();if(f&&m){let{layout:e}=i(),t=eA(e,m)?.paneGroup,n=eA(e,f)?.paneGroup;if(!g||t?.id===n?.id)return h&&s({paneId:f,pane:c}),a({paneId:f,activate:p}),f}let{placement:x}=d;return g&&null!=m?x={type:"after",paneId:m}:x?.type!=="secondary"||x.relativeTo||(x={type:"secondary",relativeTo:m}),r({pane:c,activate:p,placement:x})},[e,o,l,r,t,n,i,u,a,s])}var ss=e.i(778203);function so(){let e,t=aC(),n=(0,nC.useActivatePane)(),i=(e=(0,nC.useObservableActiveFile)(),(0,q.default)(()=>t=>e.subscribe(t),[e])),r=(0,nC.useGetActiveFile)(),a=(0,sr.default)(),s=sa(),o=(0,nC.useGetActivePaneId)(),l=n7(t7),u=n9(na),d=(0,ss.default)(),c=(0,at.default)(d),p=(0,v.useCallback)(({extensionId:e,installationId:t,baseUrl:n,path:i,name:r})=>{s({pane:{type:"extension",data:{extensionId:e,installationId:t,baseUrl:n,path:i,name:r}},activate:!0,placement:{type:"secondary",relativeTo:o()}})},[s,o]);return(0,q.default)(()=>({openFile:t,watchActiveFile:i,getActiveFile:r,activatePane:n,toasts:a,revealOrInsertTool:p,getLayoutState:l,setLayoutState:u,getSshConfig:()=>c.current}),[t,i,r,n,a,p,l,u,c])}e.i(244719);var sl=e.i(667279),su=e.i(196380),sd=e.i(100811),sc=e.i(9293),sp=e.i(251278),sh=e.i(409792),sm=e.i(343252),sf=e.i(873379),sg=e.i(529810),sx=((a={}).RAW="RAW",a.PROXY="PROXY",a.THROW="THROW",a.HANDLER="HANDLER",a),sy=((s={}).GET="GET",s.SET="SET",s.APPLY="APPLY",s.CONSTRUCT="CONSTRUCT",s.ENDPOINT="ENDPOINT",s.RELEASE="RELEASE",s);let sv=Symbol("Comlink.proxy"),sw=Symbol("Comlink.endpoint"),sb=Symbol("Comlink.releaseProxy"),sj=Symbol("Comlink.thrown"),sS=e=>"object"==typeof e&&null!==e||"function"==typeof e,sk=new Map([["proxy",{canHandle:e=>sS(e)&&e[sv],serialize(e){let{port1:t,port2:n}=new MessageChannel;return sC(e,t),[n,[n]]},deserialize:e=>(e.start(),function e(t,n=[],i=function(){}){let r=!1,a=new Proxy(i,{get(i,s){if(sE(r),s===sb)return()=>sV(t,{type:sy.RELEASE,path:n.map(e=>e.toString())}).then(()=>{sT(t),r=!0});if("then"===s){if(0===n.length)return{then:()=>a};let e=sV(t,{type:sy.GET,path:n.map(e=>e.toString())}).then(sD);return e.then.bind(e)}return e(t,[...n,s])},set(e,i,a){sE(r);let[s,o]=sR(a);return sV(t,{type:sy.SET,path:[...n,i].map(e=>e.toString()),value:s},o).then(sD)},apply(i,a,s){sE(r);let o=n[n.length-1];if(o===sw)return sV(t,{type:sy.ENDPOINT}).then(sD);if("bind"===o)return e(t,n.slice(0,-1));let[l,u]=sI(s);return sV(t,{type:sy.APPLY,path:n.map(e=>e.toString()),argumentList:l},u).then(sD)},construct(e,i){sE(r);let[a,s]=sI(i);return sV(t,{type:sy.CONSTRUCT,path:n.map(e=>e.toString()),argumentList:a},s).then(sD)}});return a}(e,[],void 0))}],["throw",{canHandle:e=>sS(e)&&sj in e,serialize:({value:e})=>[e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[]],deserialize(e){if(e.isError)throw Object.assign(Error(e.value.message),e.value);throw e.value}}]]);function sC(e,t=self,n){function i(r){let a;if(!r||!r.data||n&&(r.origin!==n.origin||r.source!==n.source))return;let{id:s,type:o,path:l}={path:[],...r.data},u=(r.data.argumentList||[]).map(sD);try{let t=l.slice(0,-1).reduce((e,t)=>e[t],e),n=l.reduce((e,t)=>e[t],e);switch(o){case sy.GET:a=n;break;case sy.SET:t[l.slice(-1)[0]]=sD(r.data.value),a=!0;break;case sy.APPLY:a=n.apply(t,u);break;case sy.CONSTRUCT:{let e=new n(...u);a=sA(e)}break;case sy.ENDPOINT:{var d,c;let{port1:t,port2:n}=new MessageChannel;sC(e,n),d=t,c=[t],sP.set(d,c),a=d}break;case sy.RELEASE:a=void 0;break;default:return}}catch(e){a={value:e,[sj]:0}}Promise.resolve(a).catch(e=>({value:e,[sj]:0})).then(e=>{let[n,r]=sR(e);t.postMessage({...n,id:s},r),o===sy.RELEASE&&(t.removeEventListener("message",i),sT(t))})}return t.addEventListener("message",i),t.start&&t.start(),()=>{t.removeEventListener("message",i),sT(t)}}function sT(e){"MessagePort"===e.constructor.name&&e.close()}function sE(e){if(e)throw Error("Proxy has been released and is not useable")}function sI(e){var t;let n=e.map(sR);return[n.map(e=>e[0]),(t=n.map(e=>e[1]),Array.prototype.concat.apply([],t))]}let sP=new WeakMap;function sA(e){return Object.assign(e,{[sv]:!0})}function sR(e){for(let[t,n]of sk)if(n.canHandle(e)){let[i,r]=n.serialize(e);return[{type:sx.HANDLER,name:t,value:i},r]}return[{type:sx.RAW,value:e},sP.get(e)||[]]}function sD(e){switch(e.type){case sx.HANDLER:return sk.get(e.name).deserialize(e.value);case sx.RAW:return e.value}}function sV(e,t,n){return new Promise(i=>{let r=[,,,,].fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-");e.addEventListener("message",function t(n){n.data&&n.data.id&&n.data.id===r&&(e.removeEventListener("message",t),i(n.data))}),e.start&&e.start(),e.postMessage({id:r,...t},n)})}var s_=e.i(623059);let sM=Symbol("timeout");var sF=e.i(881476);let sO=w.gql`
    fragment InitialCurrentUserData on CurrentUser {
  id
  username
  image
  bio
}
    `,sL=w.gql`
    fragment SocialCurrentUserData on CurrentUser {
  url
  socials {
    id
    url
    type
  }
  firstName
  lastName
  displayName
  fullName
  followCount
  followerCount
}
    `,sB=w.gql`
    fragment RolesCurrentUserData on CurrentUser {
  roles {
    id
    name
    key
    tagline
  }
}
    `,sU=w.gql`
    fragment PlanCurrentUserData on CurrentUser {
  isUserHacker: subscriptionIsType(subscriptionType: HACKER)
  ...CoreSubscriptionPlanStatus
}
    ${sF.CoreSubscriptionPlanStatusFragmentDoc}`,sN=w.gql`
    fragment SocialUserData on User {
  url
  socials {
    id
    url
    type
  }
  firstName
  lastName
  displayName
  fullName
  followCount
  followerCount
}
    `,sG=w.gql`
    fragment RolesUserData on User {
  roles {
    id
    name
    key
    tagline
  }
}
    `,s$=w.gql`
    fragment PlanUserData on User {
  isUserHacker: subscriptionIsType(subscriptionType: HACKER)
  isUserPro: subscriptionIsType(subscriptionType: HACKER_PRO)
}
    `,sz=w.gql`
    fragment InitialReplData on Repl {
  id
  url
  title
  description
  timeCreated
  slug
  isPrivate
}
    `,sW=w.gql`
    fragment SocialReplData on Repl {
  likeCount
  publicForkCount
  iconUrl
  imageUrl
}
    `,sH=w.gql`
    fragment InitialUserData on User {
  id
  username
  image
  bio
}
    `,sq=w.gql`
    fragment OwnerData on Repl {
  owner {
    __typename
    ... on User {
      ...InitialUserData
    }
    ... on Team {
      id
      username
      image
      description
    }
  }
}
    ${sH}`,sK=w.gql`
    fragment MultiplayersData on Repl {
  multiplayers {
    ...InitialUserData
  }
}
    ${sH}`,sY=w.gql`
    query extensionPortCurrentUser($includeSocialData: Boolean! = false, $includeRoles: Boolean! = false, $includePlan: Boolean! = false) {
  user: currentUser {
    ...InitialCurrentUserData
    ...SocialCurrentUserData @include(if: $includeSocialData)
    ...RolesCurrentUserData @include(if: $includeRoles)
    ...PlanCurrentUserData @include(if: $includePlan)
  }
}
    ${sO}
${sL}
${sB}
${sU}`,sX=w.gql`
    query extensionPortUserByUsername($username: String!, $includeSocialData: Boolean! = false, $includeRoles: Boolean! = false, $includePlan: Boolean! = false) {
  userByUsername(username: $username) {
    ...InitialUserData
    ...SocialUserData @include(if: $includeSocialData)
    ...RolesUserData @include(if: $includeRoles)
    ...PlanUserData @include(if: $includePlan)
  }
}
    ${sH}
${sN}
${sG}
${s$}`,sQ=w.gql`
    query extensionPortUserById($id: Int!, $includeSocialData: Boolean! = false, $includeRoles: Boolean! = false, $includePlan: Boolean! = false) {
  user(id: $id) {
    ...InitialUserData
    ...SocialUserData @include(if: $includeSocialData)
    ...RolesUserData @include(if: $includeRoles)
    ...PlanUserData @include(if: $includePlan)
  }
}
    ${sH}
${sN}
${sG}
${s$}`,sZ=w.gql`
    query currentUserEditorPreferences {
  currentUser {
    id
    workspacePreferences
  }
}
    `,sJ=w.gql`
    query extensionPortReplById($id: String!, $includeSocialData: Boolean! = false, $includeOwner: Boolean! = false, $includeMultiplayers: Boolean! = false) {
  getRepl(id: $id) {
    __typename
    ... on Repl {
      ...InitialReplData
      ...SocialReplData @include(if: $includeSocialData)
      ...OwnerData @include(if: $includeOwner)
      ...MultiplayersData @include(if: $includeMultiplayers)
    }
    ... on ReplRedirect {
      replUrl
    }
  }
}
    ${sz}
${sW}
${sq}
${sK}`,s0=w.gql`
    query extensionPortReplByUrl($url: String!, $includeSocialData: Boolean! = false, $includeOwner: Boolean! = false, $includeMultiplayers: Boolean! = false) {
  getRepl(url: $url) {
    __typename
    ... on Repl {
      ...InitialReplData
      ...SocialReplData @include(if: $includeSocialData)
      ...OwnerData @include(if: $includeOwner)
      ...MultiplayersData @include(if: $includeMultiplayers)
    }
  }
}
    ${sz}
${sW}
${sq}
${sK}`;function s1(e){return async t=>{let n=await t1.apolloClient?.query({query:e,variables:t||void 0});if(n?.data)return n.data;throw Error(n?.error?.message)}}var s2=e.i(862927);function s5(e,t){let n={};for(let i in t)"function"==typeof t[i]&&(n[i]=function(e,t){return(...n)=>{for(let t of e)t();return t(...n)}}(e,t[i]));return n}function s4(e,t){return()=>{let n=e.store.get(e.extensionStateAtom);for(let i of t)if(!n.scopes.has(i)){let t=`Scope not declared in extension.json: ${i}`;e.logger.warn(`${t}. In the future this will throw an error`)}}}let s8=em.Type.Record(em.Type.String(),em.Type.String({minLength:1}));var s3=e.i(336106),s6=e.i(221042);let s9=w.gql`
    query ExtensionApiAuthToken($installationId: String!) {
  extensionInstallationById(id: $installationId) {
    ... on ExtensionInstallation {
      id
      token
    }
  }
}
    `;function s7(e){return{registerCommand:async(t,n)=>{let i,r,a;if(n)r=t,i=n,a=await (0,sd.parseCommandProxyToExtensionCommand)(i,e);else{if(e.logger.warn("registerCommand: calling registerCommand with a single argument is deprecated. Pass a {commandId, contributions} object as the first command."),i=t,!(a=await (0,sd.parseCommandProxyToExtensionCommand)(i,e)).data.id)throw Error("Command: expected id to be defined");if(!("contributions"in a.data))throw Error(`Command: In ${a.data.id}, contributions should be an array`);0===a.data.contributions.length&&e.logger.warn(`Command: ${a.data.id} has no contributions`),(r={commandId:a.data.id,contributions:a.data.contributions}).contributions||(e.logger.warn(`Command: '${a.data.id}' has no contributions`),r.contributions=[])}e.store.set(sl.registerExtensionCreateCommandAtom,{extensionStateAtom:e.extensionStateAtom,createCommand:{id:(0,a3.asExtensionCommandId)(r.commandId),contributions:r.contributions,create:async()=>a}})},registerCreateCommand:async(t,n)=>{if(!t.commandId||""===t.commandId)throw Error("Attempted to register command without id");if(!t.contributions||!Array.isArray(t.contributions))throw Error(`Command: In ${t.commandId}, contributions should be an array`);0===t.contributions.length&&e.logger.warn(`Command: ${t.commandId} has no contributions`);let i=t.contributions.filter(e=>!(e in s_.ContributionType));i.length>0&&e.logger.warn(`Command: ${t.commandId} has unrecognized contributions: ${i.join(", ")}. Valid contributions are ${Object.values(s_.ContributionType)}`);let r={id:(0,a3.asExtensionCommandId)(t.commandId),contributions:t.contributions,create:async({path:t})=>{let i=await Promise.race([n({path:t}),new Promise(e=>setTimeout(()=>e(null),50))]);return null===i?null:(0,sd.parseCommandProxyToExtensionCommand)(i,e)}};e.store.set(sl.registerExtensionCreateCommandAtom,{extensionStateAtom:e.extensionStateAtom,createCommand:r})}}}function oe(e){return()=>{if(!e.store.get(e.extensionStateAtom).enableExperimentalApi)throw Error("Experimental APIs are not enabled. (If you are the developer, please add the `experimental-api` scope to your extension.json)")}}var ot=e.i(995683),on=e.i(703631);function oi(e){return e.error?{error:e.error,success:!1}:{success:!0,error:null}}var or=e.i(968323),oa=e.i(12291),os=e.i(412284),oo=e.i(703774);function ol({extension:e,sandboxUrl:t,sandboxTitle:n,paneId:i,environmentAPIs:r,filePath:a}){let s=(0,v.useRef)(null),o=(0,a9.default)(),l=(0,a6.useCurrentUserId)(),u=(0,sg.default)(),d=(0,v.useRef)(),c=(0,os.useExtensionsStore)(),p=(0,sl.useExtensionStateAtom)(e?.installationId),h=(0,oo.useTheme)(),m=(0,v.useRef)(h),f=(0,v.useRef)([]);m.current=h;let g=(0,q.default)(()=>({}),[]),y=(0,sf.default)(u.container),[w,b]=(0,v.useState)(!1);(0,v.useEffect)(function(){y===sp.ConnectionState.CONNECTED&&b(!0)},[y]),(0,v.useEffect)(()=>{f.current.forEach(e=>e(h.theme))},[h.theme]),(0,v.useEffect)(()=>()=>{d.current&&d.current()},[]);let j=(0,v.useCallback)(()=>{try{let e=new URL(t);if("https:"===e.protocol)return!0;return!1}catch(e){return!1}},[t]),S=(0,v.useCallback)(()=>{s.current&&j()&&e&&p&&l&&(d.current&&d.current(),d.current=function(e){let{extensionIframe:t}=e,n=new URL(t.src).origin,i=function(e){var t;let{filePath:n,replId:i,environmentAPIs:r}=e,a=e.logger.createLogger({api:"debug"});async function s(t){let n=await t?.clientName??"(unset)",i=await t?.clientVersion??"(unset)";return(0,ei.track)(er.events.EXTENSION_USED,{action:"sandbox_initialized",clientName:n,clientVersion:i,extensionId:e.extension.extensionId,extensionName:e.extension.manifest.name,installationId:e.extension.installationId}),(async()=>{if(!e.extension.isLocal||"@replit/extensions"!==n)return;let t=await e.services.container.exec("sh","-c","npm view @replit/extensions --json version 2>/dev/null");if(t.error)throw t.error;if(!t.output)throw Error("No output from npm");let r=JSON.parse(t.output?.trim());r!==i&&e.logger.warn(`There is a new version of @replit/extensions available. You are using ${i}, but the latest version is ${r}`,{clientVersion:i,latestVersion:r})})(),{success:!0}}return{filePath:n,...function(e){let{fs:t}=e.services,n=e.logger.createLogger({api:"fs"});async function i(e,n){let i,r=(0,on.normalizePath)(e);return i="string"==typeof n?n:n instanceof Blob?ot.default.from(await n.arrayBuffer()):ot.default.from(n),oi(await t.writeFile(r,i))}async function r(e,n="utf8"){var i;let a=(0,on.normalizePath)(e),s=await t.readFile(a);return s.error?{error:s.error,content:null}:{error:null,content:(i=s.content,"utf8"===n?i.toString():"binary"===n?i.toBuffer():i)}}async function a(e){let n=(0,on.normalizePath)(e),i=await t.readDir(n);return i.error?{error:i.error,children:null}:{error:null,children:i.children}}async function s(e){let n=(0,on.normalizePath)(e);return oi(await t.createDir(n))}async function o(e){let n=(0,on.normalizePath)(e);return oi(await t.deleteDir(n))}async function l(e){let n=(0,on.normalizePath)(e);return oi(await t.deleteFile(n))}async function u(e,n){let i=(0,on.normalizePath)(e),r=await t.stat(i);return r.exists?oi(r.type===n_.FileType.File?await t.moveFile(i,n):await t.moveDir(i,n)):{error:"File or directory does not exist",success:!1}}async function d(e,n){let i=(0,on.normalizePath)(e);return oi(await t.copyFile(i,n))}return s5([s4(e,["read"])],{readFile:r,readDir:a,watchFile:function(e,i,r="binary"){let a=(0,on.normalizePath)(e);(0,rt.isOTFile)(a)&&n.warn("Extension used watchFile on a text file. This works, but watchTextFile is preferred.");let s=t.watchFile(a,{onChange:e=>{"utf8"===r?i.onChange(e.toString("utf8")):i.onChange(e.asBuffer)},onError(e){i.onError(e.message)},onMoveOrDelete(e){i.onMoveOrDelete({eventType:e.eventType,node:e.node})}});return sA(()=>{s()})},watchDir:function(e,n){let i=(0,on.normalizePath)(e),r=t.watchDir(i,{onChange:t=>{n.onChange(t.map(t=>({path:(0,on.asDir)(e)+t.filename,type:t.type})))},onError(e){n.onError(e)},onMoveOrDelete(e){n.onMoveOrDelete(e)}});return sA(()=>{r()})},...s5([s4(e,["write-exec"])],{createDir:s,deleteDir:o,writeFile:i,deleteFile:l,copyFile:d,move:u,watchTextFile:function(e,i){(0,rt.isOTFile)(e)||n.warn("It appears that you are trying to use watchTextFile on a non-OT file. Please use fs.watchFile instead");let r=t.watchTextFile(e,{onReady({fetchChanges:e,initialContent:t,transformSelection:n,updateSelections:r,version:a,writeChange:s}){i.onReady(sA({writeChange:s,fetchChanges:e,initialContent:t,version:a,transformSelection:n,updateSelections:r}))},onChange:async({latestContent:e,changeSource:t,changes:n,version:r})=>{i.onChange({latestContent:e.toString(),version:r,changeSource:t,changes:n.toJSON()})},onError(e){i.onError(e.message)},onMoveOrDelete(e){i.onMoveOrDelete({eventType:e.eventType,node:e.node})}});return sA(()=>{r()})}})})}(e),...function(e){let{container:t}=e.services,n=null;async function i(){if(n)return;let e=await t.exec("bash","-c","echo $REPLIT_DB_URL");if(e.error||!e.output)throw Error("unable to find REPLIT_DB_URL");n=e.output.trim()}async function r(e,r){await i(),await t.exec("curl",n,"-s","-d",`${e}=${r}`)}async function a(e){return await i(),(await t.exec("curl","-s",`${n}/${e}`)).output}async function s(e){await i();let r=await t.exec("curl","-s",`${n}?prefix=${e}`);return r.error||!r.output?{error:r.error}:{keys:r.output.split("\n")}}async function o(e){await i();let r=await t.exec("curl","-s","-XDELETE",`${n}/${e}`);return r.error||!r.output?{error:r.error}:{keys:r.output.split("\n")}}return s5([s4(e,["repldb:read"])],{getReplDbValue:a,listReplDbKeys:s,...s5([s4(e,["repldb:write"])],{setReplDbValue:r,deleteReplDbKey:o})})}(e),...{watchActiveFile:function(e){return sA(t.environmentAPIs.watchActiveFile(e))},openFile:(t=e).environmentAPIs.openFile,getActiveFile:function(){return t.environmentAPIs.getActiveFile()}},...function({getThemeContext:e,onThemeChange:t}){return{getCurrentTheme:function(){return e().theme},getCurrentThemeValues:function(){return e().theme.values.global},onThemeChange(e){let n=t(e);return sA(()=>{n()})},onThemeChangeValues(e){let n=t(t=>e(t.values.global));return sA(()=>{n()})}}}(e),...(({extension:e},{showMessage:t,hideMessage:n,hideAllMessages:i})=>{let r=0,a=Date.now();function s(n){return function(i,s=4e3,o){let l=Date.now();l-a>=6e4&&(a=l,r=0);let u=e.manifest.name.trim()??"Unknown Extension";r<10?(t({content:(0,x.jsxs)(x.Fragment,{children:[i,(0,x.jsx)("div",{children:(0,x.jsx)(st.Text,{variant:"small",children:u})})]}),type:n,time:s>1e4?1e4:s,style:o}),r++):E.logger.error("Extension reached showMessage throttle limit",{extensionId:e.extensionId,extensionName:e.manifest.name,content:i})}}let o=s("confirm"),l=s("error");return{showConfirm:o,showError:l,showNotice:s("notice"),showWarning:s("warning"),hideMessage:n,hideAllMessages:i}})(e,r.toasts),...function({replId:e}){return{currentUser:s1(sY),userById:s1(sQ),userByUsername:s1(sX),currentRepl:t=>s1(sJ)({id:e,...t}),replById:s1(sJ),replByUrl:s1(s0)}}({replId:i}),...function(e){let t=e.services.container.client(),n=e.logger.createLogger({api:"exec"});async function i(e){let i=await e.args,r=await e.env;if(n.info(`exec: [${i.join(", ")}]`,{environmentVariables:r}),!s2.Value.Check(s8,r))throw Error("Invalid environment variables");let a=await e.splitStderr,s=()=>{};return sA({dispose:()=>{s()},promise:new Promise(o=>{s=t.openChannel({service:"exec"},({channel:t})=>{t.onCommand(t=>{a?t.output?e.onOutput(t.output):t.stderr&&e.onStdErr(t.stderr):t.output&&e.onOutput(t.output)}),t.request({exec:{args:i,env:r,splitStderr:!!a}}).then(n=>{if(n.ok)return void o({exitCode:0,error:null});if(n.channelClosed){let t="Channel closed before command's execution finished";e.onError(t),o({exitCode:null,error:t});return}if("open"===t.status&&s(),n.error){let e=Number(n.error?.match(/-?[0-9]+/g)?.[0]);o({exitCode:"number"==typeof e?e:null,error:n.error});return}throw Error("Unknown error")}).catch(t=>{n.error(`exec: threw crosis error:
${String(t||"")}`);let i="exec() failed due to internal error. See console for details.";e.onError(i),o({error:i,exitCode:null})})})})})}return{...s5([s4(e,["write-exec"])],{exec:i})}}(e),...function({extension:e,paneId:t,environmentAPIs:n}){let i=!1;return{activatePane:()=>{t&&(n.activatePane(t),i||(i=!0,(0,ei.track)(er.events.EXTENSION_USED,{action:"used",extensionId:e.extensionId,extensionName:e.manifest.name})))}}}(e),commands:{registerCommand:async(t,n)=>{if(!t.commandId||""===t.commandId)throw Error("Attempted to register command without id");if(!t.contributions||!Array.isArray(t.contributions))throw Error(`Command: In ${t.commandId}, contributions should be an array`);0===t.contributions.length&&e.logger.warn(`Command: ${t.commandId} has no contributions`);let i=await (0,sd.parseCommandProxyToExtensionCommand)(n,e);e.store.set(sl.registerExtensionCreateCommandAtom,{extensionStateAtom:e.extensionStateAtom,createCommand:{id:t.commandId,contributions:t.contributions,create:async()=>i}})},registerCreateCommand:async(t,n)=>{if(!t.commandId||""===t.commandId)throw Error("Attempted to register command without id");if(!t.contributions||!Array.isArray(t.contributions))throw Error(`Command: In ${t.commandId}, contributions should be an array`);0===t.contributions.length&&e.logger.warn(`Command: ${t.commandId} has no contributions`);let i=t.contributions.filter(e=>!(e in s_.ContributionType));i.length>0&&e.logger.warn(`Command: ${t.commandId} has unrecognized contributions: ${i.join(", ")}. Valid contributions are ${Object.values(s_.ContributionType)}`);let r={id:t.commandId,contributions:t.contributions,create:async({path:t})=>{let i=await Promise.race([n({path:t}),new Promise(e=>setTimeout(()=>e(sM),50))]);return null===i?null:i===sM?(e.logger.warn("Command took too long to create. When using registerCreateCommand, you must return a command within 50ms"),null):(0,sd.parseCommandProxyToExtensionCommand)(i,e)}};e.store.set(sl.registerExtensionCreateCommandAtom,{extensionStateAtom:e.extensionStateAtom,createCommand:r})}},experimental:{...s5([oe(e)],{hasExperimentalApi:()=>!0}),editor:s5([oe(e)],{getPreferences:async function(){let e=await t1.apolloClient?.query({query:sZ});if(e?.data?.currentUser?.workspacePreferences)return(0,s3.getUserPreferences)(e.data.currentUser.workspacePreferences);throw Error(e?.error?.message)}}),commands:s5([oe(e)],{...s7(e)}),auth:s5([oe(e)],{async getAuthToken(){if(e.extension.isLocal)return[btoa(JSON.stringify({alg:"none",typ:"JWT",local:!0,key:"there-is-no-key-for-local-extensions"})),btoa(JSON.stringify({installationId:e.extension.installationId,extensionId:e.extension.extensionId,userId:e.userId,origin:"https://staging.replit.com"})),"this-is-a-locally-generated-jwt-that-will-fail-verification-to-avoid-being-used-accidentally-in-prod-so-please-check-the-header-for-whether-this-is-a-local-extension"].join(".");let t=await t1.apolloClient?.query({query:s9,variables:{installationId:e.extension.installationId}});if(!t?.data)throw Error("Failed to authenticate: something went wrong");let n=t.data.extensionInstallationById;if("NotFoundError"===n.__typename)throw Error("Failed to authenticate: invalid installation ID");if("ExtensionInstallation"!==n.__typename||!n.token)throw Error("Failed to authenticate: something went wrong");return n.token}}),internal:s5([oe(e)],{...s7(e)})},internal:function(e){return e.store.get(e.extensionStateAtom).enableInternalApi?{hasInternalApi:()=>!0,ghostwriter:{},container:function(e){let{services:{container:t}}=e;return{getConnectionState:()=>t.getConnectionState(),onConnectionStateChanged(e){let n=t.onConnectionStateChanged(e);return sA(()=>{n()})}}}(e),layout:{revealOrInsertTool:(t=0)=>{let n=e.logger.createLogger({api:"revealOrInsertTool"});if(!e.extension.manifest.tools)return void n.warn("No tools defined in extension manifest");if(e.extension.manifest.tools.length<t+1)return void n.warn("Tool index out of bounds");let i=e.extension.manifest.tools[t],r=i.name||e.extension.manifest.name,a=i.handler;e.environmentAPIs.revealOrInsertTool({extensionId:e.extension.extensionId,installationId:e.extension.installationId,baseUrl:e.extension.baseUrl,path:a,name:r})},getLayoutState:()=>e.environmentAPIs.getLayoutState(),setLayoutState:t=>e.environmentAPIs.setLayoutState(t)},secrets:function(e){let{services:{secrets:t}}=e;return{setSecret:async({key:e,value:n})=>(await t.addEntries([{key:e,value:n}]),(0,or.Ok)(!0)),async getSecret(e){try{return(0,or.Ok)((await t.read()).get(e.key))}catch(e){return(0,or.Err)(e)}},getReferenceCode:async e=>(0,oa.getEnvCodeForLanguage)(e.filePath,e.key)}}(e),dotReplit:function(e){let{services:{dotReplit:t}}=e,{getConfig:n,updateDotReplit:i}=t;return{getConfig:n,update:i}}(e),ssh:{getSshConfig:async()=>e.environmentAPIs.getSshConfig()},commands:s7(e)}:null}(e),debug:{info:(e,t)=>a.info(e,t),warn:(e,t)=>a.warn(e,t),error:(e,t)=>a.error(e,t)},handshake:s}}(e);if(!t.contentWindow)throw Error("No contentWindow");let r=sC(i,function(e,t=self,n="*"){return{postMessage:(t,i)=>{e.postMessage(t,n,i)},addEventListener:t.addEventListener.bind(t),removeEventListener:t.removeEventListener.bind(t)}}(t.contentWindow,self,n),{origin:n,source:t.contentWindow}),a=i=>{if(i.origin!==n||t.contentWindow!==i.source)return;let{data:r}=i;r.payload&&e.logger.warn("Extension sent deprecated postMessage",r)};return window.addEventListener("message",a),()=>{r(),window.removeEventListener("message",a)}}({extension:e,extensionIframe:s.current,services:u,paneId:i,replId:o,getThemeContext:()=>m.current,onThemeChange:e=>(f.current.push(e),()=>{f.current.splice(f.current.indexOf(e),1)}),store:c,extensionStateAtom:p,environmentAPIs:r,filePath:a,logger:e.logger.createLogger({sandboxUrl:t,sandboxTitle:n}),userId:l,ghostwriter:g}))},[l,m,u,j,i,c,p,r,o,a,e,t,n,g]);return{isValidExtensionPaneUrl:j,didConnectOnce:w,getIframeProps:(e={})=>({title:n,src:t,...sh.default,...e,ref:(0,sm.mergeRefs)([s,e.ref],{breadcrumb:"client/workspace/extensions/sandbox/useExtensionSandbox.tsx:191"}),onLoad:t=>{S(),e.onLoad&&e.onLoad(t)}}),reloadSandbox:(0,v.useCallback)(()=>{if(!s.current)return;let e=s.current.src;s.current.src=e},[])}}function ou({extension:e,environmentAPIs:t}){if(!e.manifest.background)throw Error("ExtensionBackground loaded without a background script defined in manifest");let n=(0,sl.useExtensionStateAtom)(e.installationId),{didConnectOnce:i,isValidExtensionPaneUrl:r,getIframeProps:a}=ol({extension:e,sandboxUrl:(0,sc.getAssetUrl)(e.baseUrl,e.manifest.background.page),sandboxTitle:"Extension Background: "+e.manifest.name,environmentAPIs:t,paneId:null,filePath:null});return r()&&i&&n?(0,x.jsx)("iframe",{...a({css:{width:"0px",height:"0px",border:"none"}})}):null}var od=e.i(838124),oc=e.i(557154);function op(){let e=(0,a9.default)(),t=(0,a6.useCurrentUserId)(),{url:n}=(0,a7.useDevUrl)(),i=(0,od.useIsExtensionRepl)(),r=(0,su.useInstallExtension)(),a=aS(),s=(0,su.useInstallExtensionLocallyByURL)(),o=(0,su.useLoadExtension)(),l=(0,su.useInitializeExtensionSystem)();(0,od.useSyncReplConfigIsExtension)();let u=(0,sl.useExtensions)(),d=so(),[c,p]=(0,v.useState)(!1);(0,v.useEffect)(()=>{e&&t&&l({replId:e,userId:t})},[e,t,l]);let h=(0,sl.useFileHandlers)(),m=n9(tg);(0,v.useEffect)(()=>{m(h)},[h,m]);let f=n9(iP);!function(){let e,{data:t}=(e={...iS,...void 0},j.useQuery(ik,e)),n=n9(iI),i=t?.currentUser?.filetypeAssociations;(0,v.useEffect)(()=>{i&&n(i)},[n,i])}();let g=n3(iE),y=n9(iE),w=(0,sl.useExtensionCommands)(s_.ContributionType.CommandBar);return aQ({data:{type:"group",key:"Extensions",description:"Commands from Extensions"},commands:async()=>{let e=[{data:{}}];return(await Promise.all(w.map(async t=>{let n=await t.create({path:e});return n?(0,sd.wrapExtensionCommand)(n,{path:e}):null}))).filter(Boolean)}},{enabled:!0}),aQ({match:a_.matchLabel,commands:i=>i.active||""!==i.searchQuery?[{match:a_.matchLabel,data:{type:"action",label:"Extension Devtools",icon:(0,x.jsx)(a5.default,{}),description:"Manage and deploy this Repl as an extension",run:()=>{a({pane:{type:"extensionDevtools"}})}}},{match:a_.matchLabel,data:{type:"action",label:"URL",icon:(0,x.jsx)(a5.default,{}),description:"Add an extension by URL",run:()=>{p(!0)}}},{match:a_.matchLabel,data:{type:"action",label:"From this Repl",icon:(0,x.jsx)(a5.default,{}),description:"Load this Repl as an extension",run:()=>{n&&s(n)}}},{match:a_.matchLabel,data:{type:"context",label:"My Extensions",icon:(0,x.jsx)(a4.default,{}),description:"Browse extensions you have created"},commands:(({filterUser:n})=>async({active:i})=>{if(!i)return[];let a=await t1.apolloClient?.query({query:a1,variables:{replId:e,userId:n?t:void 0}});if(!a||a.error)return[];let s=a.data.extensionList;return s?s.map(t=>({match:a_.matchLabel,data:{type:"action",label:t.name,icon:(0,x.jsx)(a4.default,{}),description:t.description??"",run:()=>{t.url&&(t.installation?o({installationId:(0,a3.asInstallationId)(t.installation.id)}):r({replId:e,extensionId:(0,a3.asExtensionId)(t.id)}))}}})):[]})({filterUser:!0})},{match:a_.matchLabel,data:{type:"action",label:"Docs",icon:(0,x.jsx)(a2.default,{}),description:"Read the Extensions docs",run:()=>{window.open(a8.LINKS_DOCS.EXTENSIONS,"_blank","noopener")}}}]:[],data:{type:"context",label:"Extensions",icon:(0,x.jsx)(a4.default,{}),description:"Manage extensions"}},{enabled:i}),(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(aK.Modal,{isOpen:c,onRequestClose:()=>p(!1),children:(0,x.jsx)(oc.default,{prompt:"Add an extension by URL",desc:"Insert extension url",placeholder:"https://example-extension.replit.app",type:"text",onCancel:()=>p(!1),onConfirm:e=>{s(e)}})}),(0,x.jsx)(aK.Modal,{isOpen:!!g,onRequestClose:()=>y(null),children:g?(0,x.jsx)(si,{fileExtension:g.fileExtension,extensionId:g.extensionId,fileHandlerId:g.fileHandlerId,onCancel:()=>y(null),onConfirm:async()=>{let{fileExtension:e,extensionId:t,fileHandlerId:n}=g;await f({fileExtension:e,newAssociation:{extensionId:t,fileHandlerId:n}}),y(null)}}):null}),u.map(e=>e.manifest.background?(0,x.jsx)(ou,{environmentAPIs:d,extension:e},e.installationId):null)]})}var oh=e.i(917736),om=e.i(873169),of=e.i(127227);function og(){let{fs:e}=(0,sg.default)(),[t,n]=(0,v.useState)(!1),[i,r]=(0,v.useState)(!1),a=(0,v.useId)();(0,v.useEffect)(()=>{if(!i)return e.onDiskQuotaExceeded(()=>{n(!0)})},[e,i]);let s=(0,v.useCallback)(()=>{n(!1)},[n]);return(0,x.jsx)(aK.Modal,{isOpen:t,onRequestClose:s,children:(0,x.jsx)(V.View,{gap:24,children:(0,x.jsxs)(V.View,{gap:24,children:[(0,x.jsxs)(st.Header,{level:3,variant:"headerDefault",children:["Oops! This Repl's disk is full"," ",(0,x.jsx)(oh.default,{color:A.tokens.accentNegativeDefault,size:20})]}),(0,x.jsxs)(st.Text,{variant:"subheadDefault",children:["Please free up space by deleting some files. You can open the file tree by clicking the ",(0,x.jsx)(om.default,{})," icon on the left."]}),(0,x.jsx)(st.Text,{children:"You can check how much space you are using from the Repl Resources section under the file tree."}),(0,x.jsxs)(V.View,{row:!0,gap:8,tag:"label",children:[(0,x.jsx)(of.Checkbox,{id:a,checked:i,onChange:r}),(0,x.jsx)(st.Text,{variant:"small",children:"Do not show this message again for this session."})]}),(0,x.jsx)(se.Button,{onClick:s,text:"Close"})]})})})}var ox=e.i(816639),oy=e.i(852037),ov=e.i(989740),ow=e.i(679668);function ob(){let e=n9(nW),{isConverging:t,didContentsDiverge:n,showMoreDetail:i,failedFiles:r,failedFilesOptions:a,selectedFile:s,setSelectedFile:o,reviewingPrompt:l,onChoice:u,local:d,remote:c}=(0,ov.default)({moveOrDeleteFile:e}),p=[au.rcss.minHeight("7em"),au.rcss.maxHeight("50vh"),au.rcss.overflowY("auto"),{"> div":{display:"flex",alignItems:"stretch",width:"100%",height:"100%"},"> div > .cm-editor":{flex:"1 1 auto",width:"100%"}}];return(0,x.jsx)(aK.Modal,{css:[{maxHeight:"90%"}],preventClose:!0,maxWidth:"90%",isOpen:n,onRequestClose:()=>{},children:(0,x.jsxs)(V.View,{gap:24,children:[(0,x.jsx)(st.Header,{level:3,variant:"headerDefault",children:"Replit is out of sync!"}),(0,x.jsxs)(st.Text,{children:["Sometimes Replit has trouble making sure everyone's code is the same. Let us know which version of"," ",r.length>1?"these files":"this file"," you'd like to keep."," ",r.length>1?(0,x.jsxs)("strong",{children:["There are ",r.length," files impacted by this."]}):""]}),t?(0,x.jsx)(oy.default,{}):(0,x.jsxs)(x.Fragment,{children:[a.length?(0,x.jsx)(ow.Select,{"aria-label":"Select file with diverged contents",initialSelectedItem:a[0],selectedItem:a.find(e=>e.path===s),items:a,onChange:e=>{o(e.path)}}):null,i?(0,x.jsxs)(V.View,{css:[au.rcss.backgroundColor.redDimmest,au.rcss.font.code],pt:16,p:8,row:!0,gap:16,justify:"start",align:"center",children:[(0,x.jsx)(st.Text,{variant:"subheadDefault",multiline:!1,children:"Debug View"}),(0,x.jsxs)(st.Text,{multiline:!1,children:["Divergence type: ",l?.case]})]}):null,(0,x.jsxs)(V.View,{row:!0,gap:8,children:[(0,x.jsxs)(V.View,{css:[{flexBasis:0}],grow:!0,shrink:!0,children:[(0,x.jsx)(st.Text,{variant:"subheadDefault",multiline:!1,children:"My changes"}),(0,x.jsx)(R.ShadesSurface,{grow:!0,shrink:!0,py:8,children:(0,x.jsx)(V.View,{css:p,children:(0,x.jsx)(ox.DiffComponent,{diffViewer:d})})}),(0,x.jsxs)(V.View,{pt:16,children:[(0,x.jsx)(st.Text,{css:[au.rcss.textAlign.center],children:"This might disrupt other people's work or create unexpected bugs."}),(0,x.jsx)(se.Button,{onClick:()=>{u("local")},text:"Reset to Mine"})]})]}),(0,x.jsxs)(V.View,{css:[{flexBasis:0}],grow:!0,shrink:!0,children:[(0,x.jsx)(st.Text,{variant:"subheadDefault",multiline:!1,children:"Shared changes"}),(0,x.jsx)(R.ShadesSurface,{grow:!0,shrink:!0,py:8,children:(0,x.jsx)(V.View,{css:p,children:(0,x.jsx)(ox.DiffComponent,{diffViewer:c})})}),(0,x.jsxs)(V.View,{pt:16,justify:"end",children:[(0,x.jsx)(st.Text,{css:[au.rcss.textAlign.center],children:"This is the safest option and won't disrupt other's work."}),(0,x.jsx)(se.Button,{onClick:()=>{u("remote")},text:"Sync to Shared",colorway:"primary"})]})]})]})]})]})})}var oj=e.i(260924),oS=e.i(317919),ok=e.i(399344),oC=e.i(703916),oT=e.i(316699),oE=e.i(402099),oI=e.i(252204),oP=e.i(612633),oA=e.i(819906),oR=e.i(820228),oD=e.i(898039),oV=e.i(82130),o_=e.i(602389),oM=e.i(142685),oF=e.i(610357),oO=e.i(659042),oL=e.i(835);e.i(653863);var oB=e.i(973519),oU=e.i(519979),oN=e.i(591936),oG=e.i(41e4),o$=e.i(927158);let oz=["","","","","",""];function oW(e){return new Promise(t=>setTimeout(t,e))}var oH=e.i(346781),oq=e.i(989481),oK=e.i(612866),oY=e.i(279042);let oX=w.gql`
    fragment ReplEnvironmentDesktopMyReplsSearchRepl on Repl {
  id
  title
  timeUpdated
  url
  iconUrl
  ...ReplLinkRepl
  owner {
    ... on User {
      id
      username
      image
    }
    ... on Team {
      id
      username
      image
    }
  }
}
    ${oY.ReplLinkReplFragmentDoc}`,oQ=w.gql`
    query ReplEnvironmentDesktopMyReplsSearch($query: String, $count: Int) {
  currentUser {
    id
    search {
      repls(query: $query, count: $count) {
        id
        ...ReplEnvironmentDesktopMyReplsSearchRepl
      }
    }
  }
}
    ${oX}`;var oZ=e.i(302905),oJ=e.i(314531),o0=e.i(46654),o1=e.i(228108),o2=e.i(290446);let o5=(0,ie.cssRecord)({root:[au.rcss.viewStyle,au.rcss.rowWithGap(8),au.rcss.align.center,au.rcss.px(8),{textDecoration:"none"}],meta:{fontSize:10}});function o4({repl:e,height:t,isActive:n,searchQuery:i}){let{title:r}=e,a=(0,v.useMemo)(()=>i?oJ.default.match(i,r):null,[i,r]);return(0,x.jsxs)(oK.default,{href:e.url,passHref:!0,style:{height:t},css:o5.root,children:[(0,x.jsx)(o1.default,{alt:e.title,size:32,iconUrl:e.iconUrl}),(0,x.jsxs)(V.View,{grow:!0,shrink:!0,gap:2,children:[(0,x.jsx)(o2.HighlightMatches,{text:e.title,highlight:a?.ranges,dimmed:!n}),(0,x.jsxs)(st.Text,{css:o5.meta,color:"dimmest",multiline:!1,children:[e.owner.username,"  edited ",(0,o0.ago)(e.timeUpdated)]})]})]})}async function o8(e){if(!t1.apolloClient)throw Error("Expected apolloClient");let{data:t}=await t1.apolloClient.query({query:oQ,variables:e});return t.currentUser?.search.repls.filter(e=>!!e.owner)||[]}var o3=e.i(799634);function o6(){let e=aC(),t=aS();return(0,v.useCallback)(n=>(0,e9.isFilePane)(n)&&n.data.path?e({...n.data,path:n.data.path}):t({pane:n}),[t,e])}var o9=e.i(926118);let o7=(0,J.atom)(!1),le=(0,J.atom)(null,(e,t)=>{e(o7)?(0,ea.flushSync)(()=>{t(o7,!1)}):t(o7,!0)});function lt(){return(0,ee.useSetAtom)(le)}var ln=e.i(695337);let li={id:"toggleKeyboardShortcuts",name:"Keyboard shortcuts Help",description:"Opens the keyboard shortcuts modal",default:"Shift-/"},lr=function(){let e=(0,ee.useAtomValue)(o7),t=lt();return(0,x.jsx)(aK.Modal,{isOpen:e,onRequestClose:t,maxWidth:1200,centered:!0,children:(0,x.jsx)(V.View,{gap:12,children:(0,x.jsx)(ls,{})})})},la=["toggleGlobalCommandBarCommand","agent.switchMode","agent.toggle","webviewpane.reload","toggleKeyboardShortcuts","sidebar.toggle","paneMenu.toggle","files.searchContents","files.searchFiles","repl.showShell"];function ls(){let e=(0,a$.useKeyBindings)(),t=o6(),n=lt(),i=[...e.values()].filter(e=>e.shortcut).filter(e=>void 0===e.scope).sort((e,t)=>{let n=la.indexOf(e.id),i=la.indexOf(t.id);return -1!==n&&-1!==i?n-i:e.description&&!t.description?-1:!e.description&&t.description?1:e.name.localeCompare(t.name)}),r=(0,v.useCallback)(()=>{t({type:"preferences",data:{tab:1}}),n()},[t,n]);return(0,x.jsxs)(V.View,{p:0,gap:12,children:[(0,x.jsx)(st.Header,{level:2,variant:"subheadBig",children:"Keyboard shortcuts"}),i.length>0?(0,x.jsx)(R.ShadesSurface,{className:ln.default.surface,elevate:!1,children:i.map(e=>(0,x.jsxs)(V.View,{row:!0,align:"start",justify:"space-between",gap:8,"data-testid":e.id,children:[(0,x.jsxs)(V.View,{grow:0,shrink:!0,gap:2,children:[(0,x.jsx)(st.Text,{multiline:!1,children:e.name}),e.description?(0,x.jsx)(st.Text,{color:"dimmest",multiline:!1,children:e.description}):null]}),e.shortcut?(0,x.jsx)(o9.KeyComboBlocks,{small:!0,keyCombo:e.shortcut}):null]},e.id))}):(0,x.jsx)(V.View,{children:(0,x.jsx)(st.Text,{color:"dimmest",children:"No keyboard shortcuts found."})}),(0,x.jsx)(V.View,{align:"start",children:(0,x.jsx)(se.Button,{variant:"outlined",onClick:r,iconLeft:(0,x.jsx)(o3.default,{}),text:"Customize keyboard shortcuts"})})]})}var lo=e.i(752539),ll=e.i(393428),lu=e.i(255701),ld=e.i(556088),lc=e.i(61524),lp=e.i(171362);let lh=["fontSize","wrapping","minimapDisplay","indentDetection","indentFormatPastes","indentIsSpaces","keyboardHandler","showFileTreeGitStatus","codeIntelligence","shellBellAudio","accessibleTerminal","webviewAutoOpenOnPortOpened","forwardPortsAutomatically","multiselectModifierKey","codeSuggestion"];var lm=e.i(982829),lf=e.i(211733),lg=e.i(133783),lx=e.i(959407),ly=e.i(6560),lv=e.i(578166),lw=e.i(806930),lb=e.i(77164);function lj(e){return(0,v.useMemo)(()=>{let t=(n,i=[])=>{let r=[];return Object.entries(n).forEach(([n,a])=>{let s=[...i,n];if(a.children){let e=t(a.children,s);r.push({match:a_.matchLabel,data:{type:"context",label:a.label,icon:a.icon??(0,x.jsx)(x.Fragment,{})},commands:()=>e})}else a.component&&r.push({match:a_.matchLabel,data:{type:"action",label:a.label,icon:a.icon??(0,x.jsx)(x.Fragment,{}),run:()=>e(s)}})}),r},n=t(lb.developerTabs);return{data:{type:"context",label:"Developer",icon:(0,x.jsx)(lw.default,{})},commands:e=>e.active||""!==e.searchQuery?n:[]}},[e])}var lS=e.i(1736),lk=e.i(729122),lC=e.i(589721),lT=e.i(267103),lE=e.i(103490);function lI(e){return(0,x.jsx)(ai.default,{...e,children:(0,x.jsx)("path",{fillRule:"evenodd",d:"M7.24 3.25h9.52a2.751 2.751 0 0 1 2.462 1.526l3.449 6.888a.75.75 0 0 1 .079.336v6A2.75 2.75 0 0 1 20 20.75H4A2.75 2.75 0 0 1 1.25 18v-6a.75.75 0 0 1 .08-.336l3.448-6.888A2.75 2.75 0 0 1 7.24 3.25Zm0 1.5a1.25 1.25 0 0 0-1.118.694l-.001.002-2.907 5.804H8a.75.75 0 0 1 .624.334l1.777 2.666H13.6l1.777-2.666A.75.75 0 0 1 16 11.25h4.786l-2.907-5.804v-.002a1.25 1.25 0 0 0-1.119-.694m4.49 8h-4.849l-1.777 2.666a.75.75 0 0 1-.624.334h-4a.75.75 0 0 1-.624-.334L7.599 12.75H2.75V18A1.25 1.25 0 0 0 4 19.25h16A1.25 1.25 0 0 0 21.25 18v-5.25Zm-4.49-8H7.24h9.52Z",clipRule:"evenodd"})})}var lP=e.i(613141);let lA={},lR=w.gql`
    fragment AgentFeedbackItem on AgentFeedback {
  id
  topic
  feedbackText
  currentPage
  status
  timeCreated
  timeUpdated
  screenshots
  user {
    id
    username
    fullName
    displayName
    image
  }
  deployment {
    id
  }
  build {
    id
  }
}
    `,lD=w.gql`
    query InboxContentAgentFeedback($replId: String!) {
  getRepl(id: $replId) {
    ... on Repl {
      id
      agentFeedback {
        ... on ReplAgentFeedback {
          isEnabled
          pendingCount
          items {
            ...AgentFeedbackItem
          }
        }
        ... on Error {
          message
        }
      }
    }
  }
}
    ${lR}`;function lV(e){let t={...lA,...e};return j.useQuery(lD,t)}let l_=w.gql`
    subscription AgentFeedbackUpdates($replId: String!) {
  agentFeedback(replId: $replId) {
    ...AgentFeedbackItem
  }
}
    ${lR}`,lM=w.gql`
    mutation UpdateAgentFeedbackStatus($input: UpdateAgentFeedbackStatusInput!) {
  updateAgentFeedbackStatus(input: $input) {
    ... on AgentFeedback {
      ...AgentFeedbackItem
    }
    ... on Error {
      message
    }
  }
}
    ${lR}`;var lF=e.i(385832),lO=e.i(225500),lL=e.i(852819);let lB={new:"New",resolved:"Resolved",current_deployment:"Current deployment",recently_deleted:"Recently deleted"},lU=(0,ed.createJSONStorage)(()=>({getItem:e=>t2.default.get(e,"string"),setItem:(e,t)=>t2.default.set(e,t),removeItem:e=>t2.default.remove(e)})),lN=(0,ed.atomWithStorage)("agentInboxFilter","new",lU);function lG(){let e=(0,a9.default)(),{data:t,refetch:n}=lV({variables:{replId:e}}),{isEnabled:i}=(0,lF.useShowAgentInbox)(e),{authorizations:r,loading:a}=(0,lO.useAgentAuthorization)(),s=t?.getRepl?.__typename==="Repl"?t.getRepl.agentFeedback:null,o=s?.__typename==="ReplAgentFeedback"&&s.isEnabled,l=s?.__typename==="ReplAgentFeedback"?s.pendingCount:0,u=a||!!r?.paidAgent.isAuthorized;return{isEnabled:o,pendingCount:l,isAvailable:i&&u&&(o||l>0),refetchFeedbackQuery:n}}let l$={},lz=w.gql`
    query ConfiguredTools($replId: String!) {
  getRepl(id: $replId) {
    ... on Repl {
      id
      hasAuthUsers
      defaultBucket {
        ... on Bucket {
          id
        }
      }
    }
  }
}
    `;var lW=e.i(633042),lH=e.i(630818);function lq({openPane:e,currentPaneId:t}){let n,i,r,a,{fs:s}=(0,sg.default)(),o=(0,aF.usePaneUIContext)(),l=(0,v.useCallback)(({path:t})=>{let n=(0,e9.getPaneTypeForFile)({path:t});(0,ei.track)(er.events.TOOL_OPENED,{source:"New Tab",tool:n}),e({pane:{type:n,data:{path:t}}})},[e]),u=n9(ae),d=n7(ty),c=(0,v.useCallback)(n=>{if((0,ei.track)(er.events.TOOL_OPENED,{source:"New Tab",tool:n.type}),t&&(0,e9.isSingleton)(n.type)){let e=d().find(([e,{type:t}])=>t===n.type);if(e)return u({from:e[0],to:t})}e({pane:n})},[e,d,t,u]),p=lj((0,v.useCallback)(e=>{c({type:"developer",data:{tab:e}})},[c])),h=(0,lS.useShouldHideFileInWorkspace)(),m=(0,nC.useGetRecentFiles)(),f=lX(t),{groupedPanes:g,existingNonSingletonTools:y,extensions:w}=(n=function(){let e=(0,a9.default)(),{data:t}=(0,lC.useNewPanePrimaryOutputQuery)({variables:{replId:e}}),n=t?.getRepl.__typename==="Repl"?t.getRepl:null,{isServer:i,isAgentStack:r,isExpertMode:a}=n?.config||{};return(0,v.useMemo)(()=>r?[{type:"automations"}]:a?[...i?[{type:"webview"}]:[],{type:"runnerOutput"}]:[{type:"webview"}],[i,r,a])}(),i=function(){var e;let t,{data:n}=(e={variables:{replId:(0,a9.default)()}},t={...l$,...e},j.useQuery(lz,t)),i=n?.getRepl.__typename==="Repl"?n.getRepl:null,{hasDevelopmentDatabase:r}=(0,lW.useDatabaseState)(),a=!!i?.hasAuthUsers,s=i?.defaultBucket?.__typename==="Bucket";return(0,v.useMemo)(()=>{let e=[];return a&&e.push({type:"replitAuth"}),r&&e.push({type:"neon"}),s&&e.push({type:"objectStorage"}),e},[r,a,s])}(),r=(0,aN.useToolPanes)(),a=n3(ty),(0,v.useMemo)(()=>{let e=new Map,t=new Set,s=[],o=(n,i)=>{if((0,e9.isExtensionPane)(i))return void s.push(i);if(t.has(i.type))return;t.add(i.type);let r=e.get(n);r?r.push(i):e.set(n,[i])};for(let e of n)o("output",e);for(let e of i)o("configured",e);for(let e of lK)o("suggested",e);for(let e of r)o("rest",e);let l=[];for(let t of e.values())for(let e of t){let t=!(0,e9.isSingleton)(e.type)&&!(0,e9.isFilePane)(e)&&a.find(([t,n])=>n.type===e.type);t&&l.push(t)}return{groupedPanes:e,existingNonSingletonTools:l,extensions:s}},[n,i,r,a]));return(0,v.useMemo)(()=>{let e=(0,ly.createFindOrCreateFileCommand)({openFile:l,fs:s,shouldHideFile:h,getRecentFiles:m}),n=function({openFile:e,fs:t}){return{match:a_.fzfMatchLabel,data:{type:"context",label:"New file",description:"Create a new file",icon:(0,x.jsx)(a5.default,{})},commands:({searchQuery:n,active:i})=>n&&i?[{match:a_.matchLabel,data:{type:"action",description:"Create a new file",label:n,icon:(0,x.jsx)(lH.default,{path:n}),run:async()=>(await t.stat(n)).exists?{type:"error",message:`"${n}" already exists`}:(await t.writeFile(n,ot.default.from(""))).error?{type:"error",message:'Could not create "'+n+'"'}:void e({path:n})}}]:[]}}({fs:s,openFile:l}),i=[];f&&i.push(f);let r=(e,t)=>{if(!t.panes||0===t.panes.length)return;let n=[];for(let e of t.panes)y.some(([t,n])=>n.type===e.type)||n.push(lY(e,c,o,t.large));i.push({data:"context"===e.type?{...e,icon:(0,x.jsx)(x.Fragment,{})}:e,commands:()=>n})};return r({type:"context",label:"Your App"},{panes:g.get("output"),large:!0}),r({type:"group",key:"configured"},{panes:g.get("configured")}),y.length>0&&t&&i.push({data:{label:"Jump to existing tab",type:"context",icon:(0,x.jsx)(x.Fragment,{})},commands:()=>y.map(([e,n])=>lY(n,()=>{u({from:e,to:t})},o))}),r({type:"context",label:"Suggested"},{panes:g.get("suggested")}),r({type:"group",key:"Other tools"},{panes:g.get("rest")}),i.push({data:{type:"context",label:"Extensions",icon:(0,x.jsx)(x.Fragment,{})},commands:()=>w.map(e=>lY(e,c,o))}),y.length>0&&i.push({data:{key:"existing-non-singleton-tools",type:"group"},commands:()=>y.map(([e,t])=>lY(t,c,o))}),i.push(p),i.push({data:{type:"context",label:"Files",icon:(0,x.jsx)(x.Fragment,{})},commands:()=>[e,n]}),{data:{type:"group",key:"root",description:"Search for tools & files"},commands:()=>i}},[s,m,h,l,p,g,w,y,t,u,c,o,f])}let lK=[{type:"deployments"},{type:"integrations"},{type:"neon"},{type:"objectStorage"},{type:"replitAuth"},{type:"securityScan"},{type:"envEditor"}];function lY(e,t,n,i=!1){let r=i?24:void 0,a=n.getTitle(e),s=n.Icon({pane:e,size:r});return{match:(0,aB.matchToolPane)({pane:e,aliases:aU.paneAliases.get(e.type),iconSize:r}),data:{key:"extension"===e.type?`extension-${e.data.installationId}-${e.data.path}`:void 0,type:"action",label:a,icon:s,run:()=>t(e)}}}function lX(e){let t=n9(ny),n=aD(),i=(0,lT.useObservable)(n.isCollapsed),{toggle:r}=n;return(0,v.useMemo)(()=>i?{match:a_.matchLabel,data:{type:"action",label:"Open Agent",icon:(0,x.jsx)(lE.default,{}),run(){e&&t(e),r(!0)}}}:null,[i,r,t,e])}var lQ=e.i(368964);let lZ={nextTab:{id:"tabs.next",name:"Switch to next tab",default:{[lQ.KeybindingsEnvironmentEnum.DesktopApp]:(0,aq.defaultKeyCombo)({cmdOrCtrl:!0,shift:!0,key:"]"})}},previousTab:{id:"tabs.previous",name:"Switch to previous tab",default:{[lQ.KeybindingsEnvironmentEnum.DesktopApp]:(0,aq.defaultKeyCombo)({cmdOrCtrl:!0,shift:!0,key:"["})}},newTab:{id:"tabs.new",name:"New tab",description:"Opens a tab in the current active group",default:{[lQ.KeybindingsEnvironmentEnum.DesktopApp]:(0,aq.defaultKeyCombo)({cmdOrCtrl:!0,key:"t"})}},closeTab:{id:"tabs.close",name:"Close tab",description:"Close the current active tab",default:{[lQ.KeybindingsEnvironmentEnum.DesktopApp]:(0,aq.defaultKeyCombo)({cmdOrCtrl:!0,key:"w"})}},reopenClosedTab:{id:"tabs.reopenClosed",name:"Reopen closed tab",default:{[lQ.KeybindingsEnvironmentEnum.DesktopApp]:(0,aq.defaultKeyCombo)({cmdOrCtrl:!0,shift:!0,key:"t"})}},findFile:{id:"files.find",name:"Find file",default:(0,aq.defaultKeyCombo)({cmdOrCtrl:!0,key:"p"})},searchFileContents:{id:"files.searchContents",name:"Search file contents",default:lv.keyboardShortcut},run:{id:"repl.run",name:"Run Repl",default:(0,aq.defaultKeyCombo)({cmdOrCtrl:!0,key:"Enter"})},toggleInviteDialog:{id:"repl.multiplayers",name:"See multiplayers",default:(0,aq.defaultKeyCombo)({cmdOrCtrl:!0,key:"m"})},showShell:{id:"repl.showShell",name:"Show shell",default:(0,aq.defaultKeyCombo)({ctrl:!0,key:"`"}),description:"Opens or reveals a Shell in a tab"},showConsole:{id:"repl.showConsole",name:"Show console",description:"Opens or reveals the Console in a tab",default:void 0},showSettings:{id:"repl.showSettings",name:"Show settings",description:"Opens or reveals the Settings tab",default:{[lQ.KeybindingsEnvironmentEnum.DesktopApp]:(0,aq.defaultKeyCombo)({cmdOrCtrl:!0,key:","})}},saveAllFiles:{id:"repl.saveAllFiles",name:"Save all files",description:"Forces all changes to be flushed to disk",default:void 0},showGit:{id:"repl.showGit",name:"Show git",description:"Opens or reveals the Git tool in a tab",default:void 0},toggleFloatPaneGroup:{id:"paneGroup.toggleFloat",name:"Toggle float group",description:"Floats or un-floats the current active group",default:void 0},toggleMaximizePaneGroup:{id:"paneGroup.toggleMaximize",name:"Toggle maximize group",description:"Maximizes or restores the current active group",default:void 0},removePaneGroup:{id:"paneGroup.close",name:"Close group",description:"Closes all tabs in the current active group",default:void 0},removeOthersInPaneGroup:{id:"paneGroup.closeOthers",name:"Close other tabs in group",description:"Closes all tabs except the visible one in the current active group",default:void 0},insertPaneGroupUp:{id:"paneGroup.insertUp",name:"Insert group above",description:"Adds a new group above the current active group",default:void 0},insertPaneGroupRight:{id:"paneGroup.insertRight",name:"Insert group right",description:"Adds a new group to the right of the current active group",default:void 0},insertPaneGroupLeft:{id:"paneGroup.insertLeft",name:"Insert group left",description:"Adds a new group to the left of the current active group",default:void 0},insertPaneGroupDown:{id:"paneGroup.insertDown",name:"Insert group below",description:"Adds a new group below the current active group",default:void 0},moveTabUpGroup:{id:"tabs.move.groupUp",name:"Move tab into group above",description:"Moves the current active tab into the group above",default:void 0},moveTabRightGroup:{id:"tabs.move.groupRight",name:"Move tab into group right",description:"Moves the current active tab into the group to the right",default:void 0},moveTabLeftGroup:{id:"tabs.move.groupLeft",name:"Move tab into group left",description:"Moves the current active tab into the group to the left",default:void 0},moveTabDownGroup:{id:"tabs.move.groupDown",name:"Move tab into group below",description:"Moves the current active tab into the group below",default:void 0},moveFocusUp:{id:"paneGroup.focusUp",name:"Move focus to group above",description:"Move focus to the group above the current active group",default:void 0},moveFocusRight:{id:"paneGroup.focusRight",name:"Move focus to group right",description:"Move focus to the group to the right of the current active group",default:void 0},moveFocusLeft:{id:"paneGroup.focusLeft",name:"Move focus to group left",description:"Move focus to the group to the left of the current active group",default:void 0},moveFocusDown:{id:"paneGroup.focusDown",name:"Move focus to group below",description:"Move focus to the group below the current active group",default:void 0},webviewRefresh:{id:"webviewpane.reload",name:"Refresh preview",description:"Reload the preview pane",default:(0,aq.defaultKeyCombo)({alt:!0,key:"r"})},keepTab:{id:"tab.keep",name:"Keep tab",description:"Converts a preview tab to a persisted tab",default:void 0}};var lJ=e.i(464092);let l0=Object.values(lZ),l1=(0,v.memo)(function({isAdmin:e,isSubscribed:t}){let n,i,r=aH(),a=(0,nC.useGetRecentFiles)(),{fs:s,container:o}=(0,sg.default)(),{fork:l,isForking:u}=(0,lJ.useForkContext)(),{isOffline:d,isWorkflowsLoading:c,isRunning:p}=(0,lk.useRunInfo)(),h=(0,lk.useOnToggleRun)(),m=(0,lS.useShouldHideFileInWorkspace)(),f=aC(),g=n9(nq),y=n9(nK),w=n9(nG),b=n9((n=(0,nC.usePopClosedPane)(),(0,q.default)(()=>(0,J.atom)(null,(e,t)=>{let i=n();if(!i)return;t(nH,[i.pane]);let r=e(e7);r&&t(tt,r)}),[n]))),j=n9(rk),S=n9(nY),k=n9(tt),C=n3(e7),T=n3((0,q.default)(()=>(0,J.atom)(e=>{let t=e(e7);if(!t)return null;let n=eA(e(tc),t);return n?n.paneGroup.id:null}),[])),E=n9(rW),{toggleMaximizePane:I}=aT(),P=n9(nb),A=n9(nv),R=n9(rS),D=n9(nj),V=(0,aO.usePaneBindings)(C),_=(0,a9.default)(),M=(0,W.default)(),F=n7(tv),O=aS(),L=(0,ss.default)(),B=(0,lg.default)(),{url:U}=(0,a7.useDevUrl)(),{showNotice:N}=(0,sr.default)(),G=e||!1,$=(0,X.useQueryParam)("debug","boolean"),{openEditor:z,onConfirmConfig:H,isConfigModalOpen:K,closeConfigModal:Q}=(0,lx.default)("vscode"),Z=(0,oT.default)(e=>(0,ei.track)(er.events.PROJECT_RAN,{replId:_,placement:e}),500);(0,a$.useCommandBinding)(()=>[lZ.saveAllFiles.id,()=>{s.flush(void 0,n_.FlushSource.MANUAL_SAVE)}],[s]),(0,a$.useCommandBinding)(()=>[lZ.newTab.id,()=>g()],[g]),(0,a$.useCommandBinding)(()=>[lZ.nextTab.id,()=>S("next")],[S]),(0,a$.useCommandBinding)(()=>[lZ.previousTab.id,()=>S("previous")],[S]),(0,a$.useCommandBinding)(()=>[lZ.closeTab.id,()=>{let e=y();return e||F()>0}],[y,F]),(0,a$.useCommandBinding)(()=>[lZ.reopenClosedTab.id,()=>b()],[b]),(0,a$.useCommandBinding)(()=>[lZ.moveTabUpGroup.id,()=>w("above")],[w]),(0,a$.useCommandBinding)(()=>[lZ.moveTabRightGroup.id,()=>w("rightOf")],[w]),(0,a$.useCommandBinding)(()=>[lZ.moveTabLeftGroup.id,()=>w("leftOf")],[w]),(0,a$.useCommandBinding)(()=>[lZ.moveTabDownGroup.id,()=>w("below")],[w]),(0,a$.useCommandBinding)(()=>C?[lZ.keepTab.id,()=>k(C)]:void 0,[C,k]),(0,a$.useCommandBinding)(()=>C?[lZ.insertPaneGroupUp.id,()=>D({paneId:C,placement:"above",autoFocus:!0})]:void 0,[C]),(0,a$.useCommandBinding)(()=>C?[lZ.insertPaneGroupRight.id,()=>D({paneId:C,placement:"rightOf",autoFocus:!0})]:void 0,[C]),(0,a$.useCommandBinding)(()=>C?[lZ.insertPaneGroupLeft.id,()=>D({paneId:C,placement:"leftOf",autoFocus:!0})]:void 0,[C]),(0,a$.useCommandBinding)(()=>C?[lZ.insertPaneGroupDown.id,()=>D({paneId:C,placement:"below",autoFocus:!0})]:void 0,[C]),(0,a$.useCommandBinding)(()=>[aX.id,()=>r()],[r]);let ee=lt(),et=(0,Y.useIsInMobileWorkspace)();(0,a$.useCommandBinding)(()=>[li.id,()=>{if(function(){let e=document.activeElement;if(!e)return!1;let t=e.tagName.toLowerCase();return"textarea"===t||("input"===t?["text","password","email","search","tel","url","number","date","datetime-local","month","time","week"].includes(e.type.toLowerCase()):!!e.isContentEditable||"true"===e.getAttribute("contenteditable"))}()||et)return!1;ee()}],[ee]);let en=(0,a$.useKeyCombo)(lZ.findFile.id);(0,a$.useCommandBinding)(()=>[lZ.findFile.id,()=>r(ly.createFindOrCreateFileCommand({openFile:f,fs:s,shouldHideFile:m,getRecentFiles:a,keyboardShortcut:en}))],[r]);let ea=aL({type:"files"});aQ(ly.createFindOrCreateFileCommand({openFile:f,fs:s,shouldHideFile:m,getRecentFiles:a,getCurrentlyOpenFilePanesCommands:ea,keyboardShortcut:en}));let es=(0,a$.useKeyCombo)(lZ.searchFileContents.id),eo=aS(),el=(0,v.useCallback)(e=>{(0,e9.isFilePane)(e.pane)||(0,ei.track)(er.events.TOOL_OPENED,{source:"Command Bar",tool:e.pane.type}),eo(e)},[eo]);(0,a$.useCommandBinding)(()=>[lZ.searchFileContents.id,()=>{let e;V?.type==="searchReplace"?V.focusSearchInput?.():((0,ei.track)(er.events.SEARCH_PANE_USED,{action:"opened_via_shortcut"}),V?.type==="codeEditor"&&(e=V.getCurrentSelectionText?.()),el({pane:{type:"searchReplace",data:{initialQuery:e}}}))}],[V,el]),(0,a$.useCommandBinding)(()=>C?[lZ.toggleFloatPaneGroup.id,()=>E(C)]:void 0,[C]),(0,a$.useCommandBinding)(()=>C?[lZ.toggleMaximizePaneGroup.id,()=>I(C)]:void 0,[C]),(0,a$.useCommandBinding)(()=>T?[lZ.removePaneGroup.id,()=>{P({paneGroupId:T}),R()}]:void 0,[T]),(0,a$.useCommandBinding)(()=>C?[lZ.removeOthersInPaneGroup.id,()=>{A(C)}]:void 0,[C]),(0,a$.useCommandBinding)(()=>[lZ.moveFocusUp.id,()=>j("above")],[]),(0,a$.useCommandBinding)(()=>[lZ.moveFocusDown.id,()=>j("below")],[]),(0,a$.useCommandBinding)(()=>[lZ.moveFocusRight.id,()=>j("rightOf")],[]),(0,a$.useCommandBinding)(()=>[lZ.moveFocusLeft.id,()=>j("leftOf")],[]),aQ((i=(0,aF.usePaneUIContext)(),(0,q.default)(()=>({data:{type:"context",label:"Open with Code Search",icon:(0,x.jsx)(oH.default,{}),key:"codeSearch"},commands:({searchQuery:e})=>{if(!e)return[];let t={type:"searchReplace",data:{initialQuery:e}};return[{match:(0,a_.createFzfMatchLabel)({defaultScore:oq.commandDefaultScores.codeSearch,matchScoreMultiplier:oq.commandMatchScoreMultipliers.codeSearch,filterLowMatchScores:!1}),data:{type:"action",label:i.getTitle(t),icon:i.Icon({pane:t}),run(){O({pane:t})}}}]}}),[i,O]))),aQ(lX()),aQ(lv.createSearchFileContentsCommand({container:o,activeOnly:!0,keyboardShortcut:es,openFile:f})),(0,a$.useCommandBinding)(()=>{if(!d&&!c)return[lZ.run.id,()=>{h(lm.RunReason.KEYBOARD_SHORTCUT),Z("shortcut_cmd_enter")}]},[h]);let eu=(0,a$.useKeyCombo)(lZ.run.id);aQ({match:a_.fzfMatchLabel,data:{type:"action",icon:(0,x.jsx)(oP.default,{}),label:"New window",keyboardShortcut:"Cmd-Shift-n",description:"Open a new window",run(){oM.desktopAppApi.openNewWindow()}}},{enabled:M}),aQ({match:a_.fzfMatchLabel,data:{type:"action",icon:(0,x.jsx)(oA.default,{}),label:"Run",description:"Run Repl",run(){h(lm.RunReason.KEYBOARD_SHORTCUT)},keyboardShortcut:eu}},{enabled:!p}),aQ({match:a_.fzfMatchLabel,data:{type:"action",icon:(0,x.jsx)(oV.default,{}),label:"Stop",description:"Stop Repl",run(){h(lm.RunReason.KEYBOARD_SHORTCUT)}}},{enabled:p}),aQ(function(){let e=aA(),{isAvailable:t}=lG(),n=(0,Y.useIsInMobileWorkspace)();return(0,v.useMemo)(()=>t&&!n?{match:a_.matchLabel,data:{type:"action",label:"Inbox",description:"Review feedback from your app's users",icon:(0,x.jsx)(lI,{}),run(){e.toggleContent("inbox")}}}:null,[t,n,e])}()),aQ({match:a_.fzfMatchLabel,data:{type:"action",icon:(0,x.jsx)(oR.default,{}),label:"Kill 1",description:"Kill the Repl pid1 process if it's in a bad state (admin only)",run(){o.exec("kill","1")}}},{enabled:G}),aQ({match:a_.fzfMatchLabel,data:{type:"action",icon:(0,x.jsx)(oI.default,{}),label:"Open development URL",run(){if(!U)throw Error("Expected dotdevUrl");window.open(U,"_blank","noopener")}}}),aQ({match:a_.fzfMatchLabel,data:{type:"action",icon:(0,x.jsx)(o_.default,{}),label:"Open in VS Code",description:"Connect to this Repl in VS Code via SSH",run(){(0,ei.track)(er.events.WORKSPACE,{action:"open_in_vscode_clicked",source:"command_bar",editor:"vscode"}),z()}}},{enabled:!!L&&t}),aQ({match:a_.fzfMatchLabel,data:{type:"action",icon:(0,x.jsx)(oE.default,{}),label:"Copy SSH Command",description:"Copy a shell command to connect to this Repl via SSH",run(){if(!L)throw Error("Expected sshConfig");let{sshPort:e,sshUser:t,sshHostname:n}=L,i=`ssh -i ${B}/.ssh/replit -p ${e} ${t}@${n}`;(0,ei.track)(er.events.WORKSPACE,{action:"ssh_key_copied",source:"command_bar"}),(0,oF.default)(i),N("Copied SSH command")}}},{enabled:!!L&&t}),aQ(function({description:e,onRun:t}){let n=(0,at.default)(t);return(0,q.default)(()=>({match:(0,a_.createFzfMatchLabel)({defaultScore:oq.commandDefaultScores.myRepls}),data:{type:"context",label:"My Apps",icon:(0,x.jsx)(oZ.default,{}),description:e},commands:async({searchQuery:e,active:t})=>t?(await o8({query:e,count:50})).map(t=>(function({repl:e,searchQuery:t,run:n}){return{match:()=>({score:1,render:{height:44,content:(0,x.jsx)(o4,{repl:e,height:44,searchQuery:t})}}),data:{type:"action",label:e.title,icon:(0,x.jsx)(o1.default,{alt:e.title,size:16,iconUrl:e.iconUrl}),run:()=>n(e)}}})({repl:t,searchQuery:e,run:()=>n.current(t)})):[]}),[e,n])}({description:"Jump to another Repl",onRun:e=>{window.location.href=e.url}})),aQ({match:(0,a_.createFzfMatchLabel)({defaultScore:oq.commandDefaultScores.fork}),data:{type:"action",label:"Remix",icon:(0,x.jsx)(oD.default,{}),description:"Remix App",run(){u||l()}}}),function(){let{preferences:e,update:t}=(0,lc.usePreferences)(...lh),{setActiveTheme:n,theme:i}=(0,oo.useTheme)();aQ({match:(0,a_.createFzfMatchLabel)({defaultScore:oq.commandDefaultScores.settings,matchScoreMultiplier:oq.commandMatchScoreMultipliers.settings}),data:{type:"context",label:"Settings",description:"Change Replit Settings",icon:(0,x.jsx)(lu.default,{})},commands:({active:r,searchQuery:a})=>{if(!r&&!a)return[];let s={match:(0,a_.createFzfMatchLabel)({defaultScore:oq.commandDefaultScores.settings,matchScoreMultiplier:oq.commandMatchScoreMultipliers.settings}),data:{type:"context",label:"Theme",icon:(0,x.jsx)(ll.default,{}),description:"Change Replit Theme"},commands:()=>lp.officialThemes.map(e=>({match:(0,a_.createFzfMatchLabel)({defaultScore:oq.commandDefaultScores.settings,matchScoreMultiplier:oq.commandMatchScoreMultipliers.settings}),data:{type:"action",label:e.title,icon:i.id===e.id?(0,x.jsx)(lo.default,{}):(0,x.jsx)(lu.default,{opacity:0}),description:"Use "+e.title+" theme "+(i.id===e.id?" (current)":""),run(){n(e.id)}}}))};return[...Object.values(ld.userPreferences).filter(e=>-1!==lh.indexOf(e.editorPreferencesKey)).map(n=>({match:(0,a_.createFzfMatchLabel)({defaultScore:oq.commandDefaultScores.settings,matchScoreMultiplier:oq.commandMatchScoreMultipliers.settings}),data:{type:"context",label:n.name,icon:(0,x.jsx)(lu.default,{}),description:n.description},commands:()=>n.options.map(i=>{let r=e[n.editorPreferencesKey],a=!!n.editorPreferencesKey&&i.editorPreferencesValue===r;return{match:(0,a_.createFzfMatchLabel)({defaultScore:oq.commandDefaultScores.settings,matchScoreMultiplier:oq.commandMatchScoreMultipliers.settings}),data:{type:"action",label:i.title,icon:a?(0,x.jsx)(lo.default,{}):(0,x.jsx)(lu.default,{opacity:0}),description:i.description,async run(){var e;if(!n.editorPreferencesKey)throw Error("editorPreferencesKey is not defined");await void(Object.keys(e={[n.editorPreferencesKey]:i.editorPreferencesValue}).forEach(t=>{let n=e[t];(0,ei.track)(er.events.SETTINGS_TOGGLED,{settingChanged:t,updatedValue:n,isCommandBar:!0})}),t(e))}}}})})),s]}},{enabled:!0})}(),aQ(lj((0,v.useCallback)(e=>{el({pane:{type:"developer",data:{tab:e}}})},[el])));let ed=function(){let e=(0,a9.default)(),{show:t}=(0,oB.useGlobalModal)();return(0,v.useMemo)(()=>{let n=[];return n.push({match:a_.matchLabel,data:{type:"action",label:"[Admin] Show Slack Agent Stack Connector Modal [DEPRECATED]",icon:(0,x.jsx)(oL.default,{}),run(){t("SlackConnectorSetupModalDeprecated",{replId:e})}}}),{match:a_.matchLabel,data:{icon:(0,x.jsx)(oO.default,{}),label:"Admin",type:"context",description:"Manage internal only settings"},commands:()=>n,numCommands:n.length}},[t,e])}();aQ(ed,{enabled:G&&ed.numCommands>0});let ec=function(){let e=(0,oG.useUploadPid2)(),[t]=(0,oG.usePid2UploadState)(),{showNotice:n}=(0,sr.default)(),i=(0,o$.usePid2Callback)(e=>async()=>{try{let t=await e.healthCheck.ping.rpc({});if(t.ok)return{ok:!0,payload:t.payload};return{ok:!1}}catch(e){return{ok:!1}}}),r=(0,o$.usePid2Callback)(e=>async(t=5,i=1e3)=>{for(let r=0;r<t;r++){let a=oz[r%oz.length];n(`${a} Pinging PID2... (attempt ${r+1}/${t})`);try{let t=await e.healthCheck.ping.rpc({});if(t.ok)return n(` PID2 is ready! ${JSON.stringify(t.payload)}`),!0}catch(e){}r<t-1&&await oW(i)}return n(` PID2 not responding after ${t} attempts`),!1});return(0,v.useMemo)(()=>{let a=[];return a.push({match:a_.matchLabel,data:{type:"action",icon:(0,x.jsx)(oU.default,{}),label:"Ping PID2",description:"Check if PID2 is healthy and responding",async run(){if(!i)return void n("PID2 client not available");let e=await i();e?.ok?n(` PID2 is healthy: ${JSON.stringify(e.payload)}`):n(" PID2 ping failed")}}}),a.push({match:a_.matchLabel,data:{type:"action",icon:(0,x.jsx)(oN.default,{}),label:t===oG.Pid2UploadState.IDLE?"Upload PID2 bundle":`Upload PID2 bundle (${t.toLowerCase()})`,description:t===oG.Pid2UploadState.IDLE?"Upload and install the latest PID2 bundle to the container":`Current status: ${t.toLowerCase()}`,async run(){t===oG.Pid2UploadState.IDLE||t===oG.Pid2UploadState.ERROR?(await e(),await oW(2e3),r&&await r(5,1e3)):n(`PID2 upload already in progress: ${t}`)}}}),{match:a_.matchLabel,data:{icon:(0,x.jsx)(oO.default,{}),label:"PID2",type:"context",description:"PID2 debug commands"},commands:()=>a,numCommands:a.length}},[e,t,n,i,r])}();return aQ(ec,{enabled:(G||$)&&ec.numCommands>0}),(0,x.jsx)(x.Fragment,{children:(0,x.jsx)(aK.Modal,{isOpen:K,onRequestClose:Q,centered:!0,children:(0,x.jsx)(lf.default,{onConfirm:H})})})});var l2=e.i(921211),l5=e.i(672963),l4=e.i(670413),l8=e.i(337761),l3=e.i(682205),l6=e.i(138716),l9=e.i(597853),l7=e.i(967629);let ue=(0,l7.keyframes)({"0%":{transform:"translate(0, 0)"},"8.33%, 25%":{transform:"translate(-50%, 0)"},"33.33%, 50%":{transform:"translate(-50%, -50%)"},"58.33%, 75%":{transform:"translate(0, -50%)"},"83.33%, 100%":{transform:"translate(0, 0)"}}),ut=(0,ie.cssRecord)({root:[au.rcss.color.foregroundDimmest,au.rcss.position.relative,au.rcss.width("100%"),au.rcss.height("100%"),{overflow:"hidden"}],arrows:[au.rcss.position.absolute,au.rcss.top(0),au.rcss.left(0),au.rcss.flex.row,au.rcss.flex.wrap,au.rcss.width("200%"),au.rcss.height("200%"),{animationName:ue,animationDirection:"normal",animationTimingFunction:"ease-out",animationIterationCount:"infinite"}],arrow:[au.rcss.width("50%"),au.rcss.height("50%"),au.rcss.center]});function un({delay:e,duration:t}){return(0,x.jsx)(V.View,{css:ut.root,children:(0,x.jsxs)(V.View,{css:ut.arrows,style:{animationDelay:e?e+"ms":void 0,animationDuration:t?t+"ms":"8000ms"},children:[(0,x.jsx)(V.View,{css:ut.arrow,children:(0,x.jsx)(l3.default,{size:12})}),(0,x.jsx)(V.View,{css:ut.arrow,children:(0,x.jsx)(l6.default,{size:12})}),(0,x.jsx)(V.View,{css:ut.arrow,children:(0,x.jsx)(lo.default,{size:12})}),(0,x.jsx)(V.View,{css:ut.arrow,children:(0,x.jsx)(l9.default,{size:12})})]})})}var ui=e.i(602686);let ur=(0,ie.cssRecord)({root:[au.rcss.position.relative],circle:[au.rcss.top(-6),au.rcss.right(-6),au.rcss.minWidth(12),au.rcss.borderRadius(8),au.rcss.position.absolute,au.rcss.backgroundColor.backgroundHighest,au.rcss.shadow(3),{textAlign:"center",fontSize:10,border:"1px solid",borderColor:A.tokens.outlineDefault}],count:[{textAlign:"center",fontSize:10}]});function ua({count:e,...t}){return(0,x.jsxs)(V.View,{css:ur.root,children:[(0,x.jsx)(ui.default,{...t}),(0,x.jsx)(V.View,{css:[ur.circle,ur.count],children:e})]})}function us(){return(0,x.jsxs)(V.View,{css:ur.root,children:[(0,x.jsx)(ui.default,{}),(0,x.jsx)(V.View,{css:ur.circle,children:(0,x.jsx)(lo.default,{size:6})})]})}function uo({paneId:e,paneGroupId:t}){let n=(0,aF.usePaneUIContext)(),i=aw(e),r=n9(ny),a=n9(nw),s=n9(nv),o=function({paneId:e}){return n3((0,q.default)(()=>(0,J.atom)(t=>{let n=eA(t(tc),e);return n?n.paneGroup.panes.findIndex(t=>t===e):null}),[e]))}({paneId:e}),l=function({paneGroupId:e}){return n3(function({paneGroupId:e}){return(0,q.default)(()=>(0,J.atom)(t=>{let n=eD(t(tc),e);return n?n.panes.length:null}),[e])}({paneGroupId:e}))}({paneGroupId:t});return(0,q.default)(()=>{let t=n.getTitle(i),u=[{match:a_.matchLabel,data:{type:"action",label:"Close "+t,icon:(0,x.jsx)(ui.default,{}),run(){r(e)}}}];return l&&l>1&&(null!==o&&o<l-1&&u.push({match:a_.matchLabel,data:{type:"action",label:"Close to the right",icon:(0,x.jsx)(us,{}),run(){a(e)}}}),u.push({match:a_.matchLabel,data:{type:"action",label:"Close all other tabs",icon:(0,x.jsx)(ua,{count:l-1}),run(){s(e)}}})),u},[n,i,l,o,r,e,a,s])}function ul(){let e=ab(),t=n9(tt);return(0,v.useCallback)(n=>{let{isCommitted:i,pane:r}=e(n);return!i&&(0,e9.isFilePane)(r)?{match:a_.matchLabel,data:{type:"action",label:"Keep open",icon:(0,x.jsx)(om.default,{}),run:()=>t(n)}}:null},[e,t])}var uu=e.i(558666),ud=e.i(800908);function uc(e){return(0,x.jsx)(ai.default,{...e,children:(0,x.jsx)("path",{fillRule:"evenodd",d:"M18.667 1.25c1.328 0 2.458.148 3.196.887.739.738.887 1.868.887 3.196v6c0 1.042-.164 1.975-.803 2.614-.552.553-1.325.749-2.197.792v2.705c0 1.375-.22 2.531-.997 3.309-.778.778-1.934.997-3.309.997H6.556c-1.375 0-2.531-.22-3.309-.997-.778-.778-.997-1.934-.997-3.309V8.556c0-1.375.22-2.53.997-3.309.778-.778 1.934-.997 3.309-.997H9.26c.043-.872.24-1.645.793-2.197.639-.64 1.572-.803 2.614-.803h6ZM6.556 5.75c-1.292 0-1.914.225-2.247.559-.334.333-.559.955-.559 2.247v8.888c0 1.292.225 1.914.559 2.247.333.334.955.559 2.247.559h8.888c1.292 0 1.914-.226 2.247-.559.334-.333.559-.955.559-2.247V14.75h-5.583c-1.042 0-1.975-.164-2.614-.803-.64-.639-.803-1.572-.803-2.614V5.75H6.556Zm9.444-2a.75.75 0 0 0-.75.75v2.75H12.5a.75.75 0 0 0 0 1.5h2.75v2.75a.75.75 0 0 0 1.5 0V8.75h2.75a.75.75 0 0 0 0-1.5h-2.75V4.5a.75.75 0 0 0-.75-.75Z",clipRule:"evenodd"})})}var up=e.i(761732),uh=e.i(943172);let um=new Map([["left",{label:"Move Left",icon:(0,x.jsx)(l6.default,{})}],["right",{label:"Move Right",icon:(0,x.jsx)(lo.default,{})}],["up",{label:"Move Up",icon:(0,x.jsx)(l9.default,{})}],["down",{label:"Move Down",icon:(0,x.jsx)(l3.default,{})}]]);var uf=e.i(822142);let ug=new Map([["leftOf",{label:"Move Left",icon:(0,x.jsx)(l6.default,{})}],["rightOf",{label:"Move Right",icon:(0,x.jsx)(lo.default,{})}],["above",{label:"Move Up",icon:(0,x.jsx)(l9.default,{})}],["below",{label:"Move Down",icon:(0,x.jsx)(l3.default,{})}]]);function ux(e){return(0,x.jsx)(ai.default,{...e,children:(0,x.jsx)("path",{fillRule:"evenodd",d:"M16 2.25c1.995 0 3.542.231 4.53 1.22.989.988 1.22 2.535 1.22 4.53v9c0 1.541-.247 2.808-1.095 3.655-.847.848-2.114 1.095-3.655 1.095H7c-1.542 0-2.808-.247-3.655-1.095C2.497 19.808 2.25 18.541 2.25 17V7c0-1.542.247-2.808 1.095-3.655C4.192 2.497 5.458 2.25 7 2.25h9Zm-9 1.5c-1.458 0-2.192.253-2.595.655C4.003 4.808 3.75 5.542 3.75 7v10c0 1.459.253 2.192.655 2.595.403.402 1.137.655 2.595.655h4.25V3.75H7Zm5.75 16.5H17c1.459 0 2.192-.253 2.595-.655.402-.403.655-1.136.655-2.595V8c0-2.005-.269-2.958-.78-3.47-.512-.511-1.465-.78-3.47-.78h-3.25v16.5Z",clipRule:"evenodd"})})}let uy=new Map([["leftOf",{commandId:lZ.insertPaneGroupUp.id,label:"Insert Left",icon:(0,x.jsx)(as.default,{})}],["rightOf",{commandId:lZ.insertPaneGroupRight.id,label:"Insert Right",icon:(0,x.jsx)(ao.default,{})}],["above",{commandId:lZ.insertPaneGroupLeft.id,label:"Insert Up",icon:(0,x.jsx)(al,{})}],["below",{commandId:lZ.insertPaneGroupDown.id,label:"Insert Down",icon:(0,x.jsx)(aa.default,{})}]]);function uv({paneGroupId:e,paneId:t}){var n;let i,r,a,s,o,l,u=function({paneId:e,paneGroupId:t}){let n=aP(t),i=(0,up.default)(n.isMaximized),r=(0,up.default)(n.isFloating),a=!i&&!r,s=function({paneId:e}){let t=(0,a$.useKeyBindings)(),n=n9(nj);return(0,q.default)(()=>[...uy.entries()].map(([i,{commandId:r,label:a,icon:s}])=>({match:a_.matchLabel,data:{label:a,icon:s,type:"action",keyboardShortcut:t.get(r)?.shortcut??void 0,run:()=>{n({placement:i,paneId:e,autoFocus:!0}),(0,ei.track)(er.events.WORKSPACE,{action:"split_used",placement:i})}}})),[t,n,e])}({paneId:e});return(0,q.default)(()=>a?[{match:a_.matchLabel,data:{type:"context",label:"Add pane",icon:(0,x.jsx)(ux,{})},commands:({active:e,searchQuery:t})=>e||t?s:[]}]:[],[a,s])}({paneId:t,paneGroupId:e}),d=function({paneId:e}){let t=aI(e),n=n3(ns),i=(0,up.default)(t.isFloating),r=!n&&!i,a=n9(nG);return(0,q.default)(()=>{let e=[...ug.entries()].map(([e,{label:t,icon:n}])=>({match:a_.matchLabel,data:{label:t,icon:n,type:"action",run:()=>{a(e)}}}));return r?[{match:a_.matchLabel,data:{type:"context",label:"Move tab",icon:(0,x.jsx)(uf.default,{})},commands:({active:t,searchQuery:n})=>t||n?e:[]}]:[]},[r,a])}({paneId:t}),c=function({paneGroupId:e}){let t=aP(e),n=(0,up.default)(t.isMaximized),i=(0,up.default)(t.isFloating),r=!n&&!i,a=n9(rC);return(0,q.default)(()=>{let e=[...um.entries()].map(([e,{label:t,icon:n}])=>({match:a_.matchLabel,data:{label:t,icon:n,type:"action",run:()=>{a({direction:e})}}}));return r?[{match:a_.matchLabel,data:{type:"context",label:"Move group",icon:(0,x.jsx)(uh.default,{})},commands:({active:t,searchQuery:n})=>t||n?e:[]}]:[]},[r,a])}({paneGroupId:e}),p=function({paneGroupId:e}){let{maximizePaneGroup:t,restoreMaximizedPaneGroup:n}=aT(),i=aP(e),r=(0,up.default)(i.isMaximized),a=n3(t8),s=(0,a$.useKeyCombo)(lZ.toggleMaximizePaneGroup.id);return(0,q.default)(()=>r?a?[]:[{match:a_.matchLabel,data:{type:"action",label:"Restore",icon:(0,x.jsx)(ud.default,{}),run:()=>n(),keyboardShortcut:s}}]:[{match:a_.matchLabel,data:{type:"action",label:"Maximize",icon:(0,x.jsx)(uu.default,{}),run:()=>t({paneGroupId:e}),keyboardShortcut:s}}],[r,s,a,n,t,e])}({paneGroupId:e}),h=function({paneGroupId:e}){let t=n9(nb),n=n9(rS),i=n3(t8),r=(0,a$.useKeyCombo)(lZ.removePaneGroup.id);return(0,q.default)(()=>i?[]:[{match:a_.matchLabel,data:{type:"action",label:"Close",icon:(0,x.jsx)(ui.default,{}),run(){n(),t({paneGroupId:e})},keyboardShortcut:r}}],[n,t,i,r,e])}({paneGroupId:e}),m=function({paneId:e,paneGroupId:t}){let n=n9(rW),i=aP(t),r=(0,up.default)(i.isMaximized),a=(0,up.default)(i.isFloating),s=(0,a$.useKeyCombo)(lZ.toggleFloatPaneGroup.id);return(0,q.default)(()=>r?[]:[{match:a_.matchLabel,data:{type:"action",label:a?"Unfloat":"Float",icon:a?(0,x.jsx)(ar,{}):(0,x.jsx)(oP.default,{}),keyboardShortcut:s,run(){n(e)}}}],[e,n,s,a,r])}({paneId:t,paneGroupId:e}),f=(i=aP((n={paneId:t,paneGroupId:e}).paneGroupId),r=aI(n.paneId),a=aE(n.paneGroupId),s=n7(ty),o=n9(t4),l=(0,up.default)(i.isMaximized),(0,q.default)(()=>l?[]:[{match:a_.matchLabel,data:{type:"action",label:"New window",icon:(0,x.jsx)(uc,{}),run(){let e=(0,t0.v4)(),t=s().filter(([e])=>a.panes.current.includes(e));o({popupId:e,state:{type:"saved",layout:{floating:[],tiling:{id:(0,t0.v4)(),type:"paneGroup",percent:100,activeIndex:a.activeIndex.current,panes:a.panes.current}},data:t.reduce((e,[t,n])=>({...e,[t]:n}),{})}}),window.open(`${window.location.origin+window.location.pathname}?popupId=${e}`,"_blank",`popup=1,height=${r.size.current.height}px,width=${r.size.current.width}px`),(0,ei.track)(er.events.WORKSPACE,{action:"workspace_popout_opened",console:t.some(([e,t])=>"runnerOutput"===t.type),editor:t.some(([e,t])=>"codeEditor"===t.type),shell:t.some(([e,t])=>"shell"===t.type),paneData:t})}}}],[l,a.activeIndex,a.panes,s,o,r.size]));return(0,q.default)(()=>[{data:{type:"group",key:"pane-group"},commands:()=>[...u,...d,...c,...p,...m,...f,...h]}],[u,d,c,p,m,f,h])}var uw=e.i(546284),ub=e.i(429662),uj=e.i(605469);function uS({paneId:e}){let t,n,i,r=function({paneId:e}){let t=(0,aF.usePaneUIContext)(),n=(0,aN.useGetToolPanes)(),i=n9(nX);return(0,v.useCallback)(()=>({data:{type:"context",label:az.toolsCommandLabel,icon:(0,x.jsx)(en.default,{})},commands:()=>n().map(n=>({match:a_.matchLabel,data:{type:"action",label:t.getTitle(n),icon:t.Icon({pane:n}),run:()=>{(0,ei.track)(er.events.TOOL_OPENED,{source:"Tab Menu",tool:n.type}),i({paneId:e,pane:n})}}}))}),[n,t,i,e])}({paneId:e}),a=(t=(0,nC.useGetRecentFiles)(),n=(0,nC.useGetOpenFiles)(),i=n9(nX),(0,v.useCallback)(()=>{let r=n(),a=t().filter(e=>!r.includes(e));return{data:{type:"context",label:"Recent",icon:(0,x.jsx)(ub.default,{})},commands:({searchQuery:t})=>(0,ly.createFileCommands)({paths:a,searchQuery:t,run(t){i({paneId:e,pane:{type:(0,e9.getPaneTypeForFile)({path:t}),data:{path:t}}})}})}},[t,i,e,n])),s=function({paneId:e}){let{fs:t}=(0,sg.default)(),n=n9(nX);return(0,q.default)(()=>({match:a_.matchLabel,data:{type:"context",label:"Files",icon:(0,x.jsx)(om.default,{})},async commands({searchQuery:i,active:r}){if(!i&&!r)return[];let a=await t.listFiles();if(a.error)return[];if(!a.files)throw Error("Expected files");return(0,ly.createFileCommands)({paths:a.files,searchQuery:i,run(t){n({paneId:e,pane:{type:(0,e9.getPaneTypeForFile)({path:t}),data:{path:t}}})}})}}),[t,n,e])}({paneId:e});return(0,q.default)(()=>({match:a_.matchLabel,data:{type:"context",label:"Change tab",icon:(0,x.jsx)(uj.default,{})},commands:({searchQuery:e,active:t})=>e||t?[a(),s,r()]:[]}),[a,r,s])}let uk=(0,l7.css)(au.rcss.center,{fontSize:A.tokens.fontSizeSmall,border:"1px solid",borderColor:A.tokens.outlineDefault,width:20,height:20,marginTop:-2,marginLeft:-2},au.rcss.borderRadius(8));function uC(e){return(0,x.jsx)(V.View,{css:uk,children:(0,x.jsx)(V.View,{css:{lineHeight:1},children:e.count})})}let uT=(0,J.atom)([]);function uE(e,{run:t,enabled:n=!0}){let i=(0,ee.useSetAtom)(uT);(0,v.useEffect)(()=>{if(!n)return;let r=(Array.isArray(e)?e:[e]).map(e=>({shortcut:e,run:t}));return i(e=>[...e,...r]),()=>{i(e=>e.filter(e=>!r.includes(e)))}},[e,t,i,n])}function uI(){let e=(0,ee.useAtomValue)(uT);return(0,v.useEffect)(function(){let t=t=>{for(let{shortcut:n,run:i}of e)!!n.cmdOrCtrlKey==!!(0,l4.getCmdOrCtrl)(t)&&!!n.altKey==!!t.altKey&&!!n.shiftKey==!!t.shiftKey&&n.key?.toLowerCase()===t.key.toLowerCase()&&(t.preventDefault(),i(n))};return document.addEventListener("keydown",t),()=>{document.removeEventListener("keydown",t)}},[e]),null}var uP=e.i(877249);let uA=(0,ie.cssRecord)({overlay:[au.rcss.position.absolute,au.rcss.overflow("hidden"),au.rcss.zIndex(tN.overlay)],surface:[au.rcss.position.relative,au.rcss.borderRadius(8),au.rcss.flex.shrink(1),{maxHeight:"100%",maxWidth:"100%",border:"1px solid",borderColor:A.tokens.outlineDefault,opacity:0},au.rcss.shadow(3)],innerSurface:[au.rcss.borderRadius(8)]}),uR=(0,ie.cssRecord)({root:[{borderTop:"1px solid",borderColor:A.tokens.outlineDimmer}],row:[au.rcss.rowWithGap(2),au.rcss.align.center,au.rcss.justify.spaceBetween]});function uD(){let e=(0,aq.useCmdOrCtrl)();return(0,x.jsxs)(V.View,{css:uR.root,p:8,gap:8,children:[(0,x.jsxs)(V.View,{css:uR.row,children:[(0,x.jsx)(st.Text,{color:"dimmest",variant:"small",multiline:!1,children:"Move focus"}),(0,x.jsxs)(V.View,{row:!0,gap:4,children:[(0,x.jsx)(o9.KeyComboBlocks,{keyCombo:`${e}`,small:!0}),(0,x.jsx)(o9.KeyBlock,{text:(0,x.jsx)(un,{duration:6e3,delay:6e3})})]})]}),(0,x.jsxs)(V.View,{css:uR.row,children:[(0,x.jsx)(st.Text,{color:"dimmest",variant:"small",multiline:!1,children:"Move pane"}),(0,x.jsxs)(V.View,{row:!0,gap:4,children:[(0,x.jsx)(o9.KeyComboBlocks,{keyCombo:`${e}Shift-`,small:!0}),(0,x.jsx)(o9.KeyBlock,{text:(0,x.jsx)(un,{duration:6e3,delay:1500})})]})]})]})}let uV=(0,v.memo)(function(){let e=function(){let e=n3(ns),t=n3(ry);if(!t)return;let{width:n,height:i,transform:r}={width:t.width,height:t.height,transform:`translate(${t.x}px, ${t.y}px)`},a={border:"1px solid",borderColor:A.tokens.accentPrimaryStronger,borderRadius:A.tokens.borderRadius6,boxShadow:A.tokens.shadow3,transitionProperty:"transform, height, width",transitionDuration:uP.TRANSITIONS.duration,transitionTimingFunction:uP.TRANSITIONS.timingFunction};return{width:n,height:i,transform:r,...e?void 0:a}}(),t=n9(rS),n=(0,l5.default)(t,[]);return(0,v.useEffect)(()=>{let e=setTimeout(()=>{(0,l8.styleSet)(n,"opacity","1")});return()=>{clearTimeout(e)}},[n]),(0,x.jsx)(l2.FocusScope,{restoreFocus:!0,autoFocus:!0,contain:!0,children:(0,x.jsx)(V.View,{style:e,css:uA.overlay,p:16,align:"end",children:(0,x.jsx)(R.ShadesSurface,{innerRef:n,css:uA.surface,children:(0,x.jsx)(R.ShadesSurface,{css:uA.innerSurface,grow:!0,shrink:!0,elevate:"2x",children:(0,x.jsx)(uO,{})})})})})}),u_={ArrowUp:"above",ArrowDown:"below",ArrowRight:"rightOf",ArrowLeft:"leftOf"},uM={ArrowUp:"up",ArrowDown:"down",ArrowRight:"right",ArrowLeft:"left"},uF=Object.keys(u_),uO=(0,v.memo)(function(){let e=n9(rk),t=n9(rC),n=n9(rw),i=n3(ns);uE({key:"Escape"},{run(){n()}}),uE(uF.map(e=>({key:e,cmdOrCtrlKey:!0})),{run(t){e(u_[t.key])},enabled:!i}),uE(uF.map(e=>({key:e,cmdOrCtrlKey:!0,shiftKey:!0})),{run(e){t({direction:uM[e.key]})},enabled:!i});let r=n3(rx);return r&&"sidebar"!==r.target?(0,x.jsx)(uL,{paneGroupId:r.paneGroupId,paneId:r.paneId}):null});function uL(e){let t=n3(ns),n=n9(rS),i=n9(rw),r=function({paneGroupId:e,paneId:t}){let n=function({paneId:e,paneGroupId:t}){let n=(0,aF.usePaneUIContext)(),i=aw(e),r=(0,aO.usePaneBindings)(e),a=ul(),s=uo({paneId:e,paneGroupId:t});return(0,q.default)(()=>{let t=n.getTitle(i),o=e=>!!e&&"object"==typeof e&&"data"in e,l=[{data:{type:"group",key:"pane-actions"},commands:()=>(r?.commands?.flatMap(e=>e.commands)??[]).filter(o)},{data:{type:"group",key:"pane-close"},commands:()=>[a(e),...s].filter(o)}];return{match:a_.matchLabel,data:{type:"context",label:t,icon:(0,x.jsx)(n.Icon,{pane:i})},commands:({active:e,searchQuery:t})=>e||t?l:[]}},[i,r,n,e,s,a])}({paneId:t,paneGroupId:e}),i=function({paneGroupId:e,paneId:t}){let n=n3((0,q.default)(()=>(0,J.atom)(e=>{let t=e(e5),n=[],i=[];for(let r of t){let t=r.panes.map(t=>[t,e(e(eJ(t)).dataAtom)]),a="floating"===r.path[0];(a?n:i).push({activeIndex:r.activeIndex,paneGroupId:r.id,isFloating:a,panes:t})}return{floating:n,tiling:i}}),[])),i=(0,aF.usePaneUIContext)(),r=n9(nA),a=n9(nD),s=uS({paneId:t});return(0,q.default)(()=>{let{tiling:t,floating:o}=n,l=t.reduce((e,t)=>e+t.panes.length,0)+o.reduce((e,t)=>e+t.panes.length,0),u={match:a_.matchLabel,data:{type:"action",label:"New tab",icon:(0,x.jsx)(a5.default,{}),run(){a({paneGroupId:e,activate:!0,panes:[{type:"commands",data:{autoFocus:!0}}]})}}};return l?[s,{match:a_.matchLabel,data:{type:"context",label:(0,uw.default)("Tab",l),icon:(0,x.jsx)(uC,{count:l})},commands:({active:e,searchQuery:n})=>{if(!(e||n))return[];let a=[...t,...o].map((e,t)=>({data:{type:"group",key:"paneGroups"+t},commands:()=>e.panes.map(([e,t])=>({match:a_.matchLabel,data:{type:"action",label:i.getTitle(t),icon:(0,x.jsx)(i.Icon,{pane:t}),run(){r({paneId:e,activate:!0})}}}))}));return a.unshift(u),a}}]:[s,u]},[n,i,r,a,e,s])}({paneId:t,paneGroupId:e}),r=uv({paneGroupId:e,paneId:t});return(0,q.default)(()=>({data:{type:"group",key:"root",description:"Search"},commands:()=>[n,...i,...r]}),[n,i,r])}(e);return(0,x.jsx)(aY.CommandBar,{iconBreadcrumbs:!0,command:r,onAction:()=>n(),onKeyDown:(e,{inputValue:t,hasHighlightedItem:n})=>{if("Enter"===e.key&&!t&&!n){e.preventDefault(),i();return}(0,l4.getCmdOrCtrl)(e)&&e.preventDefault()},footer:t?null:(0,x.jsx)(uD,{}),compact:!0})}let uB={id:"paneMenu.toggle",name:"Toggle pane context menu",default:(0,aq.defaultKeyCombo)({cmdOrCtrl:!0,key:"j"})};function uU(){let e=n9(rb),t=n3(rj);return((0,a$.useCommandBinding)(()=>[uB.id,()=>e()],[e]),t)?(0,x.jsx)(uV,{}):null}let uN={id:"sidebar.toggle",name:"Toggle sidebar",description:"Opens or closes the sidebar",default:(0,aq.defaultKeyCombo)({cmdOrCtrl:!0,shift:!0,key:"b"})};var uG=e.i(971465),u$=e.i(159667),uz=e.i(782370),uW=e.i(128068),uH=e.i(682986),uq=e.i(63762),uK=e.i(200119);function uY({isInLayout:e,...t}){let n=(0,lT.useObservable)((0,uK.useAgentIsWorking)()),i=(0,lT.useObservable)((0,uq.useAgentIsWaitingOnUserInput)()),[r,a]=(0,v.useState)(!1);(0,v.useEffect)(()=>{if(!i||n||e)return void a(!1);let t=setTimeout(()=>a(!r),r?1e3:5e3);return()=>{clearTimeout(t)}},[r,i,n,e]);let s=!e&&n||r;return(0,x.jsx)(uH.AgentAvatar,{loading:s,...t})}var uX=e.i(136540),uQ=e.i(918218);let uZ={id:"agent.toggle",name:"Toggle Agent",description:"Opens or closes the Agent",default:(0,aq.defaultKeyCombo)({cmdOrCtrl:!0,shift:!0,key:"i"})};function uJ(){let e=aD(),t=(0,lT.useObservable)(e.displayState),n=(0,lT.useObservable)(e.agentFiletreeOrder),i=(0,uW.useObservableRef)(e.isCollapsed),r=(0,a$.useKeyCombo)(uZ.id),{toggle:a}=e;return(0,a$.useCommandBinding)(()=>[uZ.id,()=>a(!!i.current)],[a,i]),(0,x.jsx)(V.View,{clsx:[uQ.default.root,{[uQ.default.show]:"collapsed"===t,[uQ.default.right]:"filetree-agent"===n}],children:(0,x.jsx)(uX.IconButton,{tooltipContents:r?(0,x.jsx)(o9.KeyComboBlocks,{fontSize:10,keyCombo:r}):null,alt:"Expand Agent",onClick:()=>{e.toggle(!0)},children:(0,x.jsx)(uY,{size:16,isInLayout:!1})})})}let u0=[uZ,uG.switchAgentModeCommand,uN,aX,uB,li,...l0,...oC.editorCommands,...u$.gitCommands,uz.clearOutputsHistoryCommand];var u1=e.i(202266);function u2(e){let t=(0,u1.useSaveKeybindings)();return(0,x.jsx)(aG.KeybindingsProvider,{commands:u0,onChange:t,keybindings:e.keybindings,children:e.children})}var u5=e.i(574831),u4=e.i(135211);function u8({children:e}){let t=(0,q.default)(()=>new oj.StateCache(t2.default.get("stateCache",em.Type.Any())),[]);return(0,x.jsx)(oj.StateCacheContext.Provider,{value:t,children:e})}function u3(){return(0,ok.usePostDeployModal)(),null}function u6({ui:e,repl:t,services:n,userKeybindings:i,children:r}){return(0,x.jsx)(u2,{keybindings:i,children:(0,x.jsx)(aF.PaneUIContextProvider,{value:e,children:(0,x.jsx)(u8,{children:(0,x.jsx)(u5.default.Provider,{value:n,children:(0,x.jsxs)(oS.DeploymentProvider,{replId:t.id,orgId:t.org?.id,container:n.container,fs:n.fs,dotReplit:n.dotReplit,ports:n.ports,secrets:n.secrets,children:[(0,x.jsx)(u3,{}),(0,x.jsx)(lJ.ForkContextProvider,{repl:t,forkParams:{trackingData:{forkSource:"replEnvironmentDesktop"}},children:(0,x.jsx)(os.ExtensionStoreProvider,{children:(0,x.jsx)(u4.default,{children:r})})})]})})})})})}var u9=e.i(736318);let u7=async e=>{if(!(0,u9.hasHash)())return null;let{path:t,line:n,col:i}=await (0,u9.parseHash)(e);return t?{path:t,line:n,col:i}:null};function de(){return!function(){let e,{fs:t}=(0,sg.default)(),n=n3(tn),i=(e=aC(),(0,v.useCallback)(t=>{let n;(0,rt.isMarkdownFile)(t.path.toLowerCase())?n={paneType:"markdown"}:(0,rt.isCsvFile)(t.path.toLowerCase())&&(n={paneType:"csvPreview"}),e({...t,opener:n})},[e])),r=n3(tS),a=(0,v.useRef)(!1);(0,v.useEffect)(function(){if(!r||a.current)return;if(!n){if(!window.location.hash)return;let e=new URL(window.location.href);history.pushState({...history.state,as:e.pathname},document.title,window.location.origin+window.location.pathname+window.location.search);return}let e=(0,u9.deeplinkToHash)({path:n}),t=window.location.hash;if(t.slice(1)===n||t.startsWith(e+":"))return;let i=new URL(window.location.href);i.hash=e,window.history.pushState({...history.state,as:i.pathname+i.hash},"",i)},[n,r]),(0,v.useEffect)(function(){if(!r)return;let e=async()=>{a.current=!0;let e=await u7(t);e&&i(e),a.current=!1};return e(),window.addEventListener("hashchange",e),()=>{window.removeEventListener("hashchange",e)}},[r,t,i])}(),null}var dt=e.i(545082),dn=e.i(375310),di=e.i(557862);function dr(){let e=(0,dn.usePendingDeleteFile)(),t=(0,dn.useSetPendingDeleteFile)(),{fs:n}=(0,sg.default)(),i=()=>{t(null)};return(0,x.jsx)(aK.Modal,{isOpen:!!e,onRequestClose:i,children:e?(0,x.jsx)(di.default,{name:e,description:e,entityType:"file",hideModal:i,delete:()=>{e&&(n.deleteFile(e),t(null))}}):null})}var da=e.i(569910),ds=e.i(134628),dl=e.i(479407),du=e.i(203594),dd=e.i(16499);function dc(){let e,t,n=(0,y.useRouter)(),i=(0,Y.doesBonsaiWebviewSupportFeature)(n,"mobileBridge"),r=aA(),{isSaving:a,isOffline:s}=(0,du.default)(),o=(0,v.useRef)(null),l=(0,dd.useSetAppKeyboardState)(),u=aS(),d=aH(),{runState:c,toggleRunState:p}=(e=(0,lk.useWorkflowsRunner)(),t=(0,lk.useOnToggleRun)(),{runState:(0,v.useMemo)(()=>e?e.step:lm.RunState.OFFLINE,[e]),toggleRunState:(0,v.useCallback)(()=>{t()},[t])}),h=(0,v.useCallback)(e=>{(0,dl.workspaceBridgeMessageHandler)(e,e=>{let t=e.type;switch(t){case ds.BridgeMessageType.SET_KEYBOARD_STATE:l(e.keyboardState);break;case ds.BridgeMessageType.WORKSPACE_REQUEST_ACTION:var n=e.action;switch(n){case ds.BridgeWorkspaceAction.OPEN_FILETREE:r.toggleContent("filetree");break;case ds.BridgeWorkspaceAction.TOGGLE_RUN_STATE:p();break;case ds.BridgeWorkspaceAction.TOGGLE_ALLPANES:d();break;case ds.BridgeWorkspaceAction.OPEN_NEW_PANE:case ds.BridgeWorkspaceAction.TOGGLE_DRAWER:break;default:(0,da.default)(n)}break;case ds.BridgeMessageType.WORKSPACE_REQUEST_OPEN_PANE:(({type:e,messageId:t})=>{try{"ghostwriterChat"===e?u({pane:{type:"agentChat"}}):u({pane:{type:e}})}catch(e){(0,dl.sendErrorMessage)(t)}})({messageId:e.id,type:e.paneType});break;default:(0,da.default)(t)}})},[p,l,u,d,r]);return(0,v.useEffect)(()=>{if(!i)return;let e={messageType:ds.BridgeMessageType.WORKSPACE_STATE,isDrawerOpen:!1,isShowingAllPanes:!0,isSaving:a,isOffline:s,runState:c,activePaneType:null,activePaneFilePath:null,isInAgentMode:!1,insets:{top:0,bottom:0}},t=o.current;return(null==t||JSON.stringify(e)!==JSON.stringify(t))&&((0,dl.sendMessage)(e,(0,t0.v4)()),o.current=e),window.addEventListener("message",h),()=>{window.removeEventListener("message",h)}},[i,h,c,a,s,o]),null}var dp=e.i(545150),dh=e.i(269848),dm=e.i(830675),df=e.i(718398),dg=e.i(82259),dx=e.i(924908),dy=e.i(852155),dv=e.i(299798),dw=e.i(112942),db=e.i(45442),dj=e.i(399144),dS=e.i(28432),dk=e.i(576779);function dC({text:e,progress:t}){let n=Math.floor(100*t);return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)(V.View,{row:!0,align:"center",justify:"center",gap:8,style:{cursor:"not-allowed"},children:[(0,x.jsx)(dh.default,{}),(0,x.jsx)(st.Text,{children:e})]}),(0,x.jsx)(V.View,{clsx:dk.default.progressBarContainer,children:(0,x.jsx)(V.View,{clsx:dk.default.progressBarTrack,children:(0,x.jsx)(V.View,{clsx:dk.default.progressBarFill,style:{width:`${n}%`}})})}),(0,x.jsx)(V.View,{justify:"center",align:"center",children:(0,x.jsxs)(st.Text,{variant:"small",color:"dimmer",children:[n,"%"]})})]})}function dT({errorMessage:e}){return(0,x.jsxs)(V.View,{align:"center",gap:8,children:[(0,x.jsx)(st.Text,{children:e}),(0,x.jsx)(st.Text,{children:"Please try again or contact support"}),(0,x.jsx)(oK.default,{href:"/~",children:(0,x.jsx)(st.Text,{children:"Return to Home"})})]})}function dE({onClick:e}){return(0,x.jsxs)(V.View,{align:"center",gap:16,children:[(0,x.jsx)(st.Text,{children:"You must login again to continue importing"}),(0,x.jsx)(se.Button,{text:"Reconnect to Figma",onClick:e,colorway:"primary",iconRight:(0,x.jsx)(lo.default,{})})]})}function dI(){let e,t=(0,y.useRouter)(),n=function(){let e=(0,a9.default)(),[t]=(0,df.useUpdateReplForFigmaImportMutation)(),[n]=(0,df.useGetFigmaIntermediateTokenMutation)(),[i,r]=(0,v.useState)({status:"not_started"}),[a,s]=(0,v.useState)(0),{data:o,loading:l}=(0,df.useFigmaImportFlowQuery)({variables:{replId:e}}),u=!l&&o&&"Repl"===o.getRepl.__typename&&o.getRepl.config.figmaImportStatus===lQ.FigmaImportStatus.Started?o.getRepl.config.figmaUrl:null,d=function(e){let t=o6(),n=(0,dx.useChatter)(),i=(0,v.useRef)(!1),{settings:r}=(0,db.useAgentSettings)(),a=(0,X.useQueryParam)("initialQueuedPromptKey","string"),s=(0,at.default)(e);return(0,v.useCallback)(async()=>{if(i.current)return;i.current=!0;let e=await n.sessions.create({sessionType:dg.SessionType.AGENT_SESSION});if(!e.ok)throw Error("Failed to create Agent session");t({type:"agentChat",data:{sessionId:e.payload.id}});let o=e.payload;await o.appendEvent({kind:"setupImportedProject",importSource:dg.ProjectImportSource.PROJECT_IMPORT_SOURCE_FIGMA,agentConfig:(0,dw.convertAgentSettingsFromGQLToAiChat)(r)});let l=`initial_queued_prompt_${a}`,u=t2.default.get(l,"string");if(!u)return;t2.default.remove(l);let d=u,c=s.current;c&&(d=d.replaceAll(c,"")+`

(Figma URL: ${c} has already been imported.)`),await o.appendEvent({kind:"message",intent:dg.MessageAction.AGENT,message:d})},[n,t,a,s,r])}(u??null),c=(0,v.useCallback)(async({errorMessage:n})=>{r({status:"error",errorMessage:n}),await t({variables:{input:{id:e,figmaImportStatus:lQ.FigmaImportStatus.Failed}}})},[e,t]);return((0,dv.usePid2)(async(i,{signal:a})=>{let o;if(!u)return;let{data:l}=await n({variables:{input:{figmaUrl:u}}});if(l?.getFigmaIntermediateToken.__typename==="NoOAuthFoundError")return void r({status:"needs_auth",retryAuth:()=>s(e=>e+1)});if(l?.getFigmaIntermediateToken.__typename==="InvalidFigmaUrlError"||l?.getFigmaIntermediateToken.__typename==="FigmaRateLimitError"){dm.captureException(l.getFigmaIntermediateToken,{extra:{replId:e,figmaUrl:u}}),E.logger.error("Failed to get Figma intermediate token",{repl:e,figmaUrl:u,payload:l.getFigmaIntermediateToken}),c({errorMessage:l.getFigmaIntermediateToken.message});return}let p=l?.getFigmaIntermediateToken;if(!p||"FigmaImportIntermediateToken"!==p.__typename){E.logger.error("Failed to get Figma intermediate token",{repl:e,figmaUrl:u,payload:l}),c({errorMessage:"Something went wrong while authenticating. Please try again."});return}let h=p.token;r(e=>"in_progress"===e.status?e:{status:"in_progress",progress:0,text:"Preparing Figma import..."});let m=await i.figmaImport.startImport.rpc({intermediateToken:h},{signal:a});if(!m.ok){let e=m.payload.code;switch(e){case"INVALID_REQUEST":case"UNCAUGHT_ERROR":c({errorMessage:m.payload.message||"Something went wrong while importing. Please try again."});return;case"UNEXPECTED_DISCONNECT":case"CANCEL":return;default:(0,da.default)(e)}}let{resReadable:f}=i.figmaImport.status.subscribe({},{signal:a});for await(let t of f){if(!t.ok){let n=t.payload.code;switch(n){case"FIGMA_TOKEN_EXPIRED":case"FIGMA_INVALID_TOKEN":r({status:"needs_auth",retryAuth:()=>s(e=>e+1)});return;case"FIGMA_NODE_NOT_FOUND":c({errorMessage:"The selected Figma component could not be found, please ensure you have selected a frame and copied the link to the frame."});return;case"FIGMA_FILE_NOT_FOUND":c({errorMessage:"The Figma file could not be accessed, please ensure the linked account has permissions to access the frame."});return;case"FIGMA_SELECTION_TOO_LARGE":c({errorMessage:"Your Figma selection is too large to process, please make sure you have selected a single frame."});return;case"FIGMA_RATE_LIMIT_EXCEEDED":c({errorMessage:"Too many requests. Please wait a moment and try again."});return;case"NO_CODE_GENERATED":c({errorMessage:"No code could be generated from your frame. Please try a different link."});return;case"TIMEOUT":c({errorMessage:"The import took too long. Please try again, or try a smaller component."});return;case"FIGMA_NODE_NOT_SUPPORTED":c({errorMessage:"The selected Figma component is not supported. Please make sure you have selected a frame and copied the link to the frame."});return;case"FIGMA_PAGE_WITH_MULTIPLE_CHILDREN":c({errorMessage:"The selected Figma page has multiple children. Please make sure you have selected a single frame."});return;case"FIGMA_PAGE_WITH_NO_VALID_CHILDREN":c({errorMessage:"The selected Figma page doesn't have any content we can convert to code. Please make sure you've selected a page with visible designs then try again."});return;case"INVALID_REQUEST":case"UNKNOWN":case"UNCAUGHT_ERROR":c({errorMessage:t.payload.message||"Something went wrong while importing. Please try again."});return;case"NOT_STARTED":E.logger.error("Figma Import: Failed to import from Figma",{repl:e,figmaUrl:u,payload:t.payload}),dm.captureException(Error("Figma import: not started"),{extra:{replId:e,figmaUrl:u,payload:t.payload}}),c({errorMessage:t.payload.message||"Something went wrong while importing. Please try again."});return;case"READABLE_BROKEN":case"CANCEL":case"UNEXPECTED_DISCONNECT":return;default:(0,da.default)(n)}}let n=t.payload;"progress"===n.kind?r(e=>"in_progress"===e.status&&e.progress>=n.number?e:{status:"in_progress",progress:n.number,text:n.statusText}):"success"===n.kind&&(o=function({file:e,frame:t}){let n=`${e} (${t})`;if(n.length<=dy.maxTitleLength)return n;let i=dy.maxTitleLength-3;if(e.length<=i-1){let n=i-e.length,r=t.length>n?t.substring(0,n-1)+"":t;return`${e} (${r})`}let r=i-Math.min(t.length,10),a=e,s=t;e.length>r&&(a=e.substring(0,r-1)+"");let o=i-a.length;return t.length>o&&(s=t.substring(0,o-1)+""),`${a} (${s})`}({file:n.figmaFileName,frame:n.figmaSelectedFrameName}))}r({status:"in_progress",progress:1,text:"Creating checkpoint"});let g=await i.git.init.rpc({initialCommit:!0,includeAllInitialFiles:!0},{signal:a});if(!g.ok)switch(g.payload.code){case"CANCEL":case"UNEXPECTED_DISCONNECT":return;default:dm.withScope(e=>{e.setExtra("gitInitError",g.payload),dm.captureException(Error("figma import: git init failed"))})}r({status:"in_progress",progress:1,text:"Handing off to Agent"}),await d(),await t({variables:{input:{id:e,title:o,makeTitleUnique:!0,figmaImportStatus:lQ.FigmaImportStatus.Completed}}}),(0,ei.track)(er.events.FIGMA_IMPORT_USED,{action:"completed"}),(0,ei.track)(er.events.IMPORT,{action:"import_success",import_type:"figma"}),r({status:"success"})},[u,e,t,d,a,n,c]),o&&"Repl"===o.getRepl.__typename&&o.getRepl.config.figmaImportStatus===lQ.FigmaImportStatus.Failed&&"not_started"===i.status)?{status:"error",errorMessage:"Something went wrong"}:i}();return"not_started"===n.status||"success"===n.status?null:("in_progress"===n.status?e=(0,x.jsx)(dC,{text:n.text,progress:n.progress}):"error"===n.status?e=(0,x.jsx)(dT,{errorMessage:n.errorMessage}):"needs_auth"===n.status&&(e=(0,x.jsx)(dE,{onClick:()=>{t.push("/integrations")}})),(0,x.jsx)(dj.Portal,{children:(0,x.jsx)(V.View,{clsx:dk.default.overlay,style:{cursor:"in_progress"===n.status?"wait":"default"},children:(0,x.jsx)(dp.default,{children:(0,x.jsxs)(V.View,{clsx:dk.default.animationWrapper,tabIndex:-1,children:[(0,x.jsxs)(V.View,{align:"center",gap:16,children:[(0,x.jsx)(dS.Figma2ReplitIcons,{}),(0,x.jsx)(st.Text,{multiline:!1,variant:"subheadBig",dataCy:"figma-lock-screen",children:"Importing from Figma..."})]}),(0,x.jsx)(V.View,{pt:16,px:16,gap:4,children:e})]})})})}))}var dP=e.i(368242),dA=e.i(195680),dR=e.i(119322);function dD(){let[e,t]=(0,v.useState)(!1),[n,i]=(0,v.useState)({status:"not_started"}),r=o6(),a=(0,dA.useSetGitProviderImportMode)(),{detectedGitProvider:s}=(0,dP.useDoGitProviderImportFlow)({setConfigScreenLockIsOpen:t,openPane:r,onStatusChange:i});if((0,v.useEffect)(()=>e?(a(s),()=>{a(null)}):void a(null),[e,a,s]),!e)return null;let o="Importing";return"in_progress"===n.status?o=n.text:"error"===n.status&&(o=`Import failed: ${n.errorMessage}`),(0,x.jsx)(dR.default,{reason:o})}var dV=e.i(882848),d_=e.i(600962),dM=e.i(649960),dF=e.i(332441),dO=e.i(418725),dL=e.i(188019),dB=e.i(492267),dU=e.i(12558),dN=e.i(659790),dG=e.i(179104),d$=e.i(740616),dz=e.i(828322),dW=e.i(381010),dH=e.i(629756),dq=e.i(6338);let dK=(0,ie.cssRecord)({container:[au.rcss.position.relative],loadingGeneratedIcon:[dq.loadingStyle.foregroundPulse(A.tokens.blurpleDimmest,A.tokens.blurpleDefault),au.rcss.borderRadius()]});function dY({replId:e,replIconUrl:t,size:n=20,alt:i=""}){let{loading:r,generatedIconUrl:a}=(0,dH.usePollForGeneratedReplIcon)({replId:e,replIconUrl:t});return(0,x.jsx)(V.View,{css:dK.container,children:(0,x.jsx)(V.View,{css:r&&dK.loadingGeneratedIcon,children:(0,x.jsx)(o1.default,{iconUrl:a||t,size:n,alt:i})})})}var dX=e.i(341727),dQ=e.i(751273);let dZ=(0,ie.cssRecord)({metadata:[],iconWrapper:[au.rcss.position.relative],dimIcon:[{opacity:.2}],diconnectedIcon:[au.rcss.position.absolute,{left:0,right:0,top:0,bottom:0,margin:"auto"}],title:[au.rcss.flex.shrink(1),au.rcss.truncate],placeholderTitle:[au.rcss.width(100),au.rcss.borderRadius("default"),{alignSelf:"stretch"},dq.loadingStyle.foregroundPulse(A.tokens.backgroundDefault,A.tokens.backgroundHigher)]});function dJ({repl:e,hideTitle:t}){let{didDisconnect:n}=(0,dX.default)();return(0,x.jsxs)(V.View,{grow:!0,shrink:!0,row:!0,gap:6,align:"center",children:[(0,x.jsxs)(V.View,{css:dZ.iconWrapper,children:[e.project?.id?(0,x.jsx)(x.Fragment,{children:t?(0,x.jsx)(dz.default,{}):null}):(0,x.jsx)(V.View,{css:n&&dZ.dimIcon,children:(0,x.jsx)(dY,{replId:e.id,replIconUrl:e.iconUrl,size:16})}),n?(0,x.jsx)(dQ.Tooltip,{tooltip:"Reconnecting",children:(0,x.jsx)(dW.default,{size:16,css:dZ.diconnectedIcon})}):null]}),t?null:(0,x.jsx)(st.Text,{multiline:!1,css:dZ.title,"data-cy":"header-repl-title",color:n?"dimmer":"default",translate:"no",children:e.title})]})}var d0=e.i(754873),d1=e.i(604963);let d2=(0,ie.cssRecord)({popover:[au.rcss.maxWidth(460),au.rcss.width("100%")],button:[d0.interactive.nofill,au.rcss.height(28),au.rcss.flex.growAndShrink(1),au.rcss.align.center,au.rcss.rowWithGap(4),au.rcss.px(6),au.rcss.borderRadius(),au.rcss.color.foregroundDefault,{'&[aria-expanded="true"]':{backgroundColor:A.tokens.interactiveBackgroundActive}}]});function d5({repl:e,getDesktopLayoutState:t,hideTitle:n}){let[i,r]=(0,v.useState)(!1),a=function(){let e=(0,Y.useDoesBonsaiSupportFeature)("simplifiedTabletUI"),t=(0,v.useCallback)(()=>{e&&(0,dl.sendMessage)({messageType:ds.BridgeMessageType.SHOW_REPL_INFO},(0,dG.nanoid)())},[e]);if(e)return t}();return(0,Y.useIsInBonsaiWebview)()?(0,x.jsx)(V.View,{css:d2.button,onClick:a,children:(0,x.jsx)(dJ,{repl:e,hideTitle:n})}):(0,x.jsxs)(d1.PopoverTrigger,{isOpen:i,onOpenChange:e=>{r(e),e&&(0,ei.track)(er.events.MODAL_VIEWED,{modal_name:"repl_metadata_popover"})},placement:"bottom start",label:"Repl info",css:d2.popover,children:[(0,x.jsx)(V.SpecializedView.button,{dataCy:"ws-repl-info-container",css:d2.button,onClick:()=>{(0,ei.track)(er.events.WORKSPACE,{action:"repl_metadata_opened"})},"aria-expanded":i,children:(0,x.jsx)(dJ,{repl:e,hideTitle:n})}),(0,x.jsx)(d$.default,{getDesktopLayoutState:t,setIsEditing:r})]})}var d4=e.i(397747),d8=e.i(312087);let d3={},d6=w.gql`
    fragment ReplInfoEditFormRepl on Repl {
  ...EditReplFormRepl
  id
  title
  description
  isPrivate
  iconUrl
  publishedAs
  templateLabel
  org {
    id
    type
  }
  templateInfo {
    iconUrl
  }
  authorizations {
    editMetadata {
      isAuthorized
      message
    }
    editVisibility {
      isAuthorized
      code
      message
    }
    editTemplateMetadata {
      isAuthorized
      message
    }
  }
}
    ${d8.EditReplFormReplFragmentDoc}`,d9=w.gql`
    mutation ReplInfoEditFormUpdateRepl($input: UpdateReplInput!) {
  updateRepl(input: $input) {
    repl {
      id
      ...ReplInfoEditFormRepl
    }
  }
}
    ${d6}`;var d7=e.i(429190),ce=e.i(781621),ct=e.i(549194);let cn={},ci=w.gql`
    fragment ReplInfoDropdownMenuOrgFragment on Org {
  id
  name
  image
  slug
  type
}
    `,cr=w.gql`
    fragment ReplInfoDropdownMenuUserFragment on User {
  id
  username
  image
  url
}
    `,ca=w.gql`
    fragment ReplInfoMenuItemsRepl on Repl {
  id
  isPrivate
  isRenamed
  isFeaturedRepl
  publishedAs
  org {
    id
    type
  }
  authorizations {
    editMetadata {
      isAuthorized
    }
    fork {
      isAuthorized
    }
    publish {
      isAuthorized
    }
    deleteRepl {
      isAuthorized
    }
  }
}
    `,cs=w.gql`
    fragment ReplInfoDropdownMenuItemsRepl on Repl {
  id
  url
  slug
  config {
    isServer
  }
  org {
    ...ReplInfoDropdownMenuOrgFragment
  }
  user {
    ...ReplInfoDropdownMenuUserFragment
  }
  owner {
    __typename
    ... on Team {
      id
      username
    }
    ... on User {
      id
      username
      isSubscribed
    }
  }
  ...ReplInfoMenuItemsRepl
  ...HandleRemixRepl
  ...ReplInfoEditFormRepl
  ...FeaturedReplPreviewRepl
  ...BulkDeleteConfirmationModalRepl
  ...PublishReleaseFormRepl
}
    ${ci}
${cr}
${ca}
${d4.HandleRemixReplFragmentDoc}
${d6}
${d7.FeaturedReplPreviewReplFragmentDoc}
${ce.BulkDeleteConfirmationModalReplFragmentDoc}
${ct.PublishReleaseFormReplFragmentDoc}`,co=w.gql`
    query ReplInfoDropdownMenuQuery($replId: String!) {
  getRepl(id: $replId) {
    ... on Repl {
      id
      ...ReplInfoDropdownMenuItemsRepl
    }
  }
}
    ${cs}`,cl=w.gql`
    mutation ReplInfoDropdownMenuDeleteRepl($id: String!) {
  deleteRepl(id: $id) {
    id
  }
}
    `,cu=w.gql`
    mutation ReplInfoDropdownMenuUnpublishTemplate($input: DeleteReplDeploymentInput!) {
  deleteReplDeployment(input: $input) {
    ... on Repl {
      id
      publishedAs
    }
    ... on UserError {
      message
    }
    ... on NotFoundError {
      message
    }
  }
}
    `;var cd=e.i(204977),cc=e.i(979530),cp=e.i(113388),ch=e.i(908628),cm=e.i(541792),cf=e.i(173993),cg=e.i(491194),cx=e.i(220578),cy=e.i(213733),cv=e.i(341126),cw=e.i(773240),cb=e.i(598801),cj=e.i(157584),cS=e.i(905282),ck=e.i(674918),cC=e.i(761655),cT=e.i(416298),cE=e.i(322823),cI=e.i(236379),cP=e.i(420802);let cA={},cR=w.gql`
    mutation ReplInfoReplIconUpdate($input: UpdateReplInput!) {
  updateRepl(input: $input) {
    repl {
      id
      iconUrl
    }
  }
}
    `;var cD=e.i(349597),cV=e.i(422025),c_=e.i(971072),cM=e.i(965710),cF=e.i(418944);function cO({replId:e,authz:t,initialIconUrl:n,originIconUrl:i}){var r;let a,{showError:s,showConfirm:o}=(0,sr.default)(),[l,u]=(0,v.useState)(n),d=(0,v.useRef)(null),[c,{loading:p}]=(r={onError:()=>{s("Something unexpected happened")},onCompleted:e=>{e.updateRepl.repl&&o("App icon updated successfully")}},a={...cA,...r},U.useMutation(cR,a)),h=l!==i,m=(0,cV.default)({onUpload:async({url:t})=>{await c({variables:{input:{id:e,iconUrl:t}}}),u(t),d.current&&(URL.revokeObjectURL(d.current),d.current=null)},onUploadPreview:()=>{o("Uploading App icon")},onError:e=>s(e.message)});(0,v.useEffect)(()=>{u(n)},[n]),(0,v.useEffect)(()=>()=>{d.current&&URL.revokeObjectURL(d.current)},[]);let f=e=>{d.current&&URL.revokeObjectURL(d.current);let t=URL.createObjectURL(e);d.current=t,u(t),m.uploadImage(e,cD.ImageUploadContexts.ReplIcon)},g=async e=>{let t=e.items.filter(e=>"file"===e.kind).map(e=>e.getFile()),n=(await Promise.all(t)).filter(e=>null!==e);if(n.length>0){let e=n[0];if(!c_.ACCEPTABLE_IMAGE_UPLOAD_TYPES.includes(e.type))return void s("Only PNG, JPEG, GIF, and WebP images are supported");f(e)}};return t.isAuthorized?(0,x.jsxs)(V.View,{gap:4,children:[(0,x.jsx)(st.Text,{variant:"small",color:"dimmer",multiline:!1,children:"Icon"}),(0,x.jsx)(cM.FileUploadInput,{onSelect:e=>{if(e&&e.length>0){let t=e[0];if(!c_.ACCEPTABLE_IMAGE_UPLOAD_TYPES.includes(t.type))return void s("Only PNG, JPEG, GIF, and WebP images are supported");f(t)}},onDrop:g,acceptedFileTypes:c_.ACCEPTABLE_IMAGE_UPLOAD_TYPES,children:(0,x.jsxs)(V.View,{row:!0,gap:12,align:"start",children:[(0,x.jsx)(cF.default,{alt:"",size:48,iconUrl:l??""}),(0,x.jsxs)(V.View,{gap:4,align:"start",children:[(0,x.jsx)(se.Button,{text:h?"Upload new":"Upload icon",size:"small",loading:p}),(0,x.jsx)(st.Text,{variant:"small",color:"dimmer",children:"Icon should be square"})]})]})})]}):(0,x.jsxs)(V.View,{gap:4,children:[(0,x.jsx)(st.Text,{variant:"small",color:"dimmer",multiline:!1,children:"Icon"}),(0,x.jsxs)(V.View,{row:!0,gap:12,align:"start",children:[(0,x.jsx)(cF.default,{alt:"",size:48,iconUrl:l??""}),(0,x.jsxs)(V.View,{gap:4,align:"start",children:[(0,x.jsx)(dQ.Tooltip,{tooltip:"Not allowed to update icon",children:(0,x.jsx)(se.Button,{text:h?"Upload new":"Upload icon",disabled:!0,size:"small"})}),(0,x.jsx)(st.Text,{variant:"small",color:"dimmer",children:"Icon should be square"})]})]})]})}var cL=e.i(607278),cB=e.i(963786);let cU=e=>{let t=e.trim();return 0===t.length?{message:"Please enter a name"}:t.length>60?{message:"Name must be 60 characters or less"}:void 0},cN=e=>{if(e.length>cP.REPL_DESCRIPTION_MAX_LENGTH)return{message:`Description must be ${cP.REPL_DESCRIPTION_MAX_LENGTH} characters or less`}};function cG({message:e,id:t}){return(0,x.jsxs)(V.View,{id:t,row:!0,gap:4,align:"center",children:[(0,x.jsx)(cT.default,{clsx:cB.default.validationIcon}),(0,x.jsx)(V.View,{grow:!0,shrink:!0,children:(0,x.jsx)(st.Text,{variant:"small",clsx:cB.default.validationText,children:e})})]})}function c$({repl:e,onClose:t}){var n;let i,{showConfirm:r,showError:a}=(0,sr.default)(),{show:s}=(0,oB.useGlobalModal)(),[o,{loading:l}]=(n={onError:e=>{a(e.message)}},i={...d3,...n},U.useMutation(d9,i)),u=(0,cE.useFormField)(e.title,cU),d=(0,cE.useFormField)(e.description??"",cN),[c,p]=(0,v.useState)(e.templateLabel),[h,m]=(0,v.useState)(!1),f=e.title,g=e.description??"",y=e.templateLabel,w=e.publishedAs===lQ.PublishedReplKind.Template,b=(0,v.useId)(),j=(0,v.useId)(),S=(0,v.useId)(),k=(0,v.useId)(),C=(0,v.useId)(),T=!!u.error||!!d.error,E=u.value!==f||d.value!==g||c!==y,I=async()=>{if(!l&&null==u.validate()&&null==d.validate())try{await o({variables:{input:{id:e.id,title:u.value.trim(),description:d.value,templateLabel:e.authorizations.editTemplateMetadata.isAuthorized?c:void 0}}}),r("App details updated"),t?.()}catch(e){}},P=async t=>{if(!l){if(e.authorizations.editVisibility.isAuthorized||!1===t){try{await o({variables:{input:{id:e.id,isPrivate:t}},optimisticResponse:{__typename:"RootMutationType",updateRepl:{__typename:"UpdateReplPayload",repl:{...e,isPrivate:t}}}}),r("Visibility updated")}catch(e){}return}e.authorizations.editVisibility.code===lQ.ReplAuthorizationCode.RequiresActiveSubscription&&e.org?.__typename!=="Org"?await s("MembershipPurchaseModal",{analyticsContext:{upgrade:{context:"workspace_info_modal"}}}):a(e.authorizations.editVisibility.message)}},A=e.org?.type!=="team"&&(e.authorizations.editVisibility.isAuthorized||e.authorizations.editVisibility.code===lQ.ReplAuthorizationCode.RequiresActiveSubscription),R=e.org?.type==="team";return(0,x.jsxs)(V.View,{gap:16,children:[(0,x.jsx)(cO,{replId:e.id,authz:e.authorizations.editMetadata,initialIconUrl:e.iconUrl,originIconUrl:e.templateInfo?.iconUrl??e.iconUrl}),(0,x.jsxs)(V.View,{gap:4,children:[(0,x.jsx)("label",{htmlFor:b,children:(0,x.jsx)(st.Text,{variant:"small",color:"dimmer",multiline:!1,children:"Name"})}),(0,x.jsx)(cL.Input,{disabled:!e.authorizations.editMetadata.isAuthorized,maxLength:60,value:u.value,onChange:e=>u.setValue(e.target.value),onFocus:()=>m(!0),spellCheck:!1,id:b,"aria-describedby":j,dataCy:"ws-repl-info-title-input"}),u.value.length>=60?(0,x.jsx)(cG,{message:"You've reached the 60 character limit"}):null,u.error?(0,x.jsx)(cG,{message:u.error.message,id:j}):null]}),(0,x.jsxs)(V.View,{gap:4,children:[(0,x.jsx)("label",{htmlFor:S,children:(0,x.jsx)(st.Text,{variant:"small",color:"dimmer",multiline:!1,children:"Description"})}),(0,x.jsx)(cL.MultiLineInput,{disabled:!e.authorizations.editMetadata.isAuthorized,maxLength:cP.REPL_DESCRIPTION_MAX_LENGTH,value:d.value,onChange:e=>d.setValue(e.target.value),onFocus:()=>m(!0),placeholder:"What does this App do?",autoSize:!0,id:S,"aria-describedby":k}),d.value.length>=cP.REPL_DESCRIPTION_MAX_LENGTH?(0,x.jsx)(cG,{message:`You've reached the ${cP.REPL_DESCRIPTION_MAX_LENGTH} character limit`}):null,d.error?(0,x.jsx)(cG,{message:d.error.message,id:k}):null]}),w&&e.authorizations.editTemplateMetadata.isAuthorized?(0,x.jsxs)(V.View,{gap:4,children:[(0,x.jsx)("label",{htmlFor:C,children:(0,x.jsx)(st.Text,{variant:"small",color:"dimmer",multiline:!1,children:"Template label"})}),(0,x.jsx)(cL.Input,{value:c,maxLength:60,placeholder:"Template label",spellCheck:!1,onChange:e=>p(e.target.value),onFocus:()=>m(!0),id:C})]}):null,h?(0,x.jsx)(V.View,{row:!0,gap:8,justify:"end",children:(0,x.jsx)(se.Button,{text:"Save changes",colorway:"primary",onClick:I,disabled:l||T||!E||!e.authorizations.editMetadata.isAuthorized,iconLeft:l?(0,x.jsx)(dh.default,{}):void 0,dataCy:"repl-info-save-changes-button"})}):null,A?(0,x.jsxs)(V.View,{gap:4,align:"start",children:[(0,x.jsx)(st.Text,{variant:"small",color:"dimmer",multiline:!1,children:"Visibility"}),(0,x.jsx)(cI.PrivacyToggle,{isPrivate:e.isPrivate,onChange:P,isTeam:R})]}):null]})}var cz=e.i(714165),cW=e.i(119274),cH=e.i(624782),cq=e.i(185591),cK=e.i(355778);function cY({user:e,org:t,isInDesktopApp:n}){let i;if(!e&&!t)return null;if(t)i=(0,cv.orgLinks)(t).repls;else{if(!e)return null;i=(0,ck.userLinkProps)(e)}let r=()=>{let t="";"string"==typeof i.as?t=i.as:"string"==typeof i.href?t=i.href:e?.url&&(t=e.url),oM.desktopAppApi.openExternalUrl(t)};return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(cW.Separator,{}),(0,x.jsx)(cW.MenuItem,{label:"Created by",isDisabled:!0,labelProps:{variant:"small"}}),e&&t?(0,x.jsxs)(cW.BaseMenuItem,{textValue:`${e.username}  ${t.name}`,...!n&&{href:i.href,as:i.as},onAction:n?r:void 0,children:[(0,x.jsx)(V.View,{gap:4,grow:!0,children:(0,x.jsx)(st.Text,{children:e.username})}),(0,x.jsx)(cH.Pill,{iconLeft:(0,x.jsx)(cz.Avatar,{src:t.image??null,username:t.name,fullName:t.name,size:16}),text:t.name})]}):(0,x.jsx)(cW.MenuItem,{label:e?e.username:t?.name??"",icon:(0,x.jsx)(cz.Avatar,{src:e?.image??t?.image??null,username:e?.username??t?.name??"",fullName:t?.name,size:24}),...!n&&{href:i.href,as:i.as},onAction:n?r:void 0})]})}function cX({repl:e,loading:t,onDialogOpen:n}){let i=(0,W.default)(),{handleRemix:r,isCreatingProjectFork:a}=(0,cC.useHandleRemix)({repl:e}),s=function({repl:e,isCreatingProjectFork:t,loading:n}){let i=(0,W.default)(),r=(0,H.useFlag)({controlName:cx.flagTransferRepl,logFlagToAnalytics:!1}),a=(0,H.useFlag)({controlName:"flag-silent-podium",logFlagToAnalytics:!1}),s=[],o=[],l=[];if(!e)return[];let u=e.org?.type===lQ.OrgstypeEnumType.Team,d=e.publishedAs===lQ.PublishedReplKind.Template,c=!!e.publishedAs;s.push({value:"EditAppDetails",label:"Edit app details",icon:(0,x.jsx)(cd.default,{}),isDisabled:n||!e.authorizations.editMetadata.isAuthorized,description:e.isPrivate?"Only you can see and edit this App":void 0,dataCy:"repl-info-edit-app-details"}),e.authorizations.fork.isAuthorized&&s.push({value:"Remix",label:"Remix",icon:t?(0,x.jsx)(dh.default,{}):(0,x.jsx)(cp.default,{}),isDisabled:t}),i||s.push({value:"CoverPage",label:"Cover page",icon:(0,x.jsx)(oI.default,{}),isDisabled:n});let p=e.authorizations.publish.isAuthorized;if(!i&&!u&&p){let t=e.isPrivate||!e.isRenamed,n="";e.isPrivate?n="Make App public to publish":e.isRenamed||(n="Rename App to publish"),null!=e.publishedAs||a||o.push({value:"PublishTemplate",label:"Publish as Template",icon:(0,x.jsx)(cf.default,{}),isDisabled:t,description:n,dataCy:"repl-info-header-settings-publish"}),d&&!t&&(o.push({value:"UpdatePublishedTemplate",label:"Publish template changes",icon:(0,x.jsx)(oN.default,{})}),o.push({value:"UnpublishTemplate",label:"Unpublish Template",icon:(0,x.jsx)(cc.default,{})})),c&&!t&&o.push({value:"EditPublishedTemplateSettings",label:"Edit Template publish settings",icon:(0,x.jsx)(cd.default,{})})}return u&&o.push({value:"FeatureRepl",label:e.isFeaturedRepl?"Remove from Featured Apps":"Feature on Profile",icon:(0,x.jsx)(ch.default,{}),description:e.isPrivate?"Make App public to feature":void 0,isDisabled:e.isPrivate}),e.authorizations.deleteRepl.isAuthorized&&(r&&o.push({value:"TransferRepl",label:"Transfer",icon:(0,x.jsx)(cm.default,{})}),l.push({isDestructive:!0,value:"DeleteRepl",label:"Delete",icon:(0,x.jsx)(cg.default,{})})),[s,o,l].filter(e=>e.length>0)}({repl:e,loading:t,isCreatingProjectFork:a}),o=e.user,l=e.org;return(0,x.jsxs)(x.Fragment,{children:[s.map((t,a)=>(0,x.jsxs)(v.Fragment,{children:[a>0?(0,x.jsx)(cW.Separator,{}):null,t.map(t=>(0,x.jsx)(cW.MenuItem,{label:t.label,icon:t.icon,onAction:()=>(t=>{switch(t){case"Remix":r();break;case"CoverPage":{let t=(0,cq.replViewFullUrl)(e);i?oM.desktopAppApi.openExternalUrl(t):window.open(t,"_blank");break}default:n(t)}})(t.value),isDisabled:t.isDisabled,isDestructive:t.isDestructive,description:t.description,dataCy:t.dataCy},t.value))]},a)),(0,x.jsx)(cY,{user:o??void 0,org:l??void 0,isInDesktopApp:i})]})}function cQ({repl:e,hideTitle:t}){let n=!!e.project?.id,{didDisconnect:i}=(0,dX.default)();if(i)return t?(0,x.jsx)(uX.IconButton,{alt:"Reconnecting",size:28,children:(0,x.jsx)(dW.default,{})}):(0,x.jsx)(dQ.Tooltip,{tooltip:"Reconnecting",children:(0,x.jsx)(se.Button,{variant:"nofill",iconLeft:(0,x.jsx)(dW.default,{size:16}),text:e.title})});if(n)return t?(0,x.jsx)(uX.IconButton,{size:28,alt:"Open menu",children:(0,x.jsx)(dz.default,{})}):(0,x.jsx)(se.Button,{variant:"nofill",size:"small",text:e.title});let r=(0,x.jsx)(dY,{replId:e.id,replIconUrl:e.iconUrl,size:16,alt:"App icon"});return t?(0,x.jsx)(uX.IconButton,{size:28,alt:"Open menu",children:r}):(0,x.jsx)(se.Button,{shrink:!0,variant:"nofill",iconLeft:r,text:e.title})}function cZ({repl:e,hideTitle:t,getDesktopLayoutState:n}){var i,r,a;let s,o,l,[u,d]=(0,v.useState)(null),c=(0,y.useRouter)(),p=(0,W.default)(),{showError:h}=(0,sr.default)(),{data:m,loading:f}=(i={variables:{replId:e.id}},s={...cn,...i},j.useQuery(co,s)),g=m?.getRepl?.__typename==="Repl"?m.getRepl:void 0,[w,{loading:b}]=(r={onCompleted:()=>{if(p)return void c.push("/desktopApp/home");if(g?.org?.type==="team"){let e=(0,cv.orgLinks)(g.org);c.push(e.home.href);return}c.push("/home","/~")},update:(e,t)=>{t.data?.deleteRepl&&(e.evict({id:e.identify(t.data.deleteRepl)}),e.gc())},onError:e=>h((0,cy.default)(e.message))},o={...cn,...r},U.useMutation(cl,o)),[S,{loading:k}]=(a={variables:{input:{replId:e.id}},onCompleted:e=>{"Repl"===e.deleteReplDeployment.__typename?d(null):("NotFoundError"===e.deleteReplDeployment.__typename||"UserError"===e.deleteReplDeployment.__typename)&&h(e.deleteReplDeployment.message)},onError:e=>h((0,cy.default)(e.message))},l={...cn,...a},U.useMutation(cu,l));return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(cW.PopupMenu,{placement:"bottom start",dataCy:"repl-info-header-settings",trigger:(0,x.jsx)(cQ,{repl:e,hideTitle:t}),children:g?(0,x.jsx)(cX,{repl:g,loading:f,onDialogOpen:d}):null}),g?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(aK.Modal,{isOpen:"EditAppDetails"===u,onRequestClose:()=>d(null),maxWidth:512,children:(0,x.jsx)(c$,{repl:g,onClose:()=>d(null)})}),(0,x.jsx)(cS.default,{isOpen:"DeleteRepl"===u,onClose:()=>d(null),selectedRepls:[g],deleting:b,onDelete:()=>{w({variables:{id:g.id}})}}),(0,x.jsx)(aK.Modal,{isOpen:"TransferRepl"===u,onRequestClose:()=>d(null),children:(0,x.jsx)(cK.TransferReplDialog,{repl:g,onDone:()=>d(null),onCancel:()=>d(null)})}),(0,x.jsx)(aK.Modal,{isOpen:"FeatureRepl"===u,onRequestClose:()=>d(null),centered:!0,maxWidth:650,children:(0,x.jsx)(cw.default,{isFeatured:g.isFeaturedRepl,repl:g,orgId:g.org?.id,onCompleted:()=>d(null)})}),(0,x.jsx)(aK.Modal,{isOpen:"UnpublishTemplate"===u,onRequestClose:()=>d(null),children:(0,x.jsxs)(V.View,{gap:24,children:[(0,x.jsxs)(V.View,{gap:8,children:[(0,x.jsx)(st.Text,{variant:"headerBig",children:"Unpublish Template?"}),(0,x.jsx)(st.Text,{children:"Unpublishing will remove this Template from community discovery. You can republish anytime."})]}),(0,x.jsxs)(V.View,{row:!0,gap:8,justify:"end",children:[(0,x.jsx)(se.Button,{text:"Cancel",onClick:()=>d(null),disabled:k}),(0,x.jsx)(se.Button,{text:k?"Unpublishing...":"Yes, unpublish this Template",colorway:"negative",iconLeft:(0,x.jsx)(cc.default,{}),onClick:()=>S(),disabled:k})]})]})}),("PublishTemplate"===u||"EditPublishedTemplateSettings"===u)&&(0,x.jsx)(aK.Modal,{isOpen:!0,onRequestClose:()=>d(null),noPadding:!0,maxWidth:872,fitContent:!0,children:(0,x.jsx)(cb.default,{source:"replEnvironment",replId:g.id,getDesktopLayoutState:n})}),(0,x.jsx)(aK.Modal,{isOpen:"UpdatePublishedTemplate"===u,onRequestClose:()=>d(null),noPadding:!0,children:(0,x.jsx)(cj.default,{repl:g,getDesktopLayoutState:n})})]}):null]})}var cJ=e.i(76961),c0=e.i(663762),c1=e.i(57527),c2=e.i(490262),c5=e.i(596139),c4=e.i(443394),c8=e.i(27820),c3=e.i(929872),c6=e.i(257811),c9=e.i(672685),c7=e.i(111724);function pe({icon:e,title:t,subtitle:n,current:i,max:r,nextCreditsAt:a,isMonthly:s}){let o=Math.min(i,r),l=Math.min(o/r,1),u=(0,c9.getPercentageFillColor)({decimal:l}),d=i>=r,c=null!=a&&"countdown"===(0,c6.toCountdownDate)({date:a}).type;return(0,x.jsxs)(c3.Surface,{clsx:c7.default.usageCard,p:8,gap:8,background:"higher",children:[(0,x.jsxs)(V.View,{children:[(0,x.jsxs)(V.View,{row:!0,align:"baseline",justify:"space-between",grow:!0,children:[(0,x.jsxs)(V.View,{row:!0,align:"end",gap:6,children:[e,(0,x.jsx)(st.Text,{height:"singleLine",style:{fontWeight:A.tokens.fontWeightMedium},children:t}),d?(0,x.jsx)(cT.default,{size:16,color:A.tokens.accentNegativeDefault}):null]}),(0,x.jsxs)(st.Text,{color:"dimmer",children:[Math.floor(100*l),"%"]})]}),(0,x.jsx)(st.Text,{variant:"small",color:"dimmer",children:n})]}),(0,x.jsx)(c8.MeasureBar,{css:c7.default.measureBar,total:r,current:o,color:u,tooltipHidden:!0}),a&&c&&d?(0,x.jsxs)(V.View,{row:!0,gap:3,children:[(0,x.jsxs)(st.Text,{color:"dimmer",children:[s?"Monthly":"Daily"," credits will reset in"," "]}),(0,x.jsx)(c6.Timestamp,{date:a,dateFormat:"countdown",live:!0,textColor:"dimmer"})]}):null]})}function pt({agentLimit:e,agentUsage:t,cloudUsage:n,cloudLimit:i,agentNextCreditsAt:r,cloudNextCreditsAt:a,isUnderMonthlyQuota:s}){let o=(0,c4.getCurrentUrl)(),l=(0,H.useFlag)({controlName:"flag-free-plan",default:!1});if(void 0===e||void 0===t)return(0,x.jsx)(dh.default,{});let u=void 0!==n&&void 0!==i&&n/i>=.25;return(0,x.jsxs)(V.View,{gap:16,children:[(0,x.jsxs)(V.View,{gap:8,children:[(0,x.jsx)(st.Text,{variant:"subheadDefault",height:"singleLine",children:"Free usage limits"}),(0,x.jsx)(pe,{icon:(0,x.jsx)(lE.default,{size:16}),title:l?!1===s?"Monthly Agent credits":"Daily Agent credits":"Agent usage",subtitle:"Build, test, and iterate in fast mode",current:t,max:e,nextCreditsAt:r,isMonthly:!1===s}),l&&u?(0,x.jsx)(pe,{icon:(0,x.jsx)(c2.default,{size:16}),title:"Monthly Cloud credits",subtitle:"AI integrations, publishing, and storing assets",current:n,max:i,nextCreditsAt:a,isMonthly:!0}):null]}),(0,x.jsx)(dO.default,{text:`Upgrade to Replit ${c5.corePlanName}`,colorway:"primary",variant:"default",context:"agent_freemium_quota_v2",redirectPath:o,modalHeadingText:"Upgrade for more Agent usage",modalSubHeadingText:`Get more credits and build faster with Replit ${c5.corePlanName}`})]})}var pn=e.i(573605),pi=e.i(176843);let pr=2/3*100;function pa({usage:e,limit:t,percentThreshold:n,onHitThreshold:i}){let r=(0,v.useRef)(void 0);(0,v.useEffect)(()=>{if(void 0!==e&&void 0!==t){let a=e/t*100;void 0!==r.current&&r.current/t*100<n&&a>=n&&i(),r.current=e}},[e,t,n,i])}let ps=(0,ie.cssRecord)({root:[au.rcss.px(8),d0.interactive.nofill,au.rcss.height(32),au.rcss.align.center,au.rcss.rowWithGap(4),au.rcss.px(6),au.rcss.borderRadius(),au.rcss.color.foregroundDefault],measureBar:[au.rcss.width(50),au.rcss.height(8),{pointerEvents:"none"}],popoverWrapper:[au.rcss.width(300)]});function po(){let e,t,n,i,r,a,s,[o,l]=(0,v.useState)(!1),{agentUsage:u,agentUsageV2:d,refetch:c}=(0,pn.useGetAgentFreeUsage)(),{cloudUsage:p,refetch:h}=(0,pi.useGetCloudFreeUsage)();(0,c1.useOnPresentToUser)((0,v.useCallback)(e=>{"cloudBudgetExceeded"===e.$kind&&l(!0)},[])),d?(e=d.usage,t=d.limit,n=d.nextCreditsAt,s=d.isUnderMonthlyQuota):(e=u?.usage,t=u?.limit),p&&"FreemiumCloudUsageLimits"===p.__typename&&(i=p?.usage,r=p?.limit,a=p?.nextCreditsAt),pa({usage:e,limit:t,percentThreshold:pr,onHitThreshold:()=>{l(!0)}}),pa({usage:e,limit:t,percentThreshold:85,onHitThreshold:()=>{l(!0)}}),pa({usage:e,limit:t,percentThreshold:100,onHitThreshold:()=>{l(!0),(0,ei.track)(er.events.AGENT_USED,{action:"hit_freemium_quota"})}});let m=t&&e?e/t:0,f=r&&i?i/r:0;m=Math.min(m,1);let g=(0,c9.getPercentageFillColor)({decimal:m}),y=m>=1||f>=1;return m<.25&&f<.25?null:(0,x.jsxs)(d1.PopoverTrigger,{isOpen:o,onOpenChange:e=>{l(e),e&&(c(),h())},label:"Agent usage",placement:"bottom start",children:[(0,x.jsx)(se.BaseButton,{css:ps.root,children:(0,x.jsxs)(V.View,{row:!0,align:"center",gap:8,children:[(0,x.jsx)(c8.MeasureBar,{css:ps.measureBar,total:t??0,current:e??0,color:g,tooltipHidden:!0}),(0,x.jsxs)(st.Text,{variant:"small",color:"dimmer",children:[Math.floor(100*m),"%"]}),y?(0,x.jsx)(cT.default,{size:16,color:A.tokens.accentNegativeDefault}):null]})}),(0,x.jsx)(V.View,{css:ps.popoverWrapper,p:10,children:(0,x.jsx)(pt,{agentLimit:t,agentUsage:e,cloudUsage:i,cloudLimit:r,agentNextCreditsAt:n,cloudNextCreditsAt:a,isUnderMonthlyQuota:s})})]})}function pl(){let e=aH(),t=(0,a$.useKeyCombo)(aX.id),n=t?`${aW} (${t})`:aW;return(0,x.jsx)(uX.IconButton,{alt:n,onClick:()=>e(),size:28,dataCy:"command-bar-btn",children:(0,x.jsx)(oH.default,{})})}var pu=e.i(182409),pd=e.i(961970),pc=e.i(899869),pp=e.i(914279),ph=e.i(68893),pm=e.i(241703),pf=e.i(729678),pg=e.i(187505),px=e.i(86159),py=e.i(522821),pv=e.i(420156),pw=e.i(293265),pb=e.i(469429),pj=e.i(76430),pS=e.i(629536);e.i(784147),e.i(442966);var pk=e.i(495891);e.i(581554);var pC=e.i(409570);e.i(412223);var pT=e.i(133522);e.i(11541),e.i(709867),e.i(680189);var pE=((o={}).Welcome="Welcome",o.AiFirstWorkspace="AiFirstWorkspace",o.Assistant="Assistant",o.Agent="Agent",o.SidebarDock="SidebarDock",o.Run="Run",o.Deploy="Deploy",o.NewTab="NewTab",o.Filetree="Filetree",o);(0,ie.cssRecord)({tooltipContainer:[au.rcss.width("100%"),au.rcss.maxWidth(300),au.rcss.position.relative,au.rcss.colWithGap(8),au.rcss.pb(8)],textContent:[au.rcss.width("100%"),{wordBreak:"break-word",overflowWrap:"anywhere"}]}),pS.AGENT_NAME;let pI="workspace-desktop-tour-2025",pP={},pA=w.gql`
    query ExportVideoButtonRepl($id: String!) {
  getRepl(id: $id) {
    ... on Repl {
      id
      title
    }
  }
}
    `;var pR=e.i(36654);let pD={},pV=w.gql`
    mutation ExportVideo($input: ExportVideoInput!) {
  exportVideo(input: $input) {
    __typename
    ... on ExportVideoResult {
      id
      status
    }
    ... on UserError {
      message
    }
    ... on UnauthorizedError {
      message
    }
    ... on NotFoundError {
      message
    }
    ... on TooManyRequestsError {
      message
    }
  }
}
    `,p_=w.gql`
    subscription GetVideoExportStatus($replId: String!) {
  getVideoExportStatus(replId: $replId) {
    __typename
    ... on VideoExportStatusOutput {
      status
      filename
      downloadUrl
      errorMessage
    }
    ... on NotFoundError {
      message
    }
    ... on UnauthorizedError {
      message
    }
    ... on UserError {
      message
    }
  }
}
    `;var pM=e.i(813675);let pF=[{label:"720p 30fps",width:1280,height:720,fps:30},{label:"720p 60fps",width:1280,height:720,fps:60},{label:"1080p 30fps",width:1920,height:1080,fps:30},{label:"1080p 60fps",width:1920,height:1080,fps:60}],pO=pF[0],pL={idle:{floor:0,target:0,inProgress:!1},pending:{floor:.02,target:.15,inProgress:!0},creating_preview:{floor:.15,target:.35,inProgress:!0},rendering:{floor:.35,target:.75,inProgress:!0},copying:{floor:.75,target:1,inProgress:!0},completed:{floor:1,target:1,inProgress:!1},failed:{floor:0,target:0,inProgress:!1}};function pB(e){return pL[e].inProgress}var pU=e.i(85742),pN=e.i(12034),pG=e.i(823931);function p$(e){let t=new Date().toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",second:"2-digit",hour12:!0});return`${e??"video"}-${t}`}function pz({onExport:e,exportPhase:t,exportProgress:n,downloadUrl:i,onDownload:r,onClearDownload:a,replTitle:s}){let[o,l]=(0,v.useState)(()=>p$(s)),[u,d]=(0,v.useState)(pO),[c,p]=(0,v.useState)(!1);(0,v.useEffect)(()=>{s&&!c&&l(p$(s))},[s,c]),(0,v.useEffect)(()=>{"completed"===t&&(l(p$(s)),p(!1))},[t,s]);let h=async()=>{try{await e({name:o,format:"mp4",quality:u})}catch{}},m=pB(t),f=i&&r?{text:"Download",iconLeft:(0,x.jsx)(pR.default,{}),colorway:"positive",onClick:r,disabled:!1}:{text:"Render",colorway:"primary",onClick:h,disabled:!o.trim()};return(0,x.jsx)(V.View,{gap:12,p:20,clsx:pG.default.menu,children:(0,x.jsxs)(V.View,{gap:12,children:[(0,x.jsx)(st.Text,{variant:"subheadDefault",children:"Export video"}),(0,x.jsxs)(V.View,{gap:16,children:[(0,x.jsxs)(V.View,{gap:8,children:[(0,x.jsx)(st.Text,{variant:"small",children:"Name"}),(0,x.jsxs)(V.View,{row:!0,align:"center",gap:8,children:[(0,x.jsx)(cL.Input,{value:o,onChange:e=>{l(e.target.value),p(!0),i&&a&&a()},placeholder:"Enter video name",disabled:m,clsx:pG.default.nameInput}),(0,x.jsx)(st.Text,{variant:"small",color:"dimmest",children:".mp4"})]})]}),(0,x.jsxs)(V.View,{gap:8,children:[(0,x.jsx)(st.Text,{variant:"small",children:"Quality"}),(0,x.jsx)(pN.Select,{"aria-label":"Video quality",selectedKey:u.label,onSelectionChange:e=>{let t=pF.find(t=>t.label===e);t&&(d(t),i&&a&&a())},isDisabled:m,children:pF.map(e=>(0,x.jsx)(pU.ListBoxItem,{id:e.label,label:e.label},e.label))})]}),(0,x.jsx)(V.View,{children:m?(0,x.jsxs)(V.View,{clsx:pG.default.progressButton,children:[(0,x.jsx)(V.View,{clsx:pG.default.progressButtonFill,style:{width:`${Math.round(100*n)}%`}}),(0,x.jsxs)(st.Text,{clsx:pG.default.progressButtonText,children:["Rendering... ",Math.round(100*n),"%"]})]}):(0,x.jsx)(se.Button,{size:"small",colorway:f.colorway,text:f.text,iconLeft:f.iconLeft,onClick:f.onClick,disabled:f.disabled,clsx:pG.default.exportButton})})]})]})})}function pW(){var e;let t,{data:n}=(e={variables:{id:(0,a9.default)()}},t={...pP,...e},j.useQuery(pA,t)),i=n?.getRepl?.__typename==="Repl"?n.getRepl.title:void 0,{isOpen:r,setIsOpen:a,handleExportVideo:s,exportPhase:o,exportProgress:l,downloadUrl:u,handleDownload:d,clearDownload:c}=function(){var e;let t,n,{showConfirm:i,showError:r}=(0,sr.default)(),a=(0,a9.default)(),[s,o]=(0,v.useState)(!1),[l,u]=(0,v.useState)(!1),[d,c]=(0,v.useState)("idle"),[p,h]=(0,v.useState)(null),m=function(e){let{floor:t,target:n}=pL[e],[i,r]=(0,v.useState)(t),a=(0,v.useRef)(n);return a.current=n,(0,v.useEffect)(()=>{if(!pB(e))return void r(t);r(e=>Math.max(e,t));let n=setInterval(()=>{r(e=>{let t=a.current-e;return t>0?e+.08*t:e})},200);return()=>clearInterval(n)},[e,t]),i}(d),f=(0,v.useCallback)(()=>h(null),[]),g=(0,H.useFlag)({controlName:"flag-backend-video-rendering",default:!1}),[x]=(t={...pD,...void 0},U.useMutation(pV,t)),y=(0,v.useCallback)(()=>{!p||window.open(p,"_blank")&&h(null)},[p]),w=(0,pM.useUrls)({addDevToolsSuffix:!1}),b=(0,o$.usePid2Callback)(e=>async t=>{if(!w?.presentationUrl)throw Error("Unable to get preview URL for recording");let n=`${(0,rt.sanitizeFilename)(t.name)}.${t.format}`,i=t.quality??pO,r=await e.browserVideoRecording.record.rpc({pageUrl:w.presentationUrl,localFilePath:n,video:{frameRate:i.fps,resolution:{width:i.width,height:i.height},format:"mp4"}});if(!r.ok)throw Error(r.payload.message);return{filename:n}},[w?.presentationUrl]),j=(0,o$.usePid2Callback)(e=>async()=>{let t=await e.git.log.rpc({max:1});if(t.ok&&t.payload.commits.length>0)return t.payload.commits[0].hash;throw Error("Unable to get current commit SHA")},[]),{data:S,error:k}=(e={variables:{replId:a??""},skip:!g||!a,fetchPolicy:"no-cache"},n={...pD,...e},lP.useSubscription(p_,n));(0,v.useEffect)(()=>{k&&s&&(r("Video export failed"),o(!1),c("failed"))},[k,s,r]),(0,v.useEffect)(()=>{let e=S?.getVideoExportStatus;if(!e)return;if("UserError"===e.__typename||"UnauthorizedError"===e.__typename||"NotFoundError"===e.__typename){s&&(r("Video export failed"),o(!1),c("failed"));return}if("VideoExportStatusOutput"!==e.__typename)return;let{status:t}=e;if(t in pL){if("completed"!==t&&"failed"!==t){o(!0),c(t);return}"completed"===t?s&&(e.downloadUrl?(h(e.downloadUrl),window.open(e.downloadUrl,"_blank")?i("Video exported! Download started.",2e3):i("Video exported! Click Download to save.",5e3)):i("Video exported!",5e3),c("completed")):s&&(r("Video export failed"),c("failed")),o(!1)}},[S,s,i,r]),(0,v.useEffect)(()=>{if("completed"!==d&&"failed"!==d)return;let e=setTimeout(()=>c("idle"),2e3);return()=>clearTimeout(e)},[d]);let C=(0,v.useCallback)(async e=>{if(!g){if(!b)return void r("Unable to export video: not connected to repl");o(!0),c("pending");try{let t=await b(e);i(`Video exported successfully to ${t.filename}`),u(!1),c("completed")}catch{r("Video export failed"),c("failed")}finally{o(!1)}return}if(!a)return void r("Unable to export video: repl ID not available");if(!j)return void r("Unable to export video: not connected to repl");h(null),c("pending");try{let t=await j(),n=e.quality??pO,i=await x({variables:{input:{replId:a,gitSha:t,filename:(0,rt.sanitizeFilename)(e.name),frameRate:n.fps,width:n.width,height:n.height}}}),s=i.data?.exportVideo;if(s?.__typename==="ExportVideoResult")return;if(s?.__typename==="TooManyRequestsError"){r("Rate limited. Please try again in a minute."),c("failed");return}throw Error(s&&"message"in s?s.message:"Unknown error")}catch{r("Video export failed"),c("failed")}},[g,b,a,j,x,i,r]);return{isRecording:s,isOpen:l,setIsOpen:u,handleExportVideo:C,exportPhase:d,exportProgress:m,isBackendExport:g,downloadUrl:p,handleDownload:y,clearDownload:f}}();return(0,x.jsx)(dQ.Tooltip,{tooltip:r?void 0:"Export",children:(0,x.jsxs)(d1.PopoverTrigger,{isOpen:r,onOpenChange:a,label:"Export",placement:"bottom start",children:[(0,x.jsx)(se.Button,{size:"small",iconLeft:(0,x.jsx)(pR.default,{}),text:"Export"}),(0,x.jsx)(pz,{onExport:s,exportPhase:o,exportProgress:l,downloadUrl:u,onDownload:d,onClearDownload:c,replTitle:i})]})})}var pH=e.i(980713);function pq({color:e}){return(0,x.jsxs)(V.View,{clsx:pH.default.deployIconWithStatus,children:[(0,x.jsx)(pu.default,{}),(0,x.jsx)(V.View,{tag:"span",clsx:pH.default.deployIconDotWrapper,children:(0,x.jsx)(V.View,{tag:"span",clsx:pH.default.deployIconDot,style:{backgroundColor:e}})})]})}function pK({text:e,icon:t,disabled:n,rounded:i,onClick:r,tooltip:a,loading:s,iconOnly:o,tourStepRef:l,colorway:u}){let d=(0,x.jsx)(se.Button,{ref:l,loading:s,size:"small",text:e,iconLeft:t,colorway:u,clsx:i?s?pH.default.roundedButtonLoading:pH.default.roundedButton:s?pH.default.baseButtonLoading:pH.default.baseButton,disabled:n,onClick:r,"data-icon-only":o});return a?(0,x.jsx)(dQ.Tooltip,{tooltip:a,children:d}):d}function pY({iconOnly:e=!1,shouldSkipOpeningPane:t=!1}){let n,i=(0,pp.useDeploymentMode)(),r=(0,pc.usePauseProvisionStage)(),{isAgentStackRepl:a}=(0,dB.useIsAgentStackRepl)(),{agentStackPlatformType:s}=(0,pw.useAgentStackPlatformType)(),o=function(e,t,n){switch(e){case ph.DeploymentMode.Ready:case ph.DeploymentMode.Suspended:case ph.DeploymentMode.ProcessingLifecycleCommand:case ph.DeploymentMode.Loading:switch(t){case lQ.AgentStackPlatformType.Slack:return"Publish to Slack";case lQ.AgentStackPlatformType.Telegram:return"Publish to Telegram";case lQ.AgentStackPlatformType.TimeBased:return"Publish Automation";default:return"Publish"}case ph.DeploymentMode.Preparing:return"Preparing";case ph.DeploymentMode.PreparingDatabase:switch(n){case!0:return"Approve";case!1:return"Preparing"}break;case ph.DeploymentMode.Deploying:switch(t){case lQ.AgentStackPlatformType.Slack:return"Publishing to Slack";case lQ.AgentStackPlatformType.Telegram:return"Publishing to Telegram";case lQ.AgentStackPlatformType.TimeBased:return"Publishing Automation";default:return"Publishing"}default:(0,da.default)(e)}}(i,a&&s||null,!!r),l=!1,u=!1;switch(i){case ph.DeploymentMode.Ready:case ph.DeploymentMode.Suspended:case ph.DeploymentMode.ProcessingLifecycleCommand:n=(0,x.jsx)(pu.default,{});break;case ph.DeploymentMode.Loading:n=(0,x.jsx)(pu.default,{}),l=!0;break;case ph.DeploymentMode.Preparing:n=(0,x.jsx)(pu.default,{}),l=!0,u=!0;break;case ph.DeploymentMode.PreparingDatabase:r?(n=(0,x.jsx)(pd.default,{color:A.tokens.orangeStronger}),u=!0,l=!1):(n=(0,x.jsx)(dh.default,{}),u=!0,l=!0);break;case ph.DeploymentMode.Deploying:n=(0,x.jsx)(dh.default,{}),u=!0;break;default:(0,da.default)(i)}let d=aS(),c=(0,ok.useSetDeploymentTriggerSource)(),p=!!(0,py.useActiveAgentSessionId)(),h=function(){let{dotReplit:e}=(0,sg.default)(),[t,n]=(0,v.useState)(null);return(0,v.useEffect)(()=>e.watch(e=>{if(e.error)return n(null);n(e.config.deployment?.target||null)}),[e]),t}(),m=function(){let{deployBuild:e}=(0,ok.useDeployBuild)(),t=(0,a9.default)(),n=(0,ok.useDotReplitService)(),{showError:i}=(0,sr.default)(),r=(0,ok.useSecretsService)(),a=(0,ok.useDeploymentSubdomain)(),{enabled:s}=(0,ok.useDeploymentSecurityScanState)(),o=(0,pf.useGetSecretsAsDeploymentEntries)({secrets:r,replId:t}),l=!!(0,py.useActiveAgentSessionId)();return(0,v.useCallback)(async()=>{try{let t=await (0,pf.getDotReplitDeploymentConfig)(n),i=await o();if(!a||!t.publicDir)return!1;return await e({provider:lQ.HostingBuildProvider.Static,subdomain:a,config:{buildCommand:t.buildCommand,publicDir:t.publicDir,appType:lQ.DeployHostingBuildAppType.Static,ignorePorts:!1,runCommand:null},envVars:i,privacyMode:lQ.DeployHostingBuildPrivacyMode.Public,ignoredSecrets:[],hasAgentSession:l,enableSecurityScan:s,createNeonProductionDatabase:!1,pushDevelopmentDatabaseObjects:null}),!0}catch(e){return i(e.message||"Failed to deploy"),!1}},[e,i,n,o,a,s,l])}(),f=async()=>{i===ph.DeploymentMode.Ready&&(0,ei.track)(er.events.DEPLOY_PROJECT_SELECTED,{source:"deploy_button",has_agent_session:p}),c("workspace_header_publish_button"),t&&await m()||d({pane:{type:"deployments",flow:{skipIntro:null!==h&&p,isAgentDeployment:null!==h&&p}}})},g=(0,px.useSetTourStepTarget)(pI,pE.Deploy);return(0,x.jsx)(pK,{text:o,icon:n,onClick:f,disabled:l,loading:u,rounded:!0,iconOnly:e,tourStepRef:g,colorway:i===ph.DeploymentMode.Ready?"primary":void 0})}function pX({hideOpenPaneButton:e,forcePrimaryColorway:t}={}){let n,i,r,{trackClick:a}=(0,pg.useTrackClick)(),s=(0,pp.useDeploymentMode)(),o=(0,ok.useDeploymentError)(),l=(0,ok.useActiveBuildAction)(),u=(0,ok.useSetDeploymentTriggerSource)(),d=aS(),{redeployWithNoNewOptions:c,databaseLoading:p}=(0,ok.useDeployBuild)({openDeploymentsPane:()=>{d({pane:{type:"deployments"}})}}),{showError:h}=(0,sr.default)(),m=(0,pc.usePauseProvisionStage)(),{agentStackPlatformType:f}=(0,pw.useAgentStackPlatformType)(),g=(0,pj.useIsExpoStackWithLaunchEnabled)(),y=async()=>{if(g||s===ph.DeploymentMode.Deploying||s===ph.DeploymentMode.Suspended||s===ph.DeploymentMode.ProcessingLifecycleCommand||s===ph.DeploymentMode.Preparing||s===ph.DeploymentMode.PreparingDatabase||w&&(b(void 0),w===lQ.HostingBuildStatus.Failed)||o)return void d({pane:{type:"deployments",data:{view:pm.Views.Deployment}}});try{u("workspace_header_republish_button"),await c({hasAgentSession:!0})}catch(e){h(e.message)}},[w,b]=(0,v.useState)(void 0);(0,v.useEffect)(()=>{if(l&&"HostingBuildDeployStatusAction"===l.__typename)switch(l.status){case lQ.HostingBuildStatus.Success:case lQ.HostingBuildStatus.Failed:b(l.status)}},[l]),(0,v.useEffect)(()=>{s===ph.DeploymentMode.Deploying&&b(void 0)},[s]);let j=(()=>{switch(f){case lQ.AgentStackPlatformType.Slack:return"Republish to Slack";case lQ.AgentStackPlatformType.Telegram:return"Republish to Telegram";case lQ.AgentStackPlatformType.TimeBased:return"Republish Automation";default:return"Republish"}})(),S=(()=>{switch(f){case lQ.AgentStackPlatformType.Slack:return"Publishing to Slack";case lQ.AgentStackPlatformType.Telegram:return"Publishing to Telegram";case lQ.AgentStackPlatformType.TimeBased:return"Publishing Automation";default:return"Publishing"}})(),k=!1,C=!1;switch(s){case ph.DeploymentMode.Ready:n="Republish",i=(0,x.jsx)(pu.default,{}),w&&(w===lQ.HostingBuildStatus.Success?(i=(0,x.jsx)(pq,{color:A.tokens.accentPositiveDefault}),r="Success"):(i=(0,x.jsx)(pq,{color:A.tokens.accentNegativeDefault}),r="An error occurred"));break;case ph.DeploymentMode.Suspended:n=j,i=(0,x.jsx)(pq,{color:A.tokens.greyDefault}),r="Published app suspended";break;case ph.DeploymentMode.Loading:n=j,i=(0,x.jsx)(pu.default,{}),k=!0,C=!0;break;case ph.DeploymentMode.ProcessingLifecycleCommand:n=j,i=(0,x.jsx)(pq,{color:A.tokens.orangeStronger}),C=!0,r="Updating published app";break;case ph.DeploymentMode.Preparing:n="Preparing",i=(0,x.jsx)(dh.default,{}),C=!0,k=!0;break;case ph.DeploymentMode.PreparingDatabase:m?(n="Approve",i=(0,x.jsx)(pd.default,{color:A.tokens.orangeStronger}),C=!0,k=!1):(n="Preparing",i=(0,x.jsx)(dh.default,{}),C=!0,k=!0);break;case ph.DeploymentMode.Deploying:n=S,i=(0,x.jsx)(dh.default,{}),C=!0;break;default:(0,da.default)(s)}return o&&(n="Error",i=(0,x.jsx)(pq,{color:A.tokens.accentNegativeDefault}),r=o),(0,x.jsxs)(V.View,{row:!0,gap:2,children:[(0,x.jsx)(pK,{text:n,icon:i,tooltip:r,onClick:()=>{a({productArea:"publishing",target:"redeploy_button"}),y()},disabled:k||p,loading:C,colorway:t?"primary":void 0}),e?null:(0,x.jsx)(uX.IconButton,{filled:!0,size:28,alt:"Open Publishing pane",onClick:()=>{d({pane:{type:"deployments"}})},clsx:pH.default.openPaneButton,children:(0,x.jsx)(oP.default,{})})]})}let pQ=()=>{let e=aS();return(0,x.jsx)(se.Button,{size:"small",text:"Republish",iconLeft:(0,x.jsx)(pu.default,{}),onClick:()=>{e({pane:{type:"deployments"}})}})};function pZ({iconOnly:e,isDesignMode:t,hideOpenPaneButton:n,forcePrimaryColorway:i}){let r,a=(0,ok.useDeploymentId)(),s=(0,ok.useDeploymentCurrentBuild)(),{deployability:o}=(0,ok.useDeploymentDeployability)(),l=(0,ok.useDeploymentSessionOrg)(),u=(0,pv.useAgentStackFromDotReplit)(),d=!!l?.id,c=(0,pb.useHasAgentCheckpoint)();return(r=a&&s?o.redeploy.isAuthorized?(0,x.jsx)(pX,{hideOpenPaneButton:n,forcePrimaryColorway:i}):(0,x.jsx)(pQ,{}):(0,x.jsx)(pY,{iconOnly:e,shouldSkipOpeningPane:t&&!d&&c}),"VIDEO_JS"===u)?(0,x.jsxs)(V.View,{row:!0,gap:8,align:"center",children:[(0,x.jsx)(pW,{}),r]}):r}var pJ=e.i(927600),p0=e.i(239612);let p1={},p2=w.gql`
    query ProjectHeaderMenu($id: String!, $input: ProjectReplsInput!) {
  getRepl(id: $id) {
    ... on Repl {
      id
      title
      ...CreateProjectForkRepl
      project {
        id
        mainRepl {
          id
          title
          ...CreateProjectForkRepl
        }
        repls(input: $input) {
          items {
            id
            title
            ...ReplLinkRepl
          }
          pageInfo {
            hasNextPage
            nextCursor
          }
        }
      }
    }
  }
}
    ${p0.CreateProjectForkReplFragmentDoc}
${oY.ReplLinkReplFragmentDoc}`;var p5=e.i(183035),p4=e.i(691056),p8=e.i(611361),p3=e.i(700582),p6=e.i(537548),p9=e.i(91720),p7=e.i(988676),he=e.i(458496),he=he,ht=e.i(698043),hn=e.i(498540),hi=e.i(690821);let hr=(0,ie.cssRecord)({self:[au.rcss.display.grid,au.rcss.p(4),{gap:4,alignItems:"stretch"}],list:[au.rcss.maxHeight(640)],listItem:[he.default.item,au.rcss.px(8),au.rcss.height(28),{span:au.rcss.color.foregroundDefault}],listItemLabel:{flex:1},listButtonLink:[au.rcss.height(28),au.rcss.px(6),au.rcss.transition.none],currentReplIcon:[au.rcss.color.foregroundDimmer],tourWrapper:[au.rcss.p(8)]});function ha({label:e,icon:t,...n}){return(0,x.jsxs)(pU.BaseListBoxItem,{css:hr.listItem,...n,textValue:e,children:[(0,x.jsx)(pU.ListBoxItemLabel,{css:hr.listItemLabel,children:e}),(0,x.jsx)(ai.IconProvider,{size:16,children:t})]})}let hs=(0,v.forwardRef)(function(e,t){var n;let i,r=(0,a9.default)(),[a,s]=(0,v.useState)(""),o=(0,px.useTourStep)(p6.projectsTour.id,p6.StepIds.Forks),l=(n={variables:{id:r,input:{}},notifyOnNetworkStatusChange:!0},i={...p1,...n},j.useQuery(p2,i)),{refetch:u}=l,{showConfirm:d,showError:c}=(0,sr.default)(),[p,{loading:h}]=(0,p3.useCreateProjectFork)({onFork(){d("App forked, redirecting...")},onError(){c("Error creating fork - please try again")}});(0,p4.default)(()=>{u({input:{filters:{title:{search:a}}},id:r})},[a],300);let m=l.data?.getRepl.__typename==="Repl"?l.data.getRepl.project:null,f=l.previousData?.getRepl.__typename==="Repl"?l.previousData.getRepl.project?.repls.items:null,g=m?.mainRepl??(l.previousData?.getRepl.__typename==="Repl"?l.previousData.getRepl.project?.mainRepl??null:null),y=l.data?.getRepl.__typename==="Repl"?l.data.getRepl:null,w=(0,p8.useProjectPresenceUsersByRepl)({orgId:e.org.id,projectId:e.projectId}),b=(0,px.useActiveTourStep)();return(0,x.jsxs)("div",{css:hr.self,ref:t,children:[(0,x.jsxs)(ht.SearchableListBox,{children:[(0,x.jsx)(hn.SearchField,{"aria-label":"Search Apps in Project",placeholder:"Search by App title...",onChange:s,isLoading:l.loading,autoFocus:!0}),(0,x.jsx)(pU.ListBox,{isLoading:l.loading,items:m?.repls.items??f??[],css:hr.list,children:e=>(0,x.jsx)(ha,{icon:e.id===r?(0,x.jsx)(dQ.Tooltip,{tooltip:"You are here",placement:"right",children:(0,x.jsx)(p5.default,{css:hr.currentReplIcon})}):void 0,isDisabled:e.id===r,id:e.id,label:e.title,...(0,cq.replLinkProps)(e),sessions:w[e.id]??[]},e.id)})]}),(0,x.jsx)(p7.DividerH,{}),(0,x.jsxs)(V.View,{children:[(0,x.jsx)(p9.ButtonLink,{alignment:"start",...(0,cv.orgProjectLink)({org:e.org,projectId:e.projectId}),target:"_blank",iconLeft:(0,x.jsx)(oI.default,{}),text:"Project dashboard",variant:"nofill",css:hr.listButtonLink}),(0,x.jsxs)(cW.PopupMenu,{elevated:!1,placement:"right top",trigger:(0,x.jsx)(se.Button,{alignment:"start",variant:"nofill",text:"New fork",iconLeft:h?(0,x.jsx)(dh.default,{}):(0,x.jsx)(a5.default,{}),loading:h,css:hr.listButtonLink}),children:[y?(0,x.jsx)(cW.MenuItem,{label:`From here (${y.title})`,isDisabled:h,onAction:()=>{p({forkSource:"projectHeaderMenu",orgId:e.org.id,repl:y})}}):null,y&&g&&y.id!==g.id?(0,x.jsx)(cW.MenuItem,{label:`From main App (${g.title})`,isDisabled:!g||h,onAction:()=>{g&&p({orgId:e.org.id,repl:g,forkSource:"projectHeaderMenu"})}}):null]}),o.isActive&&b?(0,x.jsx)("div",{css:hr.tourWrapper,children:(0,x.jsx)(hi.Tour,{content:b.content,title:b.title,onDismiss:o.next,onCurrentStepChange:o.goto,currentStepIndex:p6.projectsTour.steps.findIndex(e=>e.id===p6.StepIds.Forks),totalSteps:p6.projectsTour.steps.length})}):null]})]})}),ho=(0,ie.cssRecord)({projectLinkTooltip:[au.rcss.maxWidth(400),au.rcss.flex.shrink(2)],projectLink:[au.rcss.px(6),au.rcss.noDragRegion,au.rcss.flex.growAndShrink(1)],inheritanceChevron:[au.rcss.color.outlineStrongest,{marginInline:-1}]});function hl({repl:e,hideTitle:t}){let[n,i]=(0,v.useState)(!1);return e.project&&e.org?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(dQ.Tooltip,{tooltip:"Project forks",css:ho.projectLinkTooltip,isOpen:!n&&void 0,children:(0,x.jsxs)(d1.PopoverTrigger,{label:"Project Menu",isOpen:n,onOpenChange:i,placement:"bottom start",children:[(0,x.jsx)(se.Button,{iconLeft:(0,x.jsx)(dY,{replId:e.id,replIconUrl:e.iconUrl}),text:t?"":e.project.title,variant:"nofill",css:ho.projectLink}),(0,x.jsx)(hs,{org:e.org,projectId:e.project.id})]})}),(0,x.jsx)(pJ.default,{size:12,css:ho.inheritanceChevron})]}):null}var hu=e.i(784701);let hd={},hc=w.gql`
    query UseShowInboxTour($replId: String!) {
  currentUser {
    id
    replCount {
      ... on ReplCount {
        count
      }
    }
  }
  getRepl(id: $replId) {
    ... on Repl {
      id
      config {
        isInPlanningPhase
      }
    }
  }
}
    `;function hp(){var e;let t,n=(0,a9.default)(),{data:i,loading:r}=(e={variables:{replId:n??""},skip:!n},t={...hd,...e},j.useQuery(hc,t)),a=i?.currentUser?.replCount?.__typename==="ReplCount"?i.currentUser.replCount.count:void 0;return!0!==(i?.getRepl?.__typename==="Repl"?i.getRepl.config?.isInPlanningPhase:void 0)&&void 0!==a&&a>1&&!r}var hh=e.i(952521),hm=e.i(117807);function hf({onDismiss:e,targetRef:t}){let n=(0,v.useMemo)(()=>function(){return(0,x.jsxs)(V.View,{gap:12,style:{width:300},children:[(0,x.jsxs)(V.View,{gap:4,children:[(0,x.jsxs)(V.View,{row:!0,align:"center",gap:8,children:[(0,x.jsx)(st.Text,{variant:"subheadDefault",children:"Feedback inbox"}),(0,x.jsx)(cH.Pill,{text:"New",colorway:"primary",variant:"muted",compact:!0})]}),(0,x.jsx)(st.Text,{children:"Enable the feedback widget to collect real-time feedback from viewers of your published app"})]}),(0,x.jsx)(se.Button,{variant:"outlined",text:"Got it",iconRight:(0,x.jsx)(p5.default,{}),onClick:e,stretch:!0})]})},[e]);return(0,x.jsx)(d1.RawPopover,{triggerRef:t,placement:"bottom",isOpen:!0,isNonModal:!0,arrow:!0,children:(0,x.jsx)(hi.Tour,{content:n,onDismiss:e,colorway:!1,hideCloseButton:!0,hideNavigation:!0,compact:!0,hideBorder:!0})})}var hg=e.i(803640),hx=e.i(561873),hy=e.i(782672),hv=e.i(550801);function hw({nixError:e}){let[t,n]=(0,v.useState)(!1),i=o6(),r=(0,v.useCallback)(e=>{i({type:"codeEditor",data:{path:e}})},[i]);return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)(uX.IconButton,{alt:"App is in recovery mode",onClick:()=>{n(!0)},children:["error"===e.status?(0,x.jsx)(cT.default,{color:A.tokens.orangeStronger}):null,"rebuilding-after-error"===e.status?(0,x.jsx)(dh.default,{}):null]}),(0,x.jsx)(hv.NixIsBrokenModal,{isOpen:t,setIsOpen:n,nixError:e,openFile:r})]})}let hb={},hj=w.gql`
    query WorkspaceRunButton($id: String!) {
  getRepl(id: $id) {
    ... on Repl {
      id
      title
      rootOriginReplUrl
      source {
        release {
          id
          repl {
            id
            title
            owner {
              ... on User {
                id
                username
              }
              ... on Team {
                id
                username
              }
            }
          }
        }
      }
    }
  }
  currentUser {
    id
  }
}
    `;var hS=e.i(353583);let hk={[lm.RunState.IDLE]:"Run",[lm.RunState.RUNNING]:"Stop",[lm.RunState.STOPPING]:"Stopping",[lm.RunState.OFFLINE]:"Working",[lm.RunState.BEFORE_RUN]:"Working"};function hC({stop:e,cancel:t}){return(0,x.jsxs)(V.View,{children:[(0,x.jsx)(st.Text,{children:"Stopping your project while the agent is working can lead to unexpected interruptions that incur additional costs. Are you sure you want to stop?"}),(0,x.jsxs)(V.View,{pt:12,row:!0,gap:12,justify:"end",children:[(0,x.jsx)(se.Button,{text:"Cancel",onClick:t}),(0,x.jsx)(se.Button,{iconLeft:(0,x.jsx)(hx.default,{}),text:"Stop",onClick:()=>{e(),t()},colorway:"negative"})]})]})}var hT=e.i(60166);function hE(e){let t={running:(0,x.jsx)(hx.default,{color:A.tokens.foregroundDimmest}),stopped:(0,x.jsx)(hg.default,{color:e.disabled?A.tokens.foregroundDimmest:A.tokens.accentPositiveStronger}),loading:(0,x.jsx)(dh.default,{color:A.tokens.foregroundDimmest})}[e.status];return(0,x.jsx)(R.ShadesSurface,{elevate:!!e.elevated&&"1x",clsx:hT.default.root,children:(0,x.jsx)(uX.IconButton,{disabled:e.disabled,dataCy:"ws-run-btn",alt:"Run or stop the app",tooltipContents:e.tooltip,onClick:e.onClick,size:28,children:t})})}function hI(){let{isOfflineOrLoading:e,isRunning:t,handleRunButtonClick:n,isAgentRunningWorkflow:i,isDisabled:r,runButtonName:a,runShortcut:s,isAgentRunButtonNotConfigured:o}=function(){var e;let t,n,i,{data:r}=(e={variables:{id:(0,a9.default)()}},i={...hb,...e},j.useQuery(hj,i)),a=r?.getRepl.__typename==="Repl"?r.getRepl:null,{tourRefs:s}=(t=(0,px.useTourStep)("workspace-desktop-tour-2024",pE.Run),n=t?.isActive,{tourRefs:t.tourRef,isAnyTourStepActive:n}),o=(0,a$.useKeyCombo)(lZ.run.id),[l,u]=(0,v.useState)(!1),d=(0,lk.useWorkflowsRunner)(),c=d?.workflowId??lm.PID1_RUNNER_NAME,{isRunning:p,isAgentRunningWorkflow:h,isOffline:m,isWorkflowsLoading:f,isDisabled:g}=(0,lk.useRunInfo)(),x=(0,v.useMemo)(()=>m||f,[m,f]),y=(0,hS.useIsAgentRunButtonNotConfigured)(),w=(0,lk.useOnToggleRun)();return(0,v.useEffect)(()=>{h&&l&&u(!1)},[h,l]),{tourRefs:s,isAgentRunningWorkflow:h,isOffline:m,isOfflineOrLoading:x,isWorkflowsLoading:f,runButtonName:c,runShortcut:o,isRunning:p,isDisabled:g,handleRunButtonClick:(0,v.useCallback)(()=>{a&&(0,ei.track)(er.events.PROJECT_RAN,{placement:"primary_btn",replId:a.id,replTitle:a.title,rootOriginReplUrl:a.rootOriginReplUrl,templateTitle:a.source?.release?.repl?.title,templateOwner:a.source?.release?.repl?.owner?.username}),(0,ei.track)(er.events.WORKSPACE,{action:"run_button_used",usage:"clicked",source:"header",runner:"workflows"}),w()},[a,w]),dropdownEnabled:!x&&!y,isAgentRunButtonNotConfigured:y}}(),l=(0,hy.useNixError)(),[u,d]=(0,v.useState)(!1),c=t?"running":"stopped";e&&(c="loading");let p=i?()=>d(!0):n;return l?(0,x.jsx)(hw,{nixError:l}):(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(hE,{disabled:r||o,status:c,isAgentRunningWorkflow:i,onClick:p,tooltip:function({isOffline:e,isAgentRunningWorkflow:t,isDisabled:n,isRunning:i,runButtonName:r,shortcut:a,isAgentRunButtonNotConfigured:s,isStatusButton:o}){if(e)return"Connecting to the workspace";if(t)return o?"Stop App (Agent is running it)":"Agent is running your App";if(s)return"Agent hasn't configured the run button yet";if(n)return"Run button is not configured";let l=(0,lm.removeRunPrefix)(r);return(0,x.jsxs)(V.View,{px:4,gap:4,justify:"center",align:"center",children:[r?(0,x.jsx)(st.Text,{color:"dimmer",variant:"small",children:i?hk[lm.RunState.RUNNING]+" all workflows":hk[lm.RunState.IDLE]+` ${l}`}):null,a?(0,x.jsx)(o9.KeyComboBlocks,{keyCombo:a,fontSize:12}):null]})}({isRunning:t,isAgentRunningWorkflow:i,isDisabled:r,isOffline:e,runButtonName:a,shortcut:s,isAgentRunButtonNotConfigured:o,isStatusButton:!0})}),(0,x.jsx)(aK.Modal,{isOpen:u,onRequestClose:()=>d(!1),children:(0,x.jsx)(hC,{stop:n,cancel:()=>d(!1)})})]})}var hP=e.i(652830);function hA({shortcut:e,content:t}){return(0,x.jsxs)(V.View,{row:!0,gap:8,align:"center",children:[(0,x.jsxs)(st.Text,{multiline:!1,variant:"small",children:["Toggle ",t]}),e?(0,x.jsx)(o9.KeyComboBlocks,{fontSize:10,keyCombo:e}):null]})}var hR=e.i(700283);function hD({flipped:e}){let t=aA(),n=(0,up.default)(t.activeContent),i=(0,up.default)(t.isOpen)&&"filetree"===n,r=(0,a$.useKeyCombo)(uN.id);(0,a$.useCommandBinding)(()=>[uN.id,()=>t.toggle()],[t]);let a=i?pT.default:hP.default;return(0,x.jsx)(uX.IconButton,{onClick:()=>t.toggleContent("filetree"),alt:"Toggle files",dataCy:"toggle-files-sidebar",tooltipContents:(0,x.jsx)(hA,{shortcut:r,content:"files"}),size:28,children:(0,x.jsx)(a,{clsx:{[hR.default.flipped]:e}})})}var hV=e.i(11029),h_=e.i(360118);function hM({icon:e,title:t,description:n}){return(0,x.jsxs)(V.View,{row:!0,gap:8,grow:!0,shrink:!0,children:[(0,x.jsx)(V.View,{p:2,align:"center",justify:"center",children:e}),(0,x.jsxs)(V.View,{children:[(0,x.jsx)(st.Text,{children:t}),n?(0,x.jsx)(st.Text,{variant:"small",children:n}):null]})]})}function hF({onDismiss:e,targetRef:t}){let n=(0,v.useMemo)(()=>function(){return(0,x.jsxs)(V.View,{gap:12,style:{width:300},children:[(0,x.jsxs)(V.View,{gap:4,children:[(0,x.jsxs)(V.View,{row:!0,align:"center",gap:8,children:[(0,x.jsx)(lI,{size:16}),(0,x.jsx)(st.Text,{variant:"subheadDefault",children:"Inbox"})]}),(0,x.jsxs)(V.View,{gap:8,children:[(0,x.jsx)(st.Text,{children:"Access all incoming feedback in one place"}),(0,x.jsx)(p7.DividerH,{}),(0,x.jsxs)(V.View,{gap:8,children:[(0,x.jsx)(hM,{icon:(0,x.jsx)(h_.default,{size:16}),title:"Share",description:"Send the published app link"}),(0,x.jsx)(hM,{icon:(0,x.jsx)(hV.default,{size:16}),title:"Review feedback",description:"Review targeted feedback from viewers"}),(0,x.jsx)(hM,{icon:(0,x.jsx)(l9.default,{size:16}),title:"Send to agent",description:"Send feedback to agent for fixes"})]})]})]}),(0,x.jsx)(se.Button,{variant:"outlined",text:"Got it",iconRight:(0,x.jsx)(p5.default,{}),onClick:e,stretch:!0})]})},[e]);return(0,x.jsx)(d1.RawPopover,{triggerRef:t,placement:"bottom",isOpen:!0,isNonModal:!0,arrow:!0,children:(0,x.jsx)(hi.Tour,{content:n,onDismiss:e,colorway:!1,hideCloseButton:!0,hideNavigation:!0,compact:!0,hideBorder:!0})})}var hO=e.i(787108);function hL(){let e=aA(),t=(0,a$.useKeyCombo)(uN.id),{isAvailable:n,pendingCount:i,refetchFeedbackQuery:r}=lG(),[a,s]=(0,d_.default)("inbox-button"),{shouldDisplay:o,dismiss:l}=function(e){let t=hp(),{isLoading:n,isDone:i,setAsDone:r}=(0,hh.useMemoedDismissibleElement)("inbox-onboarding-tour"),{stackBlueprint:a}=(0,hm.useAgentStackBlueprint)(),s=void 0!==a&&hu.INBOX_TOUR_STACK_BLUEPRINTS.has(a);return{shouldDisplay:t&&!n&&e&&!i&&s,dismiss:r,isLoading:n}}(n);return((0,ok.useLatestBuildActionUpdate)(e=>{"HostingBuildDeployStatusAction"===e.__typename&&e.status===lQ.HostingBuildStatus.Success&&r()}),n)?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)(V.View,{clsx:hO.default.container,children:[(0,x.jsx)(uX.IconButton,{onClick:()=>e.toggleContent("inbox"),alt:"Toggle inbox",dataCy:"toggle-inbox-sidebar",tooltipContents:(0,x.jsx)(hA,{shortcut:t,content:"inbox"}),size:28,ref:s,children:(0,x.jsx)(lI,{})}),i>0?(0,x.jsx)(V.View,{clsx:hO.default.indicator}):null]}),o&&a.current?(0,x.jsx)(hF,{targetRef:a,onDismiss:l}):null]}):null}var hB=e.i(749556),hU=e.i(414233),hN=e.i(317941);function hG({users:e=[],onAvatarClick:t,repl:n,isUnifiedPlanEnabled:i=!1}){let r=n.owner?.__typename==="Team",[a,s]=(0,v.useState)(!1);return(0,x.jsxs)(V.View,{row:!0,align:"center",gap:4,children:[e.length?(0,x.jsx)(h$,{users:e,onAvatarClick:t}):null,(0,x.jsxs)(d1.PopoverTrigger,{isOpen:a,onOpenChange:s,label:"Home",placement:"bottom start",children:[n.org?.type==="team"?(0,x.jsx)(se.Button,{size:"small",iconLeft:(0,x.jsx)(hB.default,{}),text:"Access"}):(0,x.jsx)(uX.IconButton,{alt:"Invite collaborator",size:28,children:(0,x.jsx)(hB.default,{})}),(0,x.jsx)(V.View,{clsx:hN.default.inviteDialog,children:(0,x.jsx)(hU.default,{replId:n.id,isTeamRepl:r,org:n.org??void 0,isUnifiedPlanEnabled:i,handleUpgradeTriggered:()=>{}})})]})]})}function h$({users:e,onAvatarClick:t}){let n=e.slice(0,2),i=e.length-2,[r,a]=(0,v.useState)(!1);return(0,x.jsxs)(V.View,{row:!0,gap:4,children:[n.map((e,n)=>(0,x.jsx)(hz,{onClick:()=>t(e),user:e,stacked:n>0},e.username)),i>0?(0,x.jsxs)(d1.PopoverTrigger,{isOpen:r,onOpenChange:a,label:"Home",placement:"bottom start",children:[(0,x.jsx)(se.Button,{size:"small",text:`+${i}`,clsx:[hN.default.stacked,hN.default.remainingCountButton]}),(0,x.jsxs)(cW.Menu,{children:[(0,x.jsx)(cW.MenuHeader,{text:"Observe..."}),e.slice(2).map(e=>(0,x.jsx)(cW.MenuItem,{onAction:()=>t(e),icon:(0,x.jsx)(cz.Avatar,{size:24,src:e.image||null,username:e.username,ringColor:e.color}),label:e.username},e.username))]})]}):null]})}function hz({user:e,stacked:t,onClick:n}){return(0,x.jsx)(uX.IconButton,{alt:`Observe ${e.username}`,onClick:n,clsx:[hN.default.avatar,{[hN.default.stacked]:t}],children:(0,x.jsx)(cz.Avatar,{size:24,src:e.image||null,username:e.username,ringColor:e.color})})}var hW=e.i(625251),hH=e.i(825516),hq=e.i(987143),hK=e.i(183462);let hY={},hX=w.gql`
    fragment WorkspaceHeaderNavMenuRepl on Repl {
  id
  org {
    id
    slug
  }
  ...ReplEnvironmentHeaderInviteButtonRepl
}
    ${hH.ReplEnvironmentHeaderInviteButtonReplFragmentDoc}`,hQ=w.gql`
    fragment WorkspaceHeaderNavMenuCurrentUser on CurrentUser {
  id
  isMemberOfAnyOrg
  image
  username
  ...UserLinkCurrentUser
  ...OrgSwitcherCurrentUser
}
    ${hq.UserLinkCurrentUserFragmentDoc}
${hK.OrgSwitcherCurrentUserFragmentDoc}`,hZ=w.gql`
    query WorkspaceHeaderNavMenu($replId: String!) {
  getRepl(id: $replId) {
    ... on Repl {
      ...WorkspaceHeaderNavMenuRepl
    }
  }
  currentUser {
    ...WorkspaceHeaderNavMenuCurrentUser
  }
}
    ${hX}
${hQ}`;var hJ=e.i(641555),h0=e.i(953436),h1=e.i(769822),h2=e.i(548733),h5=e.i(927196),h4=e.i(845411),h8=e.i(805518),h3=e.i(935267),h6=e.i(429878),h9=e.i(330069),h7=e.i(266899),me=e.i(273929),mt=e.i(495764),mn=e.i(531603),mi=e.i(371816),mr=e.i(995045),ma=e.i(344718),ms=e.i(841412),mo=e.i(988072),ml=e.i(346606),mu=e.i(384132);function md(e){var t;let n,[i,r]=(0,v.useState)(null),{count:a}=(0,h3.default)(),{refetch:s}=(0,pn.useGetAgentFreeUsage)({skip:!e.showUpsell}),{refetch:o}=(0,pi.useGetCloudFreeUsage)({skip:!e.showUpsell}),l=(0,Y.useIsInBonsaiWebview)(),u=(0,Y.useDoesBonsaiSupportFeature)("simplifiedTabletUI"),d=l&&u,{data:c}=(t={variables:{replId:e.replId},skip:d},n={...hY,...t},j.useQuery(hZ,n)),p=c?.getRepl.__typename==="Repl"?c.getRepl:null,h=c?.currentUser,m=function(e){let t={ssr:!1,fetchPolicy:"cache-and-network",nextFetchPolicy:"cache-first"},n=mt.RECENT_REPLS_SIDEBAR_MENU_COUNT,i=(0,h7.useSidebarRecentReplsQuery)({variables:{count:n},skip:null===e||!!e.org?.id,...t}),r=(0,h7.useSidebarRecentOrgReplsQuery)({variables:{count:n,orgId:e?.org?.id},skip:null==e||!e?.org?.id,...t});if(!e)return null;let a=[];return(r.data?.currentUser?.org?.__typename==="Org"?a=r.data.currentUser.org.recentRepls.items:i.data?.allRecentRepls&&(a=i.data.allRecentRepls),(a=a.filter(t=>t.id!==e.id).slice(0,me.RECENT_REPLS_DISPLAY_COUNT)).length)?a:null}(p);if(d)return(0,x.jsx)(V.View,{clsx:mu.default.emptySpacer});let f=p?.org?.slug,g=f?(0,cv.orgLinks)({slug:f}).home:{href:"/home",as:"/~"};return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(h5.AgentStatusProvider,{children:(0,x.jsx)(M.NavMenu,{onOpenChange:t=>{t&&e.showUpsell&&(s(),o())},children:h&&p?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)(cW.Menu,{"aria-label":"Navigation menu",clsx:mu.default.menu,children:[(0,x.jsx)(cW.MenuItem,{icon:(0,x.jsx)(h0.default,{}),label:"Home",href:g.href,as:g.as}),m?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(mh,{repls:m}),(0,x.jsx)(cW.Separator,{})]}):null,h?(0,x.jsx)(mi.AccountItems,{setActiveModal:e=>r({type:e}),currentUser:h,notificationCount:a}):null,h?.isMemberOfAnyOrg?(0,x.jsx)(mo.TeamsItem,{currentUser:h}):null,(0,x.jsx)(ml.ThemeItem,{}),(0,x.jsx)(ma.HelpItem,{setActiveModal:e=>r({type:e}),children:(0,x.jsx)(mf,{setActiveModal:r})}),h?(0,x.jsx)(mr.DevCopyUsernameItem,{currentUser:h}):null,(0,x.jsx)(cW.Separator,{}),(0,x.jsx)(ms.LogoutItem,{})]}),e.showUpsell?(0,x.jsx)(V.View,{pb:10,children:(0,x.jsx)(mp,{})}):null]}):(0,x.jsx)(dh.default,{})})}),(0,x.jsxs)(aK.Modal,{isOpen:null!==i,onRequestClose:()=>r(null),children:[i?.type==="support"?(0,x.jsx)(mn.default,{onRequestClose:()=>r(null)}):null,i?.type==="notifications"?(0,x.jsx)(mc,{}):null,i?.type==="referral"?(0,x.jsx)(h2.ReferralLinkModalContent,{trackingContext:"workspace-nav-menu"}):null,i?.type==="feedback"?(0,x.jsx)(h6.AIFeedback,{session:i.session,onClose:()=>r(null)}):null]})]})}function mc(){return(0,x.jsxs)(V.View,{gap:12,children:[(0,x.jsx)(st.Text,{variant:"subheadDefault",children:"Notifications"}),(0,x.jsx)(h8.default,{count:10,loadMore:!0,markAsSeen:!0})]})}function mp(){let{agentUsage:e,agentUsageV2:t}=(0,pn.useGetAgentFreeUsage)(),{cloudUsage:n}=(0,pi.useGetCloudFreeUsage)();return(0,x.jsx)(V.View,{gap:8,px:8,pt:12,clsx:mu.default.usage,children:(0,x.jsx)(pt,{agentLimit:t?t.limit:e?.limit,agentUsage:t?t.usage:e?.usage,cloudLimit:n?.limit,cloudUsage:n?.usage,agentNextCreditsAt:t?.nextCreditsAt,cloudNextCreditsAt:n?.nextCreditsAt,isUnderMonthlyQuota:t?.isUnderMonthlyQuota})})}function mh({repls:e}){return(0,x.jsxs)(hW.MenuSection,{children:[(0,x.jsx)(cW.MenuHeader,{text:"Recent"}),e.map(e=>(0,x.jsx)(mm,{repl:e},e.id))]})}function mm({repl:e}){let t=(0,lT.useObservable)((0,h4.useReplAgentStatus)(e));return(0,x.jsxs)(cW.BaseMenuItem,{textValue:e.title,clsx:mu.default.repl,...(0,cq.replLinkProps)(e),children:[(0,x.jsxs)(V.View,{align:"center",row:!0,gap:6,grow:!0,shrink:!0,pl:0,children:[(0,x.jsx)(o1.default,{size:20,alt:e.title,iconUrl:e.iconUrl}),(0,x.jsx)(st.Text,{translate:"no",children:e.title})]}),t&&"Paused"!==t.label?(0,x.jsx)(st.Text,{variant:"small",color:"dimmer",children:t.label}):null]},e.id)}function mf(e){let{shouldSeeFreemiumExperience:t}=(0,h9.useShouldSeeFreemiumExperience)(),n=(0,dx.useChatter)(),i=(0,hJ.useObservableMemo)(()=>n.sessions.agent.current,[n]);return!i||t?null:(0,x.jsx)(cW.MenuItem,{icon:(0,x.jsx)(h1.default,{}),label:"Submit feedback",onAction:()=>e.setActiveModal({type:"feedback",session:i})})}var mg=e.i(279606);function mx(e){let t,n=(t=n6(i5),(0,v.useMemo)(()=>new ep.Multicast(e=>(e.next(t.current),t.subscribe(t=>e.next(t)))),[t])),i=(0,eh.useCreateObservableAtom)(i1,n8()),r=(0,eh.useCreateObservableAtom)(iv,n8());return(0,v.useMemo)(()=>{var t;let a,s;return t={headerWidth:mg.Observable.from(i).select(t=>t[e]),tabHeaderWidth:n.select(t=>t[e]),sidebarWidth:mg.Observable.from(r).select(t=>t[e])},a=null,s=null,new ep.Multicast(e=>mg.Observable.combine(t.headerWidth,t.tabHeaderWidth,t.sidebarWidth).subscribe(([t,n,i])=>{if(null===t)return;let r=null===s?null:s-t+10;if(null!==s&&i>s){"large"!==a&&(a="large",e.next("large"));return}if(n<=200&&"small"!==a){a="small",s=t,e.next("small");return}n>200&&"large"!==a&&(null===r||n>200+r)&&(a="large",e.next("large"))}))},[n,i,r,e])}var my=e.i(782514),mv=e.i(342571);let mw=(0,A.cvarsFrom)("index.module.css",["--z-index","--height"]);function mb(e){let t=n9(i2),n=(0,W.default)();return(0,dM.default)(i=>{n||t(e,i.width)})}function mj(){return{[mw.zIndex]:tN.tiledPane.toString(),[mw.height]:_.APP_HEADER_HEIGHT+"px"}}function mS({repl:e,isUnifiedPlanEnabled:t}){let n=n3(tO),i=(0,W.default)(),r=n3(tB);return(0,x.jsxs)(my.TrackingHierarchyProvider,{hierarchy:{surface:"workspace_header"},children:[i?(0,x.jsx)(V.View,{clsx:mv.default.desktopDragRegion}):null,(0,x.jsx)(mk,{repl:e}),r?null:(0,x.jsx)(mT,{repl:e,isUnifiedPlanEnabled:t}),n?(0,x.jsx)(mE,{repl:e}):null]})}function mk({repl:e}){let t=aD(),n=(0,up.default)(t.agentFiletreeOrder),i=mj(),r=n7(t7),a=mb("left"),s=(0,lT.useObservable)(mx("left")),{isWebDesignMockup:o}=(0,cJ.useIsAgentWebDesignMockup)(),l=(0,dx.useChatter)(),u=(0,lT.useObservable)(l.sessions.agent.current),d=(0,H.useFlag)({controlName:"flag-repl-info-dropdown-menu"}),c=aR(),p=(0,up.default)(c.view).width,h=(0,up.default)(c.isOpen),m=p>0,f=m&&h,g="agent-filetree"===n&&m;return(0,x.jsxs)(V.View,{row:!0,align:"center",innerRef:a,style:i,clsx:mv.default.left,children:[g?(0,x.jsx)(V.View,{row:!0,align:"center",justify:"center",clsx:mv.default.logoContainer,children:(0,x.jsx)(md,{replId:e.id,showUpsell:"small"===s&&e.authorizations.viewFreemiumExperience.isAuthorized})}):null,(0,x.jsxs)(V.View,{pl:6*!g,pr:6,row:!0,align:"center",children:[(0,x.jsx)(P.default,{}),"agent-filetree"!==n?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(hD,{}),(0,x.jsx)(hL,{})]}):(0,x.jsx)(uJ,{}),g?null:(0,x.jsx)(md,{replId:e.id,showUpsell:"small"===s&&e.authorizations.viewFreemiumExperience.isAuthorized}),(0,x.jsxs)(V.View,{pl:6*!!g,row:!0,align:"center",grow:!0,children:[(0,x.jsx)(hl,{hideTitle:"small"===s&&!f,repl:e}),(0,x.jsxs)(V.View,{row:!0,gap:4,align:"center",children:[d?(0,x.jsx)(cZ,{repl:e,hideTitle:"small"===s&&!f,getDesktopLayoutState:r}):(0,x.jsx)(d5,{repl:e,getDesktopLayoutState:r,hideTitle:"small"===s&&!f}),(0,x.jsxs)(V.View,{row:!0,gap:8,align:"center",children:[o?(0,x.jsx)(dL.DesignMockupPill,{session:u}):(0,x.jsx)(hI,{}),"small"!==s&&e.authorizations.viewFreemiumExperience.isAuthorized?(0,x.jsx)(mC,{replUrl:e.url}):null]})]})]})]})]})}function mC({replUrl:e}){return(0,x.jsxs)(V.View,{row:!0,gap:8,align:"center",children:[(0,x.jsx)(po,{}),(0,x.jsx)(dO.default,{text:"Upgrade",context:"agent_freemium_quota_v2",colorway:"primary",variant:"default",size:"small",redirectPath:e,modalHeadingText:"Compare Replit plans",modalSubHeadingText:"Autonomy for all. Choose the best plan for you."})]})}function mT({repl:e,isUnifiedPlanEnabled:t}){let n=mb("right"),i=mj(),r=aD(),a=(0,up.default)(r.agentFiletreeOrder),s=(0,lT.useObservable)(mx("right")),o=e.authorizations.viewPermissions.isAuthorized,l=e.authorizations?.viewDeploymentConfig?.isAuthorized,u=e.hostingDeployment?.__typename==="HostingDeployment"?e.hostingDeployment:null,{isAgentStackRepl:d}=(0,dB.useIsAgentStackRepl)(),c=u?.replitAppSubdomain?`https://${u.replitAppSubdomain}.replit.app`:null,p=u?.latestBuildStatus==="running"||u?.latestBuildStatus==="success",h=(0,c0.useActiveUsers)(),m=function(e){let{presence:t}=(0,sg.default)(),n=(0,nC.useGetActiveFile)(),i=(0,at.default)(e);return(0,v.useCallback)(({username:e,id:r})=>{let a=t.getFollowedUser();if(a?.username===e)return void t.unfollowUser();t.followUser(e);let s=t.getActiveFileForUser(r),o=n();s&&s!==o&&i.current({path:s})},[i,n,t])}(aC()),{showConfirm:f}=(0,sr.default)(),[g,y]=(0,d_.default)("deploy-button"),{shouldDisplay:w,dismiss:b}=function(){let e=(0,a9.default)(),{isEnabled:t}=(0,lF.useShowAgentInbox)(e),{isEnabled:n}=lG(),i=hp(),{stackBlueprint:r}=(0,hm.useAgentStackBlueprint)(),{isLoading:a,isDone:s,setAsDone:o}=(0,hh.useMemoedDismissibleElement)("publish-feedback-tour"),l=void 0!==r&&hu.INBOX_TOUR_STACK_BLUEPRINTS.has(r);return{shouldDisplay:i&&!a&&t&&!n&&!s&&l,dismiss:o,isLoading:a}}(),j=(0,W.default)(),S=(0,dF.useIsWindows)();return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(V.View,{row:!0,align:"center",style:i,clsx:mv.default.right,innerRef:n,children:(0,x.jsxs)(V.View,{px:6,row:!0,gap:4,align:"center",clsx:{[mv.default.desktopAppWindowsOs]:S&&j},children:[(0,x.jsx)(pl,{}),o?(0,x.jsx)(hG,{repl:e,users:h,onAvatarClick:m,isUnifiedPlanEnabled:t}):null,l&&!d&&c&&p?(0,x.jsx)(se.Button,{size:"small",text:"Share",iconLeft:(0,x.jsx)(dV.default,{}),colorway:"primary",onClick:()=>{(0,oF.default)(c),f("App link copied to clipboard!")}}):null,l?(0,x.jsx)(V.View,{innerRef:y,children:(0,x.jsx)(pZ,{iconOnly:"small"===s,isDesignMode:!!e.config.isWebDesignMockup})}):null,"agent-filetree"===a?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(hL,{}),(0,x.jsx)(hD,{flipped:!0})]}):(0,x.jsx)(uJ,{})]})}),w&&g.current?(0,x.jsx)(hf,{targetRef:g,onDismiss:b}):null]})}function mE({repl:e}){let t=mj();n9(r9);let n=(0,H.useFlag)({controlName:"flag-agent-debug-info-button"});return(0,x.jsxs)(R.ShadesSurface,{row:!0,clsx:mv.default.planningHeader,justify:"space-between",align:"center",px:6,style:t,elevate:!1,children:[(0,x.jsxs)(V.View,{row:!0,align:"center",clsx:mv.default.planningHeaderLeft,children:[(0,x.jsx)(P.default,{}),(0,x.jsx)(md,{showUpsell:!1,replId:e.id}),(0,x.jsx)(st.Text,{translate:"no",children:e.title})]}),(0,x.jsx)(V.View,{align:"center",justify:"center",clsx:mv.default.planningTimeline,children:(0,x.jsx)(dU.PlanningTimeline,{onBuildClick:void 0})}),n?(0,x.jsx)(mI,{}):null]})}function mI(){let e=(0,dx.useChatter)(),t=(0,lT.useObservable)(e.sessions.agent.current);return t?(0,x.jsx)(dN.AiSessionDebugInfoButton,{sessionId:t.id,sessionType:dg.SessionType.AGENT_SESSION}):null}var mP=e.i(848415);e.i(312917);var mA=e.i(675186),mR=e.i(387491);function mD(e,t){let n=(0,at.default)(t);return(0,v.useMemo)(()=>{var t,i;return t="current"in e?new ep.Multicast(t=>(t.next(e.current),e.subscribe(e=>t.next(e)))):e,i=()=>n.current(),new ep.Multicast(e=>{let n=null,r=null,a=null,s=null,o=t.subscribe(function(t){n?.stop(),r&&(clearTimeout(r),r=null);let o=i();if(!o&&s&&(o=s),!1===o){a=t,e.next(t);return}s=o;let{snappiness:l=400,ramp:u,delay:d=0}=!0===o?{}:o,c=0,p={};for(let e in t)p[e]=a&&e in a?a[e]:t[e];n=new mA.AnimationLoop((n,i)=>{for(let e in c+=n,t){if("number"!=typeof p[e]||"number"!=typeof t[e]){p[e]=t[e];continue}let i=p[e],r=t[e],a=i>=0&&i<=1&&r>=0&&r<=1?.001:void 0;p[e]=(0,mR.damp)({current:i,target:r,elapsed:c,delta:n,snappiness:l,ramp:u,minStepSize:a})}e.next({...p}),(0,ti.default)(p,t)&&(s=null,a=t,i())}),d>0?r=setTimeout(()=>{r=null,n?.start()},d):n.start()});return()=>{n?.stop(),r&&clearTimeout(r),o()}})},[e,n])}var mV=e.i(802088),m_=e.i(516351),mM=e.i(375032);let mF=(0,A.cvarsFrom)("Border.module.css",["--header-height","--border-color","--box-shadow","--y-offset","--border-radius"]),mO=(0,v.memo)(function({paneId:e,...t}){let n=aI(e),i=(0,up.default)(n.paneType),r=(0,up.default)(n.border),a=(0,up.default)(n.isMaximized),s=(0,m_.default)(),o="var(--surface-border-color-regular)",l="none",u=0,d=0;switch(r){case"dragging":case"floating":o="var(--surface-border-color-regular)",l=A.tokens.shadow2,u=t.headerHeight,d=6}let c=function({paneId:e}){return n3((0,q.default)(()=>(0,J.atom)(t=>t(e7)===e),[e]))}({paneId:e});s&&c&&(o=s.color,l=`0 0 0 3px ${s.color}`);let[p,h]=(0,v.useState)(!1);return((0,mV.useObserver)((0,uK.useAgentIsWorking)(),{next:"webview"===i?h:void 0}),a)?null:(0,x.jsx)(V.View,{style:{[mF.headerHeight]:`${u}px`,[mF.borderColor]:o,[mF.boxShadow]:l,[mF.yOffset]:d+"px",[mF.borderRadius]:"6px"},clsx:[mM.default.root,{[mM.default.pulse]:p}]})});var mL=e.i(31290);let mB=V.SpecializedView.div,mU=(0,l7.css)([au.rcss.width("100%"),au.rcss.position.absolute,au.rcss.left(0),{cursor:"ns-resize",zIndex:1,":hover":{transform:"scaleY(4)"}}]),mN=(0,l7.css)([au.rcss.height("100%"),au.rcss.position.absolute,au.rcss.top(0),{cursor:"ew-resize",zIndex:1,":hover":{transform:"scaleX(4)"}}]),mG=(0,l7.css)([au.rcss.position.absolute,{zIndex:2,transform:"scale(2)",":hover":{transform:"scale(4)"}}]);function m$(e){return{transformOrigin:`${"topLeft"===e||"bottomLeft"===e?"right":"left"} ${"topLeft"===e||"topRight"===e?"bottom":"top"}`}}let mz={topLeft:(0,l7.css)([au.rcss.top(0),au.rcss.left(0),m$("topLeft")]),topRight:(0,l7.css)([au.rcss.top(0),au.rcss.right(0),m$("topRight")]),bottomLeft:(0,l7.css)([au.rcss.bottom(0),au.rcss.left(0),m$("bottomLeft")]),bottomRight:(0,l7.css)([au.rcss.bottom(0),au.rcss.right(0),m$("bottomRight")])};function mW({edge:e,size:t,onPointerDown:n}){if("top"===e||"bottom"===e)return(0,x.jsx)(mB,{onPointerDown:n,style:{height:t,[e]:-t},css:mU});if("right"===e||"left"===e)return(0,x.jsx)(mB,{onPointerDown:n,style:{width:t,[e]:-t},css:mN});let i="topLeft"===e||"bottomRight"===e?"nwse-resize":"nesw-resize";return(0,x.jsx)(mB,{onPointerDown:n,style:{height:t,width:t,cursor:i},css:[mG,mz[e]]})}let mH=["bottom","right","left","bottomRight","bottomLeft"],mq=(0,v.memo)(function(e){let t=n9(rI);return(0,x.jsx)(x.Fragment,{children:mH.map(n=>(0,x.jsx)(mW,{size:8,edge:n,onPointerDown:i=>{(0,mL.measureMouseMove)(i,{start(){t({type:"start",paneId:e.paneId,edge:n})},move({delta:e}){t({type:"update",moveDelta:e})},end(){t({type:"end"})}})}},n))})}),mK=["top","right","left","topRight","topLeft"],mY=(0,v.memo)(function(e){let t=n9(rI);return(0,x.jsx)(x.Fragment,{children:mK.map(n=>(0,x.jsx)(mW,{size:8,edge:n,onPointerDown:i=>{(0,mL.measureMouseMove)(i,{start(){t({type:"start",paneId:e.paneId,edge:n})},move({delta:e}){t({type:"update",moveDelta:e})},end(){t({type:"end"})}})}},n))})}),mX={isConnecting:!0,channel:null,context:null};function mQ({container:e,service:t,name:n,skip:i=!1}){let[r,a]=(0,v.useState)(mX);return(0,v.useEffect)(()=>{a(mX);let r=!1,s=e.openChannel({service:t,name:n,skip:()=>i},e=>{if(!r)return a({context:e.context,channel:e.channel,isConnecting:!1}),e=>{r||a({isConnecting:e.willReconnect,channel:null,context:null})}});return()=>{r=!0,s()}},[e,t,n,i]),r}var mZ=e.i(259475),mJ=v,m0=e.i(37292),m1=e.i(794149);class m2 extends mJ.Component{state={hasErrored:!1,error:null,errorInfo:null};componentDidCatch(e,t){this.setState({hasErrored:!0,error:e,errorInfo:t}),this.props.handleError(e,t),console.error(e)}render(){return this.state.hasErrored?this.props.fallback&&this.state.error&&this.state.errorInfo?this.props.fallback(this.state.error):(0,x.jsx)(V.View,{clsx:m1.default.errorMessage,children:this.state.error?.stack??"An unknown error occurred."}):this.props.children}}function m5({bsod:e=!1,reportToSentry:t=!0,handleError:n,children:i,origin:r="ErrorBoundary: (no origin provided)",tags:a={},extras:s={},fallback:o}){let l=(0,m0.useThrowBsod)();return(0,x.jsx)(m2,{fallback:o,handleError:(i,o)=>{e?l({error:i,extras:{...s,errorInfo:o},componentStack:o.componentStack||void 0,tags:{...a,errorBoundary:!0},origin:r}):t&&dm.withScope(e=>{e.setTag("errorBoundary",!0),e.setTags(a),e.setExtra("errorInfo",o),e.setExtras(s),e.setContext("react",{componentStack:o.componentStack}),dm.captureException(i)}),n&&n(i,o)},children:i})}var m4=e.i(231927);let m8=(0,A.cvarsFrom)("index.module.css",["--transform-x","--transform-y","--scale","--transform-origin-x","--width","--height","--opacity","--interaction-blanket-display","--pointer-events","--user-select","--border-top-left-radius","--border-top-right-radius","--border-gap","--iframe-pointer-events"]),m3=(0,v.memo)(function({paneId:e}){let t,n,i,r,a,{Content:s}=(0,aF.usePaneUIContext)(),o=aI(e),l=(0,up.default)(o.isHidden),u=(0,up.default)(o.data),d=(0,up.default)(o.isActive),c=(0,up.default)(o.isCommitted);(0,nC.usePaneSession)(e,u);let p=(t=sa(),n=n9(iR),i=n9(nM),r=n9(tt),a=n9(ny),(0,q.default)(()=>s=>{switch(s.operation){case"commit":r(e);return;case"open":if(s.floating)return void n(s.pane,{commit:!0,location:"center"});t({pane:s.pane,activate:!0,placement:{type:"after",paneId:e}});return;case"replace":i({paneId:e,pane:s.pane});return;case"remove":a(s.pane.id);return;case"openPip":return;default:(0,da.default)(s)}},[r,e,i,a,t,n])),h=function(){let{container:e}=(0,sg.default)(),{channel:t}=mQ({container:e,service:"panetracker"});return(0,v.useCallback)((e,n)=>{t&&t.send({paneMetricsTracker:{pane:e,flow:n}})},[t])}();return(0,x.jsx)(s,{pane:u,options:{paneId:e,isHidden:l,performPaneOperation:p,isActive:d,isCommitted:c,emitPaneMetrics:h}})}),m6=(0,v.memo)(function({paneId:e}){let t=aj(),n=function({paneId:e}){let[{isOver:t},n]=(0,mP.useDrop)({accept:[n_.FileType.File,mZ.DragItems.Pane,mZ.DragItems.NewPane],collect:e=>({isOver:e.isOver()}),hover(t,n){let r=n.getClientOffset();r&&i.drag({pageX:r.x,pageY:r.y,over:e})},drop(t,n){let r=n.getClientOffset();if(r){if(t.type===mZ.DragItems.Pane)return void i.drop({type:"pane",paneId:t.paneId,pageX:r.x,pageY:r.y,over:e});if("nodes"===t.type){let n=(0,e9.fsNodeToPanes)(t.nodes);n.length>0&&i.drop({type:"newPaneGroup",panes:n,pageX:r.x,pageY:r.y,over:e})}if(t.type===mZ.DragItems.NewPane){let{pane:n}=t;i.drop({type:"newPaneGroup",panes:[n],pageX:r.x,pageY:r.y,over:e})}}}}),i=function({isOver:e}){let t=n9(ii);return(0,v.useEffect)(()=>{e||t(null)},[e,t]),{drag:n9(ro),drop:n9(rl)}}({isOver:t});return n}({paneId:e}),i=aI(e),r=(0,up.default)(i.isActive),a=(0,up.default)(i.isFloating),s=(0,up.default)(i.isModal),o=(0,up.default)(i.paneType),l=(0,W.default)(),u=(0,dF.useIsMac)(),d=(0,dF.useIsWindows)(),c=(u||d)&&l?_.HEADER_HEIGHT:0,p=(0,v.useRef)(null);(0,tZ.useStyleSet)(p,mD(i.properties,i.getTransitionEnabled),e=>{let{width:t,height:n,x:i,y:r,scale:a,opacity:s}=e;return{[m8.width]:t+"px",[m8.height]:n+"px",[m8.transformX]:i+"px",[m8.transformY]:r+"px",[m8.scale]:a.toString(),[m8.opacity]:s.toString()}}),(0,tZ.useStyleSet)(p,i.transformOriginXAtom,e=>({[m8.transformOriginX]:e})),(0,tZ.useStyleSet)(p,i.viewportInset,({x:e,y:t})=>({"--fixed-position-offset-x":-e+"px","--fixed-position-offset-y":-t-c+"px"})),(0,tZ.useStyleSet)(p,i.isHidden,e=>({[m8.pointerEvents]:e?"none":"auto"})),(0,tZ.useStyleSet)(p,i.zIndex,e=>({"z-index":e.toString()})),(0,tZ.useStyleSet)(p,i.disableInteractions,e=>({[m8.interactionBlanketDisplay]:e?"block":"none",[m8.userSelect]:e?"none":"auto",[m8.iframePointerEvents]:e?"none":"auto"}));let h=r?void 0:()=>{t(e,{commit:"codeEditor"!==o})},m=(0,aO.useSetPaneElement)(),f={[m8.borderGap]:"4px"};a||(f[m8.borderTopLeftRadius]="6px",f[m8.borderTopRightRadius]="6px");let g=(0,sm.useMergeRefs)([p,a?void 0:n],{breadcrumb:"client/replEnvironmentDesktop/Pane/index.tsx:324"}),y=n9(av),w=(0,up.default)(i.headerHeight);return(0,x.jsx)(my.TrackingHierarchyProvider,{hierarchy:{surface:`${o}_pane`},children:(0,x.jsx)(aO.PaneIdProvider,{value:e,children:(0,x.jsx)(R.ShadesSurface,{elevate:"1x",role:"tabpanel",id:e,"aria-labelledby":`tab-${e}`,innerRef:g,clsx:m4.default.root,style:f,onMouseEnter:()=>y(e),onMouseLeave:()=>y(null),children:(0,x.jsxs)(m5,{origin:"ErrorBoundary: PaneContainer",bsod:!0,tags:(0,q.default)(()=>({paneType:o}),[o]),children:[(0,x.jsxs)(V.View,{clsx:m4.default.container,onMouseDown:h,onContextMenu:h,innerRef:t=>m(e,t),style:"agentChat"===o?{overflowX:"hidden"}:void 0,children:[(0,x.jsx)(V.View,{tabIndex:-1}),(0,x.jsx)(m3,{paneId:e})]}),(0,x.jsx)(mO,{headerHeight:w,paneId:e}),a&&!s?(0,x.jsx)(mq,{paneId:e}):null,(0,x.jsx)(V.View,{clsx:m4.default.interactionBlanket})]},e)})})})});var m9=e.i(822243),m7=e.i(429225),fe=e.i(59380);(0,ie.cssRecord)({handle:[au.rcss.minWidth(16),au.rcss.height("100%")]});var ft=e.i(112077),fn=e.i(907371),fi=e.i(33171);let fr=(0,A.cvarsFrom)("Tab.module.css",["--width","--x","--color","--bg","--font-style"]);function fa(e){return{[fr.width]:e.width+"px",[fr.x]:e.x+"px",[fr.bg]:e.active?A.tokens.surfaceBackground:"",[fr.color]:e.active?A.tokens.foregroundDefault:""}}function fs(e){let t,{layout:n,paneId:i,paneGroupId:r}=e,a=aw(i),s=(0,v.useMemo)(()=>n.tab(i),[n,i]),o=(0,v.useRef)(null),l=aI(e.paneId),u=(0,lT.useObservable)(l.isCommitted),d=(0,lT.useObservable)(l.isActive),c=(0,nC.useUniquePath)((0,e9.isFilePane)(a)?a.data.path:null),p=function({paneId:e,paneGroupId:t}){let n=(0,aO.useGetPaneBindings)(),i=ab(),r=uS({paneId:e}),a=uo({paneId:e,paneGroupId:t}),s=ul(),o=(0,aF.usePaneUIContext)();return(0,v.useCallback)(()=>{let{pane:t}=i(e),l=n(e),u=e=>!!e&&"object"==typeof e&&"data"in e;return{data:{type:"context",label:"Search actions",icon:(0,x.jsx)(o.Icon,{pane:t})},commands:()=>[{data:{type:"group",key:"pane-actions"},commands:()=>(l?.commands?.flatMap(e=>e.commands)??[]).filter(u)},{data:{type:"group",key:"secondary"},commands:()=>[s(e),r,...a].filter(u)}]}},[n,o,i,e,r,a,s])}({paneId:i,paneGroupId:r}),{onContextMenu:h}=(0,fe.useContextMenu)();(0,tZ.useStyleSet)(o,mD(s,()=>!0),fa);let m=n9(ny),f=n9(nL),g=(0,aF.usePaneUIContext)(),y=g.getTitle(a),w=g.Icon({pane:a,size:16}),b=function(){let e=(0,v.useRef)(null),t=(0,v.useRef)(!1),n=(0,ft.useCreateObservable)(!1);function i(){let i=e.current;if(!i)return;let r=i.scrollWidth>i.clientWidth;n.set(r),t.current=!1}let r=(0,dM.default)(()=>{t.current||(t.current=!0,requestAnimationFrame(i))});return{state:n,ref:(0,sm.useMergeRefs)([e,r])}}(),j=(0,lT.useObservable)(b.state);(0,e9.isFilePane)(a)&&a.data.path?t=a.data.path:j&&(t=y);let S=!u&&"commands"!==a.type,k=n9(tt),C=(0,uW.useObservableRef)(l.isActive),T=()=>{C.current&&!u?k(i):f(i)},E=(0,fn.useCreateInteractive)({variant:"nofill"}),{dragRef:I}=function(e,t){let[n,i]=(0,m9.useDrag)({type:mZ.DragItems.Pane,item:()=>({type:mZ.DragItems.Pane,paneId:e,width:80}),end:()=>{t.dragState.set(null)},collect:t=>{let n=t.getItem();return{isActive:n?.paneId===e,isDragging:t.isDragging()}}}),r=n9(n$),{isDragging:a,isActive:s}=n;return(0,v.useEffect)(()=>{r(a)},[r,a]),(0,v.useEffect)(()=>{t.dragState.set(s?{id:e}:null)},[t,s,e]),{dragRef:i}}(e.paneId,e.layout),P=(0,sm.useMergeRefs)([o,e.isOnlyTab?void 0:I]),A=(0,uW.useObservableRef)(n.state),D=(0,v.useRef)(null);if(null===D.current){let e=A.current?.tabs.get(i);e&&(D.current=fa({...e,active:!0}))}return(0,x.jsxs)(R.ShadesSurface,{elevate:!!d&&"2x",style:{[fr.fontStyle]:S?"italic":"inherit",...D.current,...E.style},onMouseUp:e=>{1===e.button&&(e.preventDefault(),e.stopPropagation(),m(i))},innerRef:P,align:"center",justify:"center",row:!0,clsx:[fi.default.tab,E.clsx],onContextMenu:e=>h(e,{command:p()}),children:[(0,x.jsx)(dQ.Tooltip,{tooltip:t,delay:"long",placement:"bottom",isDisabled:!t,children:(e,t)=>(0,x.jsxs)(V.View,{...e,innerRef:t,pl:6,tag:"button",clsx:fi.default.tabButton,row:!0,grow:!0,shrink:!0,align:"center",gap:6,onClick:T,children:[w,(0,x.jsx)(st.Text,{ref:c?void 0:b.ref,multiline:!1,clsx:fi.default.title,children:y}),c?(0,x.jsx)(st.Text,{variant:"small",clsx:fi.default.title,color:"dimmest",multiline:!1,children:c}):null]})}),(0,x.jsx)(uX.IconButton,{alt:"Close tab",clsx:fi.default.closeButton,size:28,onClick:()=>m(i),children:(0,x.jsx)(ui.default,{size:12})})]})}var fo=e.i(790164);let fl={newTabButtonWidth:28,defaultTabWidth:160,gap:4};class fu{containerWidth=new fo.ObservableState(0);isHovered=new fo.ObservableState(!1);dragState=new fo.ObservableState(null);dropState=new fo.ObservableState(null);activeId;paneIds;constructor(e){this.paneIds=e.paneIds,this.activeId=e.activeId}state=new ep.Multicast(e=>{let t=null;return mg.Observable.combine(this.paneIds,this.containerWidth,this.isHovered,this.dragState,this.dropState).subscribe(([n,i,r,a,s])=>{let o;if(s){let e=s.item.type===mZ.DragItems.Pane?s.item:null,n=e?t?.tabs?.get(e.paneId):null;o={xOffset:s.pointer.x,width:n?n.width:fl.defaultTabWidth,id:e?e.paneId:void 0}}let l=function({ids:e,gap:t,containerWidth:n,defaultTabWidth:i,newTabButtonWidth:r,matchWidths:a,dropArea:s,dragState:o}){let l,u,d=new Map;if(0===e.length||0===n)return{tabs:d};o?u="own-tab":s?.id&&(u="external");let c=n-r-t,p=e.length;"external"===u&&(p+=1);let h=p-1,m=p*i+h*t<=c?i:(c-h*t)/p,f=a&&e.length<a.size,g=0;for(let n of e){let e=f?a?.get(n)?.width??m:m,i=g+e+t/2;s&&s.xOffset>=g&&s.xOffset<i&&(l={preview:{x:g,width:e},index:d.size},g+=e+t);let r=o?.id===n;d.set(n,{x:g,width:r?0:e}),r||(g+=e+t)}return s&&!l&&(l={preview:{x:g,width:f?a?.get(e[e.length-1])?.width??m:m},index:d.size}),{tabs:d,dropData:l}}({containerWidth:i,ids:n,matchWidths:r&&t?t.tabs:void 0,...fl,dropArea:o,dragState:a||void 0});(0,ti.default)(t,l)||(t=l,e.next(l))})});dropIndex=new ep.Multicast(e=>{let t=null;return this.state.subscribe(n=>{let i=n.dropData?.index??null;i!==t&&(t=i,e.next(i))})});setContainerWidth=e=>{this.containerWidth.set(e)};tabs=new ep.Multicast(e=>this.state.select(e=>e?Array.from(e.tabs.keys()):[]).subscribe(e));tab(e){return new ep.Multicast(t=>{let n=null;return mg.Observable.combine(this.state,this.activeId,this.dropState).subscribe(([i,r,a])=>{let s=i.tabs.get(e);if(!s)return;let o={...s,active:r===e,isBeingDragged:a?.item?.type===mZ.DragItems.Pane&&a?.item?.paneId===e};(0,ti.default)(n,o)||(n=o,t.next(o))})})}newTab=new ep.Multicast(e=>{let t=null;return this.state.subscribe(n=>{let i=Array.from(n.tabs.keys()).pop(),r=i?n.tabs.get(i):null;if(!r)return;let a={x:r.x+r.width+4,width:28,visible:!n.dropData};n.dropData&&n.dropData?.index>=n.tabs.size&&(a.x+=n.dropData.preview.width+4),(0,ti.default)(t,a)||(t=a,e.next(a))})});dropPreview=new ep.Multicast(e=>{let t=null;return this.state.subscribe(n=>{let i=n.dropData?.preview??null;(0,ti.default)(t,i)||(t=i,e.next(i))})});width=new ep.Multicast(e=>this.containerWidth.subscribe(e))}var fd=e.i(13891);let fc=(0,A.cvarsFrom)("index.module.css",["--new-tab-width","--new-tab-x","--drop-preview-width","--drop-preview-x","--drop-preview-opacity"]),fp=(0,v.memo)(function(e){let t=aE(e.headerId),n=(0,v.useMemo)(()=>new fu({paneIds:mg.Observable.from(t.panes),activeId:mg.Observable.from(t.activeTabPaneId)}),[t.panes,t.activeTabPaneId]),i=(0,lT.useObservable)(n.tabs),r=(0,dM.default)(e=>n.setContainerWidth(e.width),{type:"debounce",wait:100}),a=n9(nD),s=i?.length===1,o=(0,up.default)(t.activeTabPaneId),{cursor:l,onPointerDown:u,toggleMaximizedPaneGroup:d,isMaximized:c}=function({paneGroupId:e,activeTabPaneId:t}){let{isDragging:n,dnd:i}=function({paneGroupId:e}){let t=n9(iH),n=n9(iq),i=n9(iX),r=(0,q.default)(()=>({start({mouse:n}){t({paneGroupId:e,mouse:n})},update(e){n(e)},end(e){i(e)}}),[e,t,n,i]);return{isDragging:function({paneGroupId:e}){return n3((0,q.default)(()=>(0,J.atom)(t=>e===t(i$)?.paneGroupId),[e]))}({paneGroupId:e}),dnd:r}}({paneGroupId:e}),{toggleMaximizedPaneGroup:r}=aT(),a=aP(e),s=(0,up.default)(a.isMaximized),o=aj();return{dnd:i,cursor:n?"grabbing":"grab",onPointerDown:e=>{o(t),!s&&"button"in e&&0===e.button&&(0,mL.measureMouseMove)(e,{start:i.start,move:i.update,end:i.end})},toggleMaximizedPaneGroup:r,isMaximized:s}}({paneGroupId:e.headerId,activeTabPaneId:o}),p=(0,v.useRef)(null),{dropRef:h}=function(e,t,n){let i,r,a,s,o=(0,v.useRef)(null),l=(0,uW.useObservableRef)(t.dropIndex),u=(i=n9(nD),r=n9(nN),a=aE(e),s=(0,up.default)(a.panes),(0,v.useCallback)((t,n)=>{let a=n?.index!==null?n?.index:s.length;if("nodes"===t.type){let n=(0,e9.fsNodeToPanes)(t.nodes);n.length>0&&i({activate:!0,commit:!0,paneGroupId:e,index:a,panes:n});return}if(t.type===mZ.DragItems.NewPane)return void i({activate:!0,paneGroupId:e,index:a,panes:[t.pane]});if("paneId"in t){let n=s.includes(t.paneId)?s.length-1:s.length;r({paneId:t.paneId,index:void 0!==a&&a<n?a:n,toPaneGroupId:e})}},[i,r,e,s])),[{isOver:d},c]=(0,mP.useDrop)({accept:[n_.FileType.File,mZ.DragItems.Pane,mZ.DragItems.NewPane],hover(e,n){let i=n.getClientOffset(),r=i&&o.current?{x:i.x-o.current.x,y:i.y-o.current.y}:{x:0,y:0};t.dropState.set({item:e,pointer:r})},collect:e=>(o.current=n.current?.getBoundingClientRect()??null,{isOver:e.isOver()}),drop(e,n){let i=l.current??null;t.dropState.set(null),n.didDrop()||u(e,null!==i?{index:i}:null)}});return(0,v.useEffect)(()=>{d||t.dropState.set(null)},[d,t]),{dropRef:c}}(e.headerId,n,p),m=(0,sm.useMergeRefs)([r,p,h]),f=(0,W.default)(),g=(0,dF.useIsWindows)();return(0,x.jsxs)(V.View,{row:!0,grow:!0,shrink:!0,align:"start",clsx:fd.default.tabBar,children:[c?(0,x.jsx)(P.default,{}):null,(0,x.jsxs)(V.View,{grow:!0,shrink:!0,row:!0,clsx:fd.default.tabs,innerRef:m,onMouseEnter:()=>n.isHovered.set(!0),onMouseLeave:()=>n.isHovered.set(!1),onPointerDown:s&&!c?u:void 0,children:[(0,x.jsx)(fh,{paneGroupId:e.headerId,activeTabPaneId:o,isMaximized:c,toggleMaximizedPaneGroup:d,cursor:l,onPointerDown:s?void 0:u}),(0,x.jsx)(ff,{layout:n}),i?.map(t=>(0,x.jsx)(fs,{paneGroupId:e.headerId,paneId:t,layout:n,isOnlyTab:s},t)),(0,x.jsx)(fm,{layout:n,onClick:()=>a({paneGroupId:e.headerId,activate:!0,panes:[{type:"commands",data:{autoFocus:!0}}]})})]}),c?(0,x.jsx)(uX.IconButton,{clsx:{[fd.default.desktopAppWindowsOs]:g&&f},size:28,alt:"Minimize",onClick:()=>d({paneGroupId:e.headerId}),children:(0,x.jsx)(ud.default,{})}):null]})});function fh({paneGroupId:e,activeTabPaneId:t,toggleMaximizedPaneGroup:n,isMaximized:i,cursor:r,onPointerDown:a}){let s=uv({paneId:t,paneGroupId:e}),{onContextMenu:o}=(0,fe.useContextMenu)();return(0,x.jsx)(V.View,{onContextMenu:e=>o(e,{command:s}),onDoubleClick:()=>{n({paneGroupId:e})},title:i?"Double click to restore.":"Double click to maximize. Drag to move.",clsx:fd.default.dragArea,style:{cursor:i?void 0:r},onPointerDown:a})}function fm(e){let{layout:t}=e,n=(0,v.useRef)(null),i=n3(aV),r=(0,px.useSetTourStepTarget)(pI,pE.NewTab);(0,tZ.useStyleSet)(n,t.newTab,e=>({[fc.newTabWidth]:e.width+"px",[fc.newTabX]:e.x+"px",opacity:e.visible?"1":"0"}));let{dragRef:a,isDragging:s}=function(){let[{isDragging:e},t]=(0,m9.useDrag)({type:mZ.DragItems.NewPane,item:()=>({type:mZ.DragItems.NewPane,pane:{type:"commands",data:{autoFocus:!0}},width:80}),collect:e=>({isDragging:e.isDragging()})});return{isDragging:e,dragRef:t}}(),o=(0,sm.useMergeRefs)([n,r,a]),l=(0,hJ.useObservableMemo)(()=>t.width.select(e=>e>320),[t]),u="Tools & files";return(0,x.jsx)(V.View,{innerRef:o,clsx:fd.default.newTab,children:s?null:(0,x.jsx)(x.Fragment,{children:i&&l?(0,x.jsx)(se.Button,{clsx:fd.default.newTabTextButton,onClick:e.onClick,variant:"nofill",iconLeft:(0,x.jsx)(a5.default,{}),text:u,style:{width:160}}):(0,x.jsx)(uX.IconButton,{clsx:fd.default.newTabIconButton,size:28,alt:u,onClick:e.onClick,children:(0,x.jsx)(a5.default,{})})})})}function ff(e){let{layout:t}=e,n=(0,v.useRef)(null);return(0,tZ.useStyleSet)(n,t.dropPreview,e=>({[fc.dropPreviewWidth]:(e?e.width:80)+"px",[fc.dropPreviewX]:(e?e.x:"50%")+"px",[fc.dropPreviewOpacity]:e?"1":"0"})),(0,x.jsx)(V.View,{innerRef:n,clsx:fd.default.dropPreview})}var fg=e.i(248611);let fx=(0,A.cvarsFrom)("index.module.css",["--left","--top","--scale","--transform-origin-x","--width","--height","--z-index","--transform-x","--transform-y","--border-radius","--controls-opacity","--opacity","--padding-left","--padding-top"]),fy=(0,v.memo)(function({headerId:e}){let t=aE(e),n=(0,up.default)(t.activeTabPaneId),i=aP(e),r=(0,up.default)(i.isFloating),a=(0,up.default)(i.isBeingDragged),s=(0,up.default)(i.isModal),o=(0,up.default)(i.isMaximized),l=(0,v.useRef)(null);(0,tZ.useStyleSet)(l,mD(i.properties,i.getTransitionEnabled),({width:e,height:t,x:n,y:i,scale:r,opacity:a,positioning:s})=>({[fx.width]:e+"px",[fx.height]:t+"px",[fx.scale]:r.toString(),[fx.opacity]:a.toString(),..."transform"===s?{[fx.transformX]:Math.round(n)+"px",[fx.transformY]:Math.round(i)+"px",[fx.top]:"0px",[fx.left]:"0px"}:{[fx.transformX]:"0px",[fx.transformY]:"0px",[fx.top]:Math.round(i)+"px",[fx.left]:Math.round(n)+"px"}})),(0,tZ.useStyleSet)(l,i.transformOriginX,e=>({[fx.transformOriginX]:e})),(0,tZ.useStyleSet)(l,i.zIndex,e=>({"z-index":e.toString()}));let u=n9(av);return(0,tZ.useStyleSet)(l,n6((0,v.useMemo)(()=>(0,J.atom)(e=>e(av)===n),[n])),e=>({[fx.controlsOpacity]:e?"1":"0"})),(0,x.jsxs)(R.ShadesSurface,{innerRef:l,clsx:fg.default.surface,row:!0,align:"center",style:{[fx.borderRadius]:"6px",[fx.paddingTop]:(!o&&r?6:0)+"px",[fx.paddingLeft]:(o||a||r?6:0)+"px"},onMouseEnter:()=>u(n),onMouseLeave:()=>u(null),elevate:!1,children:[(0,x.jsx)(fp,{headerId:e}),r&&!s?(0,x.jsx)(mY,{paneId:n}):null]})});function fv(){let e=aS(),t=(0,v.useCallback)(t=>e({pane:t}),[e]),n=n7(ty),i=n9(ny);return(0,v.useCallback)(function(e){let r=e9.STACK_TO_OUTPUT_PANE_MAP[e];r&&(t({type:r}),n().forEach(([e,t])=>{"agentChat"!==t.type&&t.type!==r&&i(e)}))},[t,n,i])}var fw=e.i(391119),fb=e.i(700966),fj=e.i(716636),fS=e.i(398014);let fk={Content:e=>{let[t,n]=(0,v.useState)(null);(0,aO.useSetFocusTarget)(()=>t,[t]),(0,aO.useSetPaneBindings)(()=>({type:"agentChat",focusInput:()=>t?.focus()}),[t]);let{performPaneOperation:i}=e.options,r=(0,v.useCallback)(e=>i({operation:"open",pane:e,secondary:!0}),[i]),a=fv(),s=(0,v.useCallback)(e=>{i({operation:"openPip",data:e})},[i]),{session:o,setSession:l}=(0,fw.useCurrentSession)(e.pane.data?.sessionId),u=(0,v.useCallback)(e=>{i({operation:"replace",pane:{type:"agentChat",data:{sessionId:e.id}}}),l(e)},[i,l]),d=n3(tO),c=n9(r9),p=n3(r7),{secrets:h,fs:m}=(0,sg.default)();return(0,x.jsx)(fb.AgentMain,{secrets:h,readFile:m.readFile,session:o,setSession:u,inputRef:n,openPane:r,onPlanApproval:e=>{e&&a(e),c("sidebar")},isDesktopOrTabletAgentPresentationCentered:d,isDesktopLayoutAgentPresentationTransitionInProgress:p,openPip:s})},Icon:({size:e})=>(0,x.jsx)(uH.AgentAvatar,{size:e}),getTitle:()=>"Agent",description:pS.AGENT_DESCRIPTION,category:fj.PaneCategory.WorkspaceFeatures,decode:e=>s2.Value.Decode(fS.AgentChatPaneSchema,e)};var fC=e.i(341190),fT=e.i(673920),fE=e.i(417120);let fI={};var fP=e.i(112767),fA=e.i(718042);let fR=".agents/skills",fD=".local/skills",fV=["create-animated-video","fetch-deployment-logs","generate-image","generate-video"];var f_=e.i(396776);function fM({tab:e,fullPath:t,level:n,onNavigate:i}){return e.children&&!e.component?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(fC.Header,{children:(0,x.jsx)(V.View,{pt:8,px:8,children:(0,x.jsx)(st.Text,{variant:0===n?"subheadDefault":"small",children:e.label})})}),(0,x.jsx)(fF,{tabs:e.children,currentPath:t,onNavigate:i})]}):(0,x.jsx)(cW.BaseMenuItem,{textValue:e.label,onAction:()=>i(t),children:(0,x.jsxs)(V.View,{row:!0,gap:12,align:"center",justify:"space-between",grow:!0,children:[(0,x.jsxs)(V.View,{row:!0,gap:12,align:"center",children:[e.icon,(0,x.jsxs)(V.View,{gap:2,children:[(0,x.jsx)(st.Text,{children:e.label}),e.description?(0,x.jsx)(st.Text,{variant:"small",color:"dimmer",children:e.description}):null]})]}),(0,x.jsx)(pJ.default,{size:16})]})})}function fF({tabs:e,currentPath:t=[],onNavigate:n}){let i=t.length;return(0,x.jsx)(x.Fragment,{children:Object.entries(e).map(([e,r])=>{let a=[...t,e];return(0,x.jsx)(fM,{tab:r,fullPath:a,isTopLevel:0===i,level:i,onNavigate:n},a.join("-"))})})}function fO({onNavigate:e}){let t=(0,fE.useAgentRunState)(),n=t===dg.AgentRunState.AGENT_STATE_RUNNING||t===dg.AgentRunState.AGENT_STATE_PAUSING,{skills:i,setSkills:r,error:a,fetchSkills:s,isPending:o}=function(){let[e,t]=(0,v.useState)([]),[n,i]=(0,v.useState)(null),[r,a]=(0,v.useState)(!0),s=(0,o$.usePid2Callback)(e=>async()=>{let t=await e.agentSkills.identifySkills.rpc({directories:[fR],includeDisabled:!0});if(!t.ok)throw Error("Failed to fetch skills");return(t.payload[fR]??[]).map(e=>({...e,relativePath:(0,fA.relative)(fR,e.path)})).sort((e,t)=>e.name.localeCompare(t.name))},[]),o=(0,v.useCallback)(async()=>{if(s)try{i(null);let e=await s();t(e)}catch(e){i(e instanceof Error?e:Error("Failed to fetch skills"))}finally{a(!1)}},[s]);return{skills:e,setSkills:t,error:n,fetchSkills:o,isPending:r}}(),{skills:l,error:u,fetchSkills:d,isPending:c}=function(){let[e,t]=(0,v.useState)([]),[n,i]=(0,v.useState)(null),[r,a]=(0,v.useState)(!0),s=(0,o$.usePid2Callback)(e=>async()=>{let t=await e.agentSkills.identifySkills.rpc({directories:[fD]});if(!t.ok)throw Error("Failed to fetch local skills");return(t.payload[fD]??[]).filter(e=>fV.includes(e.name)).sort((e,t)=>e.name.localeCompare(t.name))},[]);return{skills:e,error:n,isPending:r,fetchSkills:(0,v.useCallback)(async()=>{if(s)try{i(null);let e=await s();t(e)}catch(e){i(e instanceof Error?e:Error("Failed to fetch local skills"))}finally{a(!1)}},[s])}}(),[p,h]=(0,v.useState)(null),{trackClick:m}=(0,pg.useTrackClick)();(0,fT.useEffectOnce)(()=>{(0,ei.track)(er.events.AGENT_SKILLS,{action:"pane_opened"})}),(0,v.useEffect)(()=>{s();let e=setInterval(()=>{s()},5e3);return()=>{clearInterval(e)}},[s]),(0,v.useEffect)(()=>{d()},[d]);let f=a??u??p,g=(0,H.useFlag)({controlName:"flag-agent-skills-local-skills",default:!1}),y=async()=>{h(null),await s()},w=(0,o$.usePid2Callback)(e=>async(t,n)=>e.agentSkills.setSkillEnabled.rpc({skillName:t,enabled:n})),b=(0,o$.usePid2Callback)(e=>async t=>e.agentSkills.deleteSkill.rpc({skillName:t})),j=(0,v.useCallback)(async(e,t)=>{if(w){if(h(null),m({productArea:"agent",target:t?"agent_skills_skill_disabled":"agent_skills_skill_enabled"}),t){r(t=>t.map(t=>t.relativePath===e?{...t,enabled:!1}:t));let t=await w(e,!1);if(!t.ok)return void h(t.payload.message)}else{r(t=>t.map(t=>t.relativePath===e?{...t,enabled:!0}:t));let t=await w(e,!0);if(!t.ok)return void h(t.payload.message)}await s()}},[w,s,r,m]),S=(0,v.useCallback)(async e=>{if(!b)return;h(null),m({productArea:"agent",target:"agent_skills_skill_deleted"});let t=await b(e);t.ok?await s():h(t.payload.message)},[b,s,m]);return o||c?(0,x.jsx)(V.View,{p:16,children:(0,x.jsx)(st.Text,{variant:"subheadDefault",children:"Loading..."})}):(0,x.jsxs)(V.View,{p:16,gap:16,children:[(0,x.jsxs)(V.View,{row:!0,gap:8,align:"start",justify:"space-between",children:[(0,x.jsxs)(V.View,{gap:8,shrink:!0,children:[(0,x.jsx)(st.Text,{variant:"subheadBig",children:"Agent skills"}),(0,x.jsx)(st.Text,{color:"dimmer",multiline:!1,children:"Skills extend what Agent can do. Manage installed skills here."})]}),(0,x.jsx)(p9.ButtonLink,{text:"Learn more about skills",href:"https://docs.replit.com/replitai/skills",target:"_blank",rel:"noopener",size:"small",iconRight:(0,x.jsx)(lo.default,{})})]}),f?(0,x.jsx)(f_.StatusBanner,{text:f instanceof Error?f.message:f,colorway:"red",action:(0,x.jsx)(se.Button,{size:"small",text:"Retry",onClick:y})}):null,i.length>0?(0,x.jsxs)(V.View,{gap:8,children:[g?(0,x.jsxs)(V.View,{gap:4,children:[(0,x.jsx)(st.Text,{variant:"subheadDefault",children:"Installed skills"}),(0,x.jsx)(st.Text,{variant:"small",color:"dimmer",children:"Skills you've installed in this app."})]}):null,(0,x.jsx)(V.View,{gap:8,p:0,align:"stretch",children:i.map(e=>(0,x.jsx)(fL,{skillPath:e.path,name:e.name,relativePath:e.relativePath,description:e.description,isEnabled:e.enabled,onToggle:j,onDelete:S,disabledWhileAgentWorking:n},e.name))})]}):(0,x.jsxs)(R.ShadesSurface,{p:12,br:8,gap:4,background:!0,border:"subtle",justify:"space-between",align:"start",children:[(0,x.jsx)(st.Text,{variant:"text",color:"dimmer",children:"No skills installed yet"}),(0,x.jsx)(V.View,{children:(0,x.jsx)(st.Text,{variant:"small",color:"dimmer",children:"Skills are reusable instructions that teach Agent how to perform specific tasks. Ask Agent to create a skill from a chat."})})]}),g&&l.length>0?(0,x.jsxs)(V.View,{gap:8,children:[(0,x.jsxs)(V.View,{gap:4,children:[(0,x.jsx)(st.Text,{variant:"subheadDefault",children:"Replit skills"}),(0,x.jsx)(st.Text,{variant:"small",color:"dimmer",children:"Pre-set skills the Agent uses for Replit features."})]}),(0,x.jsx)(V.View,{gap:8,p:0,align:"stretch",children:l.map(e=>(0,x.jsx)(fL,{name:e.name,description:e.description},e.path))})]}):null,(0,x.jsx)(cW.Menu,{"aria-label":"Agent Skills Actions",selectionMode:"none",children:(0,x.jsx)(fF,{tabs:fI,onNavigate:e})})]})}let fL=(0,v.memo)(function({name:e,relativePath:t,description:n,onToggle:i,onDelete:r,skillPath:a,isEnabled:s=!0,disabledWhileAgentWorking:o=!1}){let l=aC(),u=(0,H.useFlag)({controlName:"flag-skills-search",default:!1}),[d,c]=(0,v.useState)(!1);return(0,x.jsx)(R.ShadesSurface,{p:12,br:8,gap:4,background:!0,border:"subtle",children:(0,x.jsxs)(V.View,{row:!0,justify:"space-between",align:"start",gap:8,children:[(0,x.jsxs)(V.View,{gap:4,grow:!0,shrink:!0,align:"start",children:[(0,x.jsx)(dQ.Tooltip,{tooltip:"Open skill file",placement:"top",delay:"long",children:a?(0,x.jsx)(se.Button,{variant:"underlinedOnHover",text:e,onClick:()=>l({path:`${a}/SKILL.md`,opener:{paneType:"markdown"}})}):(0,x.jsx)(st.Text,{children:e})}),(0,x.jsx)(st.Text,{variant:"small",color:"dimmer",children:n})]}),(0,x.jsxs)(V.View,{row:!0,gap:8,align:"center",children:[u&&r&&t?(0,x.jsxs)(d1.PopoverTrigger,{isOpen:d,onOpenChange:c,label:"Confirm skill deletion",placement:"top end",children:[(0,x.jsx)(uX.IconButton,{"aria-label":`Delete ${e}`,alt:`Delete ${e}`,onClick:()=>c(!0),disabled:o,size:24,children:(0,x.jsx)(cg.default,{})}),(0,x.jsxs)(R.ShadesSurface,{p:8,br:8,gap:8,background:!0,children:[(0,x.jsxs)(st.Text,{variant:"subheadDefault",children:['Delete "',e,'"?']}),(0,x.jsx)(st.Text,{variant:"small",color:"dimmer",multiline:!0,children:"This will permanently remove the skill and its files from disk."}),(0,x.jsxs)(V.View,{row:!0,gap:8,justify:"end",children:[(0,x.jsx)(se.Button,{size:"small",text:"Cancel",onClick:()=>c(!1)}),(0,x.jsx)(se.Button,{size:"small",colorway:"negative",text:"Delete",onClick:()=>{r(t),c(!1)}})]})]})]}):null,i&&t?(0,x.jsx)(dQ.Tooltip,{tooltip:`Cannot ${s?"disable":"enable"} the skill while Agent is working.`,isDisabled:!o,placement:"auto-end",children:(0,x.jsx)(fP.Switch,{"aria-label":`${s?"Disable":"Enable"} ${e}`,isSelected:s,onChange:()=>i(t,s),size:"small",isDisabled:o})}):null]})]})})});function fB({navTo:e}){return(0,x.jsx)(fO,{onNavigate:e})}let fU=em.Type.Object({type:em.Type.Literal("agentSkills"),data:em.Type.Optional(em.Type.Object({tab:em.Type.Optional(em.Type.Array(em.Type.String()))}))}),fN={Content({pane:{data:e},options:t}){let n=(0,v.useCallback)(e=>{t.performPaneOperation({operation:"replace",pane:{type:"agentSkills",data:e?{tab:e}:void 0}})},[t]);return(0,x.jsx)(my.TrackingHierarchyProvider,{hierarchy:{surface:"agent_skills"},children:(0,x.jsx)(fB,{tab:e?.tab,navTo:n})})},Icon:({size:e})=>(0,x.jsx)(ai.IconContext.Provider,{value:{color:A.tokens.accentPrimaryStrongest,size:e},children:(0,x.jsx)(en.default,{})}),getTitle:()=>"Agent Skills",description:"Manage skills that extend Agent capabilities",category:fj.PaneCategory.WorkspaceFeatures,decode:e=>s2.Value.Decode(fU,e)};var fG=e.i(795564);let f$={Content(e){let{performPaneOperation:t,paneId:n}=e.options,{autoFocus:i}=e.pane.data,r=n9(tt),a=(0,v.useRef)(null);(0,aO.useSetFocusTarget)(()=>({focus:()=>a.current?.()}),[]);let s=(0,v.useCallback)(e=>{t({operation:"replace",pane:e.pane}),r(n),(0,ei.track)(er.events.TOOL_OPENED,{source:"New Tab",tool:e.pane.type})},[t,n,r]),o=lq({currentPaneId:n,openPane:s});return(0,x.jsx)(V.View,{grow:!0,shrink:!0,children:(0,x.jsx)(aY.CommandBar,{autoFocus:i,command:o,focusRef:a,showToolDescriptions:!0})})},Icon:()=>null,getTitle:()=>"New tab",category:fj.PaneCategory.Other,decode:fG.decode};var fz=e.i(827836),fW=e.i(818283),fH=e.i(999519);let fq={Content:({options:{paneId:e,performPaneOperation:t},pane:{flow:n}})=>{let i=aA(),r=(0,up.default)(i.activeContent),a=(0,v.useCallback)(()=>{"filetree"!==r&&i.toggleContent("filetree")},[i,r]);return(0,x.jsx)(fW.default,{flow:n,closeConfigPane:()=>t({operation:"remove",pane:{id:e}}),useReadFile:fz.default,openSidebar:a,onNewPaneSelected:e=>t({operation:"open",pane:e}),openConsole:()=>t({operation:"open",pane:{type:"runnerOutput"}})})},Icon:()=>(0,x.jsx)(lu.default,{}),getTitle:()=>"Configure Repl",category:fj.PaneCategory.WorkspaceFeatures,decode:fH.decode};var fK=e.i(746382);let fY=(0,l7.css)([au.rcss.backgroundColor.backgroundDefault,au.rcss.height("100%"),au.rcss.borderRadius(4),{overflow:"hidden"}]),fX=(0,l7.css)([au.rcss.width("100%"),au.rcss.height("100%"),au.rcss.justify.center,au.rcss.align.center,au.rcss.display.flex]);function fQ({paneId:e,extensionPaneData:t,environmentAPIs:n}){let i=(0,sl.useExtensionByInstallationId)(t.installationId),r=(0,sl.useExtensionStateAtom)(t.installationId),{didConnectOnce:a,isValidExtensionPaneUrl:s,getIframeProps:o,reloadSandbox:l}=ol({extension:i,environmentAPIs:n,sandboxTitle:t.name,sandboxUrl:(0,sc.getAssetUrl)(t.baseUrl,t.path),paneId:e,filePath:t.filePath||null});return(0,aO.useSetPaneBindings)(()=>({type:"extension",commands:[{name:"Actions",commands:[{match:a_.matchLabel,data:{icon:(0,x.jsx)(oR.default,{}),label:"Refresh",type:"action",description:"Refresh extension",key:"refresh",run:()=>{l()}}}]}]}),[l]),(0,x.jsx)(V.View,{className:"extension-pane",css:fY,children:r&&a?(0,x.jsx)(x.Fragment,{children:s()?(0,x.jsx)("iframe",{...o({css:{width:"100%",height:"100%",border:"none"}})}):(0,x.jsx)(V.View,{p:12,children:(0,x.jsxs)(st.Text,{children:["Invalid url:"," ",(0,x.jsx)(fK.InlineCode,{children:t.baseUrl+t.path}),". Please contact the extension author, or Replit support."]})})}):(0,x.jsx)(V.View,{css:fX,children:(0,x.jsx)(dh.default,{})})})}let fZ=em.Type.Object({extensionId:em.Type.Unsafe(em.Type.String()),installationId:em.Type.Unsafe(em.Type.String()),baseUrl:em.Type.String(),path:em.Type.String(),name:em.Type.String(),filePath:em.Type.Optional(em.Type.Union([em.Type.String(),em.Type.Null(),em.Type.Undefined()])),icon:em.Type.Optional(em.Type.Union([em.Type.String(),em.Type.Null(),em.Type.Undefined()]))}),fJ=em.Type.Object({type:em.Type.Literal("extension"),data:fZ});var f0=e.i(211397);let f1={Content({pane:e,options:t}){let n=so();return(0,x.jsx)(fQ,{extensionPaneData:e.data,paneId:t.paneId,environmentAPIs:n})},Icon:({pane:e,size:t})=>e.data.icon?(0,x.jsx)(V.View,{style:{width:t,height:t,position:"relative"},children:(0,x.jsx)(f0.default,{src:(0,sc.getAssetUrl)(e.data.baseUrl,e.data.icon),layout:"fill",alt:""})}):(0,x.jsx)(a4.default,{size:t}),getTitle:e=>e.data.filePath?e.data.filePath+"  "+e.data.name:e.data.name,category:fj.PaneCategory.WorkspaceExtensions,decode:e=>s2.Value.Decode(fJ,e)};var f2=e.i(917255),f5=e.i(612054),f4=e.i(210796),f8=e.i(144494),f3=e.i(915793),f6=e.i(328751),f9=e.i(995691),f7=e.i(198769),ge=e.i(904678);let gt={},gn=w.gql`
    query currentExtensionStatus($id: String!) {
  extension(id: $id) {
    ... on Extension {
      id
      isListed
      user {
        id
      }
    }
  }
}
    `;var gi=e.i(831787),gr=e.i(416746),ga=e.i(348867),gs=e.i(656077),go=e.i(493166),gl=e.i(888136),gu=e.i(619319),gd=e.i(428596);let gc=(0,ie.cssRecord)({codeBlock:[au.rcss.borderRadius(8),au.rcss.position.relative],codeBlockCopyButton:[au.rcss.position.absolute,au.rcss.top(4),au.rcss.right(4)],selectionContainer:[au.rcss.maxHeight(400),au.rcss.overflowY("scroll")],fsNode:[au.rcss.flex.row,au.rcss.rowWithGap(8),au.rcss.align.center,au.rcss.px(4),au.rcss.py(2),au.rcss.borderRadius(8),au.rcss.cursor.pointer],fsNodeActive:[au.rcss.backgroundColor.backgroundHigher]});function gp({content:e}){let{showConfirm:t}=(0,sr.default)();return(0,x.jsxs)(R.ShadesSurface,{tag:"code",css:gc.codeBlock,p:8,children:[e,(0,x.jsx)(uX.IconButton,{alt:"Copy",tooltipBehavior:"hidden",css:gc.codeBlockCopyButton,onClick:()=>navigator.clipboard.writeText(e).then(()=>t("Copied")),children:(0,x.jsx)(oE.default,{})})]})}function gh({glob:e,openFile:t,children:n}){let[i,r]=(0,v.useState)([]),[a,s]=(0,v.useState)(""),o=(0,gd.useIdSeed)(),{fs:l}=(0,sg.default)(),u=(0,od.useStaticDirectoryPath)(),d=(0,v.useMemo)(()=>(0,gu.globToRegExp)(e),[e]);return((0,v.useEffect)(()=>{d&&l.listFiles().then(e=>{e.files&&r(e.files.filter(e=>e.match(d)).map(e=>{let t=e.split("/");return{path:e,dir:t.slice(0,t.length-1).join("/"),filename:t[t.length-1]||""}}))})},[d,u]),d)?(0,x.jsxs)(V.View,{css:gc.selectionContainer,gap:16,children:[(0,x.jsx)(st.Text,{variant:"subheadDefault",children:(0,x.jsxs)(V.View,{gap:12,children:[(0,x.jsx)(st.Text,{variant:"subheadDefault",children:"Choose an image"}),u?(0,x.jsx)(f_.StatusBanner,{icon:(0,x.jsx)(gr.default,{}),colorway:"primary",text:(0,x.jsxs)(V.View,{gap:2,children:[(0,x.jsxs)(st.Text,{children:["Images must be served from"," ",(0,x.jsx)("span",{css:[au.rcss.font.code,au.rcss.backgroundColor.accentPrimaryDimmer,au.rcss.borderRadius(4),au.rcss.px(4),au.rcss.py(2),au.rcss.mr(2),au.rcss.border({color:A.tokens.accentPrimaryDefault})],children:u.path}),"."]}),(0,x.jsx)(st.Text,{css:[au.rcss.fontWeight.normal],children:"You can change your extension's static directory in the .replit file."})]})}):null,(0,x.jsxs)(st.Text,{css:[au.rcss.fontWeight.normal],color:"dimmer",children:["Supported file types:"," ",(0,x.jsx)("span",{css:[au.rcss.font.code,au.rcss.fontSize("small"),au.rcss.backgroundColor.backgroundHigher,au.rcss.borderRadius(4),au.rcss.px(4),au.rcss.py(2),au.rcss.mr(2),au.rcss.border({color:A.tokens.outlineDefault})],children:e.match(/\{(.*)\}/)?.[1].split(",").map(e=>e.replace(".","")).join(", ")})]})]})}),n,(0,x.jsx)(gl.default,{onChange:e=>t(e.path),initialHighlightedIndex:0,defaultHighlightedIndex:0,itemToString:e=>e?.path||"",children:({getInputProps:t,getItemProps:n,highlightedIndex:r,getRootProps:l,getMenuProps:d})=>(0,x.jsxs)(V.View,{...l({refKey:"innerRef"}),gap:16,children:[(0,x.jsx)(V.View,{css:[au.rcss.position.relative],children:(0,x.jsx)(cL.Input,{id:o("file-search"),...t({ref:null,value:a,onChange:e=>s(e.currentTarget.value),placeholder:"Find a file",autoComplete:"off",autoFocus:!0})})}),(0,x.jsx)(V.View,{children:i&&i.length?(0,x.jsx)(V.View,{elevated:!0,tag:"ul",css:(au.rcss.pt(8),au.rcss.colWithGap(8)),...d({refKey:"innerRef"}),children:i.filter(e=>e.path.includes(a)).filter(e=>!u||e.path.startsWith(u.relativePath)||e.path.startsWith("public")).map((e,t)=>(0,x.jsxs)(V.View,{tag:"li",css:[gc.fsNode,t===r&&gc.fsNodeActive],...n({item:e,index:t,disabled:!!u&&!e.path.startsWith(u.relativePath)}),children:[(0,x.jsx)(lH.default,{path:e.path,size:16}),(0,x.jsx)(st.Text,{children:e.filename}),(0,x.jsx)(st.Text,{variant:"small",color:"dimmest",children:e.dir})]},t))}):(0,x.jsx)(V.View,{pt:8,children:(0,x.jsx)(st.Text,{color:"dimmer",children:(0,x.jsxs)("em",{children:["No files found matching ",(0,x.jsx)("code",{children:e})]})})})})]})})]}):(0,x.jsxs)(V.View,{css:[au.rcss.flex.column,au.rcss.colWithGap(16)],children:[(0,x.jsx)(st.Text,{variant:"subheadDefault",children:"Invalid Glob Pattern"}),(0,x.jsxs)(st.Text,{children:["The glob pattern ",(0,x.jsx)("code",{children:e})," could not be parsed."]}),(0,x.jsx)(V.View,{css:au.rcss.border({direction:"bottom",color:A.tokens.backgroundHigher})}),(0,x.jsxs)(V.View,{gap:8,children:[(0,x.jsx)(st.Text,{children:(0,x.jsx)("strong",{children:"Match all Javascript Files"})}),(0,x.jsx)(gp,{content:"**/*.js"})]}),(0,x.jsxs)(V.View,{gap:8,children:[(0,x.jsx)(st.Text,{children:(0,x.jsx)("strong",{children:"Match JSON files at root level"})}),(0,x.jsx)(gp,{content:"*.json"})]}),(0,x.jsxs)(V.View,{gap:8,children:[(0,x.jsx)(st.Text,{children:(0,x.jsx)("strong",{children:"Match specified file extensions"})}),(0,x.jsx)(gp,{content:"**/*.{js,ts,jsx,tsx}"})]})]})}var gm=((l=gm||{}).Installing="Installing",l.Loading="Loading",l.Failed="Failed",l.Success="Success",l);let gf={Installing:"Installing Extension...",Loading:"Loading Asset...",Failed:"Failed to load asset from Extension URL",Success:"Asset loaded successfully"};function gg({isOpen:e,close:t,onSubmit:n}){let i=(0,su.useInstallCurrentReplAsExtension)(),r=(0,su.useCurrentReplExtension)(),[a,s]=(0,v.useState)(null),[o,l]=(0,v.useState)(!0),[u,d]=(0,v.useState)(null),[c,p]=(0,v.useState)(null),h=(0,v.useRef)(null),[m,f]=(0,v.useState)(null),[g,y]=(0,v.useState)(null),w=(c||g||"").startsWith("/")?c||g:"/"+(c||g),[b,j]=(0,v.useState)(null),S=()=>{y(null),s(null),p(null),f(null),j(null),d(null)};(0,v.useEffect)(()=>{p(g)},[g]);let k=(0,v.useCallback)(async e=>{if(!w||!o||"Success"===a||"Failed"===a)return;let t=async(e,t)=>{s("Loading");let n=(0,sc.getAssetUrl)(e.baseUrl,t);return d(n),!!(await fetch(n)).ok&&(j(t),s("Success"),l(!1),!0)},n=e||r;if(!n){s("Installing");try{let e=await i();if(e)return void await k(e)}catch(e){if(r)return void await k(r)}}if(n){let e=w.replace(/^(\/public|\/static)/,"");await t(n,e.slice(1))||await t(n,w)}},[r,w,i,a,o]);(0,v.useEffect)(()=>{if(!m)return;let e=m.split("/"),t=e.pop(),n=e.findIndex(e=>["public","static"].includes(e));y((-1!==n?`/${m}`:`/${e.slice(n+1).join("/")}/${t}`)||m),l(!0),k()},[k,m]);let C=m?m.split("/"):[],T=C[C.length-1];return(0,x.jsx)(aK.Modal,{isOpen:e,onRequestClose:t,children:m?(0,x.jsxs)(V.View,{css:[au.rcss.flex.column,au.rcss.colWithGap(16)],children:[(0,x.jsxs)(V.View,{row:!0,gap:8,align:"center",children:[(0,x.jsx)(se.Button,{text:"Back",size:"small",iconLeft:(0,x.jsx)(gs.default,{}),onClick:()=>{f(null),S()}}),(0,x.jsxs)(V.View,{row:!0,gap:4,align:"center",children:[(0,x.jsx)(go.default,{}),(0,x.jsx)(st.Text,{color:"dimmer",children:T||""})]})]}),(0,x.jsx)(st.Text,{multiline:!0,children:"Extension assets should be stored in the public asset directory. Move the image or modify the file path, or try again."}),(0,x.jsxs)(V.View,{gap:4,children:[(0,x.jsx)(cL.Input,{defaultValue:c||"",ref:h,placeholder:"/icon.png",onChange:e=>p(e.target.value),autoFocus:!0,disabled:"Loading"===a||"Installing"===a||"Success"===a}),u&&("Loading"===a||"Success"===a||"Failed"===a)?(0,x.jsx)("a",{href:u,target:"_blank",children:(0,x.jsxs)(st.Text,{color:"dimmer",variant:"small",css:[au.rcss.rowWithGap(4),au.rcss.display.flex,{fontStyle:"italic"}],children:[(0,x.jsxs)("span",{css:[au.rcss.truncate],children:["Loading"===a?"Checking ":null,"Success"===a?"Found at ":null,"Failed"===a?"Failed to load ":null,u]}),(0,x.jsx)(V.View,{css:[au.rcss.display.inlineBlock],children:(0,x.jsx)(oI.default,{})})]})}):null]}),(0,x.jsxs)(V.View,{row:!0,justify:"space-between",align:"center",children:[(0,x.jsx)(V.View,{row:!0,gap:4,align:"center",children:a?(0,x.jsx)(x.Fragment,{children:"Loading"===a?(0,x.jsx)(dh.default,{}):(0,x.jsx)(f_.StatusBanner,{text:gf[a],colorway:"Failed"===a?"negative":"positive",icon:"Failed"===a?(0,x.jsx)(cT.default,{}):(0,x.jsx)(p5.default,{})})}):null}),"Failed"===a?(0,x.jsxs)(V.View,{row:!0,gap:8,children:[(0,x.jsx)(se.Button,{text:"Add Anyways",onClick:()=>{let e=g||m;null!==e&&n(e),S(),t()},size:"small"}),(0,x.jsx)(se.Button,{text:"Try Again",onClick:()=>{l(!0),s(null)},size:"small"})]}):null,b&&"Success"===a?(0,x.jsx)(se.Button,{text:"Continue",iconLeft:(0,x.jsx)(p5.default,{}),colorway:"primary",onClick:()=>{n(b),S(),t()}}):null]})]}):(0,x.jsx)(gh,{openFile:f,glob:"**/*.{png,jpg,jpeg,webp,svg,gif}"})})}var gx=e.i(887964);let gy=(0,ie.cssRecord)({centerRowGap8:[au.rcss.rowWithGap(8),au.rcss.align.center],featureContainer:[au.rcss.flex.column,au.rcss.borderRadius(8),{overflow:"hidden"}],noFeaturesPlaceholder:[au.rcss.border({style:"dashed"}),au.rcss.borderRadius(8),au.rcss.p(16),au.rcss.colWithGap(8),au.rcss.center],featureDetails:[au.rcss.flex.column,au.rcss.colWithGap(4),au.rcss.flex.growAndShrink(1)],newFeatureFieldWrapper:[au.rcss.border({direction:"bottom",color:A.tokens.backgroundHighest})],inputCounterFlex:[au.rcss.flex.row,au.rcss.justify.spaceBetween,au.rcss.align.center]});function gv({features:e,onCreate:t,onUpdate:n,onDelete:i}){let[r,a]=(0,v.useState)([]),[s,o]=(0,v.useState)(!1);return(0,x.jsxs)(V.View,{children:[(0,x.jsxs)(V.View,{pb:12,children:[(0,x.jsxs)(V.View,{css:gy.centerRowGap8,children:[(0,x.jsxs)(V.View,{css:gy.centerRowGap8,children:[(0,x.jsx)(gx.default,{}),(0,x.jsx)(st.Text,{variant:"subheadDefault",children:"Feature Descriptions"})]}),(0,x.jsx)(uX.IconButton,{onClick:()=>{o(!s)},alt:"Add a new Feature",tooltipBehavior:s?"hidden":"default",disabled:s,children:(0,x.jsx)(a5.default,{})})]}),(0,x.jsx)(st.Text,{color:"dimmer",variant:"small",multiline:!0,children:"Describe what your extension can do. Descriptions will appear on the store listing page."})]}),(0,x.jsxs)(V.View,{gap:8,children:[s?(0,x.jsx)(gb,{onSubmit:e=>{t(e),o(!1)},onCancel:()=>o(!1)}):null,(0,x.jsx)(V.View,{css:gy.featureContainer,children:e.length>0?e.map((t,s)=>r.includes(s)?(0,x.jsx)(gb,{feature:t,isLast:s===e.length-1,onSubmit:e=>{n(e,s),a(e=>e.filter(e=>e!==s))},onCancel:()=>a(e=>e.filter(e=>e!==s))},s):(0,x.jsx)(gw,{isLast:s===e.length-1,feature:t,onEdit:()=>a(e=>[...e,s]),onDelete:()=>{i(s)}},s)):(0,x.jsx)(x.Fragment,{children:s?null:(0,x.jsxs)(V.View,{css:gy.noFeaturesPlaceholder,children:[(0,x.jsx)(st.Text,{color:"dimmest",multiline:!0,children:"You haven't added any features yet"}),(0,x.jsx)(se.Button,{variant:"outlined",text:"New Feature",iconLeft:(0,x.jsx)(a5.default,{}),onClick:()=>o(!0)})]})})})]})]})}function gw({feature:e,onEdit:t,onDelete:n,isLast:i}){return(0,x.jsxs)(R.ShadesSurface,{css:[au.rcss.flex.row,au.rcss.rowWithGap(8),au.rcss.align.center,au.rcss.p(8),i?null:au.rcss.border({direction:"bottom",color:A.tokens.backgroundHighest})],children:[(0,x.jsx)(gj,{size:64,icon:e.image}),(0,x.jsxs)(V.View,{css:gy.featureDetails,children:[(0,x.jsxs)(V.View,{row:!0,gap:8,align:"center",justify:"space-between",children:[(0,x.jsx)(st.Text,{children:e.title}),(0,x.jsxs)(V.View,{row:!0,gap:8,children:[(0,x.jsx)(uX.IconButton,{alt:"Delete",tooltipBehavior:"hidden",onClick:n,children:(0,x.jsx)(cg.default,{color:A.tokens.accentNegativeStronger})}),(0,x.jsx)(uX.IconButton,{alt:"Edit",tooltipBehavior:"hidden",onClick:t,children:(0,x.jsx)(cd.default,{})})]})]}),(0,x.jsx)(st.Text,{color:"dimmest",multiline:!0,maxLines:1,children:e.body})]})]})}function gb({onSubmit:e,onCancel:t,feature:n,isLast:i}){let[r,a]=(0,v.useState)(n?.title||""),[s,o]=(0,v.useState)(n?.body||""),[l,u]=(0,v.useState)(n?.image||null),d=r.length>=3&&s.length>=16;return(0,x.jsxs)(R.ShadesSurface,{css:[au.rcss.flex.column,i||n?null:au.rcss.borderRadius(8),n?au.rcss.border({color:A.tokens.outlineDefault}):[i?null:au.rcss.border({direction:"bottom",color:A.tokens.backgroundHighest})]],children:[(0,x.jsxs)(V.View,{css:gy.newFeatureFieldWrapper,p:8,row:!0,gap:8,align:"center",justify:"space-between",children:[(0,x.jsx)(st.Text,{children:r||"New Feature"}),(0,x.jsxs)(V.View,{row:!0,gap:8,children:[(0,x.jsx)(se.Button,{text:"Cancel",onClick:t}),(0,x.jsx)(se.Button,{text:n?"Save":"Create",colorway:"primary",onClick:()=>e({title:r,body:s,image:l}),disabled:!d})]})]}),(0,x.jsxs)(V.View,{p:8,gap:8,children:[(0,x.jsxs)(V.View,{gap:4,children:[(0,x.jsxs)(V.View,{css:gy.inputCounterFlex,children:[(0,x.jsx)(st.Text,{color:"dimmer",children:"Title"}),(0,x.jsx)(gS,{value:r.length,min:3})]}),(0,x.jsx)(cL.Input,{value:r,onChange:e=>a(e.target.value),placeholder:"Seamless Editing",maxLength:60})]}),(0,x.jsxs)(V.View,{gap:4,children:[(0,x.jsxs)(V.View,{css:gy.inputCounterFlex,children:[(0,x.jsx)(st.Text,{color:"dimmer",children:"Body"}),(0,x.jsx)(gS,{value:s.length,min:16})]}),(0,x.jsx)(cL.MultiLineInput,{value:s,onChange:e=>o(e.target.value),placeholder:"Describe what this feature does and how to use it (Markdown supported)",autoSize:!0,maxLength:2e3})]}),(0,x.jsxs)(V.View,{row:!0,gap:8,children:[(0,x.jsxs)(V.View,{gap:4,grow:!0,shrink:!0,children:[(0,x.jsx)(st.Text,{color:"dimmer",children:"Image (Recommended)"}),(0,x.jsx)(st.Text,{color:"dimmest",multiline:!0,children:"Choose a statically-served image from your App. The Recommended aspect ratio for a cover image is 800x600."})]}),(0,x.jsx)(gj,{size:100,icon:l,editable:!0,onSubmit:e=>{u(e)}})]})]})]})}function gj({size:e,icon:t,editable:n=!1,onSubmit:i}){let{url:r}=(0,a7.useDevUrl)(),a=r&&t?(0,sc.getAssetUrl)(r,t):null,[s,o]=(0,v.useState)(!1);return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(c3.Surface,{background:"default",css:[n?d0.interactive.filledAndOutlined:null,au.rcss.flex.row,au.rcss.center,au.rcss.width(e),au.rcss.height(.75*e),au.rcss.maxWidth(e),au.rcss.maxHeight(.75*e),au.rcss.borderRadius(4),au.rcss.border({color:A.tokens.backgroundHighest}),au.rcss.flex.grow(1),{background:a?`${A.tokens.backgroundDefault} url(${a}) no-repeat center center / cover`:A.tokens.backgroundDefault}],onClick:()=>o(!0),children:a?null:(0,x.jsx)(go.default,{color:A.tokens.foregroundDimmest,size:24})}),n?(0,x.jsx)(gg,{isOpen:s,close:()=>o(!1),onSubmit:e=>{i?.(e)}}):null]})}function gS({value:e,min:t}){return(0,x.jsxs)(st.Text,{css:{color:e>=t?A.tokens.accentPositiveStronger:A.tokens.foregroundDimmest},children:[e,"/",t]})}var gk=e.i(316953);let gC=async e=>{await e.writeFile("extension.json",JSON.stringify({name:"My Extension",description:"My Extension Description",version:"0"},null,2))},gT="Failed to read manifest file, please try again",gE="No extension.json found",gI=()=>{let{fs:e,dotReplit:t}=(0,sg.default)(),{state:n,setState:i,updateString:r}=(()=>{let[e,t]=(0,v.useState)(null),n=(0,v.useCallback)(e=>{t(t=>{if(!t)throw Error("State should be defined");return{...t,manifestStr:e}})},[]);return{state:e,setState:t,updateString:n}})(),[a,s]=(0,v.useState)(0),[o,l]=(0,v.useState)(!1),u=(0,v.useCallback)(async()=>{await gC(e)},[e]);(0,v.useEffect)(()=>{i(null);let n=!1,a=()=>{};return async function(){var s;let o,l,u,[d,c]=await Promise.all([e.listFiles(),t.getConfig()]);if(n)return;if(!d.files||c.error)return i({fileReadError:gT});let p=(0,on.asDir)((o="/"===(s=c.config.extension?.outputDirectory??"dist").charAt(0),l="/"===s.slice(-1),(u=(function(e,t){let n=0;for(let t=e.length-1;t>=0;t--){let i=e[t];"."===i?e.splice(t,1):".."===i?(e.splice(t,1),n++):n&&(e.splice(t,1),n--)}if(t)for(;n--;)e.unshift("..");return e})(s.split("/").filter(e=>!!e),!o).join("/"))||o||(u="."),u&&l&&(u+="/"),(o?"/":"")+u)),h=function({filePaths:e,outputDir:t}){let n=[];for(let t of e){if("extension.json"===t)return t;t.endsWith("/extension.json")&&n.push(t)}for(let e of n)if(!e.startsWith(t))return e;return n[0]??null}({filePaths:d.files,outputDir:p});h?a=e.watchTextFile(h,{onReady:({writeChange:e,initialContent:t})=>{i({fileReadError:null,writeChange:e,manifestStr:t,manifestPath:h})},onChange:({latestContent:e})=>{r(e)},onMoveOrDelete:()=>{i({fileReadError:"extension.json was moved or deleted, please re-create it in your static directory"})},onError:()=>{i({fileReadError:gT})}}):i({fileReadError:gE})}(),()=>{a(),n=!0}},[e,r,t,a,i]);let d=(0,v.useMemo)(()=>{if(!n||null!==n.fileReadError)return null;try{let e=f3.evaluate(n.manifestStr);return(0,gk.parseManifestOrError)(e)}catch(e){return{error:e,manifest:null}}},[n]),c=(0,v.useCallback)(e=>{if(n&&!d?.error&&null===n.fileReadError){let t=f3.patch(n.manifestStr,e);n.writeChange((0,f6.changeSetFromDiff)(n.manifestStr,t)),r(t)}else throw Error("Failed to parse manifest file")},[n,d,r]),p={retry:()=>{s(e=>e+1)},creatingExtensionJson:o,setCreatingExtensionJson:l,createExtensionJson:u,updateString:r,updateManifest:c};if(!n)return{...p,__status:"loading",state:null,parsed:null};if("string"==typeof n.fileReadError)return{...p,__status:"fileReadError",state:{fileReadError:n.fileReadError},parsed:null};if(!d)return{...p,__status:"fileReadError",state:{fileReadError:gE},parsed:null};let{manifest:h}=d;return h?{...p,__status:"success",state:{fileReadError:null,writeChange:n.writeChange,manifestStr:n.manifestStr,manifestPath:n.manifestPath},parsed:d}:{...p,__status:"fileParseError",state:n,parsed:{manifest:null,error:d.error}}};var gP=((u={}).loading="loading",u.fileReadError="fileReadError",u.fileParseError="fileParseError",u.success="success",u);let gA=()=>(0,x.jsx)(V.View,{css:[au.rcss.display.flex,au.rcss.width("100%"),au.rcss.height("100%")],justify:"center",align:"center",children:(0,x.jsx)(dh.default,{})});var gR=e.i(837399);function gD({children:e}){return(0,x.jsx)(V.View,{gap:12,p:16,children:(0,x.jsx)(R.ShadesSurface,{css:[au.rcss.borderRadius(8),au.rcss.colWithGap(8)],p:16,children:e})})}var gV=e.i(959406);let g_=({error:e,performPaneOperation:t,manifestPath:n})=>(0,x.jsx)(gD,{children:(0,x.jsxs)(V.View,{gap:16,p:8,children:[(0,x.jsxs)(V.View,{row:!0,gap:8,css:[au.rcss.display.flex,au.rcss.align.center],children:[(0,x.jsx)(cT.default,{}),(0,x.jsx)(st.Text,{variant:"headerDefault",children:"Error parsing extension.json"})]}),(0,x.jsx)(st.Text,{variant:"subheadDefault",children:"Details:"}),(0,x.jsx)(V.View,{gap:8,children:e instanceof gR.TypeboxError?e.issues.map((e,t)=>{let{path:n,message:i}=e;return(0,x.jsxs)(V.View,{css:[au.rcss.display.flex,au.rcss.flex.row,au.rcss.rowWithGap(4)],children:[(0,x.jsx)(st.Text,{css:[au.rcss.font.code,au.rcss.color.orangeStrongest,au.rcss.backgroundColor.orangeDimmest],children:n}),(0,x.jsx)(st.Text,{children:i})]},t)}):(0,x.jsx)(V.View,{tag:"pre",children:e.message})}),(0,x.jsxs)(V.View,{row:!0,gap:8,children:[(0,x.jsx)(se.Button,{colorway:"primary",text:"Open extension.json",onClick:()=>{t({operation:"open",secondary:!0,pane:(0,gV.getPaneForFile)(n)})}}),(0,x.jsx)(se.Button,{iconLeft:(0,x.jsx)(f2.default,{}),text:"Read extension.json docs",onClick:()=>{window.open("https://docs.replit.com/extensions/api/manifest","_blank")}})]})]})}),gM=({message:e})=>{let{createExtensionJson:t,creatingExtensionJson:n,retry:i,setCreatingExtensionJson:r}=gI();return(0,x.jsxs)(gD,{children:[(0,x.jsxs)(V.View,{row:!0,gap:8,css:[au.rcss.display.flex,au.rcss.align.center],children:[(0,x.jsx)(cT.default,{}),(0,x.jsx)(st.Text,{variant:"subheadDefault",children:e})]}),(0,x.jsxs)(V.View,{row:!0,gap:8,children:[(0,x.jsx)(se.Button,{colorway:"primary",text:"Create extension.json",loading:n,iconLeft:n?(0,x.jsx)(dh.default,{}):(0,x.jsx)(a5.default,{}),onClick:async()=>{r(!0),await t(),i(),r(!1)}}),(0,x.jsx)(se.Button,{text:"Retry",iconLeft:(0,x.jsx)(oR.default,{}),onClick:()=>{i()}})]})]})};var gF=e.i(734882),gO=e.i(818660),gL=e.i(964269);let gB=(0,ie.cssRecord)({iconContainer:[au.rcss.position.relative,au.rcss.width(64),au.rcss.height(64),{"&:hover .edit-overlay":{opacity:1}}],iconWrapper:[au.rcss.flex.column,au.rcss.position.absolute,au.rcss.top(0),au.rcss.left(0)],iconOverlay:[au.rcss.flex.column,au.rcss.colWithGap(4),au.rcss.center,au.rcss.position.absolute,au.rcss.top(0),au.rcss.left(0),au.rcss.width("100%"),au.rcss.height("100%"),au.rcss.backgroundColor.backgroundOverlay,au.rcss.borderRadius(12),{transition:"0.25s",opacity:0,cursor:"pointer"}]});function gU({performPaneOperation:e,setSelectedTab:t}){let n=(0,su.useCurrentReplExtension)(),i=(0,su.useInstallCurrentReplAsExtension)(),r=(0,su.useReloadExtension)(),a=(0,su.useUnloadExtension)(),s=(0,od.useReplExtensionId)(),[o,l]=(0,v.useState)(!1),[u,d]=(0,v.useState)(!1);return(0,x.jsx)(V.View,{css:[au.rcss.flex.wrap,{rowGap:8}],row:!0,gap:8,children:(0,x.jsxs)(V.View,{row:!0,gap:8,children:[n||u?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(se.Button,{size:"small",text:"Reload",iconLeft:u?(0,x.jsx)(dh.default,{}):(0,x.jsx)(oR.default,{}),disabled:u,onClick:async()=>{n&&(d(!0),await r(n.installationId),d(!1))}}),(0,x.jsx)(se.Button,{size:"small",text:"Unload",iconLeft:(0,x.jsx)(ga.default,{}),disabled:!n,onClick:()=>{n&&a(n.installationId)}})]}):(0,x.jsx)(se.Button,{size:"small",text:"Load locally",colorway:"primary",iconLeft:o?(0,x.jsx)(dh.default,{}):(0,x.jsx)(pR.default,{}),loading:o,onClick:async()=>{l(!0),await i(),l(!1)}}),s?(0,x.jsx)(se.Button,{size:"small",text:"View on Store",iconLeft:(0,x.jsx)(ch.default,{}),onClick:()=>e({operation:"open",pane:{type:"extensionStore",data:{page:"cover",coverPageExtensionId:s}}})}):null,(0,x.jsx)(se.Button,{size:"small",text:"Edit Store Listing",onClick:()=>{t("releases")},iconLeft:(0,x.jsx)(cd.default,{})})]})})}function gN({performPaneOperation:e,setSelectedTab:t}){let{url:n}=(0,a7.useDevUrl)(),{parsed:i,state:r,__status:a}=gI();if(a===gP.loading)return(0,x.jsx)(gA,{});if(a===gP.fileReadError)return(0,x.jsx)(gM,{message:r.fileReadError});let{manifest:s,error:o}=i;return o?(0,x.jsx)(g_,{performPaneOperation:e,manifestPath:r.manifestPath,error:o}):(0,x.jsx)(V.View,{gap:16,css:[au.rcss.width("100%")],children:(0,x.jsxs)(R.ShadesSurface,{css:[au.rcss.borderRadius(8),au.rcss.colWithGap(8)],p:12,children:[(0,x.jsxs)(V.View,{row:!0,gap:16,align:"center",children:[(0,x.jsx)(V.View,{css:[au.rcss.display.flex,au.rcss.flex.row],grow:0,children:(0,x.jsx)(gO.ExtensionIcon,{size:64,baseUrl:n??null,icon:s.icon})}),(0,x.jsxs)(V.View,{grow:!0,shrink:!0,children:[(0,x.jsx)(gL.HStack,{align:"center",justify:"space-between",children:(0,x.jsx)(st.Text,{variant:"subheadDefault",children:s.name})}),(0,x.jsx)(st.Text,{variant:"text",color:"dimmest",children:s.description})]})]}),(0,x.jsx)(gU,{setSelectedTab:t,performPaneOperation:e})]})})}function gG({manifest:e,onSubmit:t,updateManifest:n}){var i;let r,a=(0,od.useReplExtensionId)(),s=(0,a6.useCurrentUserId)(),o=(0,gd.useIdSeed)(),[l,u]=(0,v.useState)(e.name??""),[d,c]=(0,v.useState)(e.description??""),[p,h]=(0,v.useState)(e.longDescription??void 0),[m,f]=(0,v.useState)(!1),{url:g}=(0,a7.useDevUrl)(),{data:y,loading:w,refetch:b}=(i={variables:{id:a||""},skip:!a},r={...gt,...i},j.useQuery(gn,r)),[S,{loading:k}]=(0,ge.useSetExtensionListedMutation)(),C=y?.extension?.__typename==="Extension"&&y?.extension?.user.id===s,T=y?.extension?.__typename==="Extension"&&y?.extension?.isListed;return(0,x.jsxs)(V.View,{tag:"form",gap:16,onSubmit:e=>{e.preventDefault(),t({name:l,description:d,longDescription:p})},children:[(0,x.jsxs)(V.View,{grow:!0,shrink:!0,gap:4,children:[(0,x.jsx)(st.Text,{css:[au.rcss.fontWeight.medium],children:"Do you want to publish your extension on the store?"}),w||k?(0,x.jsx)(dh.default,{}):(0,x.jsxs)(gF.RadioGroup,{css:au.rcss.colWithGap(8),name:"extensionListingStatus",value:T?"listed":"unlisted",disabled:!C,onChange:e=>{S({variables:{extensionId:a||"",isListed:"listed"===e.target.value}}).then(()=>b())},children:[C?null:(0,x.jsx)(V.View,{css:[au.rcss.width("fit-content")],children:(0,x.jsx)(f_.StatusBanner,{text:"You need to release this extension before listing it.",icon:(0,x.jsx)(gr.default,{}),colorway:"yellow"})}),(0,x.jsxs)(V.View,{row:!0,gap:8,children:[(0,x.jsx)(gF.Radio,{id:o("listed"),value:"listed"}),(0,x.jsx)("label",{htmlFor:o("listed"),children:"Yes, list my extension publicly on the Store"})]},"listed"),(0,x.jsxs)(V.View,{row:!0,gap:8,children:[(0,x.jsx)(gF.Radio,{id:o("unlisted"),value:"unlisted"}),(0,x.jsx)("label",{htmlFor:o("unlisted"),children:"No, I want to keep my listing page private"})]},"unlisted")]})]}),(0,x.jsx)(p7.DividerH,{}),(0,x.jsxs)(V.View,{grow:!0,shrink:!0,gap:4,tag:"label",htmlFor:o("name"),children:[(0,x.jsx)(st.Text,{children:"Extension Name"}),(0,x.jsx)(cL.Input,{id:o("name"),placeholder:"Give your extension a name",value:l,onChange:e=>{u(e.currentTarget.value)},required:!0})]}),(0,x.jsxs)(V.View,{grow:!0,shrink:!0,gap:4,children:[(0,x.jsx)(st.Text,{children:"Extension Icon"}),(0,x.jsxs)(V.View,{row:!0,gap:12,align:"center",children:[(0,x.jsxs)(V.View,{css:gB.iconContainer,children:[(0,x.jsx)(V.View,{css:gB.iconWrapper,children:(0,x.jsx)(gO.ExtensionIcon,{size:64,baseUrl:g??null,icon:e.icon})}),(0,x.jsxs)(V.View,{css:gB.iconOverlay,className:"edit-overlay",tag:"label",onClick:()=>f(!0),children:[(0,x.jsx)(cd.default,{}),(0,x.jsx)(st.Text,{variant:"small",children:"Edit"})]})]}),(0,x.jsx)(se.Button,{text:"Choose from file system",iconLeft:(0,x.jsx)(gi.default,{}),onClick:()=>f(!0)})]})]}),(0,x.jsxs)(V.View,{grow:!0,shrink:!0,gap:4,tag:"label",htmlFor:o("tagline"),children:[(0,x.jsxs)(V.View,{gap:0,children:[(0,x.jsx)(st.Text,{children:"Tagline"}),(0,x.jsx)(st.Text,{color:"dimmer",variant:"small",multiline:!0,children:"Provide a short description of what your Extension is for."})]}),(0,x.jsx)(cL.Input,{id:o("tagline"),placeholder:"Give your extension a short tagline",value:d,onChange:e=>{c(e.currentTarget.value)},required:!0})]}),(0,x.jsxs)(V.View,{grow:!0,shrink:!0,gap:4,tag:"label",htmlFor:o("longDescription"),children:[(0,x.jsxs)(V.View,{gap:0,children:[(0,x.jsx)(st.Text,{children:"Description"}),(0,x.jsx)(st.Text,{color:"dimmer",variant:"small",multiline:!0,children:"Add more detail about the usage of your extension."})]}),(0,x.jsx)(cL.MultiLineInput,{id:o("longDescription"),placeholder:"Give your extension a long description, markdown formatting is supported",value:p??"",onChange:e=>{h(e.currentTarget.value||void 0)},css:{resize:"vertical"},autoSize:!0})]}),(0,x.jsx)(p7.DividerH,{}),(0,x.jsx)(gv,{features:e.features??[],onDelete:t=>{if(e.features?.length===1&&0===t){let t={...e};delete t.features,n(t)}else n({...e,features:e.features?.filter((e,n)=>n!==t)})},onUpdate:(t,i)=>{n({...e,features:[...e.features?.slice(0,i)??[],t,...e.features?.slice(i+1)??[]]})},onCreate:t=>{n({...e,features:[...e.features??[],t]})}}),(0,x.jsx)(V.View,{row:!0,gap:12,css:[{alignSelf:"end"},au.rcss.pt(8)],children:(0,x.jsx)(se.Button,{text:"Continue",iconRight:(0,x.jsx)(lo.default,{}),colorway:"primary",type:"submit",disabled:!l||!d||!p})}),(0,x.jsx)(gg,{isOpen:m,close:()=>f(!1),onSubmit:t=>{n({...e,icon:t})}})]})}function g$({fileHandlers:e,onCreate:t,onUpdate:n,onOpen:i,onDelete:r}){let[a,s]=(0,v.useState)([]),[o,l]=(0,v.useState)(!1);return(0,x.jsxs)(V.View,{children:[(0,x.jsxs)(V.View,{pb:12,children:[(0,x.jsxs)(V.View,{row:!0,gap:8,align:"center",children:[(0,x.jsxs)(V.View,{row:!0,gap:8,align:"center",children:[(0,x.jsx)(om.default,{}),(0,x.jsx)(st.Text,{variant:"subheadDefault",multiline:!1,children:"File Handlers"})]}),(0,x.jsx)(uX.IconButton,{onClick:()=>l(!o),alt:"Add a new File Handler",tooltipBehavior:o?"hidden":"default",disabled:o,children:(0,x.jsx)(a5.default,{})})]}),(0,x.jsx)(st.Text,{color:"dimmer",variant:"small",multiline:!1,children:"Custom file viewers and editors"})]}),(0,x.jsxs)(V.View,{gap:8,children:[o?(0,x.jsx)(gz,{onSubmit:e=>{t(e),l(!1)},onCancel:()=>{l(!1)}}):null,e.length?e.map((e,t)=>a.includes(t)?(0,x.jsx)(gz,{initialFileHandler:e,onSubmit:e=>{n(e,t),s(e=>e.filter(e=>e!==t))},onCancel:()=>{s(e=>e.filter(e=>e!==t))}},t):(0,x.jsxs)(R.ShadesSurface,{css:[au.rcss.borderRadius(8),au.rcss.flex.wrap,{rowGap:8}],p:8,row:!0,justify:"space-between",align:"center",children:[(0,x.jsx)(st.Text,{multiline:!1,children:e.name??"Unnamed"}),(0,x.jsxs)(V.View,{row:!0,gap:12,align:"center",children:[(0,x.jsx)(uX.IconButton,{alt:`Remove ${e.name||"this file handler"}`,colorway:"red",onClick:()=>{r(t)},children:(0,x.jsx)(cg.default,{})}),(0,x.jsx)(uX.IconButton,{alt:`Edit ${e.name||"this file handler"}`,onClick:()=>{s(e=>[...e,t])},children:(0,x.jsx)(cd.default,{})}),(0,x.jsx)(se.Button,{iconLeft:(0,x.jsx)(gi.default,{}),variant:"outlined",text:"Preview",onClick:()=>{i(e)}})]})]},t)):(0,x.jsx)(x.Fragment,{children:o?null:(0,x.jsxs)(V.View,{css:[au.rcss.border({style:"dashed"}),au.rcss.borderRadius(8),au.rcss.p(16),au.rcss.colWithGap(8),au.rcss.center],children:[(0,x.jsx)(st.Text,{color:"dimmest",children:"You haven't added a file handler yet"}),(0,x.jsx)(se.Button,{variant:"outlined",text:"New File Handler",iconLeft:(0,x.jsx)(a5.default,{}),onClick:()=>l(!0)})]})})]})]})}function gz({onSubmit:e,onCancel:t,initialFileHandler:n}){let[i,r]=(0,v.useState)(n?.name??""),[a,s]=(0,v.useState)(n?.icon??""),[o,l]=(0,v.useState)(n?.handler??""),[u,d]=(0,v.useState)(n?.glob??""),c=(0,gd.useIdSeed)();return(0,x.jsxs)(R.ShadesSurface,{css:[au.rcss.borderRadius(8),au.rcss.border({color:A.tokens.outlineDimmest}),au.rcss.p(8),au.rcss.colWithGap(8)],tag:"form",onSubmit:t=>{t.preventDefault(),e({name:i,icon:a,handler:o,glob:u})},children:[(0,x.jsxs)(V.View,{css:[au.rcss.border({color:A.tokens.outlineDimmest,direction:"bottom"}),au.rcss.align.center,au.rcss.flex.wrap,{rowGap:8}],row:!0,gap:2,justify:"space-between",children:[(0,x.jsx)(st.Text,{multiline:!1,children:i||"New File Viewer"}),(0,x.jsxs)(V.View,{row:!0,gap:8,children:[(0,x.jsx)(se.Button,{text:"Cancel",onClick:()=>{t()}}),(0,x.jsx)(se.Button,{colorway:"primary",iconLeft:(0,x.jsx)(p5.default,{}),text:"Save Changes",type:"submit"})]})]}),(0,x.jsxs)(V.View,{gap:8,children:[(0,x.jsxs)(V.View,{grow:!0,shrink:!0,gap:2,tag:"label",htmlFor:c("name"),children:[(0,x.jsx)(st.Text,{color:"dimmer",multiline:!1,children:"Name"}),(0,x.jsx)(cL.Input,{id:c("name"),placeholder:"SVG Editor",value:i,onChange:e=>{r(e.currentTarget.value)},required:!0})]}),(0,x.jsxs)(V.View,{grow:!0,shrink:!0,gap:2,tag:"label",htmlFor:c("handler"),children:[(0,x.jsx)(st.Text,{color:"dimmer",multiline:!1,children:"URL Path"}),(0,x.jsx)(cL.Input,{id:c("handler"),placeholder:"/svg-editor",value:o,onChange:e=>{l(e.currentTarget.value)},required:!0})]}),(0,x.jsxs)(V.View,{grow:!0,shrink:!0,gap:2,tag:"label",htmlFor:c("glob"),children:[(0,x.jsx)(st.Text,{color:"dimmer",multiline:!1,children:"Glob Pattern"}),(0,x.jsx)(cL.Input,{id:c("glob"),placeholder:"*.svg",value:u,onChange:e=>{d(e.currentTarget.value)},required:!0})]}),(0,x.jsxs)(V.View,{grow:!0,shrink:!0,gap:2,tag:"label",htmlFor:c("icon"),children:[(0,x.jsx)(st.Text,{color:"dimmer",multiline:!1,children:"Icon (path)"}),(0,x.jsx)(cL.Input,{id:c("icon"),placeholder:"/svg-editor-logo.png",value:a,onChange:e=>{s(e.currentTarget.value)},required:!0})]})]})]})}function gW({tools:e,onCreate:t,onUpdate:n,onOpen:i,onDelete:r}){let[a,s]=(0,v.useState)([]),[o,l]=(0,v.useState)(!1);return(0,x.jsxs)(V.View,{children:[(0,x.jsxs)(V.View,{pb:12,children:[(0,x.jsxs)(V.View,{row:!0,gap:8,align:"center",children:[(0,x.jsxs)(V.View,{row:!0,gap:8,align:"center",children:[(0,x.jsx)(en.default,{}),(0,x.jsx)(st.Text,{variant:"subheadDefault",multiline:!1,children:"Tools"})]}),(0,x.jsx)(uX.IconButton,{onClick:()=>l(!o),alt:"Add a new tool",disabled:o,tooltipBehavior:o?"hidden":"default",children:(0,x.jsx)(a5.default,{})})]}),(0,x.jsx)(st.Text,{color:"dimmer",variant:"small",multiline:!1,children:"Custom user interfaces as a Pane"})]}),(0,x.jsxs)(V.View,{gap:8,children:[o?(0,x.jsx)(gH,{onSubmit:e=>{t(e),l(!1)},onCancel:()=>{l(!1)}}):null,e.length?e.map((e,t)=>a.includes(t)?(0,x.jsx)(gH,{initialTool:e,onSubmit:e=>{n(e,t),s(e=>e.filter(e=>e!==t))},onCancel:()=>{s(e=>e.filter(e=>e!==t))}},t):(0,x.jsxs)(R.ShadesSurface,{css:[au.rcss.borderRadius(8),au.rcss.flex.wrap,{rowGap:8}],p:8,row:!0,justify:"space-between",align:"center",children:[(0,x.jsx)(st.Text,{multiline:!1,children:e.name??"Unnamed"}),(0,x.jsxs)(V.View,{row:!0,gap:12,align:"center",children:[(0,x.jsx)(uX.IconButton,{alt:`Remove ${e.name||"this tool"}`,colorway:"red",onClick:()=>{r(t)},children:(0,x.jsx)(cg.default,{})}),(0,x.jsx)(uX.IconButton,{alt:`Remove ${e.name||"this tool"}`,onClick:()=>{s(e=>[...e,t])},children:(0,x.jsx)(cd.default,{})}),(0,x.jsx)(se.Button,{iconLeft:(0,x.jsx)(uf.default,{}),variant:"outlined",text:"Preview",onClick:()=>{i(e)}})]})]},t)):(0,x.jsx)(x.Fragment,{children:o?null:(0,x.jsxs)(V.View,{css:[au.rcss.border({style:"dashed"}),au.rcss.borderRadius(8),au.rcss.p(16),au.rcss.colWithGap(8),au.rcss.center],children:[(0,x.jsx)(st.Text,{color:"dimmest",children:"You haven't added any tools"}),(0,x.jsx)(se.Button,{variant:"outlined",text:"New Tool",iconLeft:(0,x.jsx)(a5.default,{}),onClick:()=>l(!0)})]})})]})]})}function gH({onSubmit:e,onCancel:t,initialTool:n}){let[i,r]=(0,v.useState)(n?.name??""),[a,s]=(0,v.useState)(n?.icon??null),[o,l]=(0,v.useState)(n?.handler??""),u=(0,gd.useIdSeed)();return(0,x.jsxs)(R.ShadesSurface,{tag:"form",css:[au.rcss.borderRadius(8),au.rcss.border({color:A.tokens.outlineDimmest}),au.rcss.p(8)],onSubmit:t=>{t.preventDefault(),e({name:i,icon:a,handler:o})},children:[(0,x.jsxs)(V.View,{css:[au.rcss.border({color:A.tokens.outlineDimmest,direction:"bottom"}),au.rcss.align.center,au.rcss.flex.wrap,{rowGap:8}],row:!0,gap:2,justify:"space-between",children:[(0,x.jsx)(st.Text,{multiline:!1,children:i||"New Tool"}),(0,x.jsxs)(V.View,{row:!0,gap:8,children:[(0,x.jsx)(se.Button,{text:"Cancel",onClick:()=>{t()}}),(0,x.jsx)(se.Button,{colorway:"primary",iconLeft:(0,x.jsx)(p5.default,{}),text:"Save Changes",type:"submit"})]})]}),(0,x.jsxs)(V.View,{gap:8,children:[(0,x.jsxs)(V.View,{grow:!0,shrink:!0,gap:2,tag:"label",htmlFor:u("name"),children:[(0,x.jsx)(st.Text,{color:"dimmer",multiline:!1,children:"Name"}),(0,x.jsx)(cL.Input,{id:u("name"),placeholder:"SQL Viewer",value:i,onChange:e=>{r(e.currentTarget.value)},required:!0})]}),(0,x.jsxs)(V.View,{grow:!0,shrink:!0,gap:2,tag:"label",htmlFor:u("handler"),children:[(0,x.jsx)(st.Text,{color:"dimmer",multiline:!1,children:"URL Path"}),(0,x.jsx)(cL.Input,{id:u("handler"),placeholder:"/sql",value:o,onChange:e=>{l(e.currentTarget.value)},required:!0})]}),(0,x.jsxs)(V.View,{grow:!0,shrink:!0,gap:2,tag:"label",htmlFor:u("icon"),children:[(0,x.jsx)(st.Text,{color:"dimmer",multiline:!1,children:"Icon (path)"}),(0,x.jsx)(cL.Input,{id:u("icon"),placeholder:"/sql-logo.png",value:a??"",onChange:e=>{s(e.currentTarget.value||null)},required:!0})]})]})]})}function gq({manifest:e,performPaneOperation:t,update:n}){let i=(0,su.useCurrentReplExtension)(),r=(0,su.useInstallCurrentReplAsExtension)(),[a,s]=(0,v.useState)(null);return(0,x.jsxs)(V.View,{gap:24,css:[au.rcss.width("100%")],children:[(0,x.jsx)(g$,{onOpen:async e=>{s(e)},onDelete:t=>{n({...e,fileHandlers:e.fileHandlers?.filter((e,n)=>n!==t)})},onUpdate:(t,i)=>{n({...e,fileHandlers:[...e.fileHandlers?.slice(0,i)??[],t,...e.fileHandlers?.slice(i+1)??[]]})},onCreate:t=>{n({...e,fileHandlers:[...e.fileHandlers??[],t]})},fileHandlers:e.fileHandlers??[]}),(0,x.jsx)(gW,{onOpen:async e=>{let n=i;if(n||(n=await r()),!n)throw Error("Expected current repl to be installed as an extension");t({operation:"open",pane:{type:"extension",data:{extensionId:n.extensionId,installationId:n.installationId,name:e.name??n.manifest.name,baseUrl:n.baseUrl,icon:e.icon,path:e.handler}}})},onDelete:t=>{n({...e,tools:e.tools?.filter((e,n)=>n!==t)})},onUpdate:(t,i)=>{n({...e,tools:[...e.tools?.slice(0,i)??[],t,...e.tools?.slice(i+1)??[]]})},onCreate:t=>{n({...e,tools:[...e.tools??[],t]})},tools:e.tools??[]}),(0,x.jsx)(aK.Modal,{isOpen:!!a,onRequestClose:()=>s(null),children:a?(0,x.jsx)(gh,{glob:a.glob,openFile:async e=>{if(!a)throw Error("Expected pending file handler");let n=i;if(n||(n=await r()),!n)throw Error("Expected current repl to be installed as an extension");t({operation:"open",pane:{type:"extension",data:{extensionId:n.extensionId,installationId:n.installationId,name:a.name??n.manifest.name,baseUrl:n.baseUrl,path:(0,sc.getAssetUrl)(n.baseUrl,a.handler),filePath:e}}}),s(null)}}):null})]})}var gK=e.i(965097),gY=e.i(140154);let gX=(0,l7.css)(d0.interactive.filled,au.rcss.position.relative,au.rcss.p(4),au.rcss.border({color:A.tokens.outlineDimmer}),au.rcss.backgroundColor.backgroundHigher,{"&[data-complete]":[au.rcss.backgroundColor.backgroundDefault,{pointerEvents:"none"}],button:{overflow:"hidden",margin:-1,borderWidth:0,padding:0,width:1,height:1,background:"none",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",cursor:"pointer","&::after":{content:'""',position:"absolute",top:0,right:0,bottom:0,left:0,display:"block",cursor:"pointer",zIndex:1}}}),gQ=({complete:e,onClick:t,description:n,title:i,icon:r})=>(0,x.jsx)(V.View,{tag:"li",css:gX,"data-complete":e,children:(0,x.jsxs)(V.View,{p:4,children:[(0,x.jsxs)(V.View,{row:!0,gap:6,align:"center",children:[e?(0,x.jsx)(p5.default,{color:A.tokens.accentPositiveStrongest,size:16,css:[au.rcss.mr(4)]}):r??null,(0,x.jsx)(st.Text,{variant:"small",color:e?"dimmer":"default",css:[au.rcss.fontWeight.medium],children:i})]}),n?(0,x.jsx)(st.Text,{color:"dimmer",variant:"small",children:n}):null,(0,x.jsx)(V.View,{children:(0,x.jsx)("button",{onClick:()=>{t&&"function"==typeof t&&t()},type:"button",children:"Start"})})]})}),gZ=({setSelectedTab:e})=>{let{isDone:t,setAsDone:n}=(0,hh.useDismissibleElement)("extensions-onboarding-checklist"),{isDone:i,setAsDone:r}=(0,hh.useDismissibleElement)("extensions-onboarding-checklist-create"),{isDone:a,setAsDone:s}=(0,hh.useDismissibleElement)("extensions-onboarding-checklist-concepts"),{isDone:o,setAsDone:l}=(0,hh.useDismissibleElement)("extensions-onboarding-checklist-api"),{isDone:u}=(0,hh.useDismissibleElement)("extensions-onboarding-checklist-publish");if((0,v.useEffect)(()=>{r()},[]),void 0===t||!0===t)return null;let d=[i,a,o,u].filter(Boolean).length,c=[{name:"create",title:"Create an Extension",complete:!!i,icon:(0,x.jsx)(a4.default,{})},{name:"concepts",title:"Learn key concepts",complete:!!a,onClick:()=>{window.open(a8.LINKS_DOCS.EXTENSIONS,"_blank","noopener"),(0,ei.track)(er.events.EXTENSION_USED,{action:"developer_onboarding_completed",step:"concepts"}),s()},icon:(0,x.jsx)(gK.default,{})},{name:"learn",title:"Use the API",complete:!!o,onClick:()=>{window.open(a8.LINKS_DOCS.EXTENSIONS,"_blank","noopener"),(0,ei.track)(er.events.EXTENSION_USED,{action:"developer_onboarding_completed",step:"learn"}),l()},icon:(0,x.jsx)(lw.default,{})},{name:"publish",title:"Publish your Extension",complete:!!u,onClick:()=>{e("releases")},icon:(0,x.jsx)(gY.default,{})}];return(0,x.jsx)("section",{css:[au.rcss.width("100%")],children:(0,x.jsxs)(V.View,{gap:12,children:[(0,x.jsx)(V.View,{gap:2,children:(0,x.jsxs)(V.View,{row:!0,gap:12,css:[au.rcss.flex.wrap],align:"center",children:[(0,x.jsx)(st.Text,{variant:"subheadDefault",children:"Get started with Extensions"}),(0,x.jsxs)(V.View,{row:!0,gap:12,align:"center",children:[(0,x.jsx)(V.View,{row:!0,gap:2,align:"center",justify:"center",children:Array.from({length:c.length}).map((e,t)=>(0,x.jsx)(V.View,{css:[au.rcss.borderRadius(8),au.rcss.width(12),au.rcss.height(4),t<d?au.rcss.backgroundColor.accentPositiveDefault:au.rcss.backgroundColor.backgroundHighest]},t))}),(0,x.jsx)(st.Text,{multiline:!1,variant:"small",color:"dimmer",children:`${d}/${c.length}`}),(0,x.jsx)(uX.IconButton,{alt:"Hide section",onClick:n,children:(0,x.jsx)(ui.default,{})})]})]})}),(0,x.jsx)(V.View,{tag:"ul",css:[au.rcss.flex.wrap,{listStyleType:"none",gap:A.tokens.space8}],row:!0,children:c.map((e,t)=>(0,x.jsx)(gQ,{...e},t))})]})})};function gJ({performPaneOperation:e,setSelectedTab:t}){let{__status:n,parsed:i,state:r,updateString:a}=gI();if("loading"===n)return(0,x.jsx)(gA,{});if("fileReadError"===n)return(0,x.jsx)(gM,{message:r?.fileReadError||"Unknown error"});if("fileParseError"===n){let t=i.error;return(0,x.jsx)(g_,{performPaneOperation:e,manifestPath:r.manifestPath,error:t})}let s=i.manifest;return"success"===n&&s?(0,x.jsxs)(V.View,{css:[au.rcss.width("100%")],pt:12,gap:24,align:"center",children:[(0,x.jsx)(gN,{performPaneOperation:e,setSelectedTab:t}),(0,x.jsx)(gZ,{setSelectedTab:t}),(0,x.jsx)(V.View,{css:[au.rcss.border({direction:"bottom",width:4,color:A.tokens.outlineDimmest}),au.rcss.width("100%")]}),(0,x.jsxs)(V.View,{gap:8,css:[au.rcss.width("100%")],children:[(0,x.jsxs)(V.View,{gap:2,children:[(0,x.jsxs)(V.View,{row:!0,gap:8,align:"center",children:[(0,x.jsx)(f9.default,{}),(0,x.jsx)(st.Text,{variant:"subheadDefault",multiline:!1,children:"Permission Scopes"})]}),(0,x.jsxs)(st.Text,{variant:"small",color:"dimmer",children:["Let users know what your Extension can do with their data. For more information,"," ",(0,x.jsx)("a",{href:a8.LINKS_DOCS.EXTENSIONS+"/api/manifest#scopetype",target:"_blank",rel:"noopener",children:"read the docs"}),"."]})]}),(0,x.jsx)(V.View,{css:[au.rcss.borderRadius(4),au.rcss.border({color:A.tokens.outlineDimmest,width:1}),au.rcss.flex.row,au.rcss.align.center,au.rcss.p(8),au.rcss.flex.wrap,{gap:12},au.rcss.width("fit-content")],children:f7.scopes.map(e=>(0,x.jsxs)(V.View,{row:!0,gap:6,align:"center",children:[(0,x.jsx)(of.Checkbox,{id:e.key,checked:s.scopes?.some(t=>t.name===e.key),onChange:t=>{let n=s.scopes?.some(t=>t.name===e.key)&&!t?f3.patch(r.manifestStr,{...s,scopes:s.scopes?.filter(t=>t.name!==e.key)}):f3.patch(r.manifestStr,{...s,scopes:[...s.scopes??[],{name:e.key,reason:e.description}]});r.writeChange((0,f6.changeSetFromDiff)(r.manifestStr,n)),a(n)}}),(0,x.jsx)("label",{htmlFor:e.key,css:[au.rcss.fontSize(12),au.rcss.cursor.pointer],children:(0,x.jsx)("abbr",{title:e.description,css:[{textDecorationColor:A.tokens.foregroundDimmest}],children:e.friendlyName})})]},e.key))})]}),(0,x.jsx)(gq,{performPaneOperation:e,manifest:s,update:e=>{let t=f3.patch(r.manifestStr,e);r.writeChange((0,f6.changeSetFromDiff)(r.manifestStr,t)),a(t)}})]}):(0,x.jsx)("div",{children:"unknown state"})}var g0=e.i(221250),g1=e.i(542101),g2=e.i(167392),g5=e.i(109853),g4=e.i(410793);let g8=(0,ie.cssRecord)({logViewerTopLevel:[au.rcss.height("100%")],logsContainer:[au.rcss.scrollbar.thin,au.rcss.backgroundColor.backgroundDefault,au.rcss.overflowY("scroll"),au.rcss.flex.growAndShrink(1)],logViewerHeader:[au.rcss.border({direction:"bottom",width:A.tokens.borderWidthDefault}),au.rcss.display.flex,au.rcss.flex.row,au.rcss.rowWithGap(8),au.rcss.align.center],logViewerHeaderControl:[au.rcss.flex.row,au.rcss.rowWithGap(4),au.rcss.align.center],logLine:[au.rcss.font.code,d0.interactive.listItem,au.rcss.rowWithGap(2),au.rcss.align.center],logLineIcon:[{alignSelf:"flex-start"}],logMessage:{flex:"1 1 0"}});function g3({log:e,prevLevel:t,isLast:n,isFirst:i}){let[r,a]=(0,v.useState)(!1),{ref:s}=(0,g1.default)();return(0,x.jsxs)(V.View,{css:[au.rcss.flex.column,function(e){if(e===g4.LogLevel.warn)return{color:A.tokens.yellowStronger,background:"rgba(150, 125, 0, 0.2)",borderTop:i?void 0:"1px solid rgba(150, 125, 0, 0.5)",borderBottom:n?"1px solid rgba(150, 125, 0, 0.5)":void 0,"& .cm-gutter":{backgroundColor:"rgba(150, 125, 0, 0.2)"}};if(e===g4.LogLevel.error)return{color:A.tokens.accentNegativeStronger,backgroundColor:"rgba(229, 34, 34, 0.2)",borderTop:i?void 0:"1px solid rgba(229, 34, 34, 0.5)",borderBottom:n?"1px solid rgba(229, 34, 34, 0.5)":void 0,"& .cm-gutter":{backgroundColor:"rgba(229, 34, 34, 0.2)"}};let r=A.tokens.backgroundHigher;return t===g4.LogLevel.warn?r="rgba(150, 125, 0, 0.5)":t===g4.LogLevel.error&&(r="rgba(229, 34, 34, 0.5)"),{color:A.tokens.foregroundDefault,borderTop:i?void 0:`1px solid ${r}`,borderBottom:n?`1px solid ${r}`:void 0}}(e.logLevel)],children:[(0,x.jsxs)(V.View,{css:g8.logLine,p:2,onClick:()=>a(e=>!e),children:[(0,x.jsx)(V.View,{css:g8.logLineIcon,p:4,children:(0,x.jsx)(function(){return e.logLevel===g4.LogLevel.warn?(0,x.jsx)(cT.default,{size:16}):e.logLevel===g4.LogLevel.error?(0,x.jsx)(f5.default,{size:16}):(0,x.jsx)(gr.default,{size:16,css:{opacity:0}})},{})}),(0,x.jsx)(st.Text,{maxLines:10,css:g8.logMessage,variant:"small",children:e.message}),r?(0,x.jsx)(g2.default,{size:16}):(0,x.jsx)(pJ.default,{size:16})]}),r?(0,x.jsx)(V.View,{children:(0,x.jsx)(g0.default,{ref:s,css:g5.CodeMirrorEditorStyleEditorContainer,noHistory:!0,readOnly:!0,lineWrapping:!0,language:"json",fontSize:12,initialDoc:JSON.stringify(e,null,2)})}):null]})}let g6=function(){let e=(0,os.useExtAtomValue)(sl.filteredLogsAtom),t=(0,os.useSetExtAtom)(sl.clearLogsAtom),[n,i]=(0,os.useExtAtom)(sl.logFilterQueryAtom),r=(0,v.useRef)(null);return(0,v.useEffect)(()=>{let e=r.current;e&&e.children[e.children.length-1]?.scrollIntoView({behavior:"smooth"})},[e]),(0,x.jsxs)(V.View,{css:g8.logViewerTopLevel,children:[(0,x.jsxs)(V.View,{className:"log-viewer-header",css:g8.logViewerHeader,p:8,children:[(0,x.jsx)(V.View,{css:g8.logViewerHeaderControl,style:{flexGrow:1},children:(0,x.jsx)(cL.Input,{type:"search",placeholder:"Filter logs",value:n??"",onChange:e=>i(e.target.value)})}),(0,x.jsxs)(V.View,{css:g8.logViewerHeaderControl,children:[(0,x.jsx)(uX.IconButton,{alt:"Clear logs",onClick:()=>t(),children:(0,x.jsx)(ui.default,{id:"clear-logs"})}),(0,x.jsx)("label",{htmlFor:"clear-logs",children:"Clear logs"})]})]}),(0,x.jsx)(V.View,{css:g8.logsContainer,innerRef:r,children:e.map((t,n)=>(0,x.jsx)(g3,{log:t,prevLevel:e[n-1]?.logLevel,isFirst:0===n,isLast:n===e.length-1},t.index))})]})},g9={},g7=w.gql`
    subscription ExtensionBuildLogs($extensionId: String!) {
  extensionBuildDeployActionUpdates(input: {extensionId: $extensionId}) {
    ... on ExtensionBuildDeployLogAction {
      log
    }
    ... on ExtensionBuildDeployStatusAction {
      status
      message
      build {
        id
      }
    }
  }
}
    `,xe=w.gql`
    mutation DeployExtension2($extensionId: String!, $replId: String!, $outputDirectory: String!, $buildCommand: String!) {
  deployExtension2(
    extensionId: $extensionId
    replId: $replId
    outputDirectory: $outputDirectory
    buildCommand: $buildCommand
  ) {
    ... on Extension {
      ...TopLevelExtension
    }
    ... on TooManyRequestsError {
      message
    }
    ... on UserError {
      message
    }
  }
}
    ${a0.TopLevelExtensionFragmentDoc}`,xt=w.gql`
    query Publish2Extension($extensionId: String!) {
  extension(id: $extensionId) {
    ... on Extension {
      id
      user {
        id
        username
      }
      name
      description
      canDeployExtension
    }
    ... on NotFoundError {
      message
    }
  }
}
    `,xn=w.gql`
    mutation CreateExtension($name: String!, $description: String!) {
  createExtension(name: $name, description: $description) {
    ... on Extension {
      id
      url
    }
    ... on UserError {
      message
    }
    ... on TooManyRequestsError {
      message
    }
    ... on UnauthorizedError {
      message
    }
  }
}
    `,xi=w.gql`
    mutation UpdateExtension($extensionId: String!, $name: String, $description: String) {
  updateExtension(
    extensionId: $extensionId
    name: $name
    description: $description
  ) {
    ... on Extension {
      id
      name
      description
    }
    ... on UserError {
      message
    }
  }
}
    `;var xr=e.i(919061);e.i(713984);var xa=e.i(966036),xs=e.i(883021);let xo=V.SpecializedView.button;var xl=((d={}).Pending="pending",d.Active="active",d.Complete="complete",d.Error="error",d);let xu=()=>(0,x.jsx)(V.View,{css:[au.rcss.border({color:A.tokens.outlineDimmest,direction:"top"})],grow:!0,row:!0}),xd=({text:e,size:t="default",state:n,onClick:i,disabled:r,hideLoadingIcon:a})=>{let s=(0,se.getTextVariant)(t),o=(0,se.getIconSize)(t);return(0,x.jsx)(xo,{type:"button",css:[au.rcss.reset.button,au.rcss.position.relative,i&&d0.interactive.nofill,au.rcss.px(8),au.rcss.py(2),au.rcss.borderRadius(4),au.rcss.rowWithGap(4),au.rcss.align.center,{borderRadius:A.tokens.borderRadiusRound},..."error"===n?[au.rcss.color.accentNegativeStronger]:"active"===n?[au.rcss.backgroundColor.accentPrimaryDimmer,au.rcss.color.accentPrimaryStrongest]:"complete"===n?[au.rcss.color.accentPositiveStronger]:[au.rcss.color.foregroundDimmest]],onClick:i,disabled:r,children:(0,x.jsx)(se.ButtonContent,{text:e,iconSize:o,textVariant:s,iconRight:function(){if("error"===n)return(0,x.jsx)(cT.default,{});if("active"===n){if(a)return;return(0,x.jsx)(dh.default,{})}return"complete"===n?(0,x.jsx)(p5.default,{}):(0,x.jsx)(f9.default,{})}()})})};var xc=e.i(210481),xp=e.i(818976),xh=e.i(972882),xm=((c=xm||{}).Details="Details",c.Init="Init",c.CreatingExtension="CreatingExtension",c.CreatingExtensionError="CreatingExtensionError",c.Queued="Queued",c.Deploying="Deploying",c.DeployError="DeployError",c.Success="Success",c);let xf=["CreatingExtension","Deploying"];var xg=((p=xg||{}).Details="Details",p.Init="Configure",p.Create="Create",p.Deploy="Deploy",p);let xx=["Details","Configure","Deploy"];function xy({performPaneOperation:e}){let t,n,i,r,a,{container:s,fs:o,dotReplit:l}=(0,sg.default)(),[u]=(t={...g9,...void 0},S.useLazyQuery(xt,t)),d=function(e){let{setAsDone:t}=(0,hh.useDismissibleElement)(`extensions-onboarding-checklist-${e}`);return t}("publish"),[c,p]=(0,v.useState)(null),[h,m]=(0,v.useState)("Details"),[f,g]=(0,v.useState)(null),{__status:y,parsed:w,state:b,updateManifest:j}=gI(),{value:k,setValue:C,error:T,validate:E}=(0,cE.useFormField)("",e=>e?e.startsWith("/")?{message:'Folder must be relative to the root of your project (e.g. "extension" or "./extension")',severity:"error"}:null:{message:"Output folder is required",severity:"error"}),[I,P]=(0,v.useState)([]),D=(0,v.useCallback)(t=>e({operation:"open",secondary:!0,pane:{type:(0,e9.getPaneTypeForFile)(t),data:t}}),[e]),[_,M]=(0,xc.default)({openFile:D,listFiles:o.listFiles}),F=(0,xp.useTerminalTheme)();n={...g9,variables:{extensionId:c??""},onData:({data:e})=>{if(!e.data||e.error)return;let t=e.data.extensionBuildDeployActionUpdates;"ExtensionBuildDeployLogAction"===t.__typename&&P(e=>[...e,...t.log]),"ExtensionBuildDeployStatusAction"===t.__typename&&(t.status===lQ.HostingBuildStatus.Success?m("Success"):t.status===lQ.HostingBuildStatus.Failed&&m("DeployError"))},skip:"Deploying"!==h||!c},lP.useSubscription(g7,n),(0,v.useEffect)(()=>{_&&(_.clear(),I.forEach(e=>{_.write(e.replaceAll("\n","\r\n"))}))},[I,_]);let O=(0,v.useCallback)(e=>{if(!e?.config)return;let t=e.config.extension;if(!t||!1===t.isExtension){p(null),g(null),C(null);return}t.buildCommand&&g(t.buildCommand),t.outputDirectory&&C(t.outputDirectory),t.extensionID&&p(t.extensionID)},[C]);(0,v.useEffect)(()=>{let e=!1;return(async()=>{let t=await l.getConfig();e||O(t)})(),()=>{e=!0}},[l,O]);let L=(0,v.useCallback)(async e=>{p(e),await l.updateDotReplit([{op:"add",path:"extension/extensionID",value:JSON.stringify(e)},{op:"add",path:"extension/isExtension",value:JSON.stringify(!0)}])},[l]),B=(0,v.useCallback)(async e=>{g(e),await l.updateDotReplit([{op:"add",path:"extension/buildCommand",value:JSON.stringify(e)},{op:"add",path:"extension/isExtension",value:JSON.stringify(!0)}])},[l]),[N,G]=(0,v.useState)(null),[$,z]=(0,v.useState)(null),[W,H]=(0,v.useState)(null),[q,K]=(0,v.useState)(null),[Y,X]=(0,v.useState)(null),[Q]=(i={...g9,...void 0},U.useMutation(xe,i)),Z=(0,a9.default)(),[J]=(r={...g9,...void 0},U.useMutation(xn,r)),[ee,et]=(0,v.useState)(null),en=(0,v.useCallback)(async({name:e,description:t})=>{let n=await J({variables:{name:e,description:t}});if(n.errors)return{error:n.errors.map(e=>e.message).join(", "),result:null};let i=n.data?.createExtension;if(!i)return{error:"Failed to create extension",result:null};if("TooManyRequestsError"===i.__typename||"UserError"===i.__typename||"UnauthorizedError"===i.__typename)return{error:"Failed to create extension: "+i.message,result:null};if("Extension"===i.__typename)return{error:null,result:i};throw Error("Unexpected response from createExtension mutation")},[J]),[ea]=(a={...g9,...void 0},U.useMutation(xi,a)),es=(0,v.useCallback)(async()=>{let e,t=c,n=await E();if(n?.message)return void H(n?.message);if(!k)throw Error("expected output folder");let i=(0,on.normalizePath)(k),r=()=>{m("Init"),P([]),X(null),H(null),z(null),G(null)};if(r(),await o.flush(),t){let e=await u({variables:{extensionId:t}});if(e.error||!e.data)throw Error("Encountered an unknown error. Please contact support.");let n=e.data.extension;if(n?.__typename==="NotFoundError"){if(!await new Promise(e=>{et({message:`The extension referenced in .replit (${t}) does not exist. Would you like to create a new extension?`,callback:t=>{et(null),e(t)}})}))return void r();t=null}else if(n?.__typename!=="Extension"||n.canDeployExtension)if(n?.__typename==="Extension"&&n.canDeployExtension){let e=w?.manifest?.name,i=w?.manifest?.description;(e&&e!==n.name||i&&i!==n.description)&&await ea({variables:{extensionId:t,description:i??void 0,name:e??void 0}})}else throw Error("Encountered an unknown error. Please contact support.");else{if(!await new Promise(e=>{et({message:`You do not have the permissions to deploy the extension referenced in .replit (${t}). Would you like to create a new extension?`,callback:t=>{et(null),e(t)}})}))return void r();t=null}}if(!t){m("CreatingExtension");let e=await en({name:w?.manifest?.name??"My extension",description:w?.manifest?.description??"My extension's description"});if(null!==e.error){m("CreatingExtensionError"),K(e.error);return}L(t=e.result.id)}if(!t)throw Error("expected extension id to be set");await new Promise(e=>{let t=s.openChannel({service:"gcsfiles"},n=>(n.channel.request({persistMirror:{path:i}}).then(n=>{n.ok,t(),e()}),({willReconnect:e})=>{e&&t()}))}),m("Queued");try{e=await Q({variables:{extensionId:t,replId:Z,outputDirectory:i,buildCommand:f??""}})}catch(e){if(m("DeployError"),e.message.includes("received message larger than max"))return void X("Your extension's size is too large. Please compress assets or remove files, and try again.");X(e.message);return}if(e.errors){m("DeployError"),X("Internal error. Please contact support: "+e.errors.map(e=>e.message).join(", "));return}if(!e.data){m("DeployError"),X("Encountered an unknown error. Please contact support.");return}let a=e.data.deployExtension2;if("Extension"===a.__typename){m("Deploying"),d(),(0,ei.track)(er.events.EXTENSION_USED,{action:"developer_onboarding_completed",step:"publish"}),G(a);return}if("message"in a){m("DeployError"),X(a.message);return}m("DeployError"),X("Encountered an unknown error. Please contact support.")},[f,s,k,E,Z,o,m,Q,u,ea,c,en,L,d,w]),eo=function(e){switch(e){case"Details":default:return"Details";case"Init":return"Configure";case"CreatingExtension":case"CreatingExtensionError":return"Create";case"Queued":case"Deploying":case"DeployError":return"Deploy"}}(h),el=xx.indexOf(eo);function eu(){return $?`Build error: ${$}`:W?`Validation error: ${W}`:W?`Create extension error: ${q}`:Y?`Deploy error: ${Y}`:void 0}let ed=(0,sl.useExtensions)().find(e=>e.extensionId===c),[ec,ep]=(0,v.useState)(!1),eh=(0,su.useInstallExtension)(),em=(0,v.useMemo)(()=>ec?(0,x.jsx)(dh.default,{}):ed?(0,x.jsx)(p5.default,{}):(0,x.jsx)(pR.default,{}),[ec,ed]),{values:{global:ef}}=(0,oo.useTheme)(),{fireBurst:eg}=(0,xs.useConfetti)(),[ex,ey]=(0,v.useState)(!1),ev=(0,v.useRef)(null);if((0,v.useEffect)(()=>{ev.current&&!ex&&"Success"===h&&(eg({x:ev.current.getBoundingClientRect().left,y:ev.current.getBoundingClientRect().top,heading:-45,numParticles:160,lifetime:1,spread:80,velocity:()=>(0,xa.randNum)(300,5e3),size:()=>({width:(0,xa.randNum)(8,16),height:(0,xa.randNum)(8,16)}),color:[ef.tealStronger,ef.blurpleStronger,ef.yellowStronger]}),eg({x:ev.current.getBoundingClientRect().right,y:ev.current.getBoundingClientRect().top,heading:225,numParticles:160,lifetime:1,velocity:()=>(0,xa.randNum)(300,5e3),size:()=>({width:(0,xa.randNum)(8,16),height:(0,xa.randNum)(8,16)}),color:[ef.blueStronger,ef.greenStronger,ef.pinkStronger]}),ey(!0))},[h,ef,eg,ex]),y===gP.loading)return(0,x.jsx)(gA,{});if(y===gP.fileReadError)return(0,x.jsx)(gM,{message:b.fileReadError});let{manifest:ew,error:eb}=w;return eb?(0,x.jsx)(g_,{performPaneOperation:e,manifestPath:b.manifestPath,error:eb}):(0,x.jsxs)(V.View,{css:[au.rcss.flex.column,au.rcss.display.flex,au.rcss.height("100%"),au.rcss.justify.center,au.rcss.align.center,au.rcss.position.relative],children:[(0,x.jsx)(V.View,{css:[au.rcss.position.absolute,au.rcss.top(0),au.rcss.left(0),au.rcss.right(0)],className:"Confetti",innerRef:ev}),(0,x.jsxs)(V.View,{css:[au.rcss.width("100%"),au.rcss.maxWidth(f8.PANE_CONTENT_MAX_WIDTH)],grow:!0,shrink:!0,p:12,pt:16,gap:24,children:["Success"!==h?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)(V.View,{gap:16,children:[(0,x.jsx)(st.Text,{variant:"subheadBig",multiline:!0,children:"Create a new release"}),(0,x.jsx)(V.View,{row:!0,gap:4,align:"center",children:xx.map((e,t)=>{var n;return(0,x.jsxs)(v.Fragment,{children:[0!==t&&(0,x.jsx)(xu,{}),(0,x.jsx)(xd,{state:(n=t)<el?xl.Complete:n!==el?xl.Pending:["CreatingExtensionError","DeployError"].includes(h)?xl.Error:xl.Active,text:e,hideLoadingIcon:"Configure"===e||"Details"===e})]},e)})})]}),"Details"===h?(0,x.jsx)(V.View,{css:[au.rcss.flex.column,au.rcss.colWithGap(8),au.rcss.width("100%")],children:(0,x.jsx)(gG,{manifest:ew,updateManifest:j,onSubmit:e=>{j({...ew,...e}),m("Init")}})}):null,"Details"!==h?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)(V.View,{gap:16,children:[(0,x.jsxs)(V.View,{row:!0,gap:8,align:"center",children:[(0,x.jsx)(pC.default,{}),(0,x.jsx)(st.Text,{variant:"subheadDefault",children:"Build settings"}),(0,x.jsx)(V.View,{css:[au.rcss.border({color:A.tokens.backgroundHighest,direction:"y"})],grow:!0})]}),(0,x.jsxs)(V.View,{gap:4,children:[(0,x.jsxs)("label",{htmlFor:"buildCommand",css:[au.rcss.display.flex,au.rcss.rowWithGap(4),au.rcss.align.center],children:[(0,x.jsx)(st.Text,{color:"dimmer",variant:"small",children:"Build command (optional)"}),(0,x.jsx)(dQ.Tooltip,{tooltip:"This is the command that compiles your app at build time. Leave it blank if you don't need to build your app.",children:(0,x.jsx)(gr.default,{size:12})})]}),(0,x.jsx)(cL.Input,{value:f??"",onChange:e=>B(e.target.value),placeholder:"Example: npm run build",disabled:"Init"!==h&&xf.includes(h)})]}),(0,x.jsxs)(V.View,{gap:4,children:[(0,x.jsxs)("label",{htmlFor:"outputFolder",css:[au.rcss.display.flex,au.rcss.rowWithGap(4),au.rcss.align.center],children:[(0,x.jsx)(st.Text,{color:"dimmer",variant:"small",children:"Output folder"}),(0,x.jsx)(dQ.Tooltip,{tooltip:"This is where your build will live. There must be an extension.json file in this folder.",children:(0,x.jsx)(gr.default,{size:12})})]}),(0,x.jsx)(cL.Input,{id:"outputFolder",value:k??"",disabled:"Init"!==h&&xf.includes(h),onChange:e=>{C(e.currentTarget.value),l.updateDotReplit([{op:"add",path:"extension/outputDirectory",value:JSON.stringify(e.currentTarget.value)},{op:"add",path:"extension/isExtension",value:JSON.stringify(!0)}])},placeholder:"./extension"}),T?(0,x.jsx)(st.Text,{css:[au.rcss.color.accentNegativeStronger],children:T.message}):null]}),(0,x.jsx)(se.Button,{text:"Init"===h||h.endsWith("Error")?"Deploy and Release":"Deploying",iconLeft:"Init"===h||h.endsWith("Error")?(0,x.jsx)(pu.default,{}):(0,x.jsx)(dh.default,{}),onClick:es,disabled:"Init"!==h&&xf.includes(h),colorway:"primary"}),(0,x.jsxs)(st.Text,{multiline:!0,variant:"small",color:"dimmer",children:["By releasing an Extension, you agree to the"," ",(0,x.jsx)("a",{href:a8.LINKS_LEGAL.EXTENSIONS_DEVELOPER_TERMS,children:"Developer Terms"})]})]}),I.length>0?(0,x.jsxs)(V.View,{gap:8,children:[(0,x.jsxs)(V.View,{row:!0,gap:8,align:"center",children:[(0,x.jsx)(xr.default,{}),(0,x.jsx)(st.Text,{variant:"subheadDefault",children:"Build logs"}),(0,x.jsx)(V.View,{css:[au.rcss.border({color:A.tokens.backgroundHighest,direction:"y"})],grow:!0})]}),eu()?(0,x.jsx)(f_.StatusBanner,{text:eu(),colorway:"red",icon:(0,x.jsx)(f5.default,{})}):null,(0,x.jsx)(V.View,{css:[au.rcss.display.flex,au.rcss.py(12),au.rcss.pl(16),au.rcss.borderRadius(8),au.rcss.overflow("hidden"),{border:`1px solid ${A.tokens.outlineDimmest}`,backgroundColor:F?.background}],children:(0,x.jsx)(V.SpecializedView.div,{css:[au.rcss.width("100%"),au.rcss.maxWidth("100%")],ref:M})})]}):null,ee?(0,x.jsxs)(R.ShadesSurface,{css:[au.rcss.borderRadius(8)],p:8,gap:8,children:[(0,x.jsx)(st.Text,{variant:"text",multiline:!0,maxLines:3,children:ee.message}),(0,x.jsxs)(V.View,{row:!0,gap:4,align:"center",children:[(0,x.jsx)(se.Button,{text:"No",css:[au.rcss.flex.grow(1)],onClick:()=>ee.callback(!1)}),(0,x.jsx)(se.Button,{text:"Yes",colorway:"primary",css:[au.rcss.flex.grow(1)],onClick:()=>ee.callback(!0)})]})]}):null]}):null]}):null,N&&"Success"===h?(0,x.jsxs)(V.View,{gap:16,children:[(0,x.jsxs)(V.View,{gap:4,children:[(0,x.jsx)(st.Text,{variant:"subheadBig",multiline:!1,children:"Congratulations!"}),(0,x.jsx)(st.Text,{color:"dimmer",multiline:!1,children:"You just published a new release to the Extensions Store."})]}),(0,x.jsx)(V.View,{py:8,children:(0,x.jsx)(xh.ExtensionCard,{showMetadata:!1,extension:N,onClick:()=>{e({operation:"open",pane:{type:"extensionStore",data:{page:"cover",coverPageExtensionId:(0,a3.asExtensionId)(N.id)}}})}})}),(0,x.jsxs)(V.View,{row:!0,gap:8,align:"center",children:[(0,x.jsx)(gK.default,{}),(0,x.jsx)(st.Text,{variant:"subheadDefault",multiline:!1,children:"Next steps"}),(0,x.jsx)(V.View,{css:[au.rcss.border({color:A.tokens.backgroundHighest,direction:"y"})],grow:!0})]}),(0,x.jsxs)(V.View,{css:[au.rcss.border({color:A.tokens.outlineDimmest}),au.rcss.borderRadius(8)],p:12,gap:8,children:[(0,x.jsx)(st.Text,{variant:"subheadDefault",children:"Install your Extension"}),(0,x.jsx)(st.Text,{color:"dimmer",children:"Once installed, you can use the extension in any of your Apps."}),(0,x.jsx)(se.Button,{text:ed?"Already installed":"Install Extension",colorway:ed?"green":"primary",disabled:ec||!!ed,iconLeft:em,loading:ec,onClick:async()=>{ep(!0),await eh({extensionId:(0,a3.asExtensionId)(N.id),replId:null}),ep(!1)}})]})]}):null]})]})}var xv=e.i(628796);function xw({performPaneOperation:e}){let[t,n]=(0,v.useState)("home");return(0,x.jsx)(V.View,{css:[au.rcss.flex.column,au.rcss.height("100%"),au.rcss.position.relative],children:(0,x.jsx)("div",{css:[au.rcss.flex.grow(1),au.rcss.flex.column,au.rcss.align.center,au.rcss.display.flex,au.rcss.overflow("hidden")],children:(0,x.jsxs)(xv.Tabs,{selectedKey:t,onSelectionChange:e=>n(e),children:[(0,x.jsx)(R.ShadesSurface,{css:[au.rcss.top(0),au.rcss.width("100%"),au.rcss.zIndex(1)],align:"center",elevate:!1,children:(0,x.jsxs)(xv.TabList,{css:[au.rcss.align.center,au.rcss.width("100%"),au.rcss.pb(0),au.rcss.maxWidth(f8.PANE_CONTENT_MAX_WIDTH)],children:[(0,x.jsx)(xv.Tab,{id:"home",css:[au.rcss.p(12),au.rcss.height("100%"),au.rcss.borderRadius(0)],iconLeft:(0,x.jsx)(h0.default,{}),children:"Home"}),(0,x.jsx)(xv.Tab,{id:"releases",css:[au.rcss.p(12),au.rcss.height("100%"),au.rcss.borderRadius(0)],iconLeft:(0,x.jsx)(f4.default,{}),children:"Releases"}),(0,x.jsx)(xv.Tab,{id:"logs",css:[au.rcss.p(12),au.rcss.height("100%"),au.rcss.borderRadius(0)],iconLeft:(0,x.jsx)(f5.default,{}),children:"Logs"}),(0,x.jsx)(V.View,{grow:!0}),(0,x.jsx)(R.ShadesSurface,{css:[{boxShadow:`inset 0 -1px 0 ${A.tokens.outlineDimmest}`}],p:8,elevate:!1,children:(0,x.jsx)(p9.ButtonLink,{text:"Docs",href:a8.LINKS_DOCS.EXTENSIONS,target:"_blank",rel:"noopener",variant:"outlined",size:"small",iconLeft:(0,x.jsx)(f2.default,{}),css:[au.rcss.display.inlineFlex]})})]})}),(0,x.jsx)("div",{css:[au.rcss.flex.grow(1),au.rcss.align.center,au.rcss.justify.center,au.rcss.width("100%"),au.rcss.display.flex,au.rcss.overflow("hidden")],children:(0,x.jsxs)(xv.TabPanels,{children:[(0,x.jsx)(xv.TabPanel,{id:"home",css:[au.rcss.height("100%"),au.rcss.p(12),au.rcss.maxWidth(f8.PANE_CONTENT_MAX_WIDTH),au.rcss.display.flex,au.rcss.width("100%"),au.rcss.justify.center,au.rcss.overflowY("scroll")],children:(0,x.jsx)(gJ,{performPaneOperation:e,setSelectedTab:n})}),(0,x.jsx)(xv.TabPanel,{id:"releases",css:[au.rcss.height("100%"),au.rcss.width("100%"),au.rcss.overflowY("scroll")],children:(0,x.jsx)(xy,{performPaneOperation:e})}),(0,x.jsx)(xv.TabPanel,{id:"logs",css:[au.rcss.height("100%"),au.rcss.width("100%")],children:(0,x.jsx)(g6,{})})]})})]})})})}let xb=em.Type.Object({type:em.Type.Literal("extensionDevtools")}),xj={Content:({options:{performPaneOperation:e}})=>(0,x.jsx)(xw,{performPaneOperation:e}),Icon:({size:e})=>(0,x.jsx)(a4.default,{size:e}),getTitle:()=>"Extensions Devtools",description:"Manage and debug workspace extensions",category:fj.PaneCategory.WorkspaceExtensions,decode:e=>s2.Value.Decode(xb,e)};var xS=e.i(678486),xk=e.i(495954);function xC(e){let t=n9(nM),n=(0,su.useInstallExtension)(),i=(0,su.useUninstallExtension)(),r=(0,sl.useExtensions)(),a=(0,v.useCallback)((n,i)=>{if("cover"===n){if(null===i)return void a("store",null);t({paneId:e.paneId,pane:{type:"extensionStore",data:{coverPageExtensionId:i??null,page:"cover"}}})}else t({paneId:e.paneId,pane:{type:"extensionStore",data:{page:n}}})},[t,e.paneId]);if("cover"===e.page){let t=r.find(t=>t.extensionId===e.coverPageExtensionId)?.installationId??null;return(0,x.jsx)(xS.ExtensionCoverPage,{existingInstallationId:t,extensionId:e.coverPageExtensionId,goBackToStore:()=>a("store",null),installExtension:async()=>{let t=await n({extensionId:e.coverPageExtensionId,replId:null});if(!t)throw Error("Failed to install extension");return(0,a3.asInstallationId)(t.id)},uninstallExtension:async e=>{await i({installationId:e,replId:null})}})}return(0,x.jsx)(xk.default,{storeMode:"pane",openExtensionCover:e=>a("cover",e),setPage:e=>a(e,null),page:e.page})}let xT=em.Type.Union([em.Type.Object({page:em.Type.Union([em.Type.Literal("store"),em.Type.Literal("manage")])}),em.Type.Object({page:em.Type.Literal("cover"),coverPageExtensionId:em.Type.Unsafe(em.Type.String())})]),xE=em.Type.Object({type:em.Type.Literal("extensionStore"),data:xT}),xI={Content:e=>(0,x.jsx)(xC,{...e.pane.data,paneId:e.options.paneId}),Icon:({size:e})=>(0,x.jsx)(ai.IconContext.Provider,{value:{color:A.tokens.yellowStronger,size:e},children:(0,x.jsx)(a4.default,{})}),getTitle:()=>"Extension Store",description:"Find and install workspace extensions",category:fj.PaneCategory.WorkspaceExtensions,decode:e=>s2.Value.Decode(xE,e)};var xP=e.i(334028),xA=e.i(257042);let xR=em.Type.Object({type:em.Type.Literal("replAuth")}),xD={Content:xA.default,Icon:({size:e})=>(0,x.jsx)(ai.IconContext.Provider,{value:{color:A.tokens.orangeStrongest,size:e},children:(0,x.jsx)(xP.default,{})}),getTitle:()=>"Authentication",description:"Let users log in to your App using a prebuilt login page or customize your own button",category:fj.PaneCategory.CloudServices,decode:e=>s2.Value.Decode(xR,e)};var xV=e.i(324975),x_=e.i(86306),xM=e.i(357114);let xF=e=>{e.focus?.()};function xO({isValid:e,move:t,focus:n=xF,wrap:i=!1,selector:r,boundary:a}){let s=(0,v.useRef)(null);return(0,v.useEffect)(()=>{if(!s.current)return;let o=s.current,l=s=>{let l;if(!e(s)||0===(l=r?[...o.querySelectorAll(r)]:[...o.querySelectorAll('a[href],button,input,textarea,select,details,[tabindex]:not([tabindex="-1"])')]).length)return;let u=document.activeElement;if(!o.contains(u))return;if(r)if(a){let e=u?.closest(a),t=u?.closest(r);u=t||e?.querySelector(r)}else u=u?.closest(r);if(r&&(!u||!o.contains(document.activeElement))){s.preventDefault(),s.stopPropagation();let e=document.activeElement?.querySelector(r);e?n(e):n(l[0]);return}if(!u){s.preventDefault(),s.stopPropagation(),n(l[0]);return}let d=l.findIndex(e=>e===u);if(-1===d){s.preventDefault(),s.stopPropagation(),n(l[0]);return}let c=t({event:s,children:l,activeIndex:d,activeElement:u});!i&&(c<0||c>l.length-1)||(n(c<0?l[l.length-1]:c>l.length-1?l[0]:l[c]),s.stopPropagation(),s.preventDefault())};return o.addEventListener("keydown",l),()=>{o.removeEventListener("keydown",l)}},[a,e,t,n,s,r,i]),s}var xL=e.i(712516),xB=e.i(624253);let xU=(0,ie.cssRecord)({queryPill:[au.rcss.display.inline,au.rcss.fontSize(A.tokens.fontSizeDefault)],popover:[{"& > .popover-control-container":au.rcss.mr(0)}]});function xN({text:e}){return(0,x.jsx)(cH.Pill,{css:xU.queryPill,text:0===e.length?"":e})}function xG({query:e,replacement:t,numMatches:n,onCancel:i,onConfirm:r}){return(0,x.jsxs)(V.View,{gap:8,p:12,children:[(0,x.jsxs)(V.View,{children:[(0,x.jsxs)(st.Text,{children:["Replace ",(0,x.jsx)(xN,{text:e})," with"," ",(0,x.jsx)(xN,{text:t})," in"," ",(0,uw.default)("match",n,!0),"?"]}),(0,x.jsx)(st.Text,{children:"This operation cannot be undone!"})]}),(0,x.jsxs)(V.View,{row:!0,gap:12,justify:"end",children:[(0,x.jsx)(se.Button,{onClick:()=>i(),text:"Cancel"}),(0,x.jsx)(se.Button,{colorway:"negative",onClick:()=>r(),text:`Yes, replace ${(0,uw.default)("match",n,!0)}`,iconLeft:(0,x.jsx)(xB.default,{})})]})]})}function x$({disabled:e,loading:t,query:n,replacement:i,results:r,replace:a,onReplace:s,buttonProps:o}){let[l,u]=(0,v.useState)(!1),d=async()=>{u(!1),(0,ei.track)(er.events.SEARCH_PANE_USED,{action:"replace"}),(await a()).success&&s()},c=(0,v.useMemo)(()=>r.reduce((e,{lines:t})=>e+t.reduce((e,t)=>e+t.matches.length,0),0),[r]);return(0,x.jsx)(V.View,{css:xU.popover,children:(0,x.jsxs)(d1.PopoverTrigger,{onOpenChange:u,label:"Confirm replace all",isOpen:l,children:[(0,x.jsx)(se.Button,{...o,text:"Replace all",disabled:e||t,onClick:()=>{u(e=>!e)}}),(0,x.jsx)(xG,{query:n,replacement:i,numMatches:c,onCancel:()=>u(!1),onConfirm:d})]})})}var xz=e.i(551959);let xW=(0,ie.cssRecord)({self:[au.rcss.position.relative,au.rcss.flex.shrink(1),au.rcss.width("100%")],iconWrapper:[au.rcss.position.absolute,au.rcss.top(0),au.rcss.right(0),au.rcss.height("100%"),au.rcss.p(4)]}),xH=(0,v.forwardRef)(({onClear:e,...t},n)=>(0,x.jsxs)(V.View,{css:xW.self,children:[(0,x.jsx)(xz.MultiLineInputWithHistory,{ref:n,...t}),(t.value?.length||0)>0?(0,x.jsx)(V.View,{css:xW.iconWrapper,children:(0,x.jsx)(uX.IconButton,{alt:"Clear search query",tooltipBehavior:"hidden",onClick:e,css:{"&:hover":{backgroundColor:`${A.tokens.backgroundHighest} !important`}},children:(0,x.jsx)(ui.default,{})})}):null]}));xH.displayName="SearchInput";var xq=e.i(294751),xK=e.i(163793),xY=e.i(790486),xX=e.i(927225);let xQ=(0,ie.cssRecord)({self:[au.rcss.width("fit-content"),au.rcss.display.inlineBlock,au.rcss.color.accentNegativeDefault,au.rcss.fontWeight.bold]});function xZ({content:e}){return(0,x.jsx)(x.Fragment,{children:e.split("\n").reduce((e,t,n)=>null===e?[t]:[...e,(0,x.jsx)(V.SpecializedView.span,{css:xQ.self,children:"\\n"},`${t}-${n}`),t],null)})}let xJ=V.SpecializedView.span,x0="SearchMatch";var x1=((h=x1||{}).HIGHLIGHT="highlight",h.REMOVE="remove",h.ADD="add",h.TEXT="text",h);function x2(e){return{outlineColor:e,outlineWidth:"1px",outlineStyle:"solid"}}let x5=(0,ie.cssRecord)({self:[au.rcss.width("fit-content"),au.rcss.display.inline,au.rcss.cursor.pointer,{"&:focus-visible":[au.rcss.focusRing]},au.rcss.mx(1),au.rcss.px(2),au.rcss.borderRadius(4)],highlight:[au.rcss.backgroundColor.accentPrimaryDimmest,x2(A.tokens.accentPrimaryDimmer)],remove:[au.rcss.backgroundColor.accentNegativeDimmest,x2(A.tokens.accentNegativeDimmer),{textDecoration:"line-through"}],add:[au.rcss.backgroundColor.accentPositiveDimmest,x2(A.tokens.accentPositiveDimmer)],hiddenTextWrapper:[au.rcss.display.inlineBlock,au.rcss.mx(2),{"& > div":[au.rcss.display.inlineBlock],transform:"translateY(12.5%)"}],firstHiddenTextWrapper:[au.rcss.ml(0)],lastHiddenTextWrapper:[au.rcss.mr(0)]});function x4({content:e,matches:t,dedentBy:n,replacement:i,isRegex:r,query:a,onOpenAtPosition:s}){return(0,x.jsx)(x.Fragment,{children:(function({content:e,matches:t,dedentBy:n,replacement:i}){let r=[],a=n;for(let n=0;n<t.length;n++){let s=t[n],o=s.start+s.length;r.push({start:a,end:s.start,type:"text"});let l=e.substring(s.start,o);i.length>0&&i!==l?(r.push({start:s.start,end:o,type:"remove"}),r.push({start:-1,end:o,type:"add"})):r.push({start:s.start,end:o,type:"highlight",matchIndex:n}),a=o}return r.push({start:a,end:e.length,type:"text"}),r})({content:e,matches:t,dedentBy:n,replacement:i}).map(({start:t,end:n,type:o},l,u)=>{let d=`${t}-${n}`,c=n-t;if("text"===o){let i=u[l+1];if(0===l&&c>50)return(0,x.jsxs)(v.Fragment,{children:[(0,x.jsx)(xJ,{css:[x5.hiddenTextWrapper,x5.firstHiddenTextWrapper],children:(0,x.jsx)(uX.IconButton,{size:18,alt:"Jump to hidden text",onClick:()=>{s(n-50)},children:(0,x.jsx)(xX.default,{})})},d),(0,x.jsx)("span",{children:e.substring(n-50,n)})]},d);if(l===u.length-1&&c>50)return(0,x.jsxs)(v.Fragment,{children:[(0,x.jsx)("span",{children:e.substring(t,t+50)}),(0,x.jsx)(xJ,{css:[x5.hiddenTextWrapper,x5.lastHiddenTextWrapper],children:(0,x.jsx)(uX.IconButton,{size:18,alt:"Jump to hidden text",onClick:()=>{s(t+50)},children:(0,x.jsx)(xX.default,{})})},d)]},d);if(i&&c>100)return(0,x.jsxs)(v.Fragment,{children:[(0,x.jsx)("span",{children:e.substring(t,t+50)}),(0,x.jsx)(xJ,{css:x5.hiddenTextWrapper,children:(0,x.jsx)(uX.IconButton,{size:18,alt:"Jump to hidden text",onClick:()=>{s(t+50)},children:(0,x.jsx)(xX.default,{})})},d),(0,x.jsx)("span",{children:e.substring(n-50,n)})]},d)}let p=-1===t?i:e.substring(t,n);if("text"===o)return(0,x.jsx)(v.Fragment,{children:p},d);let h=null,m=u[l-1];return"add"===o&&m?.type==="remove"&&(h=e.substring(m.start,m.end)),(0,x.jsx)(x8,{content:p,type:o,isRegex:r,query:a,replacement:i,removedText:h,onClick:e=>{e.stopPropagation(),s(n)}},d)})})}function x8({content:e,type:t,isRegex:n,replacement:i,query:r,removedText:a,...s}){let o,l=e;switch(t){case"highlight":o=`Matched text ${l}`;break;case"remove":o=`Removed text ${l}`;break;case"add":if(o=`Added text ${l}`,n&&null!==a)try{l=a.replace(new RegExp(r),i.replaceAll(/\$[&`']/g,"$$$&"))}catch(e){}}return(0,x.jsx)(V.SpecializedView.span,{css:[x5.self,x5[t]],tabIndex:0,"aria-label":o,role:"button","data-nav":x0,...s,children:"add"===t?(0,x.jsx)(xZ,{content:l}):l})}let x3=(0,ie.cssRecord)({self:[au.rcss.width("100%"),au.rcss.flex.wrap],text:[au.rcss.display.block,au.rcss.textAlign.center,{overflow:"visible",whiteSpace:"normal"}]});function x6({error:e}){return(0,x.jsxs)(V.View,{css:x3.self,pt:8,pb:8,row:!0,gap:4,align:"center",justify:"center",children:[(0,x.jsx)(cT.default,{}),(0,x.jsx)(st.Text,{css:x3.text,multiline:!1,children:e})]})}var x9=e.i(8412),x7=e.i(717639);let ye="SearchLine",yt="--search-line-number-width",yn=(0,ie.cssRecord)({self:[au.rcss.overflow("hidden"),au.rcss.cursor.pointer,au.rcss.borderRadius(4),{"&:focus-visible":[au.rcss.focusRing],"&:hover, &:focus-visible":[au.rcss.backgroundColor.backgroundHighest]}],content:[au.rcss.font.code,au.rcss.maxWidth("100%"),au.rcss.width("fit-content"),{whiteSpace:"pre-wrap",overflowWrap:"break-word"}],lineNumberWrapper:[au.rcss.display.inlineBlock,au.rcss.color.foregroundDimmest,au.rcss.mr(8),au.rcss.pl(8)],lineNumber:[au.rcss.display.inlineBlock,au.rcss.textAlign.right,{width:`var(${yt})`}]});function yi({lineNumber:e,content:t,matches:n,path:i,dedentBy:r,onFileLineClicked:a,...s}){let o=(0,q.default)(()=>t=>{(0,ei.track)(er.events.SEARCH_PANE_USED,{action:"result_clicked",...s}),a({path:i,lineNumber:e,columnNumber:t})},[e,s,i,a]),l=(0,q.default)(()=>()=>{let e=n.length>0?n[0]:null;o(e?e.start+e.length:0)},[n,o]);return(0,x.jsxs)(V.View,{tabIndex:0,css:yn.self,row:!0,gap:8,align:"stretch","data-nav":ye,onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),e.stopPropagation(),l())},onClick:l,children:[(0,x.jsx)(V.View,{css:yn.lineNumberWrapper,children:(0,x.jsx)(V.View,{tag:"span",css:yn.lineNumber,"aria-label":`Line ${e}`,children:e})}),(0,x.jsx)("pre",{css:yn.content,children:(0,x.jsx)(x4,{isRegex:s.isRegex,content:t,matches:n,dedentBy:r,query:s.query,replacement:s.replacement,onOpenAtPosition:o})})]})}var yr=e.i(965153);let ya="SearchFileNav",ys="SearchFileHeaderNav",yo="SearchQueryNav",yl="SearchQueryTogglesNav",yu=parseInt(A.values.space24,10)+10,yd=(0,ie.cssRecord)({header:[au.rcss.rowWithGap(4),au.rcss.align.center,au.rcss.rowWithGap(6),au.rcss.flex.growAndShrink(1),au.rcss.overflow("hidden")],headerParentPathText:[au.rcss.flex.shrink(1e7)],headerFileNameText:[au.rcss.flex.shrink(1)],headerMatchesCountPill:[au.rcss.height(20),au.rcss.flex.shrink(0)],accordionWrapper:[au.rcss.mx(4),au.rcss.border({direction:"top",color:A.tokens.outlineDimmest})],accordionChildren:[au.rcss.p(4)],linesWrapper:[au.rcss.overflow("hidden"),au.rcss.borderRadius(4),au.rcss.font.code]});function yc({path:e,lines:t,dedentBy:n,isFirst:i,expanded:r=!0,onClick:a,scrollOffset:s=0,onFileLineClicked:o,searchResultBackgroundColor:l,...u}){let{preferences:{fontSize:d}}=(0,lc.usePreferences)("fontSize"),c=(0,v.useRef)(null),p=(0,q.default)(()=>t.reduce((e,t)=>e+t.matches.length,0),[t]),h=(0,q.default)(()=>{let e=t[t.length-1];if(!e)return{};let n=(0,x7.getDigits)(e.lineNumber),i=(0,x9.lineHeightFromFontSize)(d);return{fontSize:d,lineHeight:i,[yt]:`${n}ch`}},[t,d]);return(0,x.jsx)(R.ShadesSurface,{css:yd.accordionWrapper,style:h,"data-nav":ya,innerRef:c,elevate:!1,children:(0,x.jsx)(yr.AccordionItem,{expanded:r,onClick:()=>{a(c.current)},headerProps:{"data-nav":`${ys} ${ye} ${i?`${yo} ${yl}`:""}`,style:{position:"sticky",zIndex:1,insetBlockStart:`-${s}px`,borderRadius:0,backgroundColor:l}},headerContent:(0,x.jsxs)(V.View,{css:yd.header,children:[(0,x.jsx)(lH.default,{path:e,size:16}),(0,x.jsx)(st.Text,{css:yd.headerFileNameText,multiline:!1,children:(0,rt.getFileName)(e)}),(0,x.jsx)(st.Text,{color:"dimmest",css:yd.headerParentPathText,multiline:!1,children:(0,rt.getParentPath)(e).replace(/^\.\//,"")}),(0,x.jsx)(cH.Pill,{variant:"muted",text:`${p} ${(0,uw.default)("match",p)}`,css:yd.headerMatchesCountPill})]}),children:(0,x.jsx)(V.View,{css:yd.accordionChildren,children:(0,x.jsx)(V.View,{css:yd.linesWrapper,children:t.map(t=>(0,x.jsx)(yi,{...t,...u,path:e,dedentBy:n,onFileLineClicked:o},t.lineNumber))})})})})}var yp=e.i(526017),yh=e.i(178496),ym=e.i(564604);let yf=(0,ie.cssRecord)({container:[au.rcss.border({direction:"bottom",color:A.tokens.outlineDimmest})],actions:[au.rcss.display.flex,au.rcss.rowWithGap(4)]});function yg(e){let t="collapse"===e.collapseExpandAllState;return(0,x.jsxs)(V.View,{css:yf.container,p:4,row:!0,align:"center",justify:"space-between",children:[(0,x.jsxs)(st.Text,{color:"dimmer",children:[e.totalCount," results in ",(0,uw.default)("file",e.fileCount,!0)]}),(0,x.jsxs)(V.View,{css:yf.actions,children:[(0,x.jsx)(uX.IconButton,{alt:"Open New Search",onClick:e.onStartNewSearch,children:(0,x.jsx)(ym.default,{})}),(0,x.jsx)(uX.IconButton,{alt:t?"Collapse All":"Expand All",onClick:e.onToggleCollapseExpandAll,children:t?(0,x.jsx)(yp.default,{}):(0,x.jsx)(yh.default,{})})]})]})}var yx=e.i(189920);let yy=(0,l7.keyframes)({from:{opacity:0},to:{opacity:1}}),yv=(0,ie.cssRecord)({listWrapper:[au.rcss.overflowY("auto"),au.rcss.flex.grow(1),{contain:"strict"}],list:[au.rcss.width("100%"),au.rcss.position.relative],listItem:[au.rcss.position.absolute,au.rcss.top(0),au.rcss.left(0),au.rcss.width("100%")],resultRow:[{animation:`${yy} 120ms linear forwards`}]});function yw({results:e,error:t,paneRef:n,onFileLineClicked:i,onOpenSearchPane:r,searchResultBackgroundColor:a,...s}){var o,l,u;let d,c,p,h,m,f,g=(0,q.default)(()=>e.filter(e=>e.lines.length>0),[e]),y=(0,q.default)(()=>g.reduce((e,t)=>e+t.lines.reduce((e,t)=>e+t.matches.length,0),0),[g]),[w,b]=(0,v.useState)({}),j=(0,v.useRef)(null),S=(0,xY.useVirtualizer)({count:g.length,getScrollElement:()=>j.current,estimateSize:e=>(function(e,t){let n=e.length;if(t){let i=t-24;for(let t=0;t<e.length;t++){let r=e[t],a=9*(0,x7.getDigits)(t)+9*r.content.length+4*r.matches.length;a>i&&(n+=Math.floor(i/a)+1)}}return yu+20+24.39*n+2*n})(g[e].lines,n?.current?.offsetWidth),overscan:3}),k=S.getVirtualItems(),C=(0,v.useRef)(null),T=(0,v.useCallback)(e=>{let t=j.current;if(!t||C.current===e)return;if(e.matches(`[data-nav*="${ys}"]`))return void e.focus();let n=e.closest(`[data-nav="${ya}"]`),i=n?.querySelector(`[data-nav*="${ys}"]`);if(!i)return void e.focus();let r=i.getBoundingClientRect();if(i.offsetTop+r.height>e.offsetTop){let n=e.offsetTop-r.height;C.current=e;let i=()=>{t.scrollTop===n&&(t.removeEventListener("scroll",i),C.current===e&&(e.focus(),C.current=null))};t.addEventListener("scroll",i),t.scrollTo({top:n})}else e.focus()},[]),E=(o={selector:`[data-nav*="${ys}"]`,boundary:`[data-nav*="${ya}"]`},d=(0,v.useCallback)(e=>"Tab"===e.key,[]),c=(0,v.useCallback)(({event:e,activeIndex:t})=>e.shiftKey?t-1:t+1,[]),xO({...o,isValid:d,move:c})),I=(l={selector:`[data-nav*="${ye}"]`,focus:T},p=(0,v.useCallback)(e=>"ArrowUp"===e.key||"ArrowDown"===e.key,[]),h=(0,v.useCallback)(({event:e,activeIndex:t})=>"ArrowUp"===e.key?t-1:t+1,[]),xO({...l,isValid:p,move:h})),P=(u={selector:`[data-nav*="${x0}"]`,focus:T},m=(0,v.useCallback)(e=>"ArrowLeft"===e.key||"ArrowRight"===e.key,[]),f=(0,v.useCallback)(({event:e,activeIndex:t})=>"ArrowLeft"===e.key?t-1:t+1,[]),xO({...u,isValid:m,move:f})),A=(0,xK.mergeRefs)(E,I,P),R=(0,q.default)(()=>g.length===Object.keys(w).length&&Object.values(w).every(Boolean),[w,g.length]),D=null;return g.length>0?D=(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(yg,{fileCount:g.length,totalCount:y,collapseExpandAllState:R?"expand":"collapse",onToggleCollapseExpandAll:()=>{R?b({}):b(g.reduce((e,t)=>({...e,[t.path]:!0}),{}))},onStartNewSearch:r}),(0,x.jsx)(V.SpecializedView.div,{ref:j,css:yv.listWrapper,children:(0,x.jsx)(V.View,{css:yv.list,style:{height:S.getTotalSize()},children:(0,x.jsx)(V.View,{css:yv.listItem,style:{transform:`translateY(${k[0]?.start}px)`},innerRef:A,children:k.map(e=>{let t=g[e.index],{path:n}=t;return(0,x.jsx)(V.SpecializedView.div,{"data-index":e.index,ref:S.measureElement,css:yv.resultRow,children:(0,x.jsx)(yc,{...t,...s,scrollOffset:k[0]?.start,onFileLineClicked:i,isFirst:0===e.index,expanded:!0!==w[n],searchResultBackgroundColor:a,onClick:e=>{if(b(e=>({...e,[n]:!(n in e)||!e[n]})),!j.current||!e)return;let t=Math.floor(k[0]?.start??0),i=Math.floor(j.current.scrollTop),r=e.offsetTop+t;r>i||j.current.scrollTo({top:r-1})}})},e.key.toString())})})})})]}):t===yx.SearchError.EMPTY_RESULTS&&(D=(0,x.jsx)(xL.default,{pane:{type:"searchReplace"},headerText:t})),(0,x.jsxs)(x.Fragment,{children:[t&&t!==yx.SearchError.EMPTY_RESULTS?(0,x.jsx)(x6,{error:t}):null,D]})}var yb=e.i(316346);function yj(e){return(0,v.useMemo)(()=>[...(0,yb.splitGlobAware)(e,",")].map(e=>e.trim()).filter(e=>e.length>0),[e])}var yS=((m={}).QUERY_EMPTY="The query is empty",m.QUERY_SAME="The query is the same as replacement",m.NO_MATCHES="No matches were found to replace",m.RG_EMPTY="Ripgrep didn't return a response",m.NOT_MOUNTED="Component wasn't mounted",m),yk=e.i(431544);async function yC({container:e,fileList:t,...n}){let i;if(0===n.query.length)return{success:!1,errorOn:"exit",errorMessage:yS.QUERY_EMPTY};if(n.query===n.replacement)return{success:!1,errorOn:"exit",errorMessage:yS.QUERY_SAME};if(t&&t.length>0)i=t;else{let t=await e.exec(...(0,yk.createSearchCommand)({...n,context:1,mode:"files"}));if(t.error)return{success:!1,errorOn:"rg",errorMessage:"exit status 1"===t.error?yS.NO_MATCHES:t.error};i=t.output?.split("\n").filter(e=>e.trim().length>0)||[]}if(0===i.length)return{success:!1,errorOn:"rg",errorMessage:yS.NO_MATCHES};let r=await e.exec(...function({replacement:e,query:t,isRegex:n,isCaseSensitive:i,isMatchingWholeWords:r}){let a=["sd"],s=[t.indexOf("\n")>=0?"m":"e",i?"c":"i"];return r&&s.push("w"),a.push("--flags",s.join("")),n||a.push("--string-mode"),t.startsWith("-")&&(t="\\"+t),a.push(t,e),a}(n),...i);return r.error?{success:!1,errorOn:"sd",errorMessage:r.error}:{success:!0}}e.i(694906);var yT=e.i(55449),yE=e.i(406393),yI=e.i(606296);let yP="SearchQueryControlsNav",yA="SearchQueryExcludeNav",yR="SearchQueryControlsColumnNav",yD=(0,l7.keyframes)({from:{transform:"scaleX(0)"},to:{transform:"scaleX(0.9)"}}),yV=au.container.min(360),y_=(0,ie.cssRecord)({self:[au.rcss.height("100%"),au.rcss.width("100%"),au.rcss.overflow("hidden"),au.rcss.px(4),au.rcss.container()],filesIncludeExcludeWrapper:[au.rcss.mt(6),au.rcss.border({direction:"top",color:A.tokens.outlineDimmest}),{[yV]:[au.rcss.rowWithGap(6),au.rcss.align.start,au.rcss.mt(0),{border:"none"}]}],inputWithLabel:[au.rcss.flex.growAndShrink(1),au.rcss.colWithGap(1)],inputLabelText:[{userSelect:"none"},au.rcss.color.foregroundDimmest,au.rcss.truncate,{fontSize:A.tokens.fontSizeSmall}],inputLabel:[au.rcss.flex.shrink(1),au.rcss.m(0),{lineHeight:1}],input:[au.rcss.viewStyle,au.rcss.border(),{blockSize:A.tokens.space32,"::placeholder":{color:A.tokens.foregroundDimmest},"&:hover::placeholder":{color:A.tokens.foregroundDimmer},"&:focus::placeholder, &:hover:focus::placeholder":{color:A.tokens.foregroundDimmest},":not([disabled])":{cursor:"text",":focus":{boxShadow:"none"}}}],optionsWrapper:[au.rcss.rowWithGap(2),au.rcss.align.center,{order:2,[yV]:[{order:1," > *":au.rcss.height("100%")}]}],closeWrapper:[{order:1,[yV]:{order:2," > *":au.rcss.height("100%")}}],results:[au.rcss.position.relative,{flex:"1 1 auto"}],searchWrapper:[{flex:"0 1 auto"}],expandCollapseButton:[au.rcss.height(32)],searchInputAndOptionsWrapper:{flex:1,display:"grid",gap:4,gridTemplateColumns:"1fr max-content",[yV]:{gridTemplateColumns:"1fr max-content max-content"}},replacementWrapper:[au.rcss.ml(24),au.rcss.pl(4),au.rcss.pb(6)],replaceInputWrapper:[au.rcss.border({direction:"top",color:A.tokens.outlineDimmest}),{[yV]:[au.rcss.rowWithGap(4),au.rcss.pt(0),au.rcss.align.center,{border:"none"}]}],loadingBar:[au.rcss.position.absolute,au.rcss.mt(2),au.rcss.height(1),au.rcss.borderRadius(2),au.rcss.width("100%"),au.rcss.backgroundColor.accentPrimaryDimmer,{animation:`${yD} 20s 1s ease forwards`,transformOrigin:"center left",transform:"scaleX(0)"}]});function yM({updateData:e,query:t,setQuery:n,isRegex:i,setIsRegex:r,isCaseSensitive:a,setIsCaseSensitive:s,isMatchingWholeWords:o,setIsMatchingWholeWords:l,isCollapsed:u,setIsCollapsed:d,executeSearch:c,searchInputRef:p,onCloseRequested:h}){return(0,x.jsxs)(V.View,{css:y_.searchWrapper,pb:4,row:!0,gap:4,children:[(0,x.jsx)(uX.IconButton,{onClick:()=>d(e=>!e),alt:u?"Show replacement options":"Hide replacement options",css:y_.expandCollapseButton,children:u?(0,x.jsx)(pJ.default,{}):(0,x.jsx)(g2.default,{})}),(0,x.jsxs)(V.View,{css:y_.searchInputAndOptionsWrapper,children:[(0,x.jsx)(xH,{"data-nav":`${yo} ${yP}`,ref:p,autoSize:!0,placeholder:"Search",value:t,css:y_.input,onChange:t=>{n(t),e({initialQuery:t})},onClear:()=>{n(""),e({initialQuery:""})},onKeyDown:e=>{"Enter"!==e.key||(0,l4.getCmdOrCtrl)(e)||e.shiftKey||(e.preventDefault(),e.stopPropagation(),c())}}),(0,x.jsxs)(V.View,{css:y_.optionsWrapper,children:[(0,x.jsx)(xq.default,{alt:"case sensitive","data-nav":`${yP} ${yR}`,icon:(0,x.jsx)(xV.default,{}),checked:a,onClick:()=>s(e=>!e)}),(0,x.jsx)(xq.default,{alt:"regular expressions","data-nav":`${yP} ${yR}`,icon:(0,x.jsx)(x_.default,{}),checked:i,onClick:()=>r(e=>!e)}),(0,x.jsx)(xq.default,{alt:"whole words","data-nav":`${yP} ${yR}`,icon:(0,x.jsx)(xM.default,{}),checked:o,onClick:()=>l(e=>!e)})]}),(0,x.jsx)(V.View,{css:y_.closeWrapper,row:!0,gap:2,align:"center",children:h?(0,x.jsx)(uX.IconButton,{onClick:h,alt:"Close",children:(0,x.jsx)(ui.default,{})}):null})]})]})}function yF({updateData:e,replacement:t,setReplacement:n,query:i,replaceLoading:r,search:a,includeGlob:s,setIncludeGlob:o,excludeGlob:l,setExcludeGlob:u,replace:d,results:c}){return(0,x.jsxs)(V.View,{css:y_.replacementWrapper,children:[(0,x.jsxs)(V.View,{css:y_.replaceInputWrapper,pt:8,gap:6,children:[(0,x.jsx)(xH,{"data-nav":`${yo} ${yP} ${yA}`,autoSize:!0,placeholder:"Replacement",value:t,css:y_.input,onChange:t=>{n(t),e({initialReplacement:t})},onClear:()=>{n(""),e({initialReplacement:""})}}),(0,x.jsx)(V.View,{css:y_.optionsWrapper,children:(0,x.jsx)(x$,{query:i,replacement:t,results:c,disabled:0===i.length,loading:r,replace:d,onReplace:a,buttonProps:{"data-nav":`${yP} ${yl} ${yR}`}})})]}),(0,x.jsxs)(V.View,{css:y_.filesIncludeExcludeWrapper,pt:8,gap:8,children:[(0,x.jsxs)(V.View,{css:y_.inputWithLabel,id:"filesToInclude",children:[(0,x.jsx)("label",{htmlFor:"filesToIncludeInput",css:y_.inputLabel,children:(0,x.jsx)(st.Text,{css:y_.inputLabelText,color:"dimmer",multiline:!1,children:"Files to include"})}),(0,x.jsx)(xH,{id:"filesToIncludeInput","data-nav":`${yo} ${yP}`,autoSize:!0,value:s,css:y_.input,placeholder:"e.g. **.js, src/**, app/",onChange:t=>{o(t),e({initialIncludeGlob:t})},onClear:()=>{o(""),e({initialIncludeGlob:""})}})]}),(0,x.jsxs)(V.View,{css:y_.inputWithLabel,id:"filesToExclude",children:[(0,x.jsx)("label",{htmlFor:"filesToExcludeInput",css:y_.inputLabel,children:(0,x.jsx)(st.Text,{css:y_.inputLabelText,color:"dimmer",multiline:!1,children:"Files to exclude"})}),(0,x.jsx)(xH,{id:"filesToExcludeInput","data-nav":`${yP} ${yA}`,autoSize:!0,value:l,css:y_.input,onChange:t=>{u(t),e({initialExcludeGlob:t})},onClear:()=>{u(""),e({initialExcludeGlob:""})}})]})]})]})}function yO({isActive:e,initialQuery:t="",initialReplacement:n="",initialIncludeGlob:i="",initialExcludeGlob:r="",searchInputRef:a,onDataChanged:s,onFileLineClicked:o,onOpenSearchPane:l,onCloseRequested:u,searchResultBackgroundColor:d}){let[c,p]=(0,v.useState)(t),[h,m]=(0,v.useState)(n),[f,g]=(0,v.useState)(!1),[y,w]=(0,v.useState)(!1),[b,j]=(0,v.useState)(!1),[S,k]=(0,v.useState)(!0),[C,T]=(0,v.useState)(r),[E,I]=(0,v.useState)(i),P=yj(C),A=yj(E),R=(0,v.useRef)(null),{loading:D,error:_,data:M,search:F}=function({query:e,isRegex:t,isCaseSensitive:n,isMatchingWholeWords:i,includeGlobs:r=[],excludeGlobs:a=[]}){let{container:s,dotReplit:o}=(0,sg.default)(),l=(0,yE.useHiddenFilesGlobPatterns)(o),u=(0,H.useFlag)({controlName:"flag-code-search-latency-metrics",logFlagToAnalytics:!1}),[d,c]=(0,v.useState)([]),[p,h]=(0,v.useState)(null),[m,f]=(0,v.useState)(e.length>0),g=(0,q.default)(()=>[...a,...l||[],...yT.ignoredDirs],[a,l]),x=s.getConnectionState(),y=(0,v.useMemo)(()=>(0,yI.default)({container:s,onError:e=>h(e),onUpdate:e=>c(e),onLoadingStateChange:e=>f(e),isStreaming:!0,trackLatency:u}),[]);return(0,v.useEffect)(()=>{x===sp.ConnectionState.CONNECTED&&y({query:e,isRegex:t,isCaseSensitive:n,isMatchingWholeWords:i,includeGlobs:r,excludeGlobs:g})},[x,y,e,t,n,i,r,g,l]),{loading:m,error:p,data:d,search:()=>y({query:e,isRegex:t,isCaseSensitive:n,isMatchingWholeWords:i,includeGlobs:r,excludeGlobs:g})}}({query:c,isRegex:f,isCaseSensitive:y,isMatchingWholeWords:b,excludeGlobs:P,includeGlobs:A});(0,p4.default)(()=>{""!==c&&(0,ei.track)(er.events.SEARCH_PANE_USED,{action:"search",isRegex:f,isCaseSensitive:y,hasIncludes:A.length>0,hasExcludes:P.length>0})},[c,A,P,f,y],1e3);let{loading:O,replace:L}=function({query:e,replacement:t,fileList:n,...i}){let{container:r}=(0,sg.default)(),[a,s]=(0,v.useState)(!1),[o,l]=(0,v.useState)(null),[u,d]=(0,v.useState)(!1);return{replace:(0,v.useCallback)(async()=>{d(!0),l(null);let a=await yC({container:r,query:e,replacement:t,fileList:n?.map(e=>e.path),...i});return a.success||l(a.errorMessage),d(!1),s(a.success),a},[r,e,t,n,i]),loading:u,error:o,data:a}}({replacement:h,query:c,isRegex:f,isCaseSensitive:y,isMatchingWholeWords:b,excludeGlobs:P,includeGlobs:A,fileList:_?void 0:M}),B=(0,v.useCallback)((e={})=>{s?.({initialQuery:c,initialReplacement:h,initialIncludeGlob:E,initialExcludeGlob:C},e)},[s,c,h,C,E]);(0,v.useLayoutEffect)(()=>{p(t),m(n),I(i),T(r)},[t,n,i,r]);let U=xO({selector:`[data-nav*="${yo}"]`,isValid:e=>{let t="ArrowUp"===e.key||"ArrowDown"===e.key,n=e.target.matches(`[data-nav*="${yo}"]`),i=e.target.matches(`[data-nav*=${ys}]`);return t&&n&&(e.altKey||i)},move:({event:e,activeIndex:t})=>(e.preventDefault(),e.stopPropagation(),"ArrowUp"===e.key?t-1:t+1)}),N=xO({selector:`[data-nav*="${yl}"]`,isValid:e=>{let t="ArrowUp"===e.key||"ArrowDown"===e.key,n=e.target.matches(`[data-nav*="${yl}"]`),i=e.target.matches(`[data-nav*=${ys}]`);return t&&n&&!i},move:({event:e,activeIndex:t})=>(e.preventDefault(),e.stopPropagation(),"ArrowUp"===e.key?t-1:t+1)}),G=xO({selector:`[data-nav*="${yR}"]`,isValid:e=>{let t="ArrowUp"===e.key||"ArrowDown"===e.key;if(e.target.matches(`[data-nav*="${yl}"]`)&&"ArrowDown"===e.key)return!1;let n=e.target.matches(`[data-nav*="${yR}"]`);return t&&n},move:({event:e,activeIndex:t,children:n})=>{let i=e.target.matches(`[data-nav*="${yl}"]`);return(e.preventDefault(),e.stopPropagation(),i)?0:0===t&&"ArrowUp"===e.key?-1:n.length-1}}),$=xO({selector:`[data-nav*="${yA}"]`,isValid:e=>{let t="ArrowUp"===e.key||"ArrowDown"===e.key,n=e.target.matches(`[data-nav*="${yA}"]`),i=e.target.matches(`[data-nav*=${yo}]`);return t&&e.altKey&&n&&!i},move:({event:e,activeIndex:t})=>(e.preventDefault(),e.stopPropagation(),"ArrowUp"===e.key?t-1:t+1)}),z=xO({selector:`[data-nav*="${yP}"]`,isValid:e=>{let t="ArrowLeft"===e.key||"ArrowRight"===e.key,n=e.target.matches(`[data-nav*="${yR}"]`);return t&&(e.altKey||n)},move:({event:e,activeIndex:t})=>(e.preventDefault(),e.stopPropagation(),"ArrowLeft"===e.key?t-1:t+1)}),W=(0,sm.useMergeRefs)([U,N,G,$,z],{breadcrumb:"client/workspace/components/SearchReplace/index.tsx:661"}),K=(0,v.useCallback)(e=>{"Escape"===e.key&&u?.()},[u]);return(0,x.jsxs)(V.View,{css:y_.self,innerRef:W,onKeyDown:K,children:[(0,x.jsx)(yM,{isActive:e,query:c,setQuery:p,updateData:B,isRegex:f,isCaseSensitive:y,isMatchingWholeWords:b,setIsRegex:g,setIsCaseSensitive:w,setIsMatchingWholeWords:j,isCollapsed:S,setIsCollapsed:k,executeSearch:F,searchInputRef:a,onCloseRequested:u}),S?null:(0,x.jsx)(yF,{replacement:h,setReplacement:m,updateData:B,query:c,replaceLoading:O,search:F,includeGlob:E,setIncludeGlob:I,excludeGlob:C,setExcludeGlob:T,replace:L,results:M}),(0,x.jsxs)(V.View,{css:y_.results,children:[D?(0,x.jsx)(V.View,{css:y_.loadingBar},c):null,0===c.length&&0===M.length?(0,x.jsx)(xL.default,{pane:{type:"searchReplace"},bodyText:"Enter a search query above to see results."}):(0,x.jsx)(yw,{isRegex:f,query:c,replacement:h,include:E,exclude:C,results:M,error:_,paneRef:R,onOpenSearchPane:l,onFileLineClicked:o,searchResultBackgroundColor:d})]})]})}let yL=em.Type.Object({type:em.Type.Literal("searchReplace"),data:em.Type.Optional(em.Type.Object({initialQuery:em.Type.Optional(em.Type.String()),initialReplacement:em.Type.Optional(em.Type.String()),initialIncludeGlob:em.Type.Optional(em.Type.String()),initialExcludeGlob:em.Type.Optional(em.Type.String())}))}),yB={Content:({pane:e,options:t})=>(0,x.jsx)(yN,{paneData:e?.data||{},isActive:t.isActive,performPaneOperation:t.performPaneOperation}),Icon:({size:e})=>(0,x.jsx)(oH.default,{size:e}),getTitle:e=>{let t=e?.data?.initialQuery;return t&&t.length>0?`Code Search: ${t}`:"Code Search"},description:"Search through the text contents of your App",category:fj.PaneCategory.WorkspaceFeatures,decode:e=>s2.Value.Decode(yL,e)},yU=(0,ie.cssRecord)({wrapper:[au.rcss.height("100%"),au.rcss.width("100%")]});function yN({paneData:e,isActive:t,performPaneOperation:n}){let i=(0,v.useRef)(null),r=(0,v.useCallback)(()=>{i.current?.select(),i.current?.focus()},[]);(0,aO.useSetPaneBindings)(()=>({type:"searchReplace",focusSearchInput:r}),[r]),(0,aO.useSetFocusTarget)(()=>({focus:r}),[r]);let a=(0,v.useCallback)(({path:e,lineNumber:t,columnNumber:i})=>{n({operation:"open",pane:{type:"codeEditor",data:{path:e,line:t,col:i}},secondary:!0})},[n]),s=(0,v.useCallback)(()=>{n({operation:"commit"}),n({operation:"open",pane:{type:"searchReplace"}})},[n]),o=(0,v.useCallback)((e,t)=>{n({operation:"replace",pane:{type:"searchReplace",data:{...e,...t}}})},[n]);return(0,x.jsx)(V.View,{css:yU.wrapper,pt:6,children:(0,x.jsx)(yO,{...e,isActive:t,searchInputRef:i,onFileLineClicked:a,onOpenSearchPane:s,onDataChanged:o,searchResultBackgroundColor:A.tokens.backgroundDefault})})}var yG=e.i(446692),y$=e.i(180703),yz=e.i(917375),yW=e.i(411928),yH=e.i(952685),yq=e.i(49416),yK=e.i(91442);let yY=["workspace-guided-tour-data-app","workspace-guided-tour-portfolio-website","100-days-of-python","100-days-of-python-promo","add-guest-new-user","agent-banner","agent-disclaimer","ai-image-generation-banner","apps-announcement","appsOnboardingForkRepl","appsOnboardingRunRepl","appsOnboardingSelectRepl","april_2019_hiring","archive-cta","assignment_markdown","boosts-modal","changelog-banner","classroom-repl-talk-ask-on-error","cleanup-popover-dismissed","codemirror-explorers-banner","create-model-solution","credit-packs-banner","credit-packs-promo-dec-2025","createWebsite","curriculum-launch-modal","custom-themes-banner","custom-domain-purchase-announcement","dashboard_new_folder","dashboard_search","dashboard_templates","debugger_start","dec172020maintenance","deployment-analytics-dot","deployments-banner","deployments-mobile-download","deployments-synced-secrets","desktop-app-banner","desktop-app-nav-menu","devtools-intro","discount_hacker_18","discount_holiday_19","discount_newyear_19","downtime-073118","draw-new-user-cta","edfest-announcement","enveditorintro","expo-qr-preview-pane","expo-go-mobile-preview-nudge","file_tree","flexible-spend-announcement","follow-cursor-avatar-click","ghostwriter-banner","ghostwriter-chat-banner","ghostwriter-repl-resources-cta","ghostwriter-trial-repl-resources-cta","ghostwriter-trial-3-day-left-modal","ghostwriter-trial-banner","ghostwriter-trial-expired-modal","ghostwriter-post-purchase-tour","ghostwriter-existing-user-chat-beta-tour","grid_click","hacker_upgrade","hacker-gift","header-layout-tooltip","home","home-feed","home-onboarding-checklist","home-onboarding-checklist-apps","home-onboarding-checklist-learn","home-onboarding-checklist-repl","home-page-modules-tooltip","home-page-demo-repl-tour-suggestion","hosting_url","introduceYourself","js-4-day-challenge-day-1","js-4-day-challenge-day-2","js-4-day-challenge-day-3","js-4-day-challenge-day-4","js-4-day-challenge-day-end","july_2019_music_jam","july18_irl","landing","languagesInterestedIn","launch-modal","learn-onboarding","make_website","march_2019_game_jam","migrate-to-deployments-banner","migrated_unnamed_repls","mobile-app-banner","mobile-app-banner-web-update","mobile-announcement","mobile-new-workspace-banner","mobile-survey-banner-11042021","move_unnamed_repls","repricing-announcement","multiplayer","multiplayer_invite","multiplayer_welcome","new_in_repls","new_share","nft-world-2022","onboarding_connection_toast","onboarding_run","onboarding-simplify-experiment","onboarding-upsell-seen","packager-shell-hint","packman","prettier-formatter","product_hunt","profile-refresh-beta","profile2","projects-overview-cta","projects-overview-tests-disclaimer","publish-guidelines","repl_stars","repl-con-2022","repl-talk-update-2021","repl-talk-update-2022","replit-teams-onboarding-tour","resources-upgrade-modal","revisions_history","run_on_replit","saw_unnamed_folders","search","self-grouping-projects-cta","series-b-announcement","share_classroom","share_repl_to_talk","show_packager_about_tooltip","show_packager_import_tooltip","show_test_update_tooltip","stack-create-cta","stack-migration-cta","summer_hacker","summer-2021-pd-survey","teams_pro_module","teams-grading-survey","teams-pro-2022","template-jam-announcement","threads-2-announcement","upgrade_module","usage-migration-reserved-vms","usage-migration-power-ups-free-user","usage-migration-power-ups-core-user","workspace-always-on-user-reserved-deployments-announcement","workspace-assistant-auto-apply-changes","workspace-assistant-auto-restart-repl","workspace-assistant-intro-video","workspace-deployments-webview-banner","workspace-desktop-tour","workspace-desktop-tour19","workspace-experience-task-completion-survey-06022022","workspace-experience-task-completion-survey-nudge-06022022","workspace-guided-tour-data-app","workspace-guided-tour-portfolio-website","workspace-history-announcement","workspace-ssh-connect-to-vscode-config-tour","workspace-tools-databases-postgres-tour","workspace-repo-projects-tour","youtube-in-the-ws","themes-announcement","extensions-onboarding-checklist","extensions-onboarding-checklist-create","extensions-onboarding-checklist-concepts","extensions-onboarding-checklist-api","extensions-onboarding-checklist-publish","extensions-store-info","external-claim-privacy-warning","gcp-docs-landing-screen","trending-home-module","following-home-module","storage-announcement","pro-onboarding-tour","pro-trial-expired","pro-trial-hcaptcha-fail","pro-trial-enrollment","ai-code-completion","replit-ai-chat-onbording-10-2023","workspace-desktop-new-user-tour","workspace-desktop-tour-2024","workspace-desktop-tour-2025","workspace-bonsai-tour-2025","workspace-desktop-sidebar-tour","replit-core-banner","hosting-deployments-announcement-7-2023","teams-for-education-deprecation-12-2023","teams-for-education-verification-prompt","usage-based-billing-announcement-1-2024","port-nudges","mobileApp-themes-announcement","mobileApp-server-change-CTA","mobileApp-purchase-subscription-announcement","mobileApp-onboarding-education-announcement","mobileApp-teams-coming-soon-announcement","incident-20240219-action-required-banner","incident-20250711-refund-banner","scheduled-deployments-banner","quick-start-guides","teams-projects-onboarding-card","onboarding-purchase-seen","replit-teams-banner","integrations-toast","starter-changes-announcement-aug-2024","private-deployments-banner","editors-have-secret-access-warning","workspace-right-sidebar-cta","assistant-now-defaulting-to-claude-3-5","org-roles-and-permissions-info-banner","onboarding-seen","teams-sponsorships-onboarding-card","agent-billing-notification-usage-page","agent-billing-notification-creation-entrypoint","agent-billing-creation-disclaimer","agent-billing-workspace-disclaimer","agent-billing-threshold-reached-warning","agent-billing-workspace-flex-credits-almost-reached","agent-billing-announcement","agent-billing-announcement-banner","drizzle-studio-announcement","freemium-agent-access-announcement","referral-program-banner","referral-pending-banner","post-verification-educational-upsell","invoice-threshold-change-announcement","agent-v2-welcome-modal","agent-v2-homepage-modal","agent-mobile-notification-nudge","visual-editor-callout","deterministic-edits-callout","image-gen-awareness-callout","bonsai-ws-agent-onboarding","queue-drawer-callout","viewer-seats-announcement","apps-private-by-default-announcement","agent-billing-v2-announcement","agent-billing-v2-home-banner","agent-chat-mode-intro-callout","effort-based-pricing-announcement","dynamic-intelligence-modal","expert-mode-acknowledged","agent-3-announcement-banner","workspace-deployment-pane-production-database-banner","workspace-database-pane-toggle-tour","max-autonomy-warning-acknowledged","design-mode-announcement-banner","design-mode-limitations-warning","free-fast-mode-announcement-banner","connectors-announcement-banner","agent-quick-edit-chat-footer-banner","agent-quick-edit-settings-banner","agent-chat-upsell-with-free-quick-edits-option","promo-high-power-model-announcement-tour","fast-promo-ended-tour","agent-high-power-model-toggle-info","agent-home-chat-mode-tour","agent-starter-fast-mode-enabled-banner","expo-launch-jan-2026-announcement-banner","inbox-onboarding-tour","publish-feedback-tour"],yX=({challenge:e})=>{let t=yY.find(t=>t.toString()===e.tourName)||"js-4-day-challenge-day-1",{isDone:n,isLoading:i,setAsDone:r}=(0,hh.useDismissibleElement)(t),a=(0,y.useRouter)();return i?null:(0,x.jsx)(se.Button,{colorway:n?"primary":"positive",onClick:()=>{r(),(0,ei.track)(er.events.TUTORIAL_DONE_BUTTON_COMPLETED),a.push("/~")},disabled:n,iconLeft:(0,x.jsx)(p5.default,{}),size:"big",text:n?"Challenge completed!":"Complete Challenge"})};var yQ=((f=yQ||{}).Ready="READY",f.Loading="LOADING",f.Error="ERROR",f);let yZ=({progress:e})=>(0,x.jsx)(dQ.Tooltip,{tooltip:`Progress: ${Math.round(100*e*10)/10}%`,children:(0,x.jsx)(V.View,{css:[au.rcss.width("100%"),au.rcss.height(4),au.rcss.backgroundColor.backgroundHigher],children:(0,x.jsx)(V.View,{css:[au.rcss.width(`${100*e}%`),au.rcss.height("100%"),au.rcss.backgroundColor.purpleDefault]})})}),yJ=em.Type.Object({type:em.Type.Literal("tutorial")}),y0={Content:function(){let e,t,n,{fs:i}=(0,sg.default)(),r=(e=n3(rH),t=n3(rK),n=n9(rX),t||!e?null:n),a=(0,px.useSetTourStepTarget)(yz.newUserTour.id,yz.TourStepIds.Sidepane),[s,o]=(0,v.useState)([]),[l,u]=(0,v.useState)("LOADING"),d=(0,a9.default)(),[c,p]=(0,y$.default)(`tutorialProgress--${d}`,0),[h,m]=(0,v.useState)(!1),f=(0,v.useRef)(null),g=(0,a6.useCurrentUserId)(),y=g?g.toString():"",w=(0,yK.useGetCursorState)(),b=(0,yK.useCursorFilepath)(),j=(0,yH.default)(b),S=(0,q.default)(()=>j?e=>j({code:e,insertAt:w()?.position.offset??"end"}):void 0,[j,w]),k=((e,t)=>{var n;let i=JSON.parse(t2.default.get(`${e}-tutorialChallenge-${t}`,"string")||"{}");if("string"==typeof i.tourName&&"string"==typeof i.url&&(n=i.tourName,yY.includes(n)))return i})(y,d),C=k?(0,x.jsx)(yX,{challenge:k}):null,T=(0,v.useCallback)(()=>{f.current&&(f.current.scrollTop=0)},[f]);return((0,v.useEffect)(()=>{let e=!1;return(async()=>{u("LOADING");let t=await i.readDir(yq.TUTORIAL_DIR);if(e)return;if(t.error)return u("ERROR");let n=[],r=await Promise.all(t.children.filter(e=>e.type===n_.FileType.File&&yG.FileTypeRepository.from(e.filename)?.id==="markdown").map(e=>{let t=`${yq.TUTORIAL_DIR}/${e.filename}`;return Promise.all([t,i.readFile(t)])}));if(!e){for(let[e,t]of r)if(t.error)u("ERROR");else{let i=t.content.toString(),r=/^#\s(?<title>.*)/.exec(i);n.push({title:r?.groups?.title,content:i,path:e})}o(n),u("READY")}})(),()=>{e=!0}},[i]),(0,v.useEffect)(()=>{s[c]||p(0)},[c,p,s]),"LOADING"===l)?(0,x.jsx)(V.View,{css:[au.rcss.center],grow:!0,shrink:!0,children:(0,x.jsx)(dh.default,{})}):"ERROR"===l?(0,x.jsx)(V.View,{css:[au.rcss.center],grow:!0,shrink:!0,children:(0,x.jsxs)(V.View,{css:[au.rcss.center,au.rcss.colWithGap(4)],children:[(0,x.jsx)(ui.default,{color:A.tokens.accentNegativeDefault}),(0,x.jsx)(st.Text,{color:"dimmer",multiline:!1,children:"Failed to load tutorial"})]})}):0===s.length?(0,x.jsx)(V.View,{css:[au.rcss.center],grow:!0,shrink:!0,children:(0,x.jsxs)(V.View,{css:[au.rcss.center,au.rcss.colWithGap(4)],children:[(0,x.jsx)(ui.default,{color:A.tokens.accentNegativeDefault}),(0,x.jsx)(st.Text,{color:"dimmer",multiline:!1,children:"No tutorials found!"})]})}):h?(0,x.jsxs)(V.View,{css:[au.rcss.overflowY("scroll"),au.rcss.flex.growAndShrink(1),au.rcss.p(8),au.rcss.colWithGap(16)],children:[(0,x.jsx)(st.Text,{variant:"headerDefault",multiline:!1,children:"Table of Contents"}),(0,x.jsx)(V.View,{grow:!0,shrink:!0,gap:8,children:s.map((e,t)=>(0,x.jsxs)(V.View,{css:[c===t?au.rcss.backgroundColor.backgroundHighest:au.rcss.backgroundColor.backgroundHigher,au.rcss.borderRadius(4),au.rcss.rowWithGap(8),au.rcss.align.center,au.rcss.cursor.pointer,c===t?{outline:`solid 2px ${A.tokens.outlineDimmest}`}:{},{":hover":{outline:`solid 2px ${A.tokens.outlineDimmest}`}}],p:8,onClick:()=>{p(t),m(!1)},children:[(0,x.jsx)(V.View,{css:[au.rcss.backgroundColor.backgroundHighest,au.rcss.width(20),au.rcss.height(20),au.rcss.borderRadius("full"),au.rcss.center,{outline:`solid 1px ${A.tokens.outlineDimmest}`}],children:(0,x.jsx)(st.Text,{variant:"small",color:"dimmest",multiline:!1,children:t+1})}),(0,x.jsx)(st.Text,{css:[au.rcss.maxWidth("80%")],multiline:!1,children:e.title})]},e.title))})]}):(0,x.jsx)(V.View,{innerRef:a,css:[au.rcss.height("100%")],children:(0,x.jsxs)(V.View,{dataCy:"tutorial-viewer-content",innerRef:f,css:[au.rcss.overflowY("scroll"),au.rcss.flex.growAndShrink(1),au.rcss.p(16),au.rcss.pb(48),au.rcss.colWithGap(16)],children:[r?(0,x.jsx)(se.Button,{text:"Show tutorial video",iconLeft:(0,x.jsx)(oA.default,{}),onClick:()=>r()}):null,C,s.length>1&&(0,x.jsx)(se.Button,{text:"Table of Contents",iconLeft:(0,x.jsx)(xr.default,{}),onClick:()=>m(!0)}),(0,x.jsx)(yW.default,{fs:i,path:s[c].path,source:s[c].content,sourcePos:!1,onCodeInsert:S}),s.length>1&&(0,x.jsxs)(V.View,{css:[au.rcss.position.absolute,au.rcss.width("100%"),au.rcss.left(0),au.rcss.bottom(0),au.rcss.overflow("hidden")],children:[(0,x.jsx)(yZ,{progress:(c+1)/s.length}),(0,x.jsxs)(V.View,{css:[au.rcss.width("100%"),au.rcss.height(40),au.rcss.align.center,au.rcss.flex.row],children:[(0,x.jsx)(V.View,{tag:"button",css:[au.rcss.backgroundColor.backgroundHigher,au.rcss.cursor.pointer,au.rcss.width(40),au.rcss.height("100%")],p:8,justify:"center",onClick:()=>{c>0&&(p(e=>e-1),T())},children:c>0&&(0,x.jsx)(gs.default,{size:24})}),(0,x.jsx)(V.View,{tag:"button",css:[au.rcss.height("100%"),au.rcss.justify.spaceBetween,au.rcss.backgroundColor.backgroundHighest,au.rcss.align.center,au.rcss.p(8),au.rcss.cursor.pointer,{userSelect:"none"}],grow:!0,shrink:!0,row:!0,gap:8,onClick:()=>{c<s.length-1&&(p(e=>e+1),T())},children:c<s.length-1&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)(st.Text,{multiline:!1,css:[au.rcss.flex.growAndShrink(1),au.rcss.textAlign.left,au.rcss.fontSize(A.tokens.fontSizeSubheadDefault)],children:[(0,x.jsxs)("span",{css:[au.rcss.color.foregroundDimmer],children:["Next",s[c+1].title?": ":" page"]}),(0,x.jsx)("b",{children:s[c+1].title??""})]}),(0,x.jsx)(pJ.default,{size:24})]})})]})]})]})})},Icon:({size:e})=>(0,x.jsx)(f2.default,{size:e}),getTitle:()=>"Tutorial",category:fj.PaneCategory.Other,decode:e=>s2.Value.Decode(yJ,e)};var y1=e.i(155119),y2=e.i(524283),y5=e.i(561132),y4=e.i(137218),y8=e.i(134405),y3=e.i(378042),y6=e.i(157648),y9=e.i(401135),y7=e.i(813453),ve=e.i(942314),vt=e.i(827420),vn=e.i(548364),vi=e.i(236906),vr=e.i(759967),va=e.i(336563);let vs={Content:function({pane:{data:e},options:{performPaneOperation:t,paneId:n}}){let i=(0,v.useRef)(null),r=(0,vr.useIsExpertMode)(),{isAgentStackRepl:a}=(0,dB.useIsAgentStackRepl)(),{artifacts:s}=(0,vt.useArtifacts)(),o=(0,H.useFlag)({controlName:"flag-everything-everywhere",default:!1}),l=(0,lk.useWorkflowsTaskFlatMap)(),u=(0,pj.useIsExpoStack)(),d=(0,v.useMemo)(()=>(0,y2.getInitialPort)({data:e,tasks:l,isExpoStack:u}),[e,l,u]),c=(0,y9.useShowEmptyState)(d),{didConnectOnce:p,didDisconnect:h}=(0,dX.default)(),m=(0,v.useCallback)(e=>{t({operation:"open",secondary:!1,pane:e})},[t]),f=(0,v.useCallback)(()=>m({type:"developer",data:{tab:["networking"]}}),[m]),g=(0,v.useCallback)(()=>m({type:"deployments"}),[m]),y=e?.previewScreenSize,w=(0,v.useCallback)(n=>{t({operation:"replace",pane:{type:"webview",data:{...e??{},previewScreenSize:n}}})},[e,t]),b=!e?.expoPreviewGuide||e.expoPreviewGuide.shown,j=(0,v.useCallback)(n=>{t({operation:"replace",pane:{type:"webview",data:{...e??{},expoPreviewGuide:{shown:n}}}})},[e,t]),S=(0,v.useCallback)(n=>{let i="mobile"===n;t({operation:"replace",pane:{type:"webview",data:{...e??{},previewScreenSize:i?y6.DEFAULT_MOBILE_SCREEN_SIZE:void 0,expoPreviewGuide:{shown:i}}}})},[e,t]),[k]=(0,v.useState)(()=>e?.ports?.path),C=(0,v.useCallback)((n,i)=>{let r=n.split(/[?#]/)[0];(e?.ports?.type!=="external"||e?.ports?.port!==i||e?.ports?.path!==r)&&t({operation:"replace",pane:{type:"webview",data:{...e??{},ports:{type:"external",port:i,path:r}}}})},[e,t]),{getCommandGroups:T}=(0,vn.useDeploymentCommands)({openDeploymentsPane:g,includeSharing:!0});return((0,aO.useSetPaneBindings)(()=>{let e={type:"webview",refresh:()=>{i.current?.refresh()},navigate:(e,t)=>{i.current?.navigateTo(e,t)}},t=T();return t.length>0?{...e,commands:t}:e},[T]),a)?(0,x.jsx)(y7.WebviewDisabledForAgentStack,{openPane:m}):(r||a)&&!o?c||void 0===d?(0,x.jsx)(ve.default,{openNetworkingTool:f,didConnectOnce:p,didDisconnect:h}):(0,x.jsx)(y3.WebviewBrowser,{ref:i,initialPort:d,initialPath:k,openPane:m,previewScreenSize:y,setPreviewScreenSize:w,expoPreviewGuideShown:b,setExpoPreviewGuideShown:j,onArtifactChange:S,paneId:n,onUrlChange:C}):(0,x.jsx)(vo,{ref:i,initialPort:d,initialPath:k,openPane:m,previewScreenSize:y,setPreviewScreenSize:w,expoPreviewGuideShown:b,setExpoPreviewGuideShown:j,onArtifactChange:S,paneId:n,artifacts:s,onUrlChange:C})},Icon:({size:e})=>(0,x.jsx)(ai.IconContext.Provider,{value:{size:e},children:(0,x.jsx)(y1.default,{})}),getTitle:()=>"Preview",description:"Preview your App",category:fj.PaneCategory.WorkspaceFeatures,decode:vi.decode},vo=(0,v.forwardRef)(function({initialPort:e,initialPath:t,openPane:n,previewScreenSize:i,setPreviewScreenSize:r,expoPreviewGuideShown:a,setExpoPreviewGuideShown:s,onArtifactChange:o,paneId:l,artifacts:u,onUrlChange:d},c){let p=(0,y8.useAgentAwareWebviewState)(),h=(0,lk.useWorkflowsTaskFlatMap)(),m=(0,va.getForwardedPortsFromTasks)(h),f=(0,pj.useIsExpoStack)(),g=(0,H.useFlag)({controlName:"flag-free-plan",default:!1}),{shouldSeeFreemiumExperience:y}=(0,h9.useShouldSeeFreemiumExperience)(),{agentUsage:w,agentUsageV2:b,loading:j,error:S}=(0,pn.useGetAgentFreeUsage)(),k=b?b.isUnderQuota:w?.isUnderQuota,C=g&&!j&&!S&&y&&!1===k,T=p.state===y8.WebviewState.READY||p.state===y8.WebviewState.LAST_RESORT_READY,{isWebDesignMockup:E}=(0,cJ.useIsAgentWebDesignMockup)(),[I,P]=(0,v.useState)(!1),A=(0,fE.useIsAgentOptimisticallyWorking)(),R=I&&(E||C);if(!T)return(0,x.jsx)(y4.AgentAwareWebviewNonReadyStates,{webviewState:p,openPane:n,isFreemiumUserOutOfAgentCredits:C});let D=p.state===y8.WebviewState.READY?p.presentPort:p.externalPort,V=!0===f?(0,pj.filterPortsForExpo)(m):m,_=void 0!==D&&V.some(e=>e.externalPort===D)?D:e,M=p.state===y8.WebviewState.READY?p.presentRoute:t;if(void 0===_)return(0,x.jsx)(y4.AgentAwareWebviewNonReadyStates,{webviewState:{state:y8.WebviewState.APP_STARTING_AGENT_IDLE},openPane:n,isFreemiumUserOutOfAgentCredits:C});let F=()=>P(!1);return(0,x.jsxs)(x.Fragment,{children:[R&&A&&(0,x.jsx)(y5.AgentAwareWebviewPreviewSoonEmptyStateV2,{canDismiss:!0,onDismiss:F,isFreemiumUserOutOfAgentCredits:C}),R&&!A&&(0,x.jsx)(y5.AgentAwareWebviewRuntimeErrorCrashedEmptyState,{openPane:n,canDismiss:!0,onDismiss:F,isFreemiumUserOutOfAgentCredits:C}),(0,x.jsx)(y3.WebviewBrowser,{ref:c,initialPort:_,initialPath:M??t,openPane:n,previewScreenSize:i,setPreviewScreenSize:r,expoPreviewGuideShown:a,setExpoPreviewGuideShown:s,onArtifactChange:o,paneId:l,onUnhandledExceptionChange:P,artifacts:u,onUrlChange:d})]})});var vl=e.i(835109),vu=e.i(676702),vd=e.i(544880),vc=e.i(637972),vp=e.i(643041);let vh={},vm=w.gql`
    query NotificationModalCheckMultiplayers($replId: String!) {
  getRepl(id: $replId) {
    ... on Repl {
      id
      multiplayers {
        id
      }
    }
  }
}
    `,vf=w.gql`
    query BrowserNotifications($username: String!) {
  user: userByUsername(username: $username) {
    id
    image
  }
}
    `,vg=!1;async function vx(e){if(null===t1.apolloClient)return;let{data:t}=await t1.apolloClient.query({query:vf,variables:{username:e}});return t?.user?.image}function vy(){return"Notification"in window?"true"===t2.default.get(vb,"string")?"dismissed":window.Notification.permission:"denied"}async function vv(){try{window.Notification.requestPermission().then()}catch(e){return new Promise(e=>{window.Notification.requestPermission(t=>{e(t)})})}return window.Notification.requestPermission()}async function vw(){await vv(),vj(!1)}let vb="notifications/dismissedModal";function vj(e){t2.default.set(vb,String(e))}let vS={};async function vk({title:e,body:t,badge:n,icon:i,iconByUsername:r,tag:a,onClick:s,cacheDuration:o=0}){if(!document.hidden&&document.hasFocus()||"granted"!==vy())return;let l=Date.now();if(a in vS&&vS[a]+o>l)return;r&&(i=await vx(r));let u=new window.Notification(e,{body:t,badge:n||"/public/images/logo-grayscale.png",icon:i||"/public/images/icon-square.png",tag:a});setTimeout(()=>{u.close()},1e4),u.addEventListener("click",()=>{window.focus(),u.close()}),s&&u.addEventListener("click",s),vS[a]=l}function vC(e){try{new Audio(e).play().catch(()=>{})}catch{}}function vT({replId:e}){var t;let n,[i,r]=(0,v.useState)(!1),a=(0,px.useIsTouring)(),{data:s}=(t={variables:{replId:e}},n={...vh,...t},j.useQuery(vm,n)),o=s?.getRepl?.__typename==="Repl"&&s.getRepl.multiplayers.length>0;(0,v.useEffect)(()=>{a||!o||"default"===vy()&&r(!0)},[o,a]);let l=(0,v.useCallback)(()=>{vj(!0),r(!1)},[]),u=(0,v.useCallback)(async()=>{await vw(),r(!1)},[]);return i?(0,x.jsx)(aK.Modal,{preventClose:!0,isOpen:!0,onRequestClose:l,children:(0,x.jsxs)(V.View,{gap:24,children:[(0,x.jsx)(st.Header,{variant:"headerDefault",level:2,children:"Replit needs your permission to enable notifications."}),(0,x.jsx)(st.Text,{children:"Never miss messages from your collaborators if you're in another tab or window."}),(0,x.jsxs)(V.View,{row:!0,gap:12,justify:"end",children:[(0,x.jsx)(se.Button,{onClick:l,text:"Deny",iconLeft:(0,x.jsx)(ui.default,{})}),(0,x.jsx)(se.Button,{text:"Allow notifications",colorway:"positive",iconLeft:(0,x.jsx)(p5.default,{}),onClick:u})]})]})}):null}var vE=e.i(657929),vI=e.i(357210);let vP=(0,A.cvarsFrom)("ResizeHandle.module.css",["--width","--height","--transform-x","--transform-y","--rotation","--z-index","--cursor"]),vA=(0,v.memo)(function({handleId:e}){let t,n=function(e){let t,n,i,r,a,s,o,l,u,d=iM(e),c=iF(e),p=tA(c),h=tR(c),m=iO(e),f=(t=iM(e),(0,q.default)(()=>(0,ed.selectAtom)(t,({snapped:e})=>!!e),[t])),g=iL(e),x=(n=tA(iF(e)),i=iL(e),(0,q.default)(()=>(0,J.atom)(e=>{let{width:t,height:r}=e(n);return e(i)?t:r}),[n,i])),y=(r=iM(e),(0,q.default)(()=>(0,J.atom)(e=>{let{snapped:t,stacked:n}=e(r);return"right"===t?n?180:90:"left"===t?270*!n:0}),[r])),v=(a=iL(e),s=iO(e),o=tA(iF(e)),(0,q.default)(()=>(0,J.atom)(e=>{let{width:t,height:n}=e(o),i=e(s),r=e(a),l=e(td);return r?{width:i?t:24,height:l?6:2}:{height:i?n:24,width:l?6:2}}),[o,a,s])),w=(l=tA(iF(e)),u=iL(e),(0,q.default)(()=>(0,J.atom)(e=>{let{width:t,height:n}=e(l);return(e(u)?t:n)<24}),[l,u]));return{handle:n6(d),size:n6(p),position:n6(h),isActive:n6(m),isSnapped:n6(f),isStacked:n6(g),length:n6(x),rotation:n6(y),gripSize:n6(v),gripIsHidden:n6(w)}}(e),i=(t=(0,v.useRef)(null),(0,tZ.useStyleSet)(t,n.size,({width:e,height:t})=>({[vP.width]:e+"px",[vP.height]:t+"px"})),(0,tZ.useStyleSet)(t,n.position,({x:e,y:t})=>({[vP.transformX]:Math.round(e)+"px",[vP.transformY]:Math.round(t)+"px"})),(0,tZ.useStyleSet)(t,n.isStacked,e=>({[vP.cursor]:e?"row-resize":"col-resize"})),(0,tZ.useStyleSet)(t,n.isActive,e=>({[vP.zIndex]:(e?tN.gutterActive:tN.gutter).toString()})),t),r=n9(i_),a=function(e=0){let t=(0,v.useRef)(e),n=n9(nk),i=n7(tc);return(0,v.useCallback)(r=>{r.snapped?n({leftPath:r.leftPath,percent:t.current}):Promise.resolve(i()).then(i=>{let a=eP(i,r.leftPath);if(!a||!eI(a))throw Error("Expected split or paneGroup");t.current=a.percent,n({leftPath:r.leftPath,percent:e})})},[e,n,i])}(),s=(0,v.useRef)(null),o=(0,up.default)(n.isSnapped),l=(0,up.default)(n.isStacked);return(0,x.jsx)(V.View,{align:"center",justify:"center",innerRef:i,clsx:[vI.default.root,{[vI.default.stacked]:l}],onDoubleClick:()=>{a(n.handle.current)},onPointerDown:e=>{(0,mL.measureMouseMove)(e,{start(){let e=n.handle.current;s.current=document.activeElement,r({type:"start",leftPath:e.leftPath,stacked:e.stacked})},move({delta:e}){r({type:"update",moveDelta:e})},end(){r({type:"end"}),s.current?.focus?.()}})},onContextMenu:e=>{e.preventDefault(),e.stopPropagation()},children:o?(0,x.jsx)(vE.default,{className:"icon"}):(0,x.jsx)(V.View,{clsx:vI.default.grip})})});var vR=e.i(387948),vD=e.i(123111),vV=e.i(736451),v_=e.i(94366),vM=e.i(924748),vF=e.i(825606),vO=e.i(241939),vL=e.i(145864),vB=e.i(231346);let vU="video.json",vN=(0,fA.join)(yq.TUTORIAL_DIR,vU);async function vG(e,t){if(!t.find(e=>e.type===n_.FileType.File&&e.filename===vU))return null;let n=await e.readFile(vN);return n.error?null:n.content.toString()}e.i(792e3);var v$=e.i(8808),vz=e.i(374106),vW=e.i(986194),vH=e.i(19379),vq=e.i(584647),vK=e.i(943565);let vY="/public/sounds/Achievement_Bell_Replit.wav",vX={direction:"reverse",state:{isExecutingPlan:!1},reducer(e,t){if(e.sender.type!==dg.UserType.AI)return!1;let{contents:n}=e.contents;switch(n?.$kind){case"agentPlanEventContents":{let e=n.agentPlanEventContents;if(!e)break;if(!0===e.requiresApproval)return t.notification={id:e.planId,text:"Plan is waiting for approval"},t.isExecutingPlan=!0,!1;if(t.isExecutingPlan&&e.step.subSteps.every(e=>e.status===dg.AgentPlanStepStatus.STEP_COMPLETE))return t.notification={id:e.planId,text:"Plan has been completed!"},t.isExecutingPlan=!1,!1;break}case"agentAskUserForActionRequest":{let i=n.agentAskUserForActionRequest.request;if(i?.$kind==="userSecretsRequest")return t.notification={id:e.id,text:"Agent needs secrets to proceed"},!1;return t.notification={id:e.id,text:"Agent has an update for you"},!1}case"agentTimelineEventContents":{let{toolData:i,toolName:r}=n.agentTimelineEventContents;if(i?.$kind==="messageData"){let n=i.messageData.agentAction;switch(n.optionType?.$kind){case"messageButtonAction":return t.notification={id:e.id,text:"Agent has a question for you"},!1;case"secretRequestAction":return t.notification={id:e.id,text:"Agent needs secrets to proceed"},!1;case"deployRequestAction":return t.notification={id:e.id,text:"Agent needs your permission to publish the application"},!1}if("user_response"===r)return t.notification={id:e.id,text:"Agent has a question for you"},!1}}}t.notification=void 0}},vQ=w.gql`
    query ReplEnvironmentNotifyUserJoin($id: String!) {
  getRepl(id: $id) {
    ... on Repl {
      id
      title
    }
  }
}
    `;async function vZ(e){if(!t1.apolloClient)throw Error("Expected Apollo client");let{data:t}=await t1.apolloClient.query({query:vQ,variables:{id:e}});return t?.getRepl.__typename==="Repl"?t.getRepl.title:null}var vJ=e.i(389320),v0=e.i(803542);async function v1(e){await new Promise(t=>setTimeout(()=>t(),e))}let v2={},v5=w.gql`
    query TrackMultiplayer($replId: String!) {
  getRepl(id: $replId) {
    ... on Repl {
      id
      multiplayers {
        id
      }
      owner {
        ... on Team {
          id
        }
        ... on User {
          id
        }
      }
    }
  }
}
    `;function v4(){let e=aS(),t=(0,od.useIsExtensionRepl)(),n=n7(ty),i=n9(nA);return(0,v.useCallback)(r=>{let a=!!r&&r.reveal;if(t)return void e({pane:{type:"runnerOutput"},activate:!1,commit:!0});let s=n().find(([e,t])=>"runnerOutput"===t.type);s||e({pane:{type:"runnerOutput"},activate:!1,reveal:!1}),a&&s&&i({paneId:s[0],activate:!0})},[t,n,e,i])}function v8(e,t,n){let i=n3(tS),r=n9(nV),a=n9(nA),s=n7(ty);(0,a$.useCommandBinding)(()=>{if(i)return[e,()=>{let e=s().find(([,e])=>e.type===t.type);e?a({paneId:e[0],activate:!0}):r({...n,pane:t,activate:!0,placement:{type:"secondary"}})}]},[i,r,a])}var v3=e.i(391542),v6=e.i(984826),v9=e.i(563209),v7=e.i(708648),we=e.i(596378),wt=e.i(143480),wn=e.i(905890),wi=e.i(681850),wr=e.i(349467),wa=e.i(402434),ws=e.i(326333),wo=e.i(8812),wl=e.i(239296),wu=e.i(829960),wd=e.i(387524),wc=e.i(464458);let wp={},wh=w.gql`
    query WorkspaceShowHiddenFiles($replId: String!) {
  getRepl(id: $replId) {
    ... on Repl {
      id
      templateInfo {
        label
      }
    }
  }
}
    `;var wm=e.i(423111),wf=e.i(416406),wg=e.i(440560),wx=e.i(985430),wy=e.i(752310),wv=e.i(741740),ww=e.i(927938),wb=e.i(551544),wj=e.i(136780),wS=e.i(604026),wk=e.i(154488);function wC({repl:e,currentUser:t}){var n;let i,r,a,s,o,l,u,d,c,p,h,m,f,g,y,w,b,S,k,C,T,P,{replspaceApi:R,dotReplit:D,container:V,ports:_}=(0,sg.default)();!function(){let{lspnix:e}=(0,sg.default)(),{preferences:{codeIntelligence:t}}=(0,lc.usePreferences)("codeIntelligence"),n=(0,nC.useOpenFiles)().length>0;(0,v.useEffect)(function(){n&&t?e.enable():e.disable()},[e,t,n])}(),function(){let e,[t]=(0,m0.useBsod)(),n=(e=n9(nr),(0,q.default)(()=>(0,ec.default)(e,1e3),[e])),i=(0,px.useIsTouring)(),r=(0,a9.default)(),a=i||t;(0,v.useEffect)(()=>{if(!a)return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)};function e(){n({replId:r,force:!1}),n.flush()}},[n,r,a]),(0,v.useEffect)(()=>{if(!a)return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)};function e(){"hidden"===document.visibilityState&&n({replId:r,force:!1})}},[n,r,a]),(0,v.useEffect)(()=>{if(a)return;let e=null;return!function t(){e=setTimeout(()=>{n({replId:r,force:!1}),t()},6e4)}(),()=>{e&&clearTimeout(e)}},[n,r,a]),(0,v.useEffect)(()=>{if(!a)return()=>{n({replId:r,force:!1}),n.flush()}},[n,r,a])}(),(0,v_.default)(),(0,wv.default)(),(0,wb.default)({workspaceType:"desktop"}),(0,v.useEffect)(()=>{function e(e){"s"===e.key&&(0,l4.getCmdOrCtrl)(e)&&e.preventDefault()}return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[]),(0,wy.default)(),function(){let{container:e,presence:t}=(0,sg.default)();(0,v.useEffect)(()=>{let n=t.onUserJoin(t=>{let i=e.getContext()?.repl;if(!i)return;let{username:r}=t;return vZ(i.id).then(e=>{e&&vk({title:"",body:`${r} joined ${e}`,tag:`${i.id}-${r}-joined`,iconByUsername:r,cacheDuration:9e5})}),()=>{n()}})},[t,e])}(),function(){let{preferences:{agentAudioNotification:e}}=(0,lc.usePreferences)("agentAudioNotification"),t=(0,vH.usePageVisibility)(),n=(0,vK.useGetExperiment)("sound-on_v2")(),i=n?.get("treatmentName")??"control",r="control"!==i,a=function(e){let t=(0,a9.default)(),n=(0,Y.useIsInMobileWorkspace)(),{preferences:{agentAudioNotification:i}}=(0,lc.usePreferences)("agentAudioNotification");return(0,v.useEffect)(()=>{let e,t;!n&&i&&(e=["click","keydown","touchstart"],t=()=>{if(!vg)try{new Audio("data:audio/mpeg;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFTb25vdGhlcXVlLm9yZwBURU5DAAAAHQAAA1N3aXRjaCBQbHVzIMKpIE5DSCBTb2Z0d2FyZQBUSVQyAAAABgAAAzIyMzUAVFNTRQAAAA8AAANMYXZmNTcuODMuMTAwAAAAAAAAAAAAAAD/80DEAAAAA0gAAAAATEFNRTMuMTAwVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQsRbAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQMSkAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV").play().catch(()=>{}),vg=!0}catch(e){}e.forEach(e=>{document.removeEventListener(e,t)})},e.forEach(e=>{document.addEventListener(e,t,{once:!0,passive:!0})}))},[n,i]),(0,v.useCallback)((r,a)=>{i&&document.hidden&&!n&&vC(vY),e&&vk({title:"Replit",body:a,tag:`${t}-${r}`,icon:"/public/icons/icon-maskable-512x512.png",cacheDuration:3e5})},[i,t,n,e])}("soundAndNoti"===i),s=(0,Y.useIsInMobileWorkspace)(),o=(0,dx.useChatter)(),l=(0,lT.useObservable)(o.sessions.agent.current),u=(0,v.useMemo)(()=>l?.reduce(vX,1),[l]),d=l?.agent.state,c=(0,v.useMemo)(()=>d&&u?mg.Observable.combine(d,u):null,[d,u]),p=(0,v.useRef)(null),h=(0,v.useRef)(0);(0,mV.useObserver)(d,{next:n=>{if(!n)return;let i=n.state,o=p.current;if(r&&e&&!t&&o===dg.AgentRunState.AGENT_STATE_RUNNING&&i===dg.AgentRunState.AGENT_STATE_PAUSED&&!s){let e=Date.now();e-h.current>=15e3&&(vC(vY),a(`agent-paused-${e}`,"Replit Agent finished working. Come back to check your results."),h.current=e)}p.current=i}}),(0,mV.useObserver)(c,{next:([e,{notification:t}])=>{t&&e?.state===dg.AgentRunState.AGENT_STATE_PAUSED&&a(t.id,t.text)}});let m=(0,vq.useCurrentAgentTestingTakeover)({sessionId:l?.id??null});(0,v.useEffect)(()=>{m?.request.status==="pending"&&a(m.request.sessionId,"Agent needs your help with testing")},[m,a]),(0,dx.useChatHook)("received-completed-event",({event:n})=>{if(r&&e&&!t&&(0,vz.isEventContentsKind)(n,"agentPlanEventContents")&&!s){let{contents:e}=n.contents,t=(0,vW.unkind)(e);if(n.sender.type===dg.UserType.AI&&t.requiresApproval){let e=Date.now();e-h.current>=5e3&&(vC(vY),a(`agent-plan-ready-${e}`,"Your Replit Agent needs your approval to continue."),h.current=e)}}})}(),(0,wl.default)(),(0,ws.useLiveViewReplConnection)(),function(){let{presence:e}=(0,sg.default)();(0,v.useEffect)(()=>e.onFollowingUsersChanged(({followingUsers:e,type:t})=>{let n=e.length;"follow"===t?(0,ei.track)(er.events.REMOTE_USER_CURSOR_FOLLOWED,{numFollowers:n}):(0,ei.track)(er.events.REMOTE_USER_CURSOR_UNFOLLOWED,{numFollowers:n})}),[e])}(),(0,wj.default)(),function(){let{presence:e}=(0,sg.default)(),t=n3(tn);(0,v.useEffect)(function(){e.updateOpenFile(t)},[e,t])}(),function(){let{showConfirm:e,showNotice:t,hideMessage:n,showError:i}=(0,sr.default)(),{container:r}=(0,sg.default)(),a=(0,v.useRef)(!1);(0,v.useEffect)(()=>{let s=r.onToast(e=>{e.startsWith("PANIC")||t(e,Math.max(1e4,e.length/.025+1e3))}),o=null,l=!1,u=r.onConnectionStateChanged(r=>{if(o&&(n(o),o=null),r===v$.ConnectionState.CONNECTED){l&&a.current&&(o=e("Connected",1500),a.current=!1),l=!0;return}if(l){if(r===v$.ConnectionState.CONNECTING){o=t("Reconnecting");return}if(r===v$.ConnectionState.DISCONNECTED){o=i("Disconnected"),a.current=!0;return}}});return()=>{o&&n(o),s(),u()}},[r,e,t,i,n])}(),function(){let{showConfirm:e}=(0,sr.default)(),{fs:t}=(0,sg.default)();(0,v.useEffect)(()=>{let n=t.registerOnFlushSuccess((t,n)=>{if(n!==n_.FlushSource.MANUAL_SAVE)return;let i=`Saved ${t}`;e(i,Math.max(1e4,i.length/.025+1e3))});return()=>{n()}},[t,e])}(),function(){let{showNotice:e,showError:t}=(0,sr.default)();(0,dv.usePid2)(async(n,{signal:i})=>{let r=await n.pythonMigration.detectLegacyPython.rpc({},{signal:i});if(!r.ok||!r.payload.oldVenvDetected)return;let a=await n.pythonMigration.migratePython.rpc({},{signal:i});if(!a.ok){"NOP"!==a.payload.code&&t((0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("div",{children:"Failed to migrate legacy Python configuration."}),(0,x.jsx)("div",{children:"You may need to reinstall your Python packages, or contact support."})]}),1e4);return}e((0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("div",{children:"This Repl contained legacy Python configuration"}),(0,x.jsx)("div",{children:"and has been automatically migrated."})]}),1e4)},[t,e])}(),i=n3(tS),r=v4(),a=(0,px.useTourStep)(yz.newUserTour.id,yz.TourStepIds.Output),(0,v.useEffect)(()=>{if(!i||!a?.isActive)return;let e=setInterval(()=>{r()},200);return()=>{clearInterval(e)}},[a?.isActive,r,i]),v8(lZ.showShell.id,{type:"shell"}),v8(lZ.showGit.id,{type:"git"}),v8(lZ.showSettings.id,{type:"preferences"}),v8(lZ.showConsole.id,{type:"runnerOutput"}),(0,v6.default)(),function(){let{presence:e}=(0,sg.default)(),t=aC();(0,v.useEffect)(function(){return e.onUserOpenedFile(({user:n,file:i})=>{let r=e.getFollowedUser();!r||r.id!==n.id||i&&t({path:i})})},[e,t]);let[n,i]=(0,v.useState)(null);(0,v.useEffect)(()=>e.onFollowedUserChanged(i),[e]),(0,v.useEffect)(function(){if(!n)return;function t(){e.unfollowUser()}let i=setTimeout(()=>{document.addEventListener("click",t)},0);return()=>{clearTimeout(i),document.removeEventListener("click",t)}},[n])}(),function(){var e;let t,n=(0,wm.useSetAreHiddenFilesVisible)(),{data:i}=(e={variables:{replId:(0,a9.default)()}},t={...wp,...e},j.useQuery(wh,t)),r=i?.getRepl.__typename==="Repl"?i.getRepl:null;(0,v.useEffect)(()=>{!r||r.templateInfo?.label.includes("Blank Repl")&&n(!0)},[n,r])}(),function(e){let{fs:t}=(0,sg.default)(),{isTutorial:n}=(0,yq.default)(),i=(0,at.default)(e);(0,v.useEffect)(()=>{if(!n)return;let e=!1,r=t.watchDir(yq.TUTORIAL_DIR,{onChange(n){vG(t,n).then(t=>{if(e)return;if(!t)return void i.current(null);let n=null;try{n=f3.evaluate(t)}catch{}let r="object"==typeof n&&"string"==typeof n.embedUrl?n.embedUrl:null;i.current(r?{embedUrl:r}:null)})},onMoveOrDelete(){i.current(null)},onError(){i.current(null)}});return()=>{e=!0,r()}},[t,n,i])}(n9(rY)),function(){let{isTutorial:e}=(0,yq.default)(),t=n9(rZ);(0,v.useEffect)(()=>{e&&t()},[t,e])}(),s=(0,vJ.default)(),o=(0,v0.useSetPaneIndicator)(),(0,v.useEffect)(()=>{o({paneType:"envEditor",indicatorType:s?A.tokens.redStronger:void 0})},[s,o]),(0,wo.useMissingSecretToast)({onOpenEnvEditor(){M({pane:{type:"envEditor"},activate:!0,placement:{type:"secondary"}})}}),l=n3(e7),u=(0,nC.useActivatePane)(),d=(0,nC.useClearActivePane)(),(0,v.useEffect)(()=>{l?u(l):d()},[u,d,l]),n=(0,aO.useFocusPane)(),c=n6(an),p=n7(e7),h=(0,at.default)(n),(0,v.useEffect)(()=>{let e=null;function t(t){t&&(null!==e&&clearTimeout(e),e=setTimeout(()=>{let e=p();e&&h.current(e)}))}t(c.current);let n=c.subscribe(t);return()=>{null!==e&&clearTimeout(e),n()}},[c,h,p]),m=n3(n$),f=n9(ak),(0,v.useEffect)(()=>{if(m)return document.addEventListener("dragend",e),()=>{document.removeEventListener("dragend",e)};function e(){f()}},[m,f]),(0,wa.default)(),g=n3(tS),y=(0,aO.useGetPaneBindings)(),w=n7(tf),(0,a$.useCommandBinding)(()=>{if(g)return[lZ.webviewRefresh.id,()=>{for(let[e]of w().filter(([,e])=>"webview"===e.type)){let t=y(e);t&&"webview"===t.type&&t.refresh()}}]},[g,y,w]),(0,wu.default)(),(0,vF.useOrgReplPresenceSession)(!e.org?.id);let M=sa();(0,v.useEffect)(()=>(dm.setTag("replId",e.id),()=>{dm.setTag("replId",void 0)}),[e.id]),(0,v.useEffect)(()=>(dm.setTag("agent",!0),(0,E.addAgentTag)(!0),()=>{dm.setTag("agent",void 0),(0,E.removeAgentTag)()}),[]),(0,v3.default)({repl:e,currentUser:t,container:V}),(0,ww.default)(),function(){let e=(0,H.useFlag)({controlName:"flag-open-telemetry-tracing"}),{visibility:t,visibleTime:n,hiddenTime:i}=function(){let[e,t]=(0,v.useState)(!1),[n,i]=(0,v.useState)(Date.now()),[r,a]=(0,v.useState)(Date.now());return(0,v.useEffect)(()=>{function e(){t(!document.hidden),document.hidden?a(Date.now()):i(Date.now())}return document.addEventListener("visibilitychange",e),e(),()=>{document.removeEventListener("visibilitychange",e)}},[]),{visibility:e,visibleTime:n,hiddenTime:r}}();(0,v.useEffect)(()=>{e&&t&&(n-i)/1e3>60&&(0,I.pruneSpans)(wc.tracerName)},[e,t,i,n])}(),function(){let{ports:e}=(0,sg.default)(),{preferences:t}=(0,lc.usePreferences)("forwardPortsAutomatically");(0,v.useEffect)(()=>{e.setForwardPortsAutomatically(t.forwardPortsAutomatically)},[t.forwardPortsAutomatically,e])}(),(0,vM.default)(e);let F=n9(tu),O=(0,vV.usePrefersReducedMotion)();(0,v.useEffect)(function(){F(!O)},[O,F]);let L=n9(td),B=(0,vD.default)();(0,v.useEffect)(function(){L(B)},[B,L]),function(){var e;let t,{presence:n}=(0,sg.default)(),i=(0,a9.default)(),r=(0,v.useRef)(!1),{data:a,loading:s}=(e={variables:{replId:i}},t={...v2,...e},j.useQuery(v5,t)),o=0;a?.getRepl.__typename==="Repl"&&(o=a.getRepl.multiplayers.length,a.getRepl.owner?.__typename==="User"&&(o+=1)),(0,v.useEffect)(()=>{if(s||r.current)return;let e=n.onActiveUsersChange(()=>{r.current=!0,e(),(0,ei.track)(er.events.MULTIPLAYER_REPL_OPENED,{replId:i,participantsCount:o,usersOnlineCount:n.getActiveUsers().length})});return e},[i,s,o,n])}();let U=(0,nC.useWaitForFileClose)();(0,v.useEffect)(()=>{R.setWaitForFileClose(U)},[R,U]);let N=(0,m0.useThrowBsod)(),G=n3(tb);(0,v.useEffect)(()=>{G&&N(G)},[N,G]),function(){let{packager:e,toolchain:t}=(0,sg.default)();(0,v.useEffect)(()=>{let n=setTimeout(()=>{i()},(10+5*Math.random())*1e3);async function i(){if(t.configs.current&&e)for(let n of t.configs.current.packagers){let t=await e.listSpecfile(n.id);if(t.packages&&t.packages.length>0){let e=t.packages.map(e=>e.name||"")||[];E.logger.info("packager installed packages",{packagerId:n.id,language:n.language,packages:e}),(0,ei.track)(er.events.PACKAGER_PACKAGES_INSTALLED,{packages:e})}let i=(5+5*Math.random())*1e3;await v1(i)}}return()=>{clearTimeout(n)}},[e,t.configs.current])}(),b=(0,nC.useGetActivePaneId)(),S=(0,aO.useFocusPane)(),(0,v.useEffect)(()=>{function e(){let e=b();e&&S(e)}function t(){"visible"===document.visibilityState&&document.activeElement===document.body&&e()}return window.addEventListener("focus",e),document.addEventListener("visibilitychange",t),()=>{window.removeEventListener("focus",e),document.removeEventListener("visibilitychange",t)}},[S,b]),(0,we.default)();let $=n9(ra),z=n9(rs),{fs:W}=(0,sg.default)();(0,wd.default)({fs:W,openMultipleFiles:$,openMultipleURLs:z,waitForFileClose:U,isMobileWorkspace:!1}),(0,aN.useSetToolPanes)(),(0,lk.useInitWorkflows)({dotReplit:D}),(0,wk.useInitResouceMonitoring)();let K=aS();(0,px.useTourStep)(p6.projectsTour.id,p6.StepIds.ProjectPane,{onEnter:()=>K({pane:{type:"project"},commit:!0,activate:!0})}),(0,wS.default)(_),k=v4(),C=(0,v.useCallback)(()=>{k({reveal:!1})},[k]),(0,lk.useOnLocalRun)(C,[C]),(0,v7.useAgentTracking)(),(0,wf.useSyncAgentFreemiumUsage)(),(0,wn.useChatterSentryBreadcrumbs)(),(0,wi.useDebugPreviewStateTracking)(),(0,v9.useQueueAutoPlay)(),(0,wt.useAutoSetExpertMode)({isAgentReplInConfig:!!e.config?.isAgentRepl,isExpertModeInConfig:!!e.config?.isExpertMode});let X=aS(),Q=(0,v.useCallback)(e=>{X({pane:{type:e},activate:!1,reveal:!1,commit:!0})},[X]);return(0,vR.default)({handleOpenPane:Q}),(0,wr.default)(),function(){let{setAgentPosition:e}=aD(),{preferences:{agentPosition:t}}=(0,lc.usePreferences)("agentPosition"),n=(0,v.useRef)(t);(0,v.useEffect)(()=>{t!==n.current&&(n.current=t,e(t))},[e,t])}(),(0,vq.useTrackAgentTestingTakeoverRequests)(),T=n7(tc),P=aS(),(0,dx.useChatHook)("received-completed-event",({event:e})=>{let{contents:t}=e.contents;if(!(0,vW.isKind)(t,"agentTimelineEventContents"))return;let{toolData:n}=t.agentTimelineEventContents;if(n?.$kind==="createPostgresqlDatabaseData"){let e;e=T(),e.tiling?.type==="paneGroup"&&1===e.tiling.panes.length&&P({pane:{type:"neon"},activate:!1})}}),!function(e){let t=(0,a9.default)(),n=n3(tO),i=n9(r9),r=(0,vL.useAgentPlanApprovalState)(),a=(0,vB.useIsCurrentSessionInitialAgentSession)(),s=(0,v.useRef)(!1),[o]=(0,vO.useUpdateReplConfigMutation)(),l=e.config,u=!!e.origin?.id;(0,v.useEffect)(()=>{if(u){l?.isInPlanningPhase!==!1&&o({variables:{input:{id:t,isInPlanningPhase:!1}}});return}l?.isAgentRepl&&a&&null!=r&&!s.current&&("approved"===r?(n&&i("sidebar"),l?.isInPlanningPhase!==!1&&o({variables:{input:{id:t,isInPlanningPhase:!1}}})):(n||i("centered"),l?.isInPlanningPhase!==!0&&o({variables:{input:{id:t,isInPlanningPhase:!0}}})),s.current=!0)},[n,t,i,o,r,a,l,u])}(e),(0,wg.useSyncAgentInitialPlanningState)(),(0,wx.useSyncAgentWebDesignMockupState)(),null}var wT=e.i(425188);function wE({children:e,tour:t,userId:n}){if(!t)return(0,x.jsx)(x.Fragment,{children:e});let i="workspace-desktop-new-user-tour"===t.id||"workspace-desktop-tour-2024"===t.id;function r(e){i&&t&&(0,ei.identify)({id:n.toString(),workspaceTourId:t.id,workspaceTourStatus:e===t.steps[t.steps.length-1].id?"completed":e.toLowerCase()})}return(0,x.jsx)(wT.TourRoot,{tour:t,onStep:e=>{t&&((0,ei.track)(er.events.WORKSPACE_TOUR_STEP_VIEWED,{tour:t.id,stepId:e.toLowerCase()}),r(e))},onDone:e=>{(0,ei.track)(er.events.WORKSPACE_TOUR_DISMISSED,{tour:t.id,stepId:e.toLowerCase(),didComplete:e===t.steps[t.steps.length-1].id}),r(e)},children:e})}var wI=e.i(508545),wP=e.i(911489),wA=e.i(263649),wR=e.i(924035),wD=e.i(384444);function wV(){let e=(0,lT.useObservable)((0,uK.useAgentIsWorking)()),t=(0,lT.useObservable)((0,uq.useAgentIsWaitingOnUserInput)()),[n,i]=(0,v.useState)(!0),r=(0,vK.useGetExperiment)("sound-on_v2")(),a="control"!==r?.get("treatmentName","control"),s=(0,v.useRef)(!1),[o,l]=(0,v.useState)(!1),u=(0,v.useRef)(null);(0,v.useEffect)(()=>{let e=()=>{let e=!document.hidden;i(e),e&&(l(!1),u.current&&(document.title=u.current))};return e(),document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}},[]),(0,v.useEffect)(()=>{if(!a)return;let i=e||t;i?s.current=!0:s.current&&!i&&(n||l(!0),s.current=!1)},[e,t,n,a]),(0,v.useEffect)(()=>(o?(null===u.current&&(u.current=document.title),document.title.startsWith("(1) ")||(document.title=`(1) ${document.title}`)):u.current&&(document.title=u.current,u.current=null),()=>{u.current&&(document.title=u.current,u.current=null)}),[o]);let d=wD.favicons.prompt;return e?d=wD.favicons.agentWorking:t?d=wD.favicons.agentWaiting:a&&o&&!n&&(d=wD.favicons.agentWaiting),d?(0,x.jsx)(wR.default,{children:(0,x.jsx)("link",{rel:"shortcut icon",href:d,sizes:"192x192",type:"image/png"})}):null}var w_=e.i(169566);function wM(){let e=(0,y.useRouter)(),t=aS(),n=(0,X.useQueryParam)("didMigrateToHelium","boolean");return(0,x.jsx)(aK.Modal,{isOpen:n,onRequestClose:()=>{(0,X.updatePathWithQueryParams)({router:e,params:[{mode:"delete",key:"didMigrateToHelium"}]})},centered:!0,children:(0,x.jsxs)(V.View,{gap:16,children:[(0,x.jsx)(st.Header,{level:1,variant:"headerDefault",children:"We've upgraded your database!"}),(0,x.jsx)(st.Text,{children:"Your data remains secure. No further action is required."}),(0,x.jsxs)(V.View,{row:!0,gap:8,children:[(0,x.jsx)(V.View,{grow:!0,children:(0,x.jsx)(se.Button,{text:"View database",iconLeft:(0,x.jsx)(oh.default,{}),onClick:()=>{t({pane:{type:"neon"}}),(0,X.updatePathWithQueryParams)({router:e,params:[{mode:"delete",key:"didMigrateToHelium"}]})}})}),(0,x.jsx)(V.View,{grow:!0,children:(0,x.jsx)(p9.ButtonLink,{variant:"outlined",text:"Learn more",iconRight:(0,x.jsx)(oI.default,{}),href:"https://docs.replit.com/cloud-services/storage-and-databases/sql-database",target:"_blank",rel:"noopener",noNextLink:!0})})]})]})})}var wF=e.i(468448),wO=e.i(748965),wL=e.i(764586),wB=e.i(968263);let wU={},wN=w.gql`
    query PublishedAs($id: String!) {
  getRepl(id: $id) {
    ... on Repl {
      id
      publishedAs
    }
  }
}
    `;var wG=e.i(966983);let w$=".replit-dynamic-template";var wz=e.i(169932),wW=e.i(420309),wH=e.i(833387);function wq(){let[e,t]=(0,v.useState)(!1),n=(0,v.useCallback)(n=>{switch(n){case"starting":return void t(!0);case"none":return void t(!1);case"running":if(!e)throw Error("expected repl not to need dynamic template initialization")}},[t,e]),[i,r]=(0,v.useState)([]),a=(0,gd.useIdSeed)();!function({handleRPC:e,onConnStateChange:t}){var n;let i,r=(0,H.useFlag)({controlName:"octopus-smokescreen"}),{loading:a,data:s}=(n={variables:{id:(0,a9.default)()}},i={...wU,...n},j.useQuery(wN,i)),o=(0,q.default)(()=>{if(a)return!1;let e=s?.getRepl;return e?.__typename==="Repl"&&e.publishedAs===lQ.PublishedReplKind.Template},[a,s]),{container:l,fs:u}=(0,sg.default)(),[d,c]=(0,v.useState)(!1),{channel:p,isConnecting:h}=mQ({container:l,service:"exec",skip:!d});(0,v.useEffect)(()=>{!r||o||a||e();async function e(){c((await u.stat(w$)).exists)}},[u,r,o,a,c]),(0,v.useEffect)(()=>{if(h)return;if(!p)throw Error("exec channel is not open");let n=(0,wB.default)();n.promise.then(async()=>{let e=await p.request({input:JSON.stringify({type:"start"})+"\n"});if(!e.ok)throw Error(": "+e.error)});let i=p.onCommand(i=>{switch(i.body){case"state":i.state===wG.api.State.Running?(t("starting"),n.resolve()):t("none");return;case"output":{let t,n=i.output;if(!n)return;try{t=JSON.parse(n)}catch(e){throw Error(`failed to parse dynamic template output: ${e}`)}e(t)?.then(e=>p.send({input:JSON.stringify(e)+"\n"}));return}case"stderr":console.warn("got dynamic template generator stderr:",i.stderr);return;case"error":console.error("got dynamic template generator error:",i.error);return;case"ok":return;default:throw Error(`unhandled exec channel body: ${i.body}`)}});return p.send({exec:{args:["sh",w$],lifecycle:wG.api.Exec.Lifecycle.STDIN}}),()=>{i()}},[p,e,h,t,d])}({handleRPC:(0,v.useCallback)(e=>{switch(e.type){case"progress":case"failed":return r(t=>[...t,{key:a(t.length),...e}]),null;case"query":case"prompt":case"confirm":{let t=(0,wB.default)();return r(n=>[...n,{respond:t,key:a(n.length),...e}]),t.promise}default:throw Error("unhandled request type: "+JSON.stringify(e))}},[a]),onConnStateChange:n});let s=i.map(e=>{switch(e.type){case"progress":return(0,x.jsx)(wK,{...e});case"failed":return(0,x.jsx)(wY,{...e});case"query":return(0,x.jsx)(wX,{...e});case"prompt":return(0,x.jsx)(wQ,{...e});case"confirm":return(0,x.jsx)(wZ,{...e})}});return(0,x.jsx)(aK.Modal,{isOpen:e,onRequestClose:()=>t(!1),children:(0,x.jsx)(V.View,{gap:8,children:s})})}function wK({progress:e,...t}){return(0,x.jsxs)(V.View,{...t,children:["progress: ",e]})}function wY({error:e,...t}){return(0,x.jsxs)(V.View,{...t,children:["error: ",e]})}function wX({query:e,options:t,respond:n,...i}){let[r,a]=(0,v.useState)(null),[s,o]=(0,v.useState)(!1),l=(0,gd.useIdSeed)(),u=(0,v.useCallback)(()=>{null!==r&&(o(!0),n.resolve({type:"answer",answer:t[r]}))},[r,t,n]);return(0,x.jsxs)(V.View,{...i,children:["query: ",e,t.map((t,n)=>(0,x.jsxs)("label",{children:[(0,x.jsx)("input",{type:"radio",name:e,value:n,checked:r===n,onChange:()=>{s||a(n)}}),t]},l(n))),(0,x.jsx)(se.Button,{text:"submit",onClick:u})]})}function wQ({prompt:e,respond:t,...n}){let[i,r]=(0,v.useState)(""),[a,s]=(0,v.useState)(!1),o=(0,v.useCallback)(()=>{s(!0),t.resolve({type:"answer",answer:i})},[i,t]);return(0,x.jsxs)(V.View,{...n,children:["prompt: ",e,(0,x.jsx)(cL.Input,{disabled:a,inputMode:"text",title:e,onChange:e=>r(e.currentTarget.value)}),(0,x.jsx)(se.Button,{text:"submit",onClick:o})]})}function wZ({confirm:e,dataConfirmation:t,respond:n,...i}){let r=Object.keys(t),a=Object.values(t);return(0,x.jsxs)(V.View,{...i,children:["confirm: ",e,(0,x.jsxs)(wz.default,{"aria-label":"the data to be used to generate your App",children:[(0,x.jsx)(wH.TableHeader,{children:r.map(e=>(0,x.jsx)(wL.Column,{isRowHeader:!0,children:e},e))}),(0,x.jsx)(wW.default,{children:(0,x.jsx)(wL.Row,{children:a.map((e,t)=>(0,x.jsx)(wL.Cell,{children:e},r[t]))})})]}),(0,x.jsx)(se.Button,{text:"yes",onClick:()=>n.resolve({type:"answer",answer:"yes"})}),(0,x.jsx)(se.Button,{text:"no",onClick:()=>n.resolve({type:"answer",answer:"no"})})]})}var wJ=e.i(982243),w0=e.i(376847),w1=e.i(678814),w2=e.i(268999),w5=e.i(660081),w4=e.i(589114),w8=e.i(435106),w3=e.i(568515),w6=e.i(267710),w9=e.i(952098),w7=e.i(63846),be=e.i(735744);e.i(660670);var bt=e.i(187822),bn=e.i(351677),bi=e.i(170039),br=e.i(110758);e.i(977195);var ba=e.i(590467),bs=e.i(638472),bo=e.i(635984),bl=e.i(668106),bu=e.i(116680);let bd=(0,v.createContext)(null),bc=(e,t,n)=>{if(E.logger[n??"info"](e,{river:t,riverTarget:"subrepl-pid2",riverVersion:bs.RIVER_VERSION}),t?.tags?.includes("invariant-violation")){let n=Error(e);dm.withScope(e=>{e.setTag("subrepl-pid2",!0),e.setExtras(t),dm.captureException(n)})}};async function bp(e,t){let n=await (0,bl.default)({replId:e,isLoggedIn:!0,requestedPid2Version:await (0,bo.getPid2Version)(),format:wG.api.token.ReplToken.WireFormat.RIVER,overrideClusterMetadata:await (0,bu.default)()}),i=`${n.wsURL}/${t}`;return{...n,wsURL:i}}function bh({replId:e,subreplId:t,currentUsername:n,children:i}){let[r,a]=(0,v.useState)(null),s=(0,v.useRef)({});return(0,v.useEffect)(()=>{if(!e||!t||!n)return;let i=`subrepl-${n}-${(0,dG.nanoid)(4)}`,[r,o]=function({clientId:e,replId:t,subreplId:n,onSessionStatusChange:i,onProtocolError:r}){let a;async function s(){let e=await bp(t,n);return a=e.token,new WebSocket(e.wsURL)}let o=(0,bs.default)(e,async()=>{let e=Date.now();return bc("subrepl-pid2: getting ws",{extras:{subreplId:n}}),s().finally(()=>{bc("subrepl-pid2: ws open",{extras:{duration:Date.now()-e,subreplId:n}})})},function(){return a},bc,"info");function l(e){i?.(e),"closed"===e.status&&setTimeout(()=>{"visible"===document.visibilityState&&"open"===o.transport.getStatus()&&(o.transport.reconnectOnConnectionDrop=!0,o.transport.connect(bs.PID2_SERVER_ID))},0)}function u(e){if(e.type===bs.RiverProtocolError.RetriesExceeded){o.transport.reconnectOnConnectionDrop=!1,o.transport.retryBudget.startRestoringBudget();return}r(e),o.transport.close()}function d(){"visible"===document.visibilityState&&(o.transport.reconnectOnConnectionDrop=!0,o.transport.connect(bs.PID2_SERVER_ID))}function c(){o.transport.reconnectOnConnectionDrop=!0,o.transport.connect(bs.PID2_SERVER_ID)}return o.transport.addEventListener("protocolError",u),o.transport.addEventListener("sessionStatus",l),document.addEventListener("visibilitychange",d),window.addEventListener("online",c),(0,ba.isBrowserOnline)()&&(o.transport.reconnectOnConnectionDrop=!0,o.transport.connect(bs.PID2_SERVER_ID)),[o,()=>{o.transport.removeEventListener("sessionStatus",l),o.transport.removeEventListener("protocolError",u),o.transport.close(),document.removeEventListener("visibilitychange",d),window.removeEventListener("online",c)}]}({clientId:i,replId:e,subreplId:t,onSessionStatusChange:e=>{"created"===e.status?(s.current.sessionStart=Date.now(),bc("subrepl-pid2: session started",{sessionId:e.session.id,clientId:i,extras:{subreplId:t}})):"closed"===e.status&&s.current.sessionStart&&bc("subrepl-pid2: session ended",{sessionId:e.session.id,clientId:i,extras:{sessionDuration:Date.now()-s.current.sessionStart,subreplId:t}}),dm.addBreadcrumb({category:"subrepl-pid2",message:`session ${e.status}`,data:{...e,subreplId:t}})},onProtocolError:e=>{dm.addBreadcrumb({category:"subrepl-pid2",message:"protocol error",data:{...e,subreplId:t}}),bc("subrepl-pid2: protocol error",{extras:{...e,subreplId:t}})}});return a(r),()=>{a(null),o()}},[n,e,t]),(0,x.jsx)(Q.Pid2Context.Provider,{value:r,children:(0,x.jsx)(bd.Provider,{value:r,children:i})})}var bm=e.i(827444),bf=e.i(282332),bg=e.i(19004),bx=e.i(416558),by=e.i(17609),bv=e.i(748855),bw=e.i(122965),bb=e.i(534518),bj=e.i(886383),bS=e.i(801127),bk=e.i(86774);function bC(e,t=new Set){let n=new Set;return new Proxy({},{get(i,r){if("then"===r)return;let a=String(r);return t.has(a)?()=>()=>{}:(...t)=>{n.has(a)||(n.add(a),console.warn(`[subrepl] ${e}.${a} is not supported in subrepl workspaces`))}}})}async function bT({subreplId:e,...t}){let n=await (0,bl.default)(t),i=`${n.wsURL}/${e}`;return{...n,wsURL:i}}function bE(e){return e.dotdevHostname.endsWith(".localhost")?`http://${e.dotdevHostname}:8081`:`https://${e.dotdevHostname}`}e.i(262962);let bI=new Map;function bP(e){let t=bI.get(e);t&&(t.container.destroy(),bI.delete(e))}var bA=e.i(436725);e.i(89080);var bR=e.i(685691);let bD=(0,J.atom)(new Set),bV=(0,v.createContext)(null);function b_(){let e=(0,v.useContext)(bV);if(!e)throw Error("useSubreplTaskStore must be used within SubreplContextProvider");return e}let bM=(0,v.createContext)({});function bF({currentUser:e,subreplId:t,children:n}){return(0,H.useFlag)({controlName:"flag-agent-teamwork",default:!1})?(0,x.jsx)(bO,{currentUser:e,subreplId:t,children:n}):(0,x.jsx)(x.Fragment,{children:n})}function bO({currentUser:e,subreplId:t,children:n}){let i,r=(0,a9.default)();i=(0,dx.useChatter)(),(0,v.useEffect)(()=>{let e={resolve:e=>i.subreplrun.run(e).data.once()},t={destroy:bP},n={onError:(e,t,n)=>{dm.captureException(e,{tags:{subrepl:!0,context:"useCleanupCompletedTaskServices"},extra:{taskId:t,subreplRunId:n}})}},r=bR.TasksCollection.subscribeChanges(i=>(function(e,t,n,i){for(let r of e){if("update"!==r.type)continue;let e=r.value;("COMPLETED"===e.state||"CANCELLED"===e.state)&&e.subreplRunId&&t.resolve(e.subreplRunId).then(e=>n.destroy(e.subreplId)).catch(t=>i.onError(t,e.id,e.subreplRunId))}})(i,e,t,n),{includeInitialState:!1});return()=>{for(let[e]of(r.unsubscribe(),bI))bP(e)}},[i]);let a=(0,v.useMemo)(()=>(0,J.createStore)(),[]),s=(0,v.useMemo)(()=>t?(0,J.createStore)():null,[t]),o=function(e,t,n,i){let[r,a]=(0,v.useState)(null),s=(0,be.default)(),o=(0,H.useFlag)({controlName:"flag-use-chort-chat-proxy",type:"boolean",default:!1}),l=null!==(0,bi.getUseChatProxyOverride)()?(0,bi.getUseChatProxyOverride)():o;return(0,v.useEffect)(()=>{if(!t)return void a(null);let r=(0,br.createCompoundReplId)(e,t),o=(0,w8.createClientId)({currentUserId:n});console.log("[SubreplWorkspace] Creating Chatter with compound repl ID:",r,"chatProxy:",l);let u=new w8.ChatConnection({clientId:o,serverId:"SERVER",isClientActiveObservable:s,logger:(e,t,n)=>{E.logger[n??"info"](e,{river:t,riverTarget:"ai-chat-subrepl",riverProxied:l})},getEndpoint:async()=>{let e=await (0,w6.auth)(r,o,void 0),t=new URL(l?(0,w9.getCurrentChatProxyEndpoint)():(0,w7.getAiEndpoint)());return t.searchParams.set("auth_token",e),t}}),d=new bt.ChortRiverConnection({userId:n,isClientActiveObservable:s,logger:(e,t,n)=>{E.logger[n??"info"](e,{river:t,riverTarget:"chort-subrepl"})},getEndpoint:async()=>(0,w9.getCurrentChortEndpoint)(),getToken:async()=>(0,bn.fetchChortAuthToken)(n,r)}),c=new w3.Yapper({connection:u,chortConnection:d,replId:r,user:{id:String(n),type:1,isTeam:!1,roles:[],membership:0,orgId:"",username:i,timeCreated:new Date,flaggingContext:"",modelfarmDisabled:!1,openrouterDisabled:!1,openaiDisabled:!1,anthropicDisabled:!1,geminiDisabled:!1,isEnterprise:!1},hasAdvancedModel:!1,overrideModel:null,logger:E.logger});u.connect(),d.connect(),a(c);let p=c.chatter().sessions.agent.current.subscribe(e=>{e&&console.log("[SubreplWorkspace] Chatter connected with active agent session:",e.id)});return()=>{p(),a(null),c.dispose(),Promise.all([u.drained(),d.drained()]).then(()=>{u.close(),d.close()})}},[e,t,n,i,l,s]),r}(r,t,e.id,e.username),l=function(e){let[t,n]=(0,v.useState)(null),i=(0,sg.default)(),r=(0,bw.useFlaggedRetrier)(),a=(0,sf.default)(i.container);return(0,v.useEffect)(()=>{if(!e)return void n(null);let t=function(e){let t=bI.get(e.subreplId);if(t)return t;let n=function({replId:e,subreplId:t,onUnrecoverableError:n,enableMultipleLSPClientsPerFile:i=!1,openTelemetryTracing:r}){let a=function({replId:e,subreplId:t,onUnrecoverableError:n}){let i,r,{register:a,unregister:s}={register:(e,t)=>(r(),window.addEventListener("online",e),window.addEventListener("offline",t),i=()=>{window.removeEventListener("online",e),window.removeEventListener("offline",t)},r),unregister:r=()=>{i&&(i(),i=void 0)}},o=async e=>bT({...e,subreplId:t});return(0,bf.default)({fetchConnectionMetadata:o,getOverrideClusterMetadata:bu.default,getDotdevUrl:bE,logger:E.logger,onUnrecoverableError:n,performance:window.performance,preFetchConnectionMetadata:async()=>{window.performance.clearMarks(bm.performanceMarks.fetchConnectionMetadataPageInvisibleStart),window.performance.clearMarks(bm.performanceMarks.fetchConnectionMetadataPageInvisibleEnd),window.performance.mark(bm.performanceMarks.fetchConnectionMetadataPageInvisibleStart),await (0,vH.pageVisible)(),window.performance.mark(bm.performanceMarks.fetchConnectionMetadataPageInvisibleEnd)},registerReconnectionMonitor:a,unregisterReconnectionMonitor:s,getPid2Version:bo.getPid2Version})}({replId:e,subreplId:t,onUnrecoverableError:n}),s=(0,bb.default)({container:a}),o=(0,bg.default)({container:a,fs:s}),l=(0,bx.default)({container:a}),u=(0,bv.default)({container:a,dotReplit:o}),d=(0,by.default)({container:a,forceTrace:r,track:ei.track}),c=(0,bS.createPortsService)({container:a,dotReplit:o}),p=(0,bj.createLSPNixService)({container:a,toolchain:u,fs:s,enableMultipleLSPClientsPerFile:i}),h=(0,bk.default)({container:a}),m=bC("presence");return{replId:e,subreplId:t,presence:m,packager:d,container:a,fs:s,dotReplit:o,nixService:l,lspnix:p,git:bC("git",new Set(["onRefresh","onUpdate"])),replspaceApi:bC("replspaceApi"),toolchain:u,ports:c,secrets:h}}(e);return bI.set(e.subreplId,n),n}(e);return n(t),()=>{t.container.close()}},[e]),(0,v.useEffect)(()=>{if(!t||!e)return;let n=i.container.getContext();if(!n)return;let a={repl:{__typename:"Repl",id:e.replId,language:n.repl.language,authorizations:n.repl.authorizations},currentUser:e.currentUser?{__typename:"CurrentUser",id:e.currentUser.id,username:e.currentUser.username,isSubscribed:n.currentUser?.isSubscribed??!1}:void 0};return t.container.connect({context:a,getMinimumRetryDelayMs:r}),()=>{t.container.close()}},[t,e,i.container,a,r]),t}((0,v.useMemo)(()=>t?{replId:r,subreplId:t,currentUser:e,onUnrecoverableError:e=>{dm.captureException(e,{tags:{subrepl:!0,context:"SubreplContextProvider"},extra:{replId:r,subreplId:t}})}}:null,[r,t,e])),u=(0,o$.usePid2Callback)(e=>async()=>{if(t)return e.git.fetchFromSubrepl.rpc({subreplId:t,subreplBranch:"main",fastForwardCurrentBranch:!0})},[t]),d=(0,v.useMemo)(()=>({fetchFromSubrepl:u}),[u]);return t&&s?o&&l?(0,x.jsx)(bV.Provider,{value:a,children:(0,x.jsx)(bM.Provider,{value:d,children:(0,x.jsx)(u5.default.Provider,{value:l,children:(0,x.jsx)(bh,{replId:r,subreplId:t,currentUsername:e.username,children:(0,x.jsx)(dx.StoreProvider,{store:s,yapper:o,children:n})})})})}):(0,x.jsx)(bV.Provider,{value:a,children:(0,x.jsx)(bA.LoadingState,{})}):(0,x.jsx)(bV.Provider,{value:a,children:n})}var bL=e.i(535076),bB=e.i(491409),bU=e.i(755867),bN=e.i(134663),bG=e.i(695926),b$=e.i(26857),bz=e.i(287999),bW=e.i(901708);let bH=()=>{},bq=()=>Promise.resolve(),bK=()=>{},bY=()=>{};function bX({session:e,openPane:t}){let n=(0,sg.default)(),i=(0,v.useRef)(!0),{agentState:r}=(0,fE.useAgentState)(),[a,s]=(0,v.useState)(!1),o=(0,b$.useSendAskUserForActionResponse)(e),l=(0,v.useCallback)((e,t)=>{s(t.hasLastToolUseGroupCandidate)},[]),u=(0,bG.useShouldShowFloatingStatusRow)(e),d=u&&!a,c={isReadOnly:!1,readFile:e=>n.fs.readFile(e),openPane:t,openPip:bH,sendMessage:bq,secrets:n.secrets,onSessionChange:bK,isInitialSession:!0,agentState:r,sendAskUserForActionResponse:o,tipData:void 0,bonsaiTourTipInfo:void 0,onShowCheckpoints:bY,isAwaitingTaskListApproval:!1};return(0,x.jsx)(bz.CheckpointProvider,{children:(0,x.jsxs)(bW.AutoScroller,{shouldAutoScrollRef:i,pt:bL.FEED_PADDING_TOP,pb:bL.FEED_PADDING_BOTTOM,px:bL.FEED_PADDING_INLINE_DESKTOP,scrollCacheKey:e.id,scrollCache:new Map,children:[(0,x.jsx)(bU.SessionFeedContent,{scopedSession:e,sessionEntry:{sessionId:e.id},onFeedStateChange:l,shouldAutoScrollRef:i,shouldShowFloatingStatusRow:u,...c}),d?(0,x.jsx)(bB.EventContainer,{py:2,children:(0,x.jsx)(bN.FeedStatusRow,{session:e})}):null]})})}var bQ=e.i(505408),bZ=e.i(563398),bJ=e.i(604275),b0=e.i(839575);let b1={direction:"reverse",state:{event:null},reducer(e,t){if((0,vz.isEventAgentToolDataKind)(e,"endOfRunSummaryData"))return t.event=e,!1}};var b2=e.i(645424);function b5({session:e}){var t;let n,i,r,a,[s,o]=(0,v.useState)(!1),l=n3(tL),u=n3(tB),{fetchFromSubrepl:d}=(0,v.useContext)(bM),{data:c}=(0,bZ.useLiveQuery)(e=>e.from({taskItems:bR.TasksCollection}).where(e=>(0,bQ.eq)(e.taskItems.id,l??""))),p=c?.[0],h=function(e,t=20){let n=(0,hJ.useObservableMemo)(()=>e?.reduce(b1,t),[e,t],{default:null});return n?.event??null}(e),m=(t=h?.id??void 0,n=b_(),i=(0,ee.useAtomValue)(bD,{store:n}),!!t&&i.has(t)),f=(r=b_(),a=(0,ee.useSetAtom)(bD,{store:r}),(0,v.useCallback)(e=>{a(t=>{let n=new Set(t);return n.add(e),n})},[a])),g=(0,v.useMemo)(()=>d&&u?async e=>{try{let t=await d(u);if(!t?.ok)return void dm.captureMessage("Failed to merge from subrepl",{extra:{taskId:e,subreplId:u,result:t}});bR.TasksCollection.update(e,e=>{e.state="COMPLETED"})}catch(e){dm.captureException(e)}}:null,[d,u]),y=p?.state==="READY_TO_MERGE"&&null!=h&&!m,w=(0,v.useCallback)(()=>{h?.id&&f(h.id)},[f,h?.id]),b=(0,v.useCallback)(async()=>{if(g&&p?.id){o(!0);try{await g(p.id)}finally{o(!1)}}},[g,p?.id]);return y?(0,x.jsx)(V.View,{px:bL.FEED_PADDING_INLINE_DESKTOP,pb:4,children:(0,x.jsxs)(b0.ChatTakeoverDialog,{children:[(0,x.jsx)(st.Text,{textWrap:"pretty",children:"This task is ready to merge. Review the changes and merge them into your main app."}),(0,x.jsx)(V.View,{gap:8,children:(0,x.jsxs)(V.View,{row:!0,gap:8,children:[(0,x.jsx)(se.Button,{clsx:b2.default.grow1,text:"Dismiss",onClick:w}),(0,x.jsx)(se.Button,{clsx:b2.default.grow1,text:"Merge",onClick:b,iconLeft:(0,x.jsx)(bJ.default,{}),colorway:"primary",disabled:!g||s})]})})]})}):(0,x.jsx)(b4,{session:e})}function b4({session:e}){let[t,n]=(0,v.useState)(""),i=(0,v.useCallback)(async()=>{let i=t.trim();i&&(await e.appendEvent({intent:dg.MessageAction.AGENT,message:i,kind:"message"}),n(""))},[t,e]);return(0,x.jsx)(V.View,{px:bL.FEED_PADDING_INLINE_DESKTOP,pb:4,children:(0,x.jsxs)(V.View,{row:!0,gap:8,align:"center",children:[(0,x.jsx)(V.View,{grow:!0,children:(0,x.jsx)(cL.Input,{value:t,onChange:e=>n(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),i())},placeholder:"Message agent",disabled:!e})}),(0,x.jsx)(se.Button,{text:"Send",onClick:i,disabled:!t.trim()||!e})]})})}function b8(){let e,t=aS(),n=(0,v.useCallback)(e=>{(0,ei.track)(er.events.TOOL_OPENED,{source:"Subrepl Agent",tool:e.type}),t({pane:e})},[t]),i=(e=(0,dx.useChatter)(),(0,lT.useObservable)(e.sessions.agent.current)??null);return i?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(V.View,{grow:!0,shrink:!0,children:(0,x.jsx)(bX,{session:i,openPane:n})}),(0,x.jsx)(b5,{session:i})]}):(0,x.jsx)(bA.LoadingState,{})}let b3={"image/png":"png","image/jpeg":"jpg","image/gif":"gif","image/webp":"webp"};async function b6({urls:e,sentryContext:t}){let n=e.filter(e=>null!==e),i=Date.now();return(await Promise.all(n.map(async(e,n)=>{try{let t=await fetch(e);if(!t.ok)throw Error(`Failed to fetch screenshot: ${t.status}`);let r=await t.blob(),a=b3[r.type]??"png",s=`screenshot-${i}-${n}.${a}`,o=new File([r],s,{type:r.type});return{fileName:s,file:o}}catch(n){return dm.captureException(n,{extra:{message:"[AgentInbox] Error downloading screenshot",screenshotUrl:e,...t}}),null}}))).filter(e=>null!==e)}var b9=e.i(224373);let b7=(0,A.cvarsFrom)("ResizeHandle.module.css",["--width"]),je=(0,v.memo)(function(){let e=(0,v.useRef)(null),t=aD(),n=(0,up.default)(t.agentFiletreeOrder);return(0,x.jsx)(jt,{gutter:t.gutter,side:"filetree-agent"===n?"left":"right",onDoubleClick:()=>{t.toggle("collapsed"===t.displayState.current)},onPointerDown:n=>{(0,mL.measureMouseMove)(n,{start(){e.current=document.activeElement,t.resizeSidebar({type:"start"})},move({delta:e}){t.resizeSidebar({type:"update",moveDelta:e})},end(){t.resizeSidebar({type:"end"}),e.current?.focus?.()}})}})});function jt({gutter:e,side:t,...n}){let i=(0,v.useRef)(null);return(0,tZ.useStyleSet)(i,e,e=>({[b7.width]:e+"px"})),(0,x.jsx)(V.View,{clsx:[b9.default.root,b9.default[t]],align:"center",justify:"center",innerRef:i,...n,children:(0,x.jsx)(V.View,{clsx:b9.default.grip})})}var jn=e.i(861781);let ji=(0,A.cvarsFrom)("index.module.css",["--x","--y","--width","--height","--z-index"]);function jr(){}function ja(){let e=n3(tO),t=n9(r9),n=n3(r7),{secrets:i,fs:r}=(0,sg.default)(),a=aS(),s=(0,v.useCallback)(e=>{(0,ei.track)(er.events.TOOL_OPENED,{source:"Agent Sidebar",tool:e.type}),a({pane:e})},[a]),o=fv(),{session:l,setSession:u,setSessionId:d}=(0,fw.useCurrentSession)(),c=aD(),p=(0,v.useRef)(null);(0,tZ.useStyleSet)(p,mD(c.rect,c.getTransitionEnabled),e=>({[ji.x]:e.x+"px",[ji.y]:e.y+"px",[ji.width]:e.width+"px",[ji.height]:e.height+"px"}));let[h,m]=(0,v.useState)(null),{setChatRef:f,toggle:g}=c;(0,v.useEffect)(()=>h?(f({setSessionId:d,focusInput:()=>h.focus(),setPromptValue:e=>h.setValue(e),attachments:h.attachments??(async()=>[]),openAgent:e=>{g(!0),d(e??null),h.focus()},openAgentWithPrompt:async({promptValue:e,attachments:t})=>{if(g(!0),h.setValue(e),h.focus(),t&&t.length>0&&h.attachments){let e=await b6({urls:t});if(e.length>0)try{await h.attachments(e)}catch(t){dm.withScope(n=>{n.setTag("agent-inbox-attachments",!0),dm.captureException(t,{extra:{fileCount:e.length}})})}}}}),()=>{f(null)}):void f({setSessionId:d,focusInput:()=>{},setPromptValue:()=>{},attachments:async()=>[],openAgent:e=>{g(!0),d(e??null)},openAgentWithPrompt:({promptValue:e})=>{g(!0)}}),[h,f,d,g]);let y=(0,px.useSetTourStepTarget)(pI,pE.Agent),w=(0,v.useCallback)(e=>{e&&o(e),t("sidebar")},[o,t]),b=!!n3(tB);return(0,x.jsxs)(R.ShadesSurface,{innerRef:p,clsx:[jn.default.root,{[jn.default.subrepl]:b}],style:{[ji.zIndex]:tN.tiledPane.toString()},elevate:!1,background:!b,children:[b?(0,x.jsx)(b8,{}):(0,x.jsx)(fb.AgentMain,{secrets:i,readFile:r.readFile,session:l,setSession:u,openPane:s,onPlanApproval:w,isDesktopOrTabletAgentPresentationCentered:e,isDesktopLayoutAgentPresentationTransitionInProgress:n,openPip:jr,inputRef:m,workspaceTourStepRef:y}),(0,x.jsx)(je,{})]})}let js=(0,ie.cssRecord)({root:[au.rcss.position.absolute,au.rcss.borderRadius(8),au.rcss.align.center,au.rcss.overflow("hidden"),{border:"1px solid",borderColor:A.tokens.outlineDimmest}],content:[au.rcss.width("100%"),au.rcss.flex.growAndShrink(1)]});function jo(){let e=n3(ij),t=n3(t8),n=n9(nI),i=function(){let[{isOver:e},t]=(0,mP.useDrop)({accept:[n_.FileType.File,mZ.DragItems.NewPane],collect:e=>({isOver:e.isOver()}),hover(e){n.drag()},drop(e){if("nodes"===e.type){let t=(0,e9.fsNodeToPanes)(e.nodes);t.length>0&&n.drop({panes:t})}}}),n=function({isOver:e}){let t=n9(ii);return(0,v.useEffect)(()=>{e||t(null)},[e,t]),{drag:n9(iw),drop:n9(ib)}}({isOver:e});return t}(),r=lq({openPane:(0,v.useCallback)(e=>{(0,ei.track)(er.events.TOOL_OPENED,{source:"Empty Layout",tool:e.pane.type}),n({pane:e.pane,edge:"left"})},[n])});return(0,x.jsx)(V.View,{style:{width:e.width,height:e.height,transform:`translate(${e.x}px, ${e.y}px)`,zIndex:t?100:void 0},css:js.root,innerRef:i,children:(0,x.jsx)(V.View,{css:js.content,children:(0,x.jsx)(aY.CommandBar,{autoFocus:!0,command:r,showToolDescriptions:!0})})})}let jl=em.Type.Object({width:em.Type.Number({minimum:0})}),ju=em.Type.Object({width:em.Type.Number({minimum:0})}),jd=em.Type.Object({width:em.Type.Number({minimum:0}),isOpen:em.Type.Boolean()}),jc=em.Type.Object({layout:eS,data:em.Type.Record(em.Type.String(),em.Type.Object({type:em.Type.String()})),agent:em.Type.Optional(ju),filetree:em.Type.Optional(jl),taskSidebar:em.Type.Optional(jd)});function jp(e,t){let n=null;try{n=s2.Value.Decode(jc,e)}catch{}if(null===n)return null;let i={layout:n.layout,data:{},type:"saved",agent:n.agent,filetree:n.filetree,taskSidebar:n.taskSidebar},r=new Set,a=function(e){let t=new Set;for(let n of e.floating)for(let e of n.panes)t.add(e);return e.tiling&&function e(n){if("paneGroup"!==n.type)return n.children.forEach(e);for(let e of n.panes)t.add(e)}(e.tiling),t}(i.layout);for(let[e,s]of Object.entries(n.data)){if(!a.has(e))continue;let n=t(s.type,s);if(!n){r.add(e);continue}i.data[e]=n}return(0,eq.produce)(i,e=>{function t(t){if(a.has(t))return void eG(e.layout,t)}for(let e of r)t(e);for(let[n,i]of Object.entries(e.data))"commands"!==i.type&&("codeEditor"!==i.type||i.data.path)&&"agentProgress"!==i.type&&"agentChat"!==i.type||(delete e.data[n],t(n))})}var jh=e.i(185296),jm=e.i(149818),jf=e.i(529131),jg=e.i(716499),jx=e.i(55721),jy=e.i(478902);let jv=(0,v.createContext)({});function jw(e){let t=(0,v.useRef)(null);return null===t.current&&(t.current=e()),t.current}let jb="u">typeof window,jj=jb?v.useLayoutEffect:v.useEffect,jS=(0,v.createContext)(null);function jk(e){return"object"==typeof e&&null!==e}function jC(e){return jk(e)&&"offsetHeight"in e}var jT=v;let jE=(0,v.createContext)({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});function jI(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}class jP extends jT.Component{getSnapshotBeforeUpdate(e){let t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){let e=t.offsetParent,n=jC(e)&&e.offsetWidth||0,i=this.props.sizeRef.current;i.height=t.offsetHeight||0,i.width=t.offsetWidth||0,i.top=t.offsetTop,i.left=t.offsetLeft,i.right=n-i.width-i.left}return null}componentDidUpdate(){}render(){return this.props.children}}function jA({children:e,isPresent:t,anchorX:n,root:i}){let r=(0,jT.useId)(),a=(0,jT.useRef)(null),s=(0,jT.useRef)({width:0,height:0,top:0,left:0,right:0}),{nonce:o}=(0,jT.useContext)(jE),l=function(...e){return v.useCallback(function(...e){return t=>{let n=!1,i=e.map(e=>{let i=jI(e,t);return n||"function"!=typeof i||(n=!0),i});if(n)return()=>{for(let t=0;t<i.length;t++){let n=i[t];"function"==typeof n?n():jI(e[t],null)}}}}(...e),e)}(a,e.props?.ref??e?.ref);return(0,jT.useInsertionEffect)(()=>{let{width:e,height:l,top:u,left:d,right:c}=s.current;if(t||!a.current||!e||!l)return;let p="left"===n?`left: ${d}`:`right: ${c}`;a.current.dataset.motionPopId=r;let h=document.createElement("style");o&&(h.nonce=o);let m=i??document.head;return m.appendChild(h),h.sheet&&h.sheet.insertRule(`
          [data-motion-pop-id="${r}"] {
            position: absolute !important;
            width: ${e}px !important;
            height: ${l}px !important;
            ${p}px !important;
            top: ${u}px !important;
          }
        `),()=>{m.contains(h)&&m.removeChild(h)}},[t]),(0,jy.jsx)(jP,{isPresent:t,childRef:a,sizeRef:s,children:jT.cloneElement(e,{ref:l})})}let jR=({children:e,initial:t,isPresent:n,onExitComplete:i,custom:r,presenceAffectsLayout:a,mode:s,anchorX:o,root:l})=>{let u=jw(jD),d=(0,v.useId)(),c=!0,p=(0,v.useMemo)(()=>(c=!1,{id:d,initial:t,isPresent:n,custom:r,onExitComplete:e=>{for(let t of(u.set(e,!0),u.values()))if(!t)return;i&&i()},register:e=>(u.set(e,!1),()=>u.delete(e))}),[n,u,i]);return a&&c&&(p={...p}),(0,v.useMemo)(()=>{u.forEach((e,t)=>u.set(t,!1))},[n]),v.useEffect(()=>{n||u.size||!i||i()},[n]),"popLayout"===s&&(e=(0,jy.jsx)(jA,{isPresent:n,anchorX:o,root:l,children:e})),(0,jy.jsx)(jS.Provider,{value:p,children:e})};function jD(){return new Map}function jV(e=!0){let t=(0,v.useContext)(jS);if(null===t)return[!0,null];let{isPresent:n,onExitComplete:i,register:r}=t,a=(0,v.useId)();(0,v.useEffect)(()=>{if(e)return r(a)},[e]);let s=(0,v.useCallback)(()=>e&&i&&i(a),[a,i,e]);return!n&&i?[!1,s]:[!0]}let j_=e=>e.key||"";function jM(e){let t=[];return v.Children.forEach(e,e=>{(0,v.isValidElement)(e)&&t.push(e)}),t}let jF=({children:e,custom:t,initial:n=!0,onExitComplete:i,presenceAffectsLayout:r=!0,mode:a="sync",propagate:s=!1,anchorX:o="left",root:l})=>{let[u,d]=jV(s),c=(0,v.useMemo)(()=>jM(e),[e]),p=s&&!u?[]:c.map(j_),h=(0,v.useRef)(!0),m=(0,v.useRef)(c),f=jw(()=>new Map),g=(0,v.useRef)(new Set),[x,y]=(0,v.useState)(c),[w,b]=(0,v.useState)(c);jj(()=>{h.current=!1,m.current=c;for(let e=0;e<w.length;e++){let t=j_(w[e]);p.includes(t)?(f.delete(t),g.current.delete(t)):!0!==f.get(t)&&f.set(t,!1)}},[w,p.length,p.join("-")]);let j=[];if(c!==x){let e=[...c];for(let t=0;t<w.length;t++){let n=w[t],i=j_(n);p.includes(i)||(e.splice(t,0,n),j.push(n))}return"wait"===a&&j.length&&(e=j),b(jM(e)),y(c),null}let{forceRender:S}=(0,v.useContext)(jv);return(0,jy.jsx)(jy.Fragment,{children:w.map(e=>{let x=j_(e),y=(!s||!!u)&&(c===w||p.includes(x));return(0,jy.jsx)(jR,{isPresent:y,initial:(!h.current||!!n)&&void 0,custom:t,presenceAffectsLayout:r,mode:a,root:l,onExitComplete:y?void 0:()=>{if(g.current.has(x)||(g.current.add(x),!f.has(x)))return;f.set(x,!0);let e=!0;f.forEach(t=>{t||(e=!1)}),e&&(S?.(),b(m.current),s&&d?.(),i&&i())},anchorX:o,children:e},x)})})};class jO{constructor(e){this.isMounted=!1,this.node=e}update(){}}let jL=e=>e,jB=()=>({translate:0,scale:1,origin:0,originPoint:0}),jU=()=>({x:jB(),y:jB()}),jN=()=>({min:0,max:0}),jG=()=>({x:jN(),y:jN()}),j$={},jz=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function jW(e,t){let n=!1,i=!0,r={delta:0,timestamp:0,isProcessing:!1},a=()=>n=!0,s=jz.reduce((e,n)=>(e[n]=function(e,t){let n=new Set,i=new Set,r=!1,a=!1,s=new WeakSet,o={delta:0,timestamp:0,isProcessing:!1},l=0;function u(t){s.has(t)&&(d.schedule(t),e()),l++,t(o)}let d={schedule:(e,t=!1,a=!1)=>{let o=a&&r?n:i;return t&&s.add(e),o.has(e)||o.add(e),e},cancel:e=>{i.delete(e),s.delete(e)},process:e=>{if(o=e,r){a=!0;return}r=!0,[n,i]=[i,n],n.forEach(u),t,l=0,n.clear(),r=!1,a&&(a=!1,d.process(e))}};return d}(a,t?n:void 0),e),{}),{setup:o,read:l,resolveKeyframes:u,preUpdate:d,update:c,preRender:p,render:h,postRender:m}=s,f=()=>{let a=j$.useManualTiming?r.timestamp:performance.now();n=!1,j$.useManualTiming||(r.delta=i?1e3/60:Math.max(Math.min(a-r.timestamp,40),1)),r.timestamp=a,r.isProcessing=!0,o.process(r),l.process(r),u.process(r),d.process(r),c.process(r),p.process(r),h.process(r),m.process(r),r.isProcessing=!1,n&&t&&(i=!1,e(f))};return{schedule:jz.reduce((t,a)=>{let o=s[a];return t[a]=(t,a=!1,s=!1)=>(!n&&(n=!0,i=!0,r.isProcessing||e(f)),o.schedule(t,a,s)),t},{}),cancel:e=>{for(let t=0;t<jz.length;t++)s[jz[t]].cancel(e)},state:r,steps:s}}let{schedule:jH,cancel:jq,state:jK,steps:jY}=jW("u">typeof requestAnimationFrame?requestAnimationFrame:jL,!0);function jX(e){return[e("x"),e("y")]}function jQ({top:e,left:t,right:n,bottom:i}){return{x:{min:t,max:n},y:{min:e,max:i}}}let jZ=(e,t,n)=>e+(t-e)*n;function jJ(e){return void 0===e||1===e}function j0({scale:e,scaleX:t,scaleY:n}){return!jJ(e)||!jJ(t)||!jJ(n)}function j1(e){return j0(e)||j2(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function j2(e){var t,n;return(t=e.x)&&"0%"!==t||(n=e.y)&&"0%"!==n}function j5(e,t,n,i,r){return void 0!==r&&(e=i+r*(e-i)),i+n*(e-i)+t}function j4(e,t=0,n=1,i,r){e.min=j5(e.min,t,n,i,r),e.max=j5(e.max,t,n,i,r)}function j8(e,{x:t,y:n}){j4(e.x,t.translate,t.scale,t.originPoint),j4(e.y,n.translate,n.scale,n.originPoint)}function j3(e,t){e.min=e.min+t,e.max=e.max+t}function j6(e,t,n,i,r=.5){let a=jZ(e.min,e.max,r);j4(e,t,n,a,i)}function j9(e,t){j6(e.x,t.x,t.scaleX,t.scale,t.originX),j6(e.y,t.y,t.scaleY,t.scale,t.originY)}function j7(e,t){return jQ(function(e,t){if(!t)return e;let n=t({x:e.left,y:e.top}),i=t({x:e.right,y:e.bottom});return{top:n.y,left:n.x,bottom:i.y,right:i.x}}(e.getBoundingClientRect(),t))}let Se=e=>!!(e&&e.getVelocity);function St(e,t){let n=e.getValue("willChange");if(Se(n)&&n.add)return n.add(t);if(!n&&j$.WillChange){let n=new j$.WillChange("auto");e.addValue("willChange",n),n.add(t)}}let Sn=e=>1e3*e;function Si(){t=void 0}let Sr={now:()=>(void 0===t&&Sr.set(jK.isProcessing||j$.useManualTiming?jK.timestamp:performance.now()),t),set:e=>{t=e,queueMicrotask(Si)}},Sa=(e,t)=>n=>t(e(n)),Ss=(...e)=>e.reduce(Sa),So=(e,t,n)=>n>t?t:n<e?e:n,Sl={layout:0,mainThread:0,waapi:0},Su=()=>{},Sd=()=>{};s6.default;let Sc=e=>t=>"string"==typeof t&&t.startsWith(e),Sp=Sc("--"),Sh=Sc("var(--"),Sm=e=>!!Sh(e)&&Sf.test(e.split("/*")[0].trim()),Sf=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu;function Sg(e){return"string"==typeof e&&e.split("/*")[0].includes("var(--")}let Sx={test:e=>"number"==typeof e,parse:parseFloat,transform:e=>e},Sy={...Sx,transform:e=>So(0,1,e)},Sv={...Sx,default:1},Sw=e=>Math.round(1e5*e)/1e5,Sb=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu,Sj=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,SS=(e,t)=>n=>!!("string"==typeof n&&Sj.test(n)&&n.startsWith(e)||t&&null!=n&&Object.prototype.hasOwnProperty.call(n,t)),Sk=(e,t,n)=>i=>{if("string"!=typeof i)return i;let[r,a,s,o]=i.match(Sb);return{[e]:parseFloat(r),[t]:parseFloat(a),[n]:parseFloat(s),alpha:void 0!==o?parseFloat(o):1}},SC={...Sx,transform:e=>Math.round(So(0,255,e))},ST={test:SS("rgb","red"),parse:Sk("red","green","blue"),transform:({red:e,green:t,blue:n,alpha:i=1})=>"rgba("+SC.transform(e)+", "+SC.transform(t)+", "+SC.transform(n)+", "+Sw(Sy.transform(i))+")"},SE={test:SS("#"),parse:function(e){let t="",n="",i="",r="";return e.length>5?(t=e.substring(1,3),n=e.substring(3,5),i=e.substring(5,7),r=e.substring(7,9)):(t=e.substring(1,2),n=e.substring(2,3),i=e.substring(3,4),r=e.substring(4,5),t+=t,n+=n,i+=i,r+=r),{red:parseInt(t,16),green:parseInt(n,16),blue:parseInt(i,16),alpha:r?parseInt(r,16)/255:1}},transform:ST.transform},SI=e=>({test:t=>"string"==typeof t&&t.endsWith(e)&&1===t.split(" ").length,parse:parseFloat,transform:t=>`${t}${e}`}),SP=SI("deg"),SA=SI("%"),SR=SI("px"),SD=SI("vh"),SV=SI("vw"),S_={...SA,parse:e=>SA.parse(e)/100,transform:e=>SA.transform(100*e)},SM={test:SS("hsl","hue"),parse:Sk("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:n,alpha:i=1})=>"hsla("+Math.round(e)+", "+SA.transform(Sw(t))+", "+SA.transform(Sw(n))+", "+Sw(Sy.transform(i))+")"},SF={test:e=>ST.test(e)||SE.test(e)||SM.test(e),parse:e=>ST.test(e)?ST.parse(e):SM.test(e)?SM.parse(e):SE.parse(e),transform:e=>"string"==typeof e?e:e.hasOwnProperty("red")?ST.transform(e):SM.transform(e),getAnimatableNone:e=>{let t=SF.parse(e);return t.alpha=0,SF.transform(t)}},SO=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu,SL="number",SB="color",SU=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function SN(e){let t=e.toString(),n=[],i={color:[],number:[],var:[]},r=[],a=0,s=t.replace(SU,e=>(SF.test(e)?(i.color.push(a),r.push(SB),n.push(SF.parse(e))):e.startsWith("var(")?(i.var.push(a),r.push("var"),n.push(e)):(i.number.push(a),r.push(SL),n.push(parseFloat(e))),++a,"${}")).split("${}");return{values:n,split:s,indexes:i,types:r}}function SG(e){return SN(e).values}function S$(e){let{split:t,types:n}=SN(e),i=t.length;return e=>{let r="";for(let a=0;a<i;a++)if(r+=t[a],void 0!==e[a]){let t=n[a];t===SL?r+=Sw(e[a]):t===SB?r+=SF.transform(e[a]):r+=e[a]}return r}}let Sz=e=>"number"==typeof e?0:SF.test(e)?SF.getAnimatableNone(e):e,SW={test:function(e){return isNaN(e)&&"string"==typeof e&&(e.match(Sb)?.length||0)+(e.match(SO)?.length||0)>0},parse:SG,createTransformer:S$,getAnimatableNone:function(e){let t=SG(e);return S$(e)(t.map(Sz))}};function SH(e,t,n){return(n<0&&(n+=1),n>1&&(n-=1),n<1/6)?e+(t-e)*6*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function Sq(e,t){return n=>n>0?t:e}let SK=(e,t,n)=>{let i=e*e,r=n*(t*t-i)+i;return r<0?0:Math.sqrt(r)},SY=[SE,ST,SM];function SX(e){let t=SY.find(t=>t.test(e));if(Su(!!t,`'${e}' is not an animatable color. Use the equivalent color code instead.`,"color-not-animatable"),!t)return!1;let n=t.parse(e);return t===SM&&(n=function({hue:e,saturation:t,lightness:n,alpha:i}){e/=360,n/=100;let r=0,a=0,s=0;if(t/=100){let i=n<.5?n*(1+t):n+t-n*t,o=2*n-i;r=SH(o,i,e+1/3),a=SH(o,i,e),s=SH(o,i,e-1/3)}else r=a=s=n;return{red:Math.round(255*r),green:Math.round(255*a),blue:Math.round(255*s),alpha:i}}(n)),n}let SQ=(e,t)=>{let n=SX(e),i=SX(t);if(!n||!i)return Sq(e,t);let r={...n};return e=>(r.red=SK(n.red,i.red,e),r.green=SK(n.green,i.green,e),r.blue=SK(n.blue,i.blue,e),r.alpha=jZ(n.alpha,i.alpha,e),ST.transform(r))},SZ=new Set(["none","hidden"]);function SJ(e,t){return n=>jZ(e,t,n)}function S0(e){return"number"==typeof e?SJ:"string"==typeof e?Sm(e)?Sq:SF.test(e)?SQ:S5:Array.isArray(e)?S1:"object"==typeof e?SF.test(e)?SQ:S2:Sq}function S1(e,t){let n=[...e],i=n.length,r=e.map((e,n)=>S0(e)(e,t[n]));return e=>{for(let t=0;t<i;t++)n[t]=r[t](e);return n}}function S2(e,t){let n={...e,...t},i={};for(let r in n)void 0!==e[r]&&void 0!==t[r]&&(i[r]=S0(e[r])(e[r],t[r]));return e=>{for(let t in i)n[t]=i[t](e);return n}}let S5=(e,t)=>{let n=SW.createTransformer(t),i=SN(e),r=SN(t);if(!(i.indexes.var.length===r.indexes.var.length&&i.indexes.color.length===r.indexes.color.length&&i.indexes.number.length>=r.indexes.number.length))return Su(!0,`Complex values '${e}' and '${t}' too different to mix. Ensure all colors are of the same type, and that each contains the same quantity of number and color values. Falling back to instant transition.`,"complex-values-different"),Sq(e,t);if(SZ.has(e)&&!r.values.length||SZ.has(t)&&!i.values.length)return SZ.has(e)?n=>n<=0?e:t:n=>n>=1?t:e;return Ss(S1(function(e,t){let n=[],i={color:0,var:0,number:0};for(let r=0;r<t.values.length;r++){let a=t.types[r],s=e.indexes[a][i[a]],o=e.values[s]??0;n[r]=o,i[a]++}return n}(i,r),r.values),n)};function S4(e,t,n){return"number"==typeof e&&"number"==typeof t&&"number"==typeof n?jZ(e,t,n):S0(e)(e,t)}let S8=e=>{let t=({timestamp:t})=>e(t);return{start:(e=!0)=>jH.update(t,e),stop:()=>jq(t),now:()=>jK.isProcessing?jK.timestamp:Sr.now()}},S3=(e,t,n=10)=>{let i="",r=Math.max(Math.round(t/n),2);for(let t=0;t<r;t++)i+=Math.round(1e4*e(t/(r-1)))/1e4+", ";return`linear(${i.substring(0,i.length-2)})`};function S6(e){let t=0,n=e.next(t);for(;!n.done&&t<2e4;)t+=50,n=e.next(t);return t>=2e4?1/0:t}function S9(e,t,n){var i,r;let a=Math.max(t-5,0);return i=n-e(a),(r=t-a)?1e3/r*i:0}let S7=.01,ke=2,kt=.005,kn=.5;function ki(e,t){return e*Math.sqrt(1-t*t)}let kr=["duration","bounce"],ka=["stiffness","damping","mass"];function ks(e,t){return t.some(t=>void 0!==e[t])}function ko(e=.3,t=.3){let n,i="object"!=typeof e?{visualDuration:e,keyframes:[0,1],bounce:t}:e,{restSpeed:r,restDelta:a}=i,s=i.keyframes[0],o=i.keyframes[i.keyframes.length-1],l={done:!1,value:s},{stiffness:u,damping:d,mass:c,duration:p,velocity:h,isResolvedFromDuration:m}=function(e){let t={velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1,...e};if(!ks(e,ka)&&ks(e,kr))if(e.visualDuration){let n=2*Math.PI/(1.2*e.visualDuration),i=n*n,r=2*So(.05,1,1-(e.bounce||0))*Math.sqrt(i);t={...t,mass:1,stiffness:i,damping:r}}else{let n=function({duration:e=800,bounce:t=.3,velocity:n=0,mass:i=1}){let r,a;Su(e<=Sn(10),"Spring duration must be 10 seconds or less","spring-duration-limit");let s=1-t;s=So(.05,1,s),e=So(.01,10,e/1e3),s<1?(r=t=>{let i=t*s,r=i*e;return .001-(i-n)/ki(t,s)*Math.exp(-r)},a=t=>{let i=t*s*e,a=Math.pow(s,2)*Math.pow(t,2)*e,o=Math.exp(-i),l=ki(Math.pow(t,2),s);return(i*n+n-a)*o*(-r(t)+.001>0?-1:1)/l}):(r=t=>-.001+Math.exp(-t*e)*((t-n)*e+1),a=t=>e*e*(n-t)*Math.exp(-t*e));let o=function(e,t,n){let i=n;for(let n=1;n<12;n++)i-=e(i)/t(i);return i}(r,a,5/e);if(e=Sn(e),isNaN(o))return{stiffness:100,damping:10,duration:e};{let t=Math.pow(o,2)*i;return{stiffness:t,damping:2*s*Math.sqrt(i*t),duration:e}}}(e);(t={...t,...n,mass:1}).isResolvedFromDuration=!0}return t}({...i,velocity:-((i.velocity||0)/1e3)}),f=h||0,g=d/(2*Math.sqrt(u*c)),x=o-s,y=Math.sqrt(u/c)/1e3,v=5>Math.abs(x);if(r||(r=v?S7:ke),a||(a=v?kt:kn),g<1){let e=ki(y,g);n=t=>o-Math.exp(-g*y*t)*((f+g*y*x)/e*Math.sin(e*t)+x*Math.cos(e*t))}else if(1===g)n=e=>o-Math.exp(-y*e)*(x+(f+y*x)*e);else{let e=y*Math.sqrt(g*g-1);n=t=>{let n=Math.exp(-g*y*t),i=Math.min(e*t,300);return o-n*((f+g*y*x)*Math.sinh(i)+e*x*Math.cosh(i))/e}}let w={calculatedDuration:m&&p||null,next:e=>{let t=n(e);if(m)l.done=e>=p;else{let i=0===e?f:0;g<1&&(i=0===e?Sn(f):S9(n,e,t));let s=Math.abs(o-t)<=a;l.done=Math.abs(i)<=r&&s}return l.value=l.done?o:t,l},toString:()=>{let e=Math.min(S6(w),2e4),t=S3(t=>w.next(e*t).value,e,30);return e+"ms "+t},toTransition:()=>{}};return w}function kl({keyframes:e,velocity:t=0,power:n=.8,timeConstant:i=325,bounceDamping:r=10,bounceStiffness:a=500,modifyTarget:s,min:o,max:l,restDelta:u=.5,restSpeed:d}){let c,p,h=e[0],m={done:!1,value:h},f=n*t,g=h+f,x=void 0===s?g:s(g);x!==g&&(f=x-h);let y=e=>-f*Math.exp(-e/i),v=e=>x+y(e),w=e=>{let t=y(e),n=v(e);m.done=Math.abs(t)<=u,m.value=m.done?x:n},b=e=>{let t;if(t=m.value,void 0!==o&&t<o||void 0!==l&&t>l){var n;c=e,p=ko({keyframes:[m.value,(n=m.value,void 0===o?l:void 0===l||Math.abs(o-n)<Math.abs(l-n)?o:l)],velocity:S9(v,e,m.value),damping:r,stiffness:a,restDelta:u,restSpeed:d})}};return b(0),{calculatedDuration:null,next:e=>{let t=!1;return(p||void 0!==c||(t=!0,w(e),b(e)),void 0!==c&&e>=c)?p.next(e-c):(t||w(e),m)}}}ko.applyToOptions=e=>{let t=function(e,t=100,n){let i=n({...e,keyframes:[0,t]}),r=Math.min(S6(i),2e4);return{type:"keyframes",ease:e=>i.next(r*e).value/t,duration:r/1e3}}(e,100,ko);return e.ease=t.ease,e.duration=Sn(t.duration),e.type="keyframes",e};let ku=(e,t,n)=>(((1-3*n+3*t)*e+(3*n-6*t))*e+3*t)*e;function kd(e,t,n,i){return e===t&&n===i?jL:r=>0===r||1===r?r:ku(function(e,t,n,i,r){let a,s,o=0;do(a=ku(s=t+(n-t)/2,i,r)-e)>0?n=s:t=s;while(Math.abs(a)>1e-7&&++o<12)return s}(r,0,1,e,n),t,i)}let kc=kd(.42,0,1,1),kp=kd(0,0,.58,1),kh=kd(.42,0,.58,1),km=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,kf=e=>t=>1-e(1-t),kg=kd(.33,1.53,.69,.99),kx=kf(kg),ky=km(kx),kv=e=>(e*=2)<1?.5*kx(e):.5*(2-Math.pow(2,-10*(e-1))),kw=e=>1-Math.sin(Math.acos(e)),kb=kf(kw),kj=km(kw),kS=e=>Array.isArray(e)&&"number"==typeof e[0],kk={linear:jL,easeIn:kc,easeInOut:kh,easeOut:kp,circIn:kw,circInOut:kj,circOut:kb,backIn:kx,backInOut:ky,backOut:kg,anticipate:kv},kC=e=>{if(kS(e)){Sd(4===e.length,"Cubic bezier arrays must contain four numerical values.","cubic-bezier-length");let[t,n,i,r]=e;return kd(t,n,i,r)}return"string"==typeof e?(Sd(void 0!==kk[e],`Invalid easing type '${e}'`,"invalid-easing-type"),kk[e]):e},kT=(e,t,n)=>{let i=t-e;return 0===i?1:(n-e)/i};function kE({duration:e=300,keyframes:t,times:n,ease:i="easeInOut"}){var r;let a,s=Array.isArray(i)&&"number"!=typeof i[0]?i.map(kC):kC(i),o={done:!1,value:t[0]},l=function(e,t,{clamp:n=!0,ease:i,mixer:r}={}){let a=e.length;if(Sd(a===t.length,"Both input and output ranges must be the same length","range-length"),1===a)return()=>t[0];if(2===a&&t[0]===t[1])return()=>t[1];let s=e[0]===e[1];e[0]>e[a-1]&&(e=[...e].reverse(),t=[...t].reverse());let o=function(e,t,n){let i=[],r=n||j$.mix||S4,a=e.length-1;for(let n=0;n<a;n++){let a=r(e[n],e[n+1]);t&&(a=Ss(Array.isArray(t)?t[n]||jL:t,a)),i.push(a)}return i}(t,i,r),l=o.length,u=n=>{if(s&&n<e[0])return t[0];let i=0;if(l>1)for(;i<e.length-2&&!(n<e[i+1]);i++);let r=kT(e[i],e[i+1],n);return o[i](r)};return n?t=>u(So(e[0],e[a-1],t)):u}((r=n&&n.length===t.length?n:(!function(e,t){let n=e[e.length-1];for(let i=1;i<=t;i++){let r=kT(0,t,i);e.push(jZ(n,1,r))}}(a=[0],t.length-1),a),r.map(t=>t*e)),t,{ease:Array.isArray(s)?s:t.map(()=>s||kh).splice(0,t.length-1)});return{calculatedDuration:e,next:t=>(o.value=l(t),o.done=t>=e,o)}}let kI=e=>null!==e;function kP(e,{repeat:t,repeatType:n="loop"},i,r=1){let a=e.filter(kI),s=r<0||t&&"loop"!==n&&t%2==1?0:a.length-1;return s&&void 0!==i?i:a[s]}let kA={decay:kl,inertia:kl,tween:kE,keyframes:kE,spring:ko};function kR(e){"string"==typeof e.type&&(e.type=kA[e.type])}class kD{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,t){return this.finished.then(e,t)}}let kV=e=>e/100;class k_ extends kD{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{let{motionValue:e}=this.options;e&&e.updatedAt!==Sr.now()&&this.tick(Sr.now()),this.isStopped=!0,"idle"!==this.state&&(this.teardown(),this.options.onStop?.())},Sl.mainThread++,this.options=e,this.initAnimation(),this.play(),!1===e.autoplay&&this.pause()}initAnimation(){let{options:e}=this;kR(e);let{type:t=kE,repeat:n=0,repeatDelay:i=0,repeatType:r,velocity:a=0}=e,{keyframes:s}=e,o=t||kE;o!==kE&&"number"!=typeof s[0]&&(this.mixKeyframes=Ss(kV,S4(s[0],s[1])),s=[0,100]);let l=o({...e,keyframes:s});"mirror"===r&&(this.mirroredGenerator=o({...e,keyframes:[...s].reverse(),velocity:-a})),null===l.calculatedDuration&&(l.calculatedDuration=S6(l));let{calculatedDuration:u}=l;this.calculatedDuration=u,this.resolvedDuration=u+i,this.totalDuration=this.resolvedDuration*(n+1)-i,this.generator=l}updateTime(e){let t=Math.round(e-this.startTime)*this.playbackSpeed;null!==this.holdTime?this.currentTime=this.holdTime:this.currentTime=t}tick(e,t=!1){let{generator:n,totalDuration:i,mixKeyframes:r,mirroredGenerator:a,resolvedDuration:s,calculatedDuration:o}=this;if(null===this.startTime)return n.next(0);let{delay:l=0,keyframes:u,repeat:d,repeatType:c,repeatDelay:p,type:h,onUpdate:m,finalKeyframe:f}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-i/this.speed,this.startTime)),t?this.currentTime=e:this.updateTime(e);let g=this.currentTime-l*(this.playbackSpeed>=0?1:-1),x=this.playbackSpeed>=0?g<0:g>i;this.currentTime=Math.max(g,0),"finished"===this.state&&null===this.holdTime&&(this.currentTime=i);let y=this.currentTime,v=n;if(d){let e=Math.min(this.currentTime,i)/s,t=Math.floor(e),n=e%1;!n&&e>=1&&(n=1),1===n&&t--,(t=Math.min(t,d+1))%2&&("reverse"===c?(n=1-n,p&&(n-=p/s)):"mirror"===c&&(v=a)),y=So(0,1,n)*s}let w=x?{done:!1,value:u[0]}:v.next(y);r&&(w.value=r(w.value));let{done:b}=w;x||null===o||(b=this.playbackSpeed>=0?this.currentTime>=i:this.currentTime<=0);let j=null===this.holdTime&&("finished"===this.state||"running"===this.state&&b);return j&&h!==kl&&(w.value=kP(u,this.options,f,this.speed)),m&&m(w.value),j&&this.finish(),w}then(e,t){return this.finished.then(e,t)}get duration(){return this.calculatedDuration/1e3}get iterationDuration(){let{delay:e=0}=this.options||{};return this.duration+e/1e3}get time(){return this.currentTime/1e3}set time(e){e=Sn(e),this.currentTime=e,null===this.startTime||null!==this.holdTime||0===this.playbackSpeed?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(Sr.now());let t=this.playbackSpeed!==e;this.playbackSpeed=e,t&&(this.time=this.currentTime/1e3)}play(){if(this.isStopped)return;let{driver:e=S8,startTime:t}=this.options;this.driver||(this.driver=e(e=>this.tick(e))),this.options.onPlay?.();let n=this.driver.now();"finished"===this.state?(this.updateFinished(),this.startTime=n):null!==this.holdTime?this.startTime=n-this.holdTime:this.startTime||(this.startTime=t??n),"finished"===this.state&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(Sr.now()),this.holdTime=this.currentTime}complete(){"running"!==this.state&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null,Sl.mainThread--}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),e.observe(this)}}let kM=e=>180*e/Math.PI,kF=e=>kL(kM(Math.atan2(e[1],e[0]))),kO={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:e=>(Math.abs(e[0])+Math.abs(e[3]))/2,rotate:kF,rotateZ:kF,skewX:e=>kM(Math.atan(e[1])),skewY:e=>kM(Math.atan(e[2])),skew:e=>(Math.abs(e[1])+Math.abs(e[2]))/2},kL=e=>((e%=360)<0&&(e+=360),e),kB=e=>Math.sqrt(e[0]*e[0]+e[1]*e[1]),kU=e=>Math.sqrt(e[4]*e[4]+e[5]*e[5]),kN={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:kB,scaleY:kU,scale:e=>(kB(e)+kU(e))/2,rotateX:e=>kL(kM(Math.atan2(e[6],e[5]))),rotateY:e=>kL(kM(Math.atan2(-e[2],e[0]))),rotateZ:kF,rotate:kF,skewX:e=>kM(Math.atan(e[4])),skewY:e=>kM(Math.atan(e[1])),skew:e=>(Math.abs(e[1])+Math.abs(e[4]))/2};function kG(e){return+!!e.includes("scale")}function k$(e,t){let n,i;if(!e||"none"===e)return kG(t);let r=e.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);if(r)n=kN,i=r;else{let t=e.match(/^matrix\(([-\d.e\s,]+)\)$/u);n=kO,i=t}if(!i)return kG(t);let a=n[t],s=i[1].split(",").map(kz);return"function"==typeof a?a(s):s[a]}function kz(e){return parseFloat(e.trim())}let kW=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],kH=new Set(kW),kq=e=>e===Sx||e===SR,kK=new Set(["x","y","z"]),kY=kW.filter(e=>!kK.has(e)),kX={width:({x:e},{paddingLeft:t="0",paddingRight:n="0"})=>e.max-e.min-parseFloat(t)-parseFloat(n),height:({y:e},{paddingTop:t="0",paddingBottom:n="0"})=>e.max-e.min-parseFloat(t)-parseFloat(n),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:(e,{transform:t})=>k$(t,"x"),y:(e,{transform:t})=>k$(t,"y")};kX.translateX=kX.x,kX.translateY=kX.y;let kQ=new Set,kZ=!1,kJ=!1,k0=!1;function k1(){if(kJ){let e=Array.from(kQ).filter(e=>e.needsMeasurement),t=new Set(e.map(e=>e.element)),n=new Map;t.forEach(e=>{let t,i=(t=[],kY.forEach(n=>{let i=e.getValue(n);void 0!==i&&(t.push([n,i.get()]),i.set(+!!n.startsWith("scale")))}),t);i.length&&(n.set(e,i),e.render())}),e.forEach(e=>e.measureInitialState()),t.forEach(e=>{e.render();let t=n.get(e);t&&t.forEach(([t,n])=>{e.getValue(t)?.set(n)})}),e.forEach(e=>e.measureEndState()),e.forEach(e=>{void 0!==e.suspendedScrollY&&window.scrollTo(0,e.suspendedScrollY)})}kJ=!1,kZ=!1,kQ.forEach(e=>e.complete(k0)),kQ.clear()}function k2(){kQ.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(kJ=!0)})}class k5{constructor(e,t,n,i,r,a=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=t,this.name=n,this.motionValue=i,this.element=r,this.isAsync=a}scheduleResolve(){this.state="scheduled",this.isAsync?(kQ.add(this),kZ||(kZ=!0,jH.read(k2),jH.resolveKeyframes(k1))):(this.readKeyframes(),this.complete())}readKeyframes(){let{unresolvedKeyframes:e,name:t,element:n,motionValue:i}=this;if(null===e[0]){let r=i?.get(),a=e[e.length-1];if(void 0!==r)e[0]=r;else if(n&&t){let i=n.readValue(t,a);null!=i&&(e[0]=i)}void 0===e[0]&&(e[0]=a),i&&void 0===r&&i.set(e[0])}for(let t=1;t<e.length;t++)e[t]??(e[t]=e[t-1])}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),kQ.delete(this)}cancel(){"scheduled"===this.state&&(kQ.delete(this),this.state="pending")}resume(){"pending"===this.state&&this.scheduleResolve()}}function k4(e){let t;return()=>(void 0===t&&(t=e()),t)}let k8=k4(()=>void 0!==window.ScrollTimeline),k3={},k6=(n=k4(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch(e){return!1}return!0}),()=>k3.linearEasing??n()),k9=([e,t,n,i])=>`cubic-bezier(${e}, ${t}, ${n}, ${i})`,k7={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:k9([0,.65,.55,1]),circOut:k9([.55,0,1,.45]),backIn:k9([.31,.01,.66,-.59]),backOut:k9([.33,1.53,.69,.99])};function Ce(e){return"function"==typeof e&&"applyToOptions"in e}class Ct extends kD{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,this.manualStartTime=null,!e)return;const{element:t,name:n,keyframes:i,pseudoElement:r,allowFlatten:a=!1,finalKeyframe:s,onComplete:o}=e;this.isPseudoElement=!!r,this.allowFlatten=a,this.options=e,Sd("string"!=typeof e.type,'Mini animate() doesn\'t support "type" as a string.',"mini-spring");const l=function({type:e,...t}){return Ce(e)&&k6()?e.applyToOptions(t):(t.duration??(t.duration=300),t.ease??(t.ease="easeOut"),t)}(e);this.animation=function(e,t,n,{delay:i=0,duration:r=300,repeat:a=0,repeatType:s="loop",ease:o="easeOut",times:l}={},u){let d={[t]:n};l&&(d.offset=l);let c=function e(t,n){if(t)return"function"==typeof t?k6()?S3(t,n):"ease-out":kS(t)?k9(t):Array.isArray(t)?t.map(t=>e(t,n)||k7.easeOut):k7[t]}(o,r);Array.isArray(c)&&(d.easing=c);let p={delay:i,duration:r,easing:Array.isArray(c)?"linear":c,fill:"both",iterations:a+1,direction:"reverse"===s?"alternate":"normal"};u&&(p.pseudoElement=u);let h=e.animate(d,p);return h}(t,n,i,l,r),!1===l.autoplay&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!r){let e=kP(i,this.options,s,this.speed);this.updateMotionValue?this.updateMotionValue(e):n.startsWith("--")?t.style.setProperty(n,e):t.style[n]=e,this.animation.cancel()}o?.(),this.notifyFinished()}}play(){this.isStopped||(this.manualStartTime=null,this.animation.play(),"finished"===this.state&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch(e){}}stop(){if(this.isStopped)return;this.isStopped=!0;let{state:e}=this;"idle"!==e&&"finished"!==e&&(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){return Number(this.animation.effect?.getComputedTiming?.().duration||0)/1e3}get iterationDuration(){let{delay:e=0}=this.options||{};return this.duration+e/1e3}get time(){return(Number(this.animation.currentTime)||0)/1e3}set time(e){this.manualStartTime=null,this.finishedTime=null,this.animation.currentTime=Sn(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return null!==this.finishedTime?"finished":this.animation.playState}get startTime(){return this.manualStartTime??Number(this.animation.startTime)}set startTime(e){this.manualStartTime=this.animation.startTime=e}attachTimeline({timeline:e,observe:t}){return(this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,e&&k8())?(this.animation.timeline=e,jL):t(this)}}let Cn={anticipate:kv,backInOut:ky,circInOut:kj};class Ci extends Ct{constructor(e){!function(e){"string"==typeof e.ease&&e.ease in Cn&&(e.ease=Cn[e.ease])}(e),kR(e),super(e),void 0!==e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){let{motionValue:t,onUpdate:n,onComplete:i,element:r,...a}=this.options;if(!t)return;if(void 0!==e)return void t.set(e);let s=new k_({...a,autoplay:!1}),o=Math.max(10,Sr.now()-this.startTime),l=So(0,10,o-10);t.setWithVelocity(s.sample(Math.max(0,o-l)).value,s.sample(o).value,l),s.stop()}}let Cr=(e,t)=>"zIndex"!==t&&!!("number"==typeof e||Array.isArray(e)||"string"==typeof e&&(SW.test(e)||"0"===e)&&!e.startsWith("url("));function Ca(e){e.duration=0,e.type="keyframes"}let Cs=new Set(["opacity","clipPath","filter","transform"]),Co=k4(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));class Cl extends kD{constructor({autoplay:e=!0,delay:t=0,type:n="keyframes",repeat:i=0,repeatDelay:r=0,repeatType:a="loop",keyframes:s,name:o,motionValue:l,element:u,...d}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=Sr.now();const c={autoplay:e,delay:t,type:n,repeat:i,repeatDelay:r,repeatType:a,name:o,motionValue:l,element:u,...d},p=u?.KeyframeResolver||k5;this.keyframeResolver=new p(s,(e,t,n)=>this.onKeyframesResolved(e,t,c,!n),o,l,u),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(e,t,n,i){this.keyframeResolver=void 0;let{name:r,type:a,velocity:s,delay:o,isHandoff:l,onUpdate:u}=n;this.resolvedAt=Sr.now(),!function(e,t,n,i){let r=e[0];if(null===r)return!1;if("display"===t||"visibility"===t)return!0;let a=e[e.length-1],s=Cr(r,t),o=Cr(a,t);return Su(s===o,`You are trying to animate ${t} from "${r}" to "${a}". "${s?a:r}" is not an animatable value.`,"value-not-animatable"),!!s&&!!o&&(function(e){let t=e[0];if(1===e.length)return!0;for(let n=0;n<e.length;n++)if(e[n]!==t)return!0}(e)||("spring"===n||Ce(n))&&i)}(e,r,a,s)&&((j$.instantAnimations||!o)&&u?.(kP(e,n,t)),e[0]=e[e.length-1],Ca(n),n.repeat=0);let d={startTime:i?this.resolvedAt&&this.resolvedAt-this.createdAt>40?this.resolvedAt:this.createdAt:void 0,finalKeyframe:t,...n,keyframes:e},c=!l&&function(e){let{motionValue:t,name:n,repeatDelay:i,repeatType:r,damping:a,type:s}=e;if(!(t?.owner?.current instanceof HTMLElement))return!1;let{onUpdate:o,transformTemplate:l}=t.owner.getProps();return Co()&&n&&Cs.has(n)&&("transform"!==n||!l)&&!o&&!i&&"mirror"!==r&&0!==a&&"inertia"!==s}(d)?new Ci({...d,element:d.motionValue.owner.current}):new k_(d);c.finished.then(()=>this.notifyFinished()).catch(jL),this.pendingTimeline&&(this.stopTimeline=c.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=c}get finished(){return this._animation?this.animation.finished:this._finished}then(e,t){return this.finished.finally(e).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),k0=!0,k2(),k1(),k0=!1),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}function Cu(e,t){return e?.[t]??e?.default??e}let Cd={type:"spring",stiffness:500,damping:25,restSpeed:10},Cc={type:"keyframes",duration:.8},Cp={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},Ch=e=>null!==e,Cm=(e,t,n,i={},r,a)=>s=>{let o=Cu(i,e)||{},l=o.delay||i.delay||0,{elapsed:u=0}=i;u-=Sn(l);let d={keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:t.getVelocity(),...o,delay:-u,onUpdate:e=>{t.set(e),o.onUpdate&&o.onUpdate(e)},onComplete:()=>{s(),o.onComplete&&o.onComplete()},name:e,motionValue:t,element:a?void 0:r};!function({when:e,delay:t,delayChildren:n,staggerChildren:i,staggerDirection:r,repeat:a,repeatType:s,repeatDelay:o,from:l,elapsed:u,...d}){return!!Object.keys(d).length}(o)&&Object.assign(d,((e,{keyframes:t})=>t.length>2?Cc:kH.has(e)?e.startsWith("scale")?{type:"spring",stiffness:550,damping:0===t[1]?2*Math.sqrt(550):30,restSpeed:10}:Cd:Cp)(e,d)),d.duration&&(d.duration=Sn(d.duration)),d.repeatDelay&&(d.repeatDelay=Sn(d.repeatDelay)),void 0!==d.from&&(d.keyframes[0]=d.from);let c=!1;if(!1!==d.type&&(0!==d.duration||d.repeatDelay)||(Ca(d),0===d.delay&&(c=!0)),(j$.instantAnimations||j$.skipAnimations)&&(c=!0,Ca(d),d.delay=0),d.allowFlatten=!o.type&&!o.ease,c&&!a&&void 0!==t.get()){let e=function(e,{repeat:t,repeatType:n="loop"},i){let r=e.filter(Ch),a=t&&"loop"!==n&&t%2==1?0:r.length-1;return r[a]}(d.keyframes,o);if(void 0!==e)return void jH.update(()=>{d.onUpdate(e),d.onComplete()})}return o.isSync?new k_(d):new Cl(d)},Cf=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function Cg(e){return Cf.has(e.tagName)||!0===e.isContentEditable}function Cx(e,t,n,i={passive:!0}){return e.addEventListener(t,n,i),()=>e.removeEventListener(t,n)}let Cy={x:!1,y:!1};function Cv(e){return e.max-e.min}function Cw(e,t,n,i=.5){e.origin=i,e.originPoint=jZ(t.min,t.max,e.origin),e.scale=Cv(n)/Cv(t),e.translate=jZ(n.min,n.max,e.origin)-e.originPoint,(e.scale>=.9999&&e.scale<=1.0001||isNaN(e.scale))&&(e.scale=1),(e.translate>=-.01&&e.translate<=.01||isNaN(e.translate))&&(e.translate=0)}function Cb(e,t,n,i){Cw(e.x,t.x,n.x,i?i.originX:void 0),Cw(e.y,t.y,n.y,i?i.originY:void 0)}function Cj(e,t,n){e.min=n.min+t.min,e.max=e.min+Cv(t)}function CS(e,t,n){e.min=t.min-n.min,e.max=e.min+Cv(t)}function Ck(e,t,n){CS(e.x,t.x,n.x),CS(e.y,t.y,n.y)}let CC=e=>"mouse"===e.pointerType?"number"!=typeof e.button||e.button<=0:!1!==e.isPrimary;function CT(e){return{point:{x:e.pageX,y:e.pageY}}}function CE(e,t,n,i){return Cx(e,t,e=>CC(e)&&n(e,CT(e)),i)}let CI=({current:e})=>e?e.ownerDocument.defaultView:null;function CP(e){return e&&"object"==typeof e&&Object.prototype.hasOwnProperty.call(e,"current")}let CA=(e,t)=>Math.abs(e-t),CR=new Set(["auto","scroll"]);class CD{constructor(e,t,{transformPagePoint:n,contextWindow:i=window,dragSnapToOrigin:r=!1,distanceThreshold:a=3,element:s}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.scrollPositions=new Map,this.removeScrollListeners=null,this.onElementScroll=e=>{this.handleScroll(e.target)},this.onWindowScroll=()=>{this.handleScroll(window)},this.updatePoint=()=>{var e,t;if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;let n=CM(this.lastMoveEventInfo,this.history),i=null!==this.startEvent,r=(e=n.offset,t={x:0,y:0},Math.sqrt(CA(e.x,t.x)**2+CA(e.y,t.y)**2)>=this.distanceThreshold);if(!i&&!r)return;let{point:a}=n,{timestamp:s}=jK;this.history.push({...a,timestamp:s});let{onStart:o,onMove:l}=this.handlers;i||(o&&o(this.lastMoveEvent,n),this.startEvent=this.lastMoveEvent),l&&l(this.lastMoveEvent,n)},this.handlePointerMove=(e,t)=>{this.lastMoveEvent=e,this.lastMoveEventInfo=CV(t,this.transformPagePoint),jH.update(this.updatePoint,!0)},this.handlePointerUp=(e,t)=>{this.end();let{onEnd:n,onSessionEnd:i,resumeAnimation:r}=this.handlers;if((this.dragSnapToOrigin||!this.startEvent)&&r&&r(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;let a=CM("pointercancel"===e.type?this.lastMoveEventInfo:CV(t,this.transformPagePoint),this.history);this.startEvent&&n&&n(e,a),i&&i(e,a)},!CC(e))return;this.dragSnapToOrigin=r,this.handlers=t,this.transformPagePoint=n,this.distanceThreshold=a,this.contextWindow=i||window;const o=CV(CT(e),this.transformPagePoint),{point:l}=o,{timestamp:u}=jK;this.history=[{...l,timestamp:u}];const{onSessionStart:d}=t;d&&d(e,CM(o,this.history)),this.removeListeners=Ss(CE(this.contextWindow,"pointermove",this.handlePointerMove),CE(this.contextWindow,"pointerup",this.handlePointerUp),CE(this.contextWindow,"pointercancel",this.handlePointerUp)),s&&this.startScrollTracking(s)}startScrollTracking(e){let t=e.parentElement;for(;t;){let e=getComputedStyle(t);(CR.has(e.overflowX)||CR.has(e.overflowY))&&this.scrollPositions.set(t,{x:t.scrollLeft,y:t.scrollTop}),t=t.parentElement}this.scrollPositions.set(window,{x:window.scrollX,y:window.scrollY}),window.addEventListener("scroll",this.onElementScroll,{capture:!0,passive:!0}),window.addEventListener("scroll",this.onWindowScroll,{passive:!0}),this.removeScrollListeners=()=>{window.removeEventListener("scroll",this.onElementScroll,{capture:!0}),window.removeEventListener("scroll",this.onWindowScroll)}}handleScroll(e){let t=this.scrollPositions.get(e);if(!t)return;let n=e===window,i=n?{x:window.scrollX,y:window.scrollY}:{x:e.scrollLeft,y:e.scrollTop},r={x:i.x-t.x,y:i.y-t.y};(0!==r.x||0!==r.y)&&(n?this.lastMoveEventInfo&&(this.lastMoveEventInfo.point.x+=r.x,this.lastMoveEventInfo.point.y+=r.y):this.history.length>0&&(this.history[0].x-=r.x,this.history[0].y-=r.y),this.scrollPositions.set(e,i),jH.update(this.updatePoint,!0))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),this.removeScrollListeners&&this.removeScrollListeners(),this.scrollPositions.clear(),jq(this.updatePoint)}}function CV(e,t){return t?{point:t(e.point)}:e}function C_(e,t){return{x:e.x-t.x,y:e.y-t.y}}function CM({point:e},t){return{point:e,delta:C_(e,CF(t)),offset:C_(e,t[0]),velocity:function(e,t){if(e.length<2)return{x:0,y:0};let n=e.length-1,i=null,r=CF(e);for(;n>=0&&(i=e[n],!(r.timestamp-i.timestamp>Sn(.1)));)n--;if(!i)return{x:0,y:0};let a=(r.timestamp-i.timestamp)/1e3;if(0===a)return{x:0,y:0};let s={x:(r.x-i.x)/a,y:(r.y-i.y)/a};return s.x===1/0&&(s.x=0),s.y===1/0&&(s.y=0),s}(t,.1)}}function CF(e){return e[e.length-1]}function CO(e,t,n){return{min:void 0!==t?e.min+t:void 0,max:void 0!==n?e.max+n-(e.max-e.min):void 0}}function CL(e,t){let n=t.min-e.min,i=t.max-e.max;return t.max-t.min<e.max-e.min&&([n,i]=[i,n]),{min:n,max:i}}function CB(e,t,n){return{min:CU(e,t),max:CU(e,n)}}function CU(e,t){return"number"==typeof e?e:e[t]||0}let CN=new WeakMap;class CG{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=jG(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:t=!1,distanceThreshold:n}={}){let{presenceContext:i}=this.visualElement;if(i&&!1===i.isPresent)return;let r=e=>{t?(this.stopAnimation(),this.snapToCursor(CT(e).point)):this.pauseAnimation()},a=(e,t)=>{this.stopAnimation();let{drag:n,dragPropagation:i,onDragStart:r}=this.getProps();if(n&&!i&&(this.openDragLock&&this.openDragLock(),this.openDragLock=function(e){if("x"===e||"y"===e)if(Cy[e])return null;else return Cy[e]=!0,()=>{Cy[e]=!1};return Cy.x||Cy.y?null:(Cy.x=Cy.y=!0,()=>{Cy.x=Cy.y=!1})}(n),!this.openDragLock))return;this.latestPointerEvent=e,this.latestPanInfo=t,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),jX(e=>{let t=this.getAxisMotionValue(e).get()||0;if(SA.test(t)){let{projection:n}=this.visualElement;if(n&&n.layout){let i=n.layout.layoutBox[e];i&&(t=Cv(i)*(parseFloat(t)/100))}}this.originPoint[e]=t}),r&&jH.postRender(()=>r(e,t)),St(this.visualElement,"transform");let{animationState:a}=this.visualElement;a&&a.setActive("whileDrag",!0)},s=(e,t)=>{this.latestPointerEvent=e,this.latestPanInfo=t;let{dragPropagation:n,dragDirectionLock:i,onDirectionLock:r,onDrag:a}=this.getProps();if(!n&&!this.openDragLock)return;let{offset:s}=t;if(i&&null===this.currentDirection){this.currentDirection=function(e,t=10){let n=null;return Math.abs(e.y)>t?n="y":Math.abs(e.x)>t&&(n="x"),n}(s),null!==this.currentDirection&&r&&r(this.currentDirection);return}this.updateAxis("x",t.point,s),this.updateAxis("y",t.point,s),this.visualElement.render(),a&&a(e,t)},o=(e,t)=>{this.latestPointerEvent=e,this.latestPanInfo=t,this.stop(e,t),this.latestPointerEvent=null,this.latestPanInfo=null},l=()=>jX(e=>"paused"===this.getAnimationState(e)&&this.getAxisMotionValue(e).animation?.play()),{dragSnapToOrigin:u}=this.getProps();this.panSession=new CD(e,{onSessionStart:r,onStart:a,onMove:s,onSessionEnd:o,resumeAnimation:l},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:u,distanceThreshold:n,contextWindow:CI(this.visualElement),element:this.visualElement.current})}stop(e,t){let n=e||this.latestPointerEvent,i=t||this.latestPanInfo,r=this.isDragging;if(this.cancel(),!r||!i||!n)return;let{velocity:a}=i;this.startAnimation(a);let{onDragEnd:s}=this.getProps();s&&jH.postRender(()=>s(n,i))}cancel(){this.isDragging=!1;let{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;let{dragPropagation:n}=this.getProps();!n&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,n){let{drag:i}=this.getProps();if(!n||!C$(e,i,this.currentDirection))return;let r=this.getAxisMotionValue(e),a=this.originPoint[e]+n[e];this.constraints&&this.constraints[e]&&(a=function(e,{min:t,max:n},i){return void 0!==t&&e<t?e=i?jZ(t,e,i.min):Math.max(e,t):void 0!==n&&e>n&&(e=i?jZ(n,e,i.max):Math.min(e,n)),e}(a,this.constraints[e],this.elastic[e])),r.set(a)}resolveConstraints(){let{dragConstraints:e,dragElastic:t}=this.getProps(),n=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,i=this.constraints;e&&CP(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&n?this.constraints=function(e,{top:t,left:n,bottom:i,right:r}){return{x:CO(e.x,n,r),y:CO(e.y,t,i)}}(n.layoutBox,e):this.constraints=!1,this.elastic=function(e=.35){return!1===e?e=0:!0===e&&(e=.35),{x:CB(e,"left","right"),y:CB(e,"top","bottom")}}(t),i!==this.constraints&&n&&this.constraints&&!this.hasMutatedConstraints&&jX(e=>{var t,i;let r;!1!==this.constraints&&this.getAxisMotionValue(e)&&(this.constraints[e]=(t=n.layoutBox[e],i=this.constraints[e],r={},void 0!==i.min&&(r.min=i.min-t.min),void 0!==i.max&&(r.max=i.max-t.min),r))})}resolveRefConstraints(){var e;let{dragConstraints:t,onMeasureDragConstraints:n}=this.getProps();if(!t||!CP(t))return!1;let i=t.current;Sd(null!==i,"If `dragConstraints` is set as a React ref, that ref must be passed to another component's `ref` prop.","drag-constraints-ref");let{projection:r}=this.visualElement;if(!r||!r.layout)return!1;let a=function(e,t,n){let i=j7(e,n),{scroll:r}=t;return r&&(j3(i.x,r.offset.x),j3(i.y,r.offset.y)),i}(i,r.root,this.visualElement.getTransformPagePoint()),s=(e=r.layout.layoutBox,{x:CL(e.x,a.x),y:CL(e.y,a.y)});if(n){let e=n(function({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}(s));this.hasMutatedConstraints=!!e,e&&(s=jQ(e))}return s}startAnimation(e){let{drag:t,dragMomentum:n,dragElastic:i,dragTransition:r,dragSnapToOrigin:a,onDragTransitionEnd:s}=this.getProps(),o=this.constraints||{};return Promise.all(jX(s=>{if(!C$(s,t,this.currentDirection))return;let l=o&&o[s]||{};a&&(l={min:0,max:0});let u={type:"inertia",velocity:n?e[s]:0,bounceStiffness:i?200:1e6,bounceDamping:i?40:1e7,timeConstant:750,restDelta:1,restSpeed:10,...r,...l};return this.startAxisValueAnimation(s,u)})).then(s)}startAxisValueAnimation(e,t){let n=this.getAxisMotionValue(e);return St(this.visualElement,e),n.start(Cm(e,n,0,t,this.visualElement,!1))}stopAnimation(){jX(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){jX(e=>this.getAxisMotionValue(e).animation?.pause())}getAnimationState(e){return this.getAxisMotionValue(e).animation?.state}getAxisMotionValue(e){let t=`_drag${e.toUpperCase()}`,n=this.visualElement.getProps();return n[t]||this.visualElement.getValue(e,(n.initial?n.initial[e]:void 0)||0)}snapToCursor(e){jX(t=>{let{drag:n}=this.getProps();if(!C$(t,n,this.currentDirection))return;let{projection:i}=this.visualElement,r=this.getAxisMotionValue(t);if(i&&i.layout){let{min:n,max:a}=i.layout.layoutBox[t],s=r.get()||0;r.set(e[t]-jZ(n,a,.5)+s)}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;let{drag:e,dragConstraints:t}=this.getProps(),{projection:n}=this.visualElement;if(!CP(t)||!n||!this.constraints)return;this.stopAnimation();let i={x:0,y:0};jX(e=>{let t=this.getAxisMotionValue(e);if(t&&!1!==this.constraints){var n,r;let a,s,o,l=t.get();i[e]=(n={min:l,max:l},r=this.constraints[e],a=.5,s=Cv(n),(o=Cv(r))>s?a=kT(r.min,r.max-s,n.min):s>o&&(a=kT(n.min,n.max-o,r.min)),So(0,1,a))}});let{transformTemplate:r}=this.visualElement.getProps();this.visualElement.current.style.transform=r?r({},""):"none",n.root&&n.root.updateScroll(),n.updateLayout(),this.resolveConstraints(),jX(t=>{if(!C$(t,e,null))return;let n=this.getAxisMotionValue(t),{min:r,max:a}=this.constraints[t];n.set(jZ(r,a,i[t]))})}addListeners(){if(!this.visualElement.current)return;CN.set(this.visualElement,this);let e=CE(this.visualElement.current,"pointerdown",e=>{let{drag:t,dragListener:n=!0}=this.getProps();t&&n&&!Cg(e.target)&&this.start(e)}),t=()=>{let{dragConstraints:e}=this.getProps();CP(e)&&e.current&&(this.constraints=this.resolveRefConstraints())},{projection:n}=this.visualElement,i=n.addEventListener("measure",t);n&&!n.layout&&(n.root&&n.root.updateScroll(),n.updateLayout()),jH.read(t);let r=Cx(window,"resize",()=>this.scalePositionWithinConstraints()),a=n.addEventListener("didUpdate",({delta:e,hasLayoutChanged:t})=>{this.isDragging&&t&&(jX(t=>{let n=this.getAxisMotionValue(t);n&&(this.originPoint[t]+=e[t].translate,n.set(n.get()+e[t].translate))}),this.visualElement.render())});return()=>{r(),e(),i(),a&&a()}}getProps(){let e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:n=!1,dragPropagation:i=!1,dragConstraints:r=!1,dragElastic:a=.35,dragMomentum:s=!0}=e;return{...e,drag:t,dragDirectionLock:n,dragPropagation:i,dragConstraints:r,dragElastic:a,dragMomentum:s}}}function C$(e,t,n){return(!0===t||t===e)&&(null===n||n===e)}let Cz=e=>(t,n)=>{e&&jH.postRender(()=>e(t,n))},CW={hasAnimatedSinceResize:!0,hasEverUpdated:!1},{schedule:CH}=jW(queueMicrotask,!1);var Cq=v;let CK=(0,v.createContext)({}),CY=!1;class CX extends Cq.Component{componentDidMount(){let{visualElement:e,layoutGroup:t,switchLayoutGroup:n,layoutId:i}=this.props,{projection:r}=e;r&&(t.group&&t.group.add(r),n&&n.register&&i&&n.register(r),CY&&r.root.didUpdate(),r.addEventListener("animationComplete",()=>{this.safeToRemove()}),r.setOptions({...r.options,onExitComplete:()=>this.safeToRemove()})),CW.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){let{layoutDependency:t,visualElement:n,drag:i,isPresent:r}=this.props,{projection:a}=n;return a&&(a.isPresent=r,CY=!0,i||e.layoutDependency!==t||void 0===t||e.isPresent!==r?a.willUpdate():this.safeToRemove(),e.isPresent!==r&&(r?a.promote():a.relegate()||jH.postRender(()=>{let e=a.getStack();e&&e.members.length||this.safeToRemove()}))),null}componentDidUpdate(){let{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),CH.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){let{visualElement:e,layoutGroup:t,switchLayoutGroup:n}=this.props,{projection:i}=e;CY=!0,i&&(i.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(i),n&&n.deregister&&n.deregister(i))}safeToRemove(){let{safeToRemove:e}=this.props;e&&e()}render(){return null}}function CQ(e){let[t,n]=jV(),i=(0,Cq.useContext)(jv);return(0,jy.jsx)(CX,{...e,layoutGroup:i,switchLayoutGroup:(0,Cq.useContext)(CK),isPresent:t,safeToRemove:n})}function CZ(e,t,n,i,r){return e-=t,e=i+1/n*(e-i),void 0!==r&&(e=i+1/r*(e-i)),e}function CJ(e,t,[n,i,r],a,s){!function(e,t=0,n=1,i=.5,r,a=e,s=e){if(SA.test(t)&&(t=parseFloat(t),t=jZ(s.min,s.max,t/100)-s.min),"number"!=typeof t)return;let o=jZ(a.min,a.max,i);e===a&&(o-=t),e.min=CZ(e.min,t,n,o,r),e.max=CZ(e.max,t,n,o,r)}(e,t[n],t[i],t[r],t.scale,a,s)}let C0=["x","scaleX","originX"],C1=["y","scaleY","originY"];function C2(e,t,n,i){CJ(e.x,t,C0,n?n.x:void 0,i?i.x:void 0),CJ(e.y,t,C1,n?n.y:void 0,i?i.y:void 0)}function C5(e,t){e.min=t.min,e.max=t.max}function C4(e,t){C5(e.x,t.x),C5(e.y,t.y)}function C8(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function C3(e){return 0===e.translate&&1===e.scale}function C6(e){return C3(e.x)&&C3(e.y)}function C9(e,t){return e.min===t.min&&e.max===t.max}function C7(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function Te(e,t){return C7(e.x,t.x)&&C7(e.y,t.y)}function Tt(e){return Cv(e.x)/Cv(e.y)}function Tn(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}let Ti=["TopLeft","TopRight","BottomLeft","BottomRight"],Tr=Ti.length,Ta=e=>"string"==typeof e?parseFloat(e):e,Ts=e=>"number"==typeof e||SR.test(e);function To(e,t){return void 0!==e[t]?e[t]:e.borderRadius}let Tl=Td(0,.5,kb),Tu=Td(.5,.95,jL);function Td(e,t,n){return i=>i<e?0:i>t?1:n(kT(e,t,i))}function Tc(e){return jk(e)&&"ownerSVGElement"in e}function Tp(e,t){-1===e.indexOf(t)&&e.push(t)}function Th(e,t){let n=e.indexOf(t);n>-1&&e.splice(n,1)}class Tm{constructor(){this.subscriptions=[]}add(e){return Tp(this.subscriptions,e),()=>Th(this.subscriptions,e)}notify(e,t,n){let i=this.subscriptions.length;if(i)if(1===i)this.subscriptions[0](e,t,n);else for(let r=0;r<i;r++){let i=this.subscriptions[r];i&&i(e,t,n)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}class Tf{constructor(e,t={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=e=>{let t=Sr.now();if(this.updatedAt!==t&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(e),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(let e of this.dependents)e.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=t.owner}setCurrent(e){this.current=e,this.updatedAt=Sr.now(),null===this.canTrackVelocity&&void 0!==e&&(this.canTrackVelocity=!isNaN(parseFloat(this.current)))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new Tm);let n=this.events[e].add(t);return"change"===e?()=>{n(),jH.read(()=>{this.events.change.getSize()||this.stop()})}:n}clearListeners(){for(let e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,t,n){this.set(t),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-n}jump(e,t=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,t&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return i&&i.push(this),this.current}getPrevious(){return this.prev}getVelocity(){var e;let t=Sr.now();if(!this.canTrackVelocity||void 0===this.prevFrameValue||t-this.updatedAt>30)return 0;let n=Math.min(this.updatedAt-this.prevUpdatedAt,30);return e=parseFloat(this.current)-parseFloat(this.prevFrameValue),n?1e3/n*e:0}start(e){return this.stop(),new Promise(t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Tg(e,t){return new Tf(e,t)}function Tx(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}let Ty={correct:(e,t)=>{if(!t.target)return e;if("string"==typeof e)if(!SR.test(e))return e;else e=parseFloat(e);let n=Tx(e,t.target.x),i=Tx(e,t.target.y);return`${n}% ${i}%`}},Tv={borderRadius:{...Ty,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Ty,borderTopRightRadius:Ty,borderBottomLeftRadius:Ty,borderBottomRightRadius:Ty,boxShadow:{correct:(e,{treeScale:t,projectionDelta:n})=>{let i=SW.parse(e);if(i.length>5)return e;let r=SW.createTransformer(e),a=+("number"!=typeof i[0]),s=n.x.scale*t.x,o=n.y.scale*t.y;i[0+a]/=s,i[1+a]/=o;let l=jZ(s,o,.5);return"number"==typeof i[2+a]&&(i[2+a]/=l),"number"==typeof i[3+a]&&(i[3+a]/=l),r(i)}}};function Tw(e){return e.replace(/([A-Z])/g,e=>`-${e.toLowerCase()}`)}let Tb="data-"+Tw("framerAppearId"),Tj=(e,t)=>e.depth-t.depth;class TS{constructor(){this.children=[],this.isDirty=!1}add(e){Tp(this.children,e),this.isDirty=!0}remove(e){Th(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(Tj),this.isDirty=!1,this.children.forEach(e)}}function Tk(e){return Se(e)?e.get():e}class TC{constructor(){this.members=[]}add(e){Tp(this.members,e),e.scheduleRender()}remove(e){if(Th(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){let e=this.members[this.members.length-1];e&&this.promote(e)}}relegate(e){let t,n=this.members.findIndex(t=>e===t);if(0===n)return!1;for(let e=n;e>=0;e--){let n=this.members[e];if(!1!==n.isPresent){t=n;break}}return!!t&&(this.promote(t),!0)}promote(e,t){let n=this.lead;if(e!==n&&(this.prevLead=n,this.lead=e,e.show(),n)){n.instance&&n.scheduleRender(),e.scheduleRender(),e.resumeFrom=n,t&&(e.resumeFrom.preserveOpacity=!0),n.snapshot&&(e.snapshot=n.snapshot,e.snapshot.latestValues=n.animationValues||n.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);let{crossfade:i}=e.options;!1===i&&n.hide()}}exitAnimationComplete(){this.members.forEach(e=>{let{options:t,resumingFrom:n}=e;t.onExitComplete&&t.onExitComplete(),n&&n.options.onExitComplete&&n.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}let TT=["","X","Y","Z"],TE=0;function TI(e,t,n,i){let{latestValues:r}=t;r[e]&&(n[e]=r[e],t.setStaticValue(e,0),i&&(i[e]=0))}function TP({attachResizeListener:e,defaultParent:t,measureScroll:n,checkIsScrollRoot:i,resetTransform:r}){return class{constructor(e={},n=t?.()){this.id=TE++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(TD),this.nodes.forEach(TB),this.nodes.forEach(TU),this.nodes.forEach(TV)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=e,this.root=n?n.root||n:this,this.path=n?[...n.path,n]:[],this.parent=n,this.depth=n?n.depth+1:0;for(let e=0;e<this.path.length;e++)this.path[e].shouldResetTransform=!0;this.root===this&&(this.nodes=new TS)}addEventListener(e,t){return this.eventHandlers.has(e)||this.eventHandlers.set(e,new Tm),this.eventHandlers.get(e).add(t)}notifyListeners(e,...t){let n=this.eventHandlers.get(e);n&&n.notify(...t)}hasListeners(e){return this.eventHandlers.has(e)}mount(t){if(this.instance)return;this.isSVG=Tc(t)&&!(Tc(t)&&"svg"===t.tagName),this.instance=t;let{layoutId:n,layout:i,visualElement:r}=this.options;if(r&&!r.current&&r.mount(t),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(i||n)&&(this.isLayoutDirty=!0),e){let n,i=0,r=()=>this.root.updateBlockedByResize=!1;jH.read(()=>{i=window.innerWidth}),e(t,()=>{let e=window.innerWidth;if(e!==i){let t,a;i=e,this.root.updateBlockedByResize=!0,n&&n(),t=Sr.now(),a=({timestamp:e})=>{let n=e-t;n>=250&&(jq(a),r(n-250))},jH.setup(a,!0),n=()=>jq(a),CW.hasAnimatedSinceResize&&(CW.hasAnimatedSinceResize=!1,this.nodes.forEach(TL))}})}n&&this.root.registerSharedNode(n,this),!1!==this.options.animate&&r&&(n||i)&&this.addEventListener("didUpdate",({delta:e,hasLayoutChanged:t,hasRelativeLayoutChanged:n,layout:i})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}let a=this.options.transition||r.getDefaultTransition()||TH,{onLayoutAnimationStart:s,onLayoutAnimationComplete:o}=r.getProps(),l=!this.targetLayout||!Te(this.targetLayout,i),u=!t&&n;if(this.options.layoutRoot||this.resumeFrom||u||t&&(l||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);let t={...Cu(a,"layout"),onPlay:s,onComplete:o};(r.shouldReduceMotion||this.options.layoutRoot)&&(t.delay=0,t.type=!1),this.startAnimation(t),this.setAnimationOrigin(e,u)}else t||TL(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=i})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);let e=this.getStack();e&&e.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),jq(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){!this.isUpdateBlocked()&&(this.isUpdating=!0,this.nodes&&this.nodes.forEach(TN),this.animationId++)}getTransformTemplate(){let{visualElement:e}=this.options;return e&&e.getProps().transformTemplate}willUpdate(e=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&function e(t){if(t.hasCheckedOptimisedAppear=!0,t.root===t)return;let{visualElement:n}=t.options;if(!n)return;let i=n.props[Tb];if(window.MotionHasOptimisedAnimation(i,"transform")){let{layout:e,layoutId:n}=t.options;window.MotionCancelOptimisedAnimation(i,"transform",jH,!(e||n))}let{parent:r}=t;r&&!r.hasCheckedOptimisedAppear&&e(r)}(this),this.root.isUpdating||this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let e=0;e<this.path.length;e++){let t=this.path[e];t.shouldResetTransform=!0,t.updateScroll("snapshot"),t.options.layoutRoot&&t.willUpdate(!1)}let{layoutId:t,layout:n}=this.options;if(void 0===t&&!n)return;let i=this.getTransformTemplate();this.prevTransformTemplateValue=i?i(this.latestValues,""):void 0,this.updateSnapshot(),e&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(TM);return}if(this.animationId<=this.animationCommitId)return void this.nodes.forEach(TF);this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(TO),this.nodes.forEach(TA),this.nodes.forEach(TR)):this.nodes.forEach(TF),this.clearAllSnapshots();let e=Sr.now();jK.delta=So(0,1e3/60,e-jK.timestamp),jK.timestamp=e,jK.isProcessing=!0,jY.update.process(jK),jY.preRender.process(jK),jY.render.process(jK),jK.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,CH.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(T_),this.sharedNodes.forEach(TG)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,jH.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){jH.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){!this.snapshot&&this.instance&&(this.snapshot=this.measure(),!this.snapshot||Cv(this.snapshot.measuredBox.x)||Cv(this.snapshot.measuredBox.y)||(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let e=0;e<this.path.length;e++)this.path[e].updateScroll();let e=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=jG(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);let{visualElement:t}=this.options;t&&t.notify("LayoutMeasure",this.layout.layoutBox,e?e.layoutBox:void 0)}updateScroll(e="measure"){let t=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===e&&(t=!1),t&&this.instance){let t=i(this.instance);this.scroll={animationId:this.root.animationId,phase:e,isRoot:t,offset:n(this.instance),wasRoot:this.scroll?this.scroll.isRoot:t}}}resetTransform(){if(!r)return;let e=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,t=this.projectionDelta&&!C6(this.projectionDelta),n=this.getTransformTemplate(),i=n?n(this.latestValues,""):void 0,a=i!==this.prevTransformTemplateValue;e&&this.instance&&(t||j1(this.latestValues)||a)&&(r(this.instance,i),this.shouldResetTransform=!1,this.scheduleRender())}measure(e=!0){var t;let n=this.measurePageBox(),i=this.removeElementScroll(n);return e&&(i=this.removeTransform(i)),TY((t=i).x),TY(t.y),{animationId:this.root.animationId,measuredBox:n,layoutBox:i,latestValues:{},source:this.id}}measurePageBox(){let{visualElement:e}=this.options;if(!e)return jG();let t=e.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(TQ))){let{scroll:e}=this.root;e&&(j3(t.x,e.offset.x),j3(t.y,e.offset.y))}return t}removeElementScroll(e){let t=jG();if(C4(t,e),this.scroll?.wasRoot)return t;for(let n=0;n<this.path.length;n++){let i=this.path[n],{scroll:r,options:a}=i;i!==this.root&&r&&a.layoutScroll&&(r.wasRoot&&C4(t,e),j3(t.x,r.offset.x),j3(t.y,r.offset.y))}return t}applyTransform(e,t=!1){let n=jG();C4(n,e);for(let e=0;e<this.path.length;e++){let i=this.path[e];!t&&i.options.layoutScroll&&i.scroll&&i!==i.root&&j9(n,{x:-i.scroll.offset.x,y:-i.scroll.offset.y}),j1(i.latestValues)&&j9(n,i.latestValues)}return j1(this.latestValues)&&j9(n,this.latestValues),n}removeTransform(e){let t=jG();C4(t,e);for(let e=0;e<this.path.length;e++){let n=this.path[e];if(!n.instance||!j1(n.latestValues))continue;j0(n.latestValues)&&n.updateSnapshot();let i=jG();C4(i,n.measurePageBox()),C2(t,n.latestValues,n.snapshot?n.snapshot.layoutBox:void 0,i)}return j1(this.latestValues)&&C2(t,this.latestValues),t}setTargetDelta(e){this.targetDelta=e,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(e){this.options={...this.options,...e,crossfade:void 0===e.crossfade||e.crossfade}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==jK.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(e=!1){let t=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=t.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=t.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=t.isSharedProjectionDirty);let n=!!this.resumingFrom||this!==t;if(!(e||n&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;let{layout:i,layoutId:r}=this.options;if(!this.layout||!(i||r))return;this.resolvedRelativeTargetAt=jK.timestamp;let a=this.getClosestProjectingParent();if(a&&this.linkedParentVersion!==a.layoutVersion&&!a.options.layoutRoot&&this.removeRelativeTarget(),this.targetDelta||this.relativeTarget||(a&&a.layout?this.createRelativeTarget(a,this.layout.layoutBox,a.layout.layoutBox):this.removeRelativeTarget()),this.relativeTarget||this.targetDelta){if(this.target||(this.target=jG(),this.targetWithTransforms=jG()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target){var s,o,l;this.forceRelativeParentToResolveTarget(),s=this.target,o=this.relativeTarget,l=this.relativeParent.target,Cj(s.x,o.x,l.x),Cj(s.y,o.y,l.y)}else this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):C4(this.target,this.layout.layoutBox),j8(this.target,this.targetDelta)):C4(this.target,this.layout.layoutBox);this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,a&&!!a.resumingFrom==!!this.resumingFrom&&!a.options.layoutScroll&&a.target&&1!==this.animationProgress?this.createRelativeTarget(a,this.target,a.target):this.relativeParent=this.relativeTarget=void 0)}}getClosestProjectingParent(){if(!(!this.parent||j0(this.parent.latestValues)||j2(this.parent.latestValues)))if(this.parent.isProjecting())return this.parent;else return this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(e,t,n){this.relativeParent=e,this.linkedParentVersion=e.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=jG(),this.relativeTargetOrigin=jG(),Ck(this.relativeTargetOrigin,t,n),C4(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){let e=this.getLead(),t=!!this.resumingFrom||this!==e,n=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(n=!1),t&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(n=!1),this.resolvedRelativeTargetAt===jK.timestamp&&(n=!1),n)return;let{layout:i,layoutId:r}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(i||r))return;C4(this.layoutCorrected,this.layout.layoutBox);let a=this.treeScale.x,s=this.treeScale.y;!function(e,t,n,i=!1){let r,a,s=n.length;if(s){t.x=t.y=1;for(let o=0;o<s;o++){a=(r=n[o]).projectionDelta;let{visualElement:s}=r.options;(!s||!s.props.style||"contents"!==s.props.style.display)&&(i&&r.options.layoutScroll&&r.scroll&&r!==r.root&&j9(e,{x:-r.scroll.offset.x,y:-r.scroll.offset.y}),a&&(t.x*=a.x.scale,t.y*=a.y.scale,j8(e,a)),i&&j1(r.latestValues)&&j9(e,r.latestValues))}t.x<1.0000000000001&&t.x>.999999999999&&(t.x=1),t.y<1.0000000000001&&t.y>.999999999999&&(t.y=1)}}(this.layoutCorrected,this.treeScale,this.path,t),e.layout&&!e.target&&(1!==this.treeScale.x||1!==this.treeScale.y)&&(e.target=e.layout.layoutBox,e.targetWithTransforms=jG());let{target:o}=e;if(!o){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}this.projectionDelta&&this.prevProjectionDelta?(C8(this.prevProjectionDelta.x,this.projectionDelta.x),C8(this.prevProjectionDelta.y,this.projectionDelta.y)):this.createProjectionDeltas(),Cb(this.projectionDelta,this.layoutCorrected,o,this.latestValues),this.treeScale.x===a&&this.treeScale.y===s&&Tn(this.projectionDelta.x,this.prevProjectionDelta.x)&&Tn(this.projectionDelta.y,this.prevProjectionDelta.y)||(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",o))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(e=!0){if(this.options.visualElement?.scheduleRender(),e){let e=this.getStack();e&&e.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=jU(),this.projectionDelta=jU(),this.projectionDeltaWithTransform=jU()}setAnimationOrigin(e,t=!1){let n,i=this.snapshot,r=i?i.latestValues:{},a={...this.latestValues},s=jU();this.relativeParent&&this.relativeParent.options.layoutRoot||(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!t;let o=jG(),l=(i?i.source:void 0)!==(this.layout?this.layout.source:void 0),u=this.getStack(),d=!u||u.members.length<=1,c=!!(l&&!d&&!0===this.options.crossfade&&!this.path.some(TW));this.animationProgress=0,this.mixTargetDelta=t=>{let i=t/1e3;if(T$(s.x,e.x,i),T$(s.y,e.y,i),this.setTargetDelta(s),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout){var u,p,h,m,f,g;Ck(o,this.layout.layoutBox,this.relativeParent.layout.layoutBox),h=this.relativeTarget,m=this.relativeTargetOrigin,f=o,g=i,Tz(h.x,m.x,f.x,g),Tz(h.y,m.y,f.y,g),n&&(u=this.relativeTarget,p=n,C9(u.x,p.x)&&C9(u.y,p.y))&&(this.isProjectionDirty=!1),n||(n=jG()),C4(n,this.relativeTarget)}l&&(this.animationValues=a,function(e,t,n,i,r,a){r?(e.opacity=jZ(0,n.opacity??1,Tl(i)),e.opacityExit=jZ(t.opacity??1,0,Tu(i))):a&&(e.opacity=jZ(t.opacity??1,n.opacity??1,i));for(let r=0;r<Tr;r++){let a=`border${Ti[r]}Radius`,s=To(t,a),o=To(n,a);(void 0!==s||void 0!==o)&&(s||(s=0),o||(o=0),0===s||0===o||Ts(s)===Ts(o)?(e[a]=Math.max(jZ(Ta(s),Ta(o),i),0),(SA.test(o)||SA.test(s))&&(e[a]+="%")):e[a]=o)}(t.rotate||n.rotate)&&(e.rotate=jZ(t.rotate||0,n.rotate||0,i))}(a,r,this.latestValues,i,c,d)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=i},this.mixTargetDelta(1e3*!!this.options.layoutRoot)}startAnimation(e){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(jq(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=jH.update(()=>{var t,n,i;let r;CW.hasAnimatedSinceResize=!0,Sl.layout++,this.motionValue||(this.motionValue=Tg(0)),this.currentAnimation=(t=this.motionValue,n=[0,1e3],i={...e,velocity:0,isSync:!0,onUpdate:t=>{this.mixTargetDelta(t),e.onUpdate&&e.onUpdate(t)},onStop:()=>{Sl.layout--},onComplete:()=>{Sl.layout--,e.onComplete&&e.onComplete(),this.completeAnimation()}},(r=Se(t)?t:Tg(t)).start(Cm("",r,n,i)),r.animation),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);let e=this.getStack();e&&e.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(1e3),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){let e=this.getLead(),{targetWithTransforms:t,target:n,layout:i,latestValues:r}=e;if(t&&n&&i){if(this!==e&&this.layout&&i&&TX(this.options.animationType,this.layout.layoutBox,i.layoutBox)){n=this.target||jG();let t=Cv(this.layout.layoutBox.x);n.x.min=e.target.x.min,n.x.max=n.x.min+t;let i=Cv(this.layout.layoutBox.y);n.y.min=e.target.y.min,n.y.max=n.y.min+i}C4(t,n),j9(t,r),Cb(this.projectionDeltaWithTransform,this.layoutCorrected,t,r)}}registerSharedNode(e,t){this.sharedNodes.has(e)||this.sharedNodes.set(e,new TC),this.sharedNodes.get(e).add(t);let n=t.options.initialPromotionConfig;t.promote({transition:n?n.transition:void 0,preserveFollowOpacity:n&&n.shouldPreserveFollowOpacity?n.shouldPreserveFollowOpacity(t):void 0})}isLead(){let e=this.getStack();return!e||e.lead===this}getLead(){let{layoutId:e}=this.options;return e&&this.getStack()?.lead||this}getPrevLead(){let{layoutId:e}=this.options;return e?this.getStack()?.prevLead:void 0}getStack(){let{layoutId:e}=this.options;if(e)return this.root.sharedNodes.get(e)}promote({needsReset:e,transition:t,preserveFollowOpacity:n}={}){let i=this.getStack();i&&i.promote(this,n),e&&(this.projectionDelta=void 0,this.needsReset=!0),t&&this.setOptions({transition:t})}relegate(){let e=this.getStack();return!!e&&e.relegate(this)}resetSkewAndRotation(){let{visualElement:e}=this.options;if(!e)return;let t=!1,{latestValues:n}=e;if((n.z||n.rotate||n.rotateX||n.rotateY||n.rotateZ||n.skewX||n.skewY)&&(t=!0),!t)return;let i={};n.z&&TI("z",e,i,this.animationValues);for(let t=0;t<TT.length;t++)TI(`rotate${TT[t]}`,e,i,this.animationValues),TI(`skew${TT[t]}`,e,i,this.animationValues);for(let t in e.render(),i)e.setStaticValue(t,i[t]),this.animationValues&&(this.animationValues[t]=i[t]);e.scheduleRender()}applyProjectionStyles(e,t){if(!this.instance||this.isSVG)return;if(!this.isVisible){e.visibility="hidden";return}let n=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,e.visibility="",e.opacity="",e.pointerEvents=Tk(t?.pointerEvents)||"",e.transform=n?n(this.latestValues,""):"none";return}let i=this.getLead();if(!this.projectionDelta||!this.layout||!i.target){this.options.layoutId&&(e.opacity=void 0!==this.latestValues.opacity?this.latestValues.opacity:1,e.pointerEvents=Tk(t?.pointerEvents)||""),this.hasProjected&&!j1(this.latestValues)&&(e.transform=n?n({},""):"none",this.hasProjected=!1);return}e.visibility="";let r=i.animationValues||i.latestValues;this.applyTransformsToTarget();let a=function(e,t,n){let i="",r=e.x.translate/t.x,a=e.y.translate/t.y,s=n?.z||0;if((r||a||s)&&(i=`translate3d(${r}px, ${a}px, ${s}px) `),(1!==t.x||1!==t.y)&&(i+=`scale(${1/t.x}, ${1/t.y}) `),n){let{transformPerspective:e,rotate:t,rotateX:r,rotateY:a,skewX:s,skewY:o}=n;e&&(i=`perspective(${e}px) ${i}`),t&&(i+=`rotate(${t}deg) `),r&&(i+=`rotateX(${r}deg) `),a&&(i+=`rotateY(${a}deg) `),s&&(i+=`skewX(${s}deg) `),o&&(i+=`skewY(${o}deg) `)}let o=e.x.scale*t.x,l=e.y.scale*t.y;return(1!==o||1!==l)&&(i+=`scale(${o}, ${l})`),i||"none"}(this.projectionDeltaWithTransform,this.treeScale,r);n&&(a=n(r,a)),e.transform=a;let{x:s,y:o}=this.projectionDelta;for(let t in e.transformOrigin=`${100*s.origin}% ${100*o.origin}% 0`,i.animationValues?e.opacity=i===this?r.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:r.opacityExit:e.opacity=i===this?void 0!==r.opacity?r.opacity:"":void 0!==r.opacityExit?r.opacityExit:0,Tv){if(void 0===r[t])continue;let{correct:n,applyTo:s,isCSSVariable:o}=Tv[t],l="none"===a?r[t]:n(r[t],i);if(s){let t=s.length;for(let n=0;n<t;n++)e[s[n]]=l}else o?this.options.visualElement.renderState.vars[t]=l:e[t]=l}this.options.layoutId&&(e.pointerEvents=i===this?Tk(t?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(e=>e.currentAnimation?.stop()),this.root.nodes.forEach(TM),this.root.sharedNodes.clear()}}}function TA(e){e.updateLayout()}function TR(e){let t=e.resumeFrom?.snapshot||e.snapshot;if(e.isLead()&&e.layout&&t&&e.hasListeners("didUpdate")){let{layoutBox:n,measuredBox:i}=e.layout,{animationType:r}=e.options,a=t.source!==e.layout.source;"size"===r?jX(e=>{let i=a?t.measuredBox[e]:t.layoutBox[e],r=Cv(i);i.min=n[e].min,i.max=i.min+r}):TX(r,t.layoutBox,n)&&jX(i=>{let r=a?t.measuredBox[i]:t.layoutBox[i],s=Cv(n[i]);r.max=r.min+s,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[i].max=e.relativeTarget[i].min+s)});let s=jU();Cb(s,n,t.layoutBox);let o=jU();a?Cb(o,e.applyTransform(i,!0),t.measuredBox):Cb(o,n,t.layoutBox);let l=!C6(s),u=!1;if(!e.resumeFrom){let i=e.getClosestProjectingParent();if(i&&!i.resumeFrom){let{snapshot:r,layout:a}=i;if(r&&a){let s=jG();Ck(s,t.layoutBox,r.layoutBox);let o=jG();Ck(o,n,a.layoutBox),Te(s,o)||(u=!0),i.options.layoutRoot&&(e.relativeTarget=o,e.relativeTargetOrigin=s,e.relativeParent=i)}}}e.notifyListeners("didUpdate",{layout:n,snapshot:t,delta:o,layoutDelta:s,hasLayoutChanged:l,hasRelativeLayoutChanged:u})}else if(e.isLead()){let{onExitComplete:t}=e.options;t&&t()}e.options.transition=void 0}function TD(e){e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function TV(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function T_(e){e.clearSnapshot()}function TM(e){e.clearMeasurements()}function TF(e){e.isLayoutDirty=!1}function TO(e){let{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function TL(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function TB(e){e.resolveTargetDelta()}function TU(e){e.calcProjection()}function TN(e){e.resetSkewAndRotation()}function TG(e){e.removeLeadSnapshot()}function T$(e,t,n){e.translate=jZ(t.translate,0,n),e.scale=jZ(t.scale,1,n),e.origin=t.origin,e.originPoint=t.originPoint}function Tz(e,t,n,i){e.min=jZ(t.min,n.min,i),e.max=jZ(t.max,n.max,i)}function TW(e){return e.animationValues&&void 0!==e.animationValues.opacityExit}let TH={duration:.45,ease:[.4,0,.1,1]},Tq=e=>"u">typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),TK=Tq("applewebkit/")&&!Tq("chrome/")?Math.round:jL;function TY(e){e.min=TK(e.min),e.max=TK(e.max)}function TX(e,t,n){return"position"===e||"preserve-aspect"===e&&!(.2>=Math.abs(Tt(t)-Tt(n)))}function TQ(e){return e!==e.root&&e.scroll?.wasRoot}let TZ=TP({attachResizeListener:(e,t)=>Cx(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),TJ={current:void 0},T0=TP({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!TJ.current){let e=new TZ({});e.mount(window),e.setOptions({layoutScroll:!0}),TJ.current=e}return TJ.current},resetTransform:(e,t)=>{e.style.transform=void 0!==t?t:"none"},checkIsScrollRoot:e=>"fixed"===window.getComputedStyle(e).position});function T1(e){let t=[{},{}];return e?.values.forEach((e,n)=>{t[0][n]=e.get(),t[1][n]=e.getVelocity()}),t}function T2(e,t,n,i){if("function"==typeof t){let[r,a]=T1(i);t=t(void 0!==n?n:e.custom,r,a)}if("string"==typeof t&&(t=e.variants&&e.variants[t]),"function"==typeof t){let[r,a]=T1(i);t=t(void 0!==n?n:e.custom,r,a)}return t}function T5(e,t,n){let i=e.getProps();return T2(i,t,void 0!==n?n:i.custom,e)}let T4=new Set(["width","height","top","left","right","bottom",...kW]),T8=e=>Array.isArray(e);function T3(e,t,{delay:n=0,transitionOverride:i,type:r}={}){let{transition:a=e.getDefaultTransition(),transitionEnd:s,...o}=t;i&&(a=i);let l=[],u=r&&e.animationState&&e.animationState.getState()[r];for(let t in o){let i=e.getValue(t,e.latestValues[t]??null),r=o[t];if(void 0===r||u&&function({protectedKeys:e,needsAnimating:t},n){let i=e.hasOwnProperty(n)&&!0!==t[n];return t[n]=!1,i}(u,t))continue;let s={delay:n,...Cu(a||{},t)},d=i.get();if(void 0!==d&&!i.isAnimating&&!Array.isArray(r)&&r===d&&!s.velocity)continue;let c=!1;if(window.MotionHandoffAnimation){let n=e.props[Tb];if(n){let e=window.MotionHandoffAnimation(n,t,jH);null!==e&&(s.startTime=e,c=!0)}}St(e,t),i.start(Cm(t,i,r,e.shouldReduceMotion&&T4.has(t)?{type:!1}:s,e,c));let p=i.animation;p&&l.push(p)}return s&&Promise.all(l).then(()=>{jH.update(()=>{s&&function(e,t){let{transitionEnd:n={},transition:i={},...r}=T5(e,t)||{};for(let t in r={...r,...n}){var a;let n=T8(a=r[t])?a[a.length-1]||0:a;e.hasValue(t)?e.getValue(t).set(n):e.addValue(t,Tg(n))}}(e,s)})}),l}function T6(e,t,n,i=0,r=1){let a=Array.from(e).sort((e,t)=>e.sortNodePosition(t)).indexOf(t),s=e.size,o=(s-1)*i;return"function"==typeof n?n(a,s):1===r?a*i:o-a*i}function T9(e,t,n={}){let i=T5(e,t,"exit"===n.type?e.presenceContext?.custom:void 0),{transition:r=e.getDefaultTransition()||{}}=i||{};n.transitionOverride&&(r=n.transitionOverride);let a=i?()=>Promise.all(T3(e,i,n)):()=>Promise.resolve(),s=e.variantChildren&&e.variantChildren.size?(i=0)=>{let{delayChildren:a=0,staggerChildren:s,staggerDirection:o}=r;return function(e,t,n=0,i=0,r=0,a=1,s){let o=[];for(let l of e.variantChildren)l.notify("AnimationStart",t),o.push(T9(l,t,{...s,delay:n+("function"==typeof i?0:i)+T6(e.variantChildren,l,i,r,a)}).then(()=>l.notify("AnimationComplete",t)));return Promise.all(o)}(e,t,i,a,s,o,n)}:()=>Promise.resolve(),{when:o}=r;if(!o)return Promise.all([a(),s(n.delay)]);{let[e,t]="beforeChildren"===o?[a,s]:[s,a];return e().then(()=>t())}}function T7(e){return"string"==typeof e||Array.isArray(e)}let Ee=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],Et=["initial",...Ee],En=Et.length;function Ei(e){return null!==e&&"object"==typeof e&&"function"==typeof e.start}function Er(e,t){if(!Array.isArray(t))return!1;let n=t.length;if(n!==e.length)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}let Ea=[...Ee].reverse(),Es=Ee.length;function Eo(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function El(){return{animate:Eo(!0),whileInView:Eo(),whileHover:Eo(),whileTap:Eo(),whileDrag:Eo(),whileFocus:Eo(),exit:Eo()}}let Eu=0;function Ed(e,t){let n=function(e,t,n){if(e instanceof EventTarget)return[e];if("string"==typeof e){let t=document,n=(void 0)??t.querySelectorAll(e);return n?Array.from(n):[]}return Array.from(e)}(e),i=new AbortController;return[n,{passive:!0,...t,signal:i.signal},()=>i.abort()]}function Ec(e){return!("touch"===e.pointerType||Cy.x||Cy.y)}function Ep(e,t,n){let{props:i}=e;e.animationState&&i.whileHover&&e.animationState.setActive("whileHover","Start"===n);let r=i["onHover"+n];r&&jH.postRender(()=>r(t,CT(t)))}let Eh=(e,t)=>!!t&&(e===t||Eh(e,t.parentElement)),Em=new WeakSet;function Ef(e){return t=>{"Enter"===t.key&&e(t)}}function Eg(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}function Ex(e){return CC(e)&&!(Cy.x||Cy.y)}function Ey(e,t,n){let{props:i}=e;if(e.current instanceof HTMLButtonElement&&e.current.disabled)return;e.animationState&&i.whileTap&&e.animationState.setActive("whileTap","Start"===n);let r=i["onTap"+("End"===n?"":n)];r&&jH.postRender(()=>r(t,CT(t)))}let Ev=new WeakMap,Ew=new WeakMap,Eb=e=>{let t=Ev.get(e.target);t&&t(e)},Ej=e=>{e.forEach(Eb)},ES={some:0,all:1},Ek=new Set(["brightness","contrast","saturate","opacity"]);function EC(e){let[t,n]=e.slice(0,-1).split("(");if("drop-shadow"===t)return e;let[i]=n.match(Sb)||[];if(!i)return e;let r=n.replace(i,""),a=+!!Ek.has(t);return i!==n&&(a*=100),t+"("+a+r+")"}let ET=/\b([a-z-]*)\(.*?\)/gu,EE={...SW,getAnimatableNone:e=>{let t=e.match(ET);return t?t.map(EC).join(" "):e}},EI={...Sx,transform:Math.round},EP={borderWidth:SR,borderTopWidth:SR,borderRightWidth:SR,borderBottomWidth:SR,borderLeftWidth:SR,borderRadius:SR,radius:SR,borderTopLeftRadius:SR,borderTopRightRadius:SR,borderBottomRightRadius:SR,borderBottomLeftRadius:SR,width:SR,maxWidth:SR,height:SR,maxHeight:SR,top:SR,right:SR,bottom:SR,left:SR,inset:SR,insetBlock:SR,insetBlockStart:SR,insetBlockEnd:SR,insetInline:SR,insetInlineStart:SR,insetInlineEnd:SR,padding:SR,paddingTop:SR,paddingRight:SR,paddingBottom:SR,paddingLeft:SR,paddingBlock:SR,paddingBlockStart:SR,paddingBlockEnd:SR,paddingInline:SR,paddingInlineStart:SR,paddingInlineEnd:SR,margin:SR,marginTop:SR,marginRight:SR,marginBottom:SR,marginLeft:SR,marginBlock:SR,marginBlockStart:SR,marginBlockEnd:SR,marginInline:SR,marginInlineStart:SR,marginInlineEnd:SR,backgroundPositionX:SR,backgroundPositionY:SR,rotate:SP,rotateX:SP,rotateY:SP,rotateZ:SP,scale:Sv,scaleX:Sv,scaleY:Sv,scaleZ:Sv,skew:SP,skewX:SP,skewY:SP,distance:SR,translateX:SR,translateY:SR,translateZ:SR,x:SR,y:SR,z:SR,perspective:SR,transformPerspective:SR,opacity:Sy,originX:S_,originY:S_,originZ:SR,zIndex:EI,fillOpacity:Sy,strokeOpacity:Sy,numOctaves:EI},EA={...EP,color:SF,backgroundColor:SF,outlineColor:SF,fill:SF,stroke:SF,borderColor:SF,borderTopColor:SF,borderRightColor:SF,borderBottomColor:SF,borderLeftColor:SF,filter:EE,WebkitFilter:EE},ER=e=>EA[e],ED=e=>t=>t.test(e),EV=[Sx,SR,SA,SP,SV,SD,{test:e=>"auto"===e,parse:e=>e}],E_=e=>EV.find(ED(e)),EM=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function EF(e,t){let n=ER(e);return n!==EE&&(n=SW),n.getAnimatableNone?n.getAnimatableNone(t):void 0}let EO=new Set(["auto","none","0"]);class EL extends k5{constructor(e,t,n,i,r){super(e,t,n,i,r,!0)}readKeyframes(){let{unresolvedKeyframes:e,element:t,name:n}=this;if(!t||!t.current)return;super.readKeyframes();for(let n=0;n<e.length;n++){let i=e[n];if("string"==typeof i&&Sm(i=i.trim())){let r=function e(t,n,i=1){Sd(i<=4,`Max CSS variable fallback depth detected in property "${t}". This may indicate a circular fallback dependency.`,"max-css-var-depth");let[r,a]=function(e){let t=EM.exec(e);if(!t)return[,];let[,n,i,r]=t;return[`--${n??i}`,r]}(t);if(!r)return;let s=window.getComputedStyle(n).getPropertyValue(r);if(s){let e=s.trim();return/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e)?parseFloat(e):e}return Sm(a)?e(a,n,i+1):a}(i,t.current);void 0!==r&&(e[n]=r),n===e.length-1&&(this.finalKeyframe=i)}}if(this.resolveNoneKeyframes(),!T4.has(n)||2!==e.length)return;let[i,r]=e,a=E_(i),s=E_(r);if(Sg(i)!==Sg(r)&&kX[n]){this.needsMeasurement=!0;return}if(a!==s)if(kq(a)&&kq(s))for(let t=0;t<e.length;t++){let n=e[t];"string"==typeof n&&(e[t]=parseFloat(n))}else kX[n]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){let{unresolvedKeyframes:e,name:t}=this,n=[];for(let t=0;t<e.length;t++)(null===e[t]||function(e){if("number"==typeof e)return 0===e;if(null===e)return!0;return"none"===e||"0"===e||/^0[^.\s]+$/u.test(e)}(e[t]))&&n.push(t);n.length&&function(e,t,n){let i,r=0;for(;r<e.length&&!i;){let t=e[r];"string"==typeof t&&!EO.has(t)&&SN(t).values.length&&(i=e[r]),r++}if(i&&n)for(let r of t)e[r]=EF(n,i)}(e,n,t)}measureInitialState(){let{element:e,unresolvedKeyframes:t,name:n}=this;if(!e||!e.current)return;"height"===n&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=kX[n](e.measureViewportBox(),window.getComputedStyle(e.current)),t[0]=this.measuredOrigin;let i=t[t.length-1];void 0!==i&&e.getValue(n,i).jump(i,!1)}measureEndState(){let{element:e,name:t,unresolvedKeyframes:n}=this;if(!e||!e.current)return;let i=e.getValue(t);i&&i.jump(this.measuredOrigin,!1);let r=n.length-1,a=n[r];n[r]=kX[t](e.measureViewportBox(),window.getComputedStyle(e.current)),null!==a&&void 0===this.finalKeyframe&&(this.finalKeyframe=a),this.removedTransforms?.length&&this.removedTransforms.forEach(([t,n])=>{e.getValue(t).set(n)}),this.resolveNoneKeyframes()}}let EB=[...EV,SF,SW],EU={current:null},EN={current:!1},EG="u">typeof window,E$=new WeakMap;function Ez(e){return Ei(e.animate)||Et.some(t=>T7(e[t]))}function EW(e){return!!(Ez(e)||e.variants)}let EH=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"],Eq={};class EK{scrapeMotionValuesFromProps(e,t,n){return{}}constructor({parent:e,props:t,presenceContext:n,reducedMotionConfig:i,blockInitialAnimation:r,visualState:a},s={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=k5,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{let e=Sr.now();this.renderScheduledAt<e&&(this.renderScheduledAt=e,jH.render(this.render,!1,!0))};const{latestValues:o,renderState:l}=a;this.latestValues=o,this.baseTarget={...o},this.initialValues=t.initial?{...o}:{},this.renderState=l,this.parent=e,this.props=t,this.presenceContext=n,this.depth=e?e.depth+1:0,this.reducedMotionConfig=i,this.options=s,this.blockInitialAnimation=!!r,this.isControllingVariants=Ez(t),this.isVariantNode=EW(t),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:u,...d}=this.scrapeMotionValuesFromProps(t,{},this);for(const e in d){const t=d[e];void 0!==o[e]&&Se(t)&&t.set(o[e])}}mount(e){this.current=e,E$.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((e,t)=>this.bindToMotionValue(t,e)),"never"===this.reducedMotionConfig?this.shouldReduceMotion=!1:"always"===this.reducedMotionConfig?this.shouldReduceMotion=!0:(EN.current||function(){if(EN.current=!0,EG)if(window.matchMedia){let e=window.matchMedia("(prefers-reduced-motion)"),t=()=>EU.current=e.matches;e.addEventListener("change",t),t()}else EU.current=!1}(),this.shouldReduceMotion=EU.current),this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){for(let e in this.projection&&this.projection.unmount(),jq(this.notifyUpdate),jq(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this),this.events)this.events[e].clear();for(let e in this.features){let t=this.features[e];t&&(t.unmount(),t.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,t){let n;this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();let i=kH.has(e);i&&this.onBindTransform&&this.onBindTransform();let r=t.on("change",t=>{this.latestValues[e]=t,this.props.onUpdate&&jH.preRender(this.notifyUpdate),i&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});"u">typeof window&&window.MotionCheckAppearSync&&(n=window.MotionCheckAppearSync(this,e,t)),this.valueSubscriptions.set(e,()=>{r(),n&&n(),t.owner&&t.stop()})}sortNodePosition(e){return this.current&&this.sortInstanceNodePosition&&this.type===e.type?this.sortInstanceNodePosition(this.current,e.current):0}updateFeatures(){let e="animation";for(e in Eq){let t=Eq[e];if(!t)continue;let{isEnabled:n,Feature:i}=t;if(!this.features[e]&&i&&n(this.props)&&(this.features[e]=new i(this)),this.features[e]){let t=this.features[e];t.isMounted?t.update():(t.mount(),t.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):jG()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let t=0;t<EH.length;t++){let n=EH[t];this.propEventSubscriptions[n]&&(this.propEventSubscriptions[n](),delete this.propEventSubscriptions[n]);let i=e["on"+n];i&&(this.propEventSubscriptions[n]=this.on(n,i))}this.prevMotionValues=function(e,t,n){for(let i in t){let r=t[i],a=n[i];if(Se(r))e.addValue(i,r);else if(Se(a))e.addValue(i,Tg(r,{owner:e}));else if(a!==r)if(e.hasValue(i)){let t=e.getValue(i);!0===t.liveStyle?t.jump(r):t.hasAnimated||t.set(r)}else{let t=e.getStaticValue(i);e.addValue(i,Tg(void 0!==t?t:r,{owner:e}))}}for(let i in n)void 0===t[i]&&e.removeValue(i);return t}(this,this.scrapeMotionValuesFromProps(e,this.prevProps||{},this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){let t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){let n=this.values.get(e);t!==n&&(n&&this.removeValue(e),this.bindToMotionValue(e,t),this.values.set(e,t),this.latestValues[e]=t.get())}removeValue(e){this.values.delete(e);let t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let n=this.values.get(e);return void 0===n&&void 0!==t&&(n=Tg(null===t?void 0:t,{owner:this}),this.addValue(e,n)),n}readValue(e,t){let n=void 0===this.latestValues[e]&&this.current?this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options):this.latestValues[e];if(null!=n){let i,r;if("string"==typeof n&&(i=n,/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(i)||(r=n,/^0[^.\s]+$/u.test(r))))n=parseFloat(n);else{let i;i=n,!EB.find(ED(i))&&SW.test(t)&&(n=EF(e,t))}this.setBaseTarget(e,Se(n)?n.get():n)}return Se(n)?n.get():n}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){let t,{initial:n}=this.props;if("string"==typeof n||"object"==typeof n){let i=T2(this.props,n,this.presenceContext?.custom);i&&(t=i[e])}if(n&&void 0!==t)return t;let i=this.getBaseTargetFromProps(this.props,e);return void 0===i||Se(i)?void 0!==this.initialValues[e]&&void 0===t?void 0:this.baseTarget[e]:i}on(e,t){return this.events[e]||(this.events[e]=new Tm),this.events[e].add(t)}notify(e,...t){this.events[e]&&this.events[e].notify(...t)}scheduleRenderMicrotask(){CH.render(this.render)}}class EY extends EK{constructor(){super(...arguments),this.KeyframeResolver=EL}sortInstanceNodePosition(e,t){return 2&e.compareDocumentPosition(t)?1:-1}getBaseTargetFromProps(e,t){let n=e.style;return n?n[t]:void 0}removeValueFromRenderState(e,{vars:t,style:n}){delete t[e],delete n[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);let{children:e}=this.props;Se(e)&&(this.childSubscription=e.on("change",e=>{this.current&&(this.current.textContent=`${e}`)}))}}let EX=(e,t)=>t&&"number"==typeof e?t.transform(e):e,EQ={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},EZ=kW.length;function EJ(e,t,n){let{style:i,vars:r,transformOrigin:a}=e,s=!1,o=!1;for(let e in t){let n=t[e];if(kH.has(e)){s=!0;continue}if(Sp(e)){r[e]=n;continue}{let t=EX(n,EP[e]);e.startsWith("origin")?(o=!0,a[e]=t):i[e]=t}}if(!t.transform&&(s||n?i.transform=function(e,t,n){let i="",r=!0;for(let a=0;a<EZ;a++){let s=kW[a],o=e[s];if(void 0===o)continue;let l=!0;if(!(l="number"==typeof o?o===+!!s.startsWith("scale"):0===parseFloat(o))||n){let e=EX(o,EP[s]);if(!l){r=!1;let t=EQ[s]||s;i+=`${t}(${e}) `}n&&(t[s]=e)}}return i=i.trim(),n?i=n(t,r?"":i):r&&(i="none"),i}(t,e.transform,n):i.transform&&(i.transform="none")),o){let{originX:e="50%",originY:t="50%",originZ:n=0}=a;i.transformOrigin=`${e} ${t} ${n}`}}let E0={offset:"stroke-dashoffset",array:"stroke-dasharray"},E1={offset:"strokeDashoffset",array:"strokeDasharray"},E2=["offsetDistance","offsetPath","offsetRotate","offsetAnchor"];function E5(e,{attrX:t,attrY:n,attrScale:i,pathLength:r,pathSpacing:a=1,pathOffset:s=0,...o},l,u,d){if(EJ(e,o,u),l){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};let{attrs:c,style:p}=e;for(let e of(c.transform&&(p.transform=c.transform,delete c.transform),(p.transform||c.transformOrigin)&&(p.transformOrigin=c.transformOrigin??"50% 50%",delete c.transformOrigin),p.transform&&(p.transformBox=d?.transformBox??"fill-box",delete c.transformBox),E2))void 0!==c[e]&&(p[e]=c[e],delete c[e]);void 0!==t&&(c.x=t),void 0!==n&&(c.y=n),void 0!==i&&(c.scale=i),void 0!==r&&function(e,t,n=1,i=0,r=!0){e.pathLength=1;let a=r?E0:E1;e[a.offset]=SR.transform(-i);let s=SR.transform(t),o=SR.transform(n);e[a.array]=`${s} ${o}`}(c,r,a,s,!1)}let E4=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]),E8=e=>"string"==typeof e&&"svg"===e.toLowerCase();function E3(e,{style:t,vars:n},i,r){let a,s=e.style;for(a in t)s[a]=t[a];for(a in r?.applyProjectionStyles(s,i),n)s.setProperty(a,n[a])}function E6(e,{layout:t,layoutId:n}){return kH.has(e)||e.startsWith("origin")||(t||void 0!==n)&&(!!Tv[e]||"opacity"===e)}function E9(e,t,n){let i=e.style,r=t?.style,a={};if(!i)return a;for(let t in i)(Se(i[t])||r&&Se(r[t])||E6(t,e)||n?.getValue(t)?.liveStyle!==void 0)&&(a[t]=i[t]);return a}function E7(e,t,n){let i=E9(e,t,n);for(let n in e)(Se(e[n])||Se(t[n]))&&(i[-1!==kW.indexOf(n)?"attr"+n.charAt(0).toUpperCase()+n.substring(1):n]=e[n]);return i}class Ie extends EY{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=jG}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(kH.has(t)){let e=ER(t);return e&&e.default||0}return t=E4.has(t)?t:Tw(t),e.getAttribute(t)}scrapeMotionValuesFromProps(e,t,n){return E7(e,t,n)}build(e,t,n){E5(e,t,this.isSVGTag,n.transformTemplate,n.style)}renderInstance(e,t,n,i){for(let n in E3(e,t,void 0,i),t.attrs)e.setAttribute(E4.has(n)?n:Tw(n),t.attrs[n])}mount(e){this.isSVGTag=E8(e.tagName),super.mount(e)}}class It extends EY{constructor(){super(...arguments),this.type="html",this.renderInstance=E3}readValueFromInstance(e,t){if(kH.has(t))return this.projection?.isProjecting?kG(t):((e,t)=>{let{transform:n="none"}=getComputedStyle(e);return k$(n,t)})(e,t);{let n=window.getComputedStyle(e),i=(Sp(t)?n.getPropertyValue(t):n[t])||0;return"string"==typeof i?i.trim():i}}measureInstanceViewportBox(e,{transformPagePoint:t}){return j7(e,t)}build(e,t,n){EJ(e,t,n.transformTemplate)}scrapeMotionValuesFromProps(e,t,n){return E9(e,t,n)}}let In=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function Ii(e){if("string"!=typeof e||e.includes("-"));else if(In.indexOf(e)>-1||/[A-Z]/u.test(e))return!0;return!1}let Ir={renderer:(e,t)=>t.isSVG??Ii(e)?new Ie(t):new It(t,{allowProjection:e!==v.Fragment}),animation:{Feature:class extends jO{constructor(e){super(e),e.animationState||(e.animationState=function(e){let t=t=>Promise.all(t.map(({animation:t,options:n})=>(function(e,t,n={}){let i;if(e.notify("AnimationStart",t),Array.isArray(t))i=Promise.all(t.map(t=>T9(e,t,n)));else if("string"==typeof t)i=T9(e,t,n);else{let r="function"==typeof t?T5(e,t,n.custom):t;i=Promise.all(T3(e,r,n))}return i.then(()=>{e.notify("AnimationComplete",t)})})(e,t,n))),n=El(),i=!0,r=t=>(n,i)=>{let r=T5(e,i,"exit"===t?e.presenceContext?.custom:void 0);if(r){let{transition:e,transitionEnd:t,...i}=r;n={...n,...i,...t}}return n};function a(a){let{props:s}=e,o=function e(t){if(!t)return;if(!t.isControllingVariants){let n=t.parent&&e(t.parent)||{};return void 0!==t.props.initial&&(n.initial=t.props.initial),n}let n={};for(let e=0;e<En;e++){let i=Et[e],r=t.props[i];(T7(r)||!1===r)&&(n[i]=r)}return n}(e.parent)||{},l=[],u=new Set,d={},c=1/0;for(let t=0;t<Es;t++){var p,h;let m=Ea[t],f=n[m],g=void 0!==s[m]?s[m]:o[m],x=T7(g),y=m===a?f.isActive:null;!1===y&&(c=t);let v=g===o[m]&&g!==s[m]&&x;if(v&&i&&e.manuallyAnimateOnMount&&(v=!1),f.protectedKeys={...d},!f.isActive&&null===y||!g&&!f.prevProp||Ei(g)||"boolean"==typeof g)continue;let w=(p=f.prevProp,"string"==typeof(h=g)?h!==p:!!Array.isArray(h)&&!Er(h,p)),b=w||m===a&&f.isActive&&!v&&x||t>c&&x,j=!1,S=Array.isArray(g)?g:[g],k=S.reduce(r(m),{});!1===y&&(k={});let{prevResolvedValues:C={}}=f,T={...C,...k},E=t=>{b=!0,u.has(t)&&(j=!0,u.delete(t)),f.needsAnimating[t]=!0;let n=e.getValue(t);n&&(n.liveStyle=!1)};for(let e in T){let t=k[e],n=C[e];if(!d.hasOwnProperty(e))(T8(t)&&T8(n)?Er(t,n):t===n)?void 0!==t&&u.has(e)?E(e):f.protectedKeys[e]=!0:null!=t?E(e):u.add(e)}f.prevProp=g,f.prevResolvedValues=k,f.isActive&&(d={...d,...k}),i&&e.blockInitialAnimation&&(b=!1);let I=v&&w,P=!I||j;b&&P&&l.push(...S.map(t=>{let n={type:m};if("string"==typeof t&&i&&!I&&e.manuallyAnimateOnMount&&e.parent){let{parent:i}=e,r=T5(i,t);if(i.enteringChildren&&r){let{delayChildren:t}=r.transition||{};n.delay=T6(i.enteringChildren,e,t)}}return{animation:t,options:n}}))}if(u.size){let t={};if("boolean"!=typeof s.initial){let n=T5(e,Array.isArray(s.initial)?s.initial[0]:s.initial);n&&n.transition&&(t.transition=n.transition)}u.forEach(n=>{let i=e.getBaseTarget(n),r=e.getValue(n);r&&(r.liveStyle=!0),t[n]=i??null}),l.push({animation:t})}let m=!!l.length;return i&&(!1===s.initial||s.initial===s.animate)&&!e.manuallyAnimateOnMount&&(m=!1),i=!1,m?t(l):Promise.resolve()}return{animateChanges:a,setActive:function(t,i){if(n[t].isActive===i)return Promise.resolve();e.variantChildren?.forEach(e=>e.animationState?.setActive(t,i)),n[t].isActive=i;let r=a(t);for(let e in n)n[e].protectedKeys={};return r},setAnimateFunction:function(n){t=n(e)},getState:()=>n,reset:()=>{n=El()}}}(e))}updateAnimationControlsSubscription(){let{animate:e}=this.node.getProps();Ei(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){let{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}},exit:{Feature:class extends jO{constructor(){super(...arguments),this.id=Eu++}update(){if(!this.node.presenceContext)return;let{isPresent:e,onExitComplete:t}=this.node.presenceContext,{isPresent:n}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===n)return;let i=this.node.animationState.setActive("exit",!e);t&&!e&&i.then(()=>{t(this.id)})}mount(){let{register:e,onExitComplete:t}=this.node.presenceContext||{};t&&t(this.id),e&&(this.unmount=e(this.id))}unmount(){}}},inView:{Feature:class extends jO{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){var e;let t;this.unmount();let{viewport:n={}}=this.node.getProps(),{root:i,margin:r,amount:a="some",once:s}=n,o={root:i?i.current:void 0,rootMargin:r,threshold:"number"==typeof a?a:ES[a]},l=e=>{let{isIntersecting:t}=e;if(this.isInView===t||(this.isInView=t,s&&!t&&this.hasEnteredView))return;t&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",t);let{onViewportEnter:n,onViewportLeave:i}=this.node.getProps(),r=t?n:i;r&&r(e)};return e=this.node.current,t=function({root:e,...t}){let n=e||document;Ew.has(n)||Ew.set(n,{});let i=Ew.get(n),r=JSON.stringify(t);return i[r]||(i[r]=new IntersectionObserver(Ej,{root:e,...t})),i[r]}(o),Ev.set(e,l),t.observe(e),()=>{Ev.delete(e),t.unobserve(e)}}mount(){this.startObserver()}update(){if("u"<typeof IntersectionObserver)return;let{props:e,prevProps:t}=this.node;["amount","margin","root"].some(function({viewport:e={}},{viewport:t={}}={}){return n=>e[n]!==t[n]}(e,t))&&this.startObserver()}unmount(){}}},tap:{Feature:class extends jO{mount(){let{current:e}=this.node;e&&(this.unmount=function(e,t,n={}){let[i,r,a]=Ed(e,n),s=e=>{let i=e.currentTarget;if(!Ex(e))return;Em.add(i);let a=t(i,e),s=(e,t)=>{window.removeEventListener("pointerup",o),window.removeEventListener("pointercancel",l),Em.has(i)&&Em.delete(i),Ex(e)&&"function"==typeof a&&a(e,{success:t})},o=e=>{s(e,i===window||i===document||n.useGlobalTarget||Eh(i,e.target))},l=e=>{s(e,!1)};window.addEventListener("pointerup",o,r),window.addEventListener("pointercancel",l,r)};return i.forEach(e=>{(n.useGlobalTarget?window:e).addEventListener("pointerdown",s,r),jC(e)&&(e.addEventListener("focus",e=>((e,t)=>{let n=e.currentTarget;if(!n)return;let i=Ef(()=>{if(Em.has(n))return;Eg(n,"down");let e=Ef(()=>{Eg(n,"up")});n.addEventListener("keyup",e,t),n.addEventListener("blur",()=>Eg(n,"cancel"),t)});n.addEventListener("keydown",i,t),n.addEventListener("blur",()=>n.removeEventListener("keydown",i),t)})(e,r)),Cg(e)||e.hasAttribute("tabindex")||(e.tabIndex=0))}),a}(e,(e,t)=>(Ey(this.node,t,"Start"),(e,{success:t})=>Ey(this.node,e,t?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}},focus:{Feature:class extends jO{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch(t){e=!0}e&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){this.isActive&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Ss(Cx(this.node.current,"focus",()=>this.onFocus()),Cx(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}},hover:{Feature:class extends jO{mount(){let{current:e}=this.node;e&&(this.unmount=function(e,t,n={}){let[i,r,a]=Ed(e,n),s=e=>{if(!Ec(e))return;let{target:n}=e,i=t(n,e);if("function"!=typeof i||!n)return;let a=e=>{Ec(e)&&(i(e),n.removeEventListener("pointerleave",a))};n.addEventListener("pointerleave",a,r)};return i.forEach(e=>{e.addEventListener("pointerenter",s,r)}),a}(e,(e,t)=>(Ep(this.node,t,"Start"),e=>Ep(this.node,e,"End"))))}unmount(){}}},pan:{Feature:class extends jO{constructor(){super(...arguments),this.removePointerDownListener=jL}onPointerDown(e){this.session=new CD(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:CI(this.node)})}createPanHandlers(){let{onPanSessionStart:e,onPanStart:t,onPan:n,onPanEnd:i}=this.node.getProps();return{onSessionStart:Cz(e),onStart:Cz(t),onMove:n,onEnd:(e,t)=>{delete this.session,i&&jH.postRender(()=>i(e,t))}}}mount(){this.removePointerDownListener=CE(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}},drag:{Feature:class extends jO{constructor(e){super(e),this.removeGroupControls=jL,this.removeListeners=jL,this.controls=new CG(e)}mount(){let{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||jL}update(){let{dragControls:e}=this.node.getProps(),{dragControls:t}=this.node.prevProps||{};e!==t&&(this.removeGroupControls(),e&&(this.removeGroupControls=e.subscribe(this.controls)))}unmount(){this.removeGroupControls(),this.removeListeners()}},ProjectionNode:T0,MeasureLayout:CQ},layout:{ProjectionNode:T0,MeasureLayout:CQ}},Ia=(0,v.createContext)(null),Is=e=>!e.isLayoutDirty&&e.willUpdate(!1),Io=({children:e,id:t,inherit:n=!0})=>{let i=(0,v.useContext)(jv),r=(0,v.useContext)(Ia),[a,s]=function(){let e,t=(e=(0,v.useRef)(!1),jj(()=>(e.current=!0,()=>{e.current=!1}),[]),e),[n,i]=(0,v.useState)(0),r=(0,v.useCallback)(()=>{t.current&&i(n+1)},[n]);return[(0,v.useCallback)(()=>jH.postRender(r),[r]),n]}(),o=(0,v.useRef)(null),l=i.id||r;if(null===o.current){let e,r,a,s;(!0==(!0===(s=n))||"id"===s)&&l&&(t=t?l+"-"+t:l),o.current={id:t,group:!0===n&&i.group||(e=new Set,r=new WeakMap,{add:t=>{e.add(t),r.set(t,t.addEventListener("willUpdate",a))},remove:t=>{e.delete(t);let n=r.get(t);n&&(n(),r.delete(t)),a()},dirty:a=()=>e.forEach(Is)})}}let u=(0,v.useMemo)(()=>({...o.current,forceRender:a}),[s]);return(0,jy.jsx)(jv.Provider,{value:u,children:e})},Il=(0,v.createContext)({strict:!1}),Iu={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Id=!1;function Ic(){return!function(){if(Id)return;let e={};for(let t in Iu)e[t]={isEnabled:e=>Iu[t].some(t=>!!e[t])};Eq=e,Id=!0}(),Eq}function Ip(e){let t=Ic();for(let n in e)t[n]={...t[n],...e[n]};Eq=t}function Ih({children:e,features:t,strict:n=!1}){let[,i]=(0,v.useState)(!Im(t)),r=(0,v.useRef)(void 0);if(!Im(t)){let{renderer:e,...n}=t;r.current=e,Ip(n)}return(0,v.useEffect)(()=>{Im(t)&&t().then(({renderer:e,...t})=>{Ip(t),r.current=e,i(!0)})},[]),(0,jy.jsx)(Il.Provider,{value:{renderer:r.current,strict:n},children:e})}function Im(e){return"function"==typeof e}let If=(0,v.createContext)({});function Ig(e){return Array.isArray(e)?e.join(" "):e}let Ix=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function Iy(e,t,n){for(let i in t)Se(t[i])||E6(i,n)||(e[i]=t[i])}let Iv=()=>({...Ix(),attrs:{}}),Iw=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Ib(e){return e.startsWith("while")||e.startsWith("drag")&&"draggable"!==e||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||Iw.has(e)}let Ij=e=>!Ib(e);try{g=e.r(14653).default,"function"==typeof g&&(Ij=e=>e.startsWith("on")?!Ib(e):g(e))}catch{}let IS=e=>(t,n)=>{let i=(0,v.useContext)(If),r=(0,v.useContext)(jS),a=()=>(function({scrapeMotionValuesFromProps:e,createRenderState:t},n,i,r){return{latestValues:function(e,t,n,i){let r={},a=i(e,{});for(let e in a)r[e]=Tk(a[e]);let{initial:s,animate:o}=e,l=Ez(e),u=EW(e);t&&u&&!l&&!1!==e.inherit&&(void 0===s&&(s=t.initial),void 0===o&&(o=t.animate));let d=!!n&&!1===n.initial,c=(d=d||!1===s)?o:s;if(c&&"boolean"!=typeof c&&!Ei(c)){let t=Array.isArray(c)?c:[c];for(let n=0;n<t.length;n++){let i=T2(e,t[n]);if(i){let{transitionEnd:e,transition:t,...n}=i;for(let e in n){let t=n[e];if(Array.isArray(t)){let e=d?t.length-1:0;t=t[e]}null!==t&&(r[e]=t)}for(let t in e)r[t]=e[t]}}}return r}(n,i,r,e),renderState:t()}})(e,t,i,r);return n?a():jw(a)},Ik=IS({scrapeMotionValuesFromProps:E9,createRenderState:Ix}),IC=IS({scrapeMotionValuesFromProps:E7,createRenderState:Iv}),IT=Symbol.for("motionComponentSymbol"),IE=function(e,{forwardMotionProps:t=!1,type:n}={},i,r){let a=n?"svg"===n:Ii("div"),s=a?IC:Ik;function o(e,n){var i;let r,o,l,u={...(0,v.useContext)(jE),...e,layoutId:function({layoutId:e}){let t=(0,v.useContext)(jv).id;return t&&void 0!==e?t+"-"+e:e}(e)},{isStatic:d}=u,c=function(e){let{initial:t,animate:n}=function(e,t){if(Ez(e)){let{initial:t,animate:n}=e;return{initial:!1===t||T7(t)?t:void 0,animate:T7(n)?n:void 0}}return!1!==e.inherit?t:{}}(e,(0,v.useContext)(If));return(0,v.useMemo)(()=>({initial:t,animate:n}),[Ig(t),Ig(n)])}(e),p=s(e,d);if(!d&&jb){(0,v.useContext)(Il).strict;let e=function(e){let{drag:t,layout:n}=Ic();if(!t&&!n)return{};let i={...t,...n};return{MeasureLayout:t?.isEnabled(e)||n?.isEnabled(e)?i.MeasureLayout:void 0,ProjectionNode:i.ProjectionNode}}(u);r=e.MeasureLayout,c.visualElement=function(e,t,n,i,r,a){let{visualElement:s}=(0,v.useContext)(If),o=(0,v.useContext)(Il),l=(0,v.useContext)(jS),u=(0,v.useContext)(jE).reducedMotion,d=(0,v.useRef)(null);i=i||o.renderer,!d.current&&i&&(d.current=i(e,{visualState:t,parent:s,props:n,presenceContext:l,blockInitialAnimation:!!l&&!1===l.initial,reducedMotionConfig:u,isSVG:a}));let c=d.current,p=(0,v.useContext)(CK);c&&!c.projection&&r&&("html"===c.type||"svg"===c.type)&&function(e,t,n,i){let{layoutId:r,layout:a,drag:s,dragConstraints:o,layoutScroll:l,layoutRoot:u,layoutCrossfade:d}=t;e.projection=new n(e.latestValues,t["data-framer-portal-id"]?void 0:function e(t){if(t)return!1!==t.options.allowProjection?t.projection:e(t.parent)}(e.parent)),e.projection.setOptions({layoutId:r,layout:a,alwaysMeasureLayout:!!s||o&&CP(o),visualElement:e,animationType:"string"==typeof a?a:"both",initialPromotionConfig:i,crossfade:d,layoutScroll:l,layoutRoot:u})}(d.current,n,r,p);let h=(0,v.useRef)(!1);(0,v.useInsertionEffect)(()=>{c&&h.current&&c.update(n,l)});let m=n[Tb],f=(0,v.useRef)(!!m&&!window.MotionHandoffIsComplete?.(m)&&window.MotionHasOptimisedAnimation?.(m));return jj(()=>{c&&(h.current=!0,window.MotionIsMounted=!0,c.updateFeatures(),c.scheduleRenderMicrotask(),f.current&&c.animationState&&c.animationState.animateChanges())}),(0,v.useEffect)(()=>{c&&(!f.current&&c.animationState&&c.animationState.animateChanges(),f.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(m)}),f.current=!1),c.enteringChildren=void 0)}),c}("div",p,u,void 0,e.ProjectionNode,a)}return(0,jy.jsxs)(If.Provider,{value:c,children:[r&&c.visualElement?(0,jy.jsx)(r,{visualElement:c.visualElement,...u}):null,function(e,t,n,{latestValues:i},r,a=!1,s){let o=(s??Ii(e)?function(e,t,n,i){let r=(0,v.useMemo)(()=>{let n=Iv();return E5(n,t,E8(i),e.transformTemplate,e.style),{...n.attrs,style:{...n.style}}},[t]);if(e.style){let t={};Iy(t,e.style,e),r.style={...t,...r.style}}return r}:function(e,t){let n,i,r={},a=(n=e.style||{},Iy(i={},n,e),Object.assign(i,function({transformTemplate:e},t){return(0,v.useMemo)(()=>{let n=Ix();return EJ(n,t,e),Object.assign({},n.vars,n.style)},[t])}(e,t)),i);return e.drag&&!1!==e.dragListener&&(r.draggable=!1,a.userSelect=a.WebkitUserSelect=a.WebkitTouchCallout="none",a.touchAction=!0===e.drag?"none":`pan-${"x"===e.drag?"y":"x"}`),void 0===e.tabIndex&&(e.onTap||e.onTapStart||e.whileTap)&&(r.tabIndex=0),r.style=a,r})(t,i,r,e),l=function(e,t,n){let i={};for(let r in e)("values"!==r||"object"!=typeof e.values)&&(Ij(r)||!0===n&&Ib(r)||!t&&!Ib(r)||e.draggable&&r.startsWith("onDrag"))&&(i[r]=e[r]);return i}(t,"string"==typeof e,a),u=e!==v.Fragment?{...l,...o,ref:n}:{},{children:d}=t,c=(0,v.useMemo)(()=>Se(d)?d.get():d,[d]);return(0,v.createElement)(e,{...u,children:c})}("div",e,(i=c.visualElement,o=(0,v.useRef)(n),(0,v.useInsertionEffect)(()=>{o.current=n}),l=(0,v.useRef)(null),(0,v.useCallback)(e=>{e&&p.onMount?.(e),i&&(e?i.mount(e):i.unmount());let t=o.current;if("function"==typeof t)if(e){let n=t(e);"function"==typeof n&&(l.current=n)}else l.current?(l.current(),l.current=null):t(e);else t&&(t.current=e)},[i])),p,d,t,a)]})}o.displayName="motion.div";let l=(0,v.forwardRef)(o);return l[IT]="div",l}("div",void 0);var II=e.i(873667);function IP(e){return(0,x.jsxs)(ai.default,{...e,children:[(0,x.jsx)("path",{d:"M4.395 4.403a.75.75 0 0 1 1.06 1.06 9.251 9.251 0 0 0 0 13.074.75.75 0 1 1-1.06 1.06 10.75 10.75 0 0 1 0-15.194ZM18.545 4.403a.75.75 0 0 1 1.06 0 10.752 10.752 0 0 1 0 15.194.75.75 0 1 1-1.06-1.06 9.25 9.25 0 0 0 0-13.074.75.75 0 0 1 0-1.06Z"}),(0,x.jsx)("path",{d:"M7.223 7.231a.75.75 0 0 1 1.061 1.06 5.25 5.25 0 0 0 0 7.419.75.75 0 0 1-1.061 1.06 6.751 6.751 0 0 1 0-9.539ZM15.717 7.23a.751.751 0 0 1 1.061.001 6.752 6.752 0 0 1 0 9.538.751.751 0 0 1-1.062-1.06 5.252 5.252 0 0 0 0-7.417.751.751 0 0 1 0-1.062Z"}),(0,x.jsx)("path",{fillRule:"evenodd",d:"M12 9.25a2.75 2.75 0 1 1 0 5.5 2.75 2.75 0 0 1 0-5.5Zm0 1.5a1.25 1.25 0 1 0 0 2.5 1.25 1.25 0 0 0 0-2.5Z",clipRule:"evenodd"})]})}var IA=e.i(593767),IR=e.i(568430),ID=e.i(536262),IV=e.i(705539),I_=e.i(798406);function IM({item:e,onAddToChat:t,onSendToAgent:n,onUpdateStatus:i}){let[r,a]=(0,v.useState)(null),[s,o]=(0,v.useState)(!1),[l,u]=(0,v.useState)(!1),d=(0,v.useRef)(null),{trackClick:c}=(0,pg.useTrackClick)();(0,v.useEffect)(()=>{d.current&&u(d.current.scrollHeight>240)},[e.feedbackText]);let p=e.topic&&hu.INBOX_TOPIC_CONFIG[e.topic]?hu.INBOX_TOPIC_CONFIG[e.topic]:hu.INBOX_TOPIC_CONFIG.other,h=e.user.displayName??e.user.username,m=function(e,t,n){let i="";t&&"other"!==t&&hu.INBOX_TOPIC_CONFIG[t]&&(i=`{{"replit-type": "inbox_topic", "topic": "${t}"}} `);let r="";if(n)try{let e=new URL(n).pathname,t="/"===e?"homepage":`\`${e}\` page`;r=`
Feedback is for the ${t}`}catch{}return`${i}${e}${r}`}(e.feedbackText,e.topic,e.currentPage),f=(0,v.useCallback)(()=>{c({productArea:"agent_inbox",target:"inbox_add_to_chat_button"}),t(m,e.screenshots??void 0),i(e.id,"acknowledged")},[c,t,i,m,e.id,e.screenshots]),g=(0,v.useCallback)(()=>{c({productArea:"agent_inbox",target:"inbox_send_to_agent_button"}),n(m,e.screenshots??void 0),i(e.id,"implemented")},[c,n,i,m,e.id,e.screenshots]),y=(0,v.useCallback)(()=>{c({productArea:"agent_inbox",target:"inbox_resolve_button"}),i(e.id,"dismissed")},[c,i,e.id]),w=(0,v.useCallback)(()=>{c({productArea:"agent_inbox",target:"inbox_delete_button"}),i(e.id,"deleted")},[c,i,e.id]),b=(0,v.useCallback)(()=>{c({productArea:"agent_inbox",target:"inbox_restore_button"}),i(e.id,"pending")},[c,i,e.id]),j=(0,v.useCallback)(()=>{c({productArea:"agent_inbox",target:"inbox_unresolve_button"}),i(e.id,"pending")},[c,i,e.id]),S="pending"===e.status,k="deleted"===e.status,C="dismissed"===e.status||"acknowledged"===e.status||"implemented"===e.status,T=(0,v.useCallback)(e=>{c({productArea:"agent_inbox",target:"inbox_screenshot_thumbnail"}),a(e)},[c]),E=(0,v.useCallback)(()=>{a(null)},[]);return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)(R.ShadesSurface,{elevate:"2x",br:8,gap:8,pb:8,pt:6,px:8,style:k?{opacity:.6}:void 0,children:[(0,x.jsxs)(V.View,{row:!0,align:"center",justify:"space-between",children:[(0,x.jsx)(cH.Pill,{text:p?.label??"Other",colorway:p?.colorway??"grey",variant:"muted",compact:!0}),(0,x.jsxs)(V.View,{row:!0,gap:4,children:[S?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(uX.IconButton,{alt:"Add to chat",onClick:f,children:(0,x.jsx)(IA.default,{})}),(0,x.jsx)(uX.IconButton,{alt:"Send to agent",onClick:g,children:(0,x.jsx)(l9.default,{})})]}):null,k?(0,x.jsx)(uX.IconButton,{alt:"Restore",onClick:b,children:(0,x.jsx)(ID.default,{})}):C?(0,x.jsxs)(cW.PopupMenu,{trigger:(0,x.jsx)(uX.IconButton,{alt:"More actions",children:(0,x.jsx)(dz.default,{})}),"aria-label":"Feedback actions",children:[(0,x.jsx)(cW.MenuItem,{label:"Unresolve",labelProps:{variant:"small"},icon:(0,x.jsx)(IV.default,{size:12}),onAction:j}),(0,x.jsx)(cW.MenuItem,{label:"Delete",labelProps:{variant:"small"},icon:(0,x.jsx)(cg.default,{size:12}),onAction:w})]}):(0,x.jsxs)(cW.PopupMenu,{trigger:(0,x.jsx)(uX.IconButton,{alt:"More actions",children:(0,x.jsx)(dz.default,{})}),"aria-label":"Feedback actions",children:[(0,x.jsx)(cW.MenuItem,{label:"Resolve",labelProps:{variant:"small"},icon:(0,x.jsx)(II.default,{size:12}),onAction:y}),(0,x.jsx)(cW.MenuItem,{label:"Delete",labelProps:{variant:"small"},icon:(0,x.jsx)(cg.default,{size:12}),onAction:w})]})]})]}),(0,x.jsxs)(V.View,{row:!0,gap:4,align:"center",children:[(0,x.jsx)(cz.Avatar,{src:e.user.image,username:e.user.username,fullName:e.user.fullName??void 0,size:20,ringColor:"transparent"}),(0,x.jsxs)(V.View,{row:!0,gap:8,align:"baseline",children:[(0,x.jsx)(st.Text,{color:"dimmer",children:h}),(0,x.jsx)(c6.Timestamp,{date:e.timeCreated,textColor:"dimmest",textVariant:"small",live:!0})]})]}),(0,x.jsxs)(V.View,{children:[(0,x.jsx)(V.View,{innerRef:d,clsx:[I_.default.feedbackText,{[I_.default.feedbackTextCollapsed]:!s},{[I_.default.feedbackTextFaded]:!s&&l}],children:(0,x.jsx)(st.Text,{children:e.feedbackText})}),l?(0,x.jsx)(se.Button,{clsx:I_.default.showButton,text:s?"Show less":"Show more",iconRight:s?(0,x.jsx)(IR.default,{}):(0,x.jsx)(g2.default,{}),variant:"underlinedOnHover",size:"small",onClick:()=>o(!s)}):null]}),e.screenshots&&e.screenshots.length>0?(0,x.jsx)(IG,{screenshots:e.screenshots,onScreenshotClick:T}):null]}),(0,x.jsx)(I$,{isOpen:null!==r,screenshotUrl:r,onClose:E})]})}var IF=e.i(399978),IO=e.i(913811),IL=e.i(230776),IB=e.i(445059),IU=e.i(124803);function IN({url:e,index:t,onClick:n}){let[i,r]=(0,v.useState)(!1);return(0,x.jsxs)("button",{type:"button",onClick:()=>n(e),clsx:IU.default.screenshotThumbnailButton,"aria-label":`View screenshot ${t+1}`,children:[!i&&(0,x.jsx)(R.ShadesSurface,{br:4,clsx:IU.default.thumbnailShimmer,style:{width:80,height:60,position:"absolute"}}),(0,x.jsx)(jh.default,{src:e,alt:`Screenshot ${t+1}`,width:80,height:60,unoptimized:!0,loading:"lazy",clsx:IU.default.screenshotThumbnail,onLoad:()=>r(!0),style:{opacity:+!!i}})]})}function IG({screenshots:e,onScreenshotClick:t}){if(!e||0===e.length)return null;let n=e.filter(e=>null!==e);return 0===n.length?null:(0,x.jsx)(V.View,{row:!0,wrap:!0,gap:8,pt:4,children:n.map((e,n)=>(0,x.jsx)(IN,{url:e,index:n,onClick:t},n))})}function I$({isOpen:e,screenshotUrl:t,onClose:n}){let[i,r]=(0,v.useState)(!0);return((0,v.useEffect)(()=>{e&&t&&r(!0)},[e,t]),t)?(0,x.jsx)(aK.Modal,{isOpen:e,onRequestClose:n,maxWidth:872,centered:!0,noPadding:!0,children:(0,x.jsxs)(V.View,{align:"center",justify:"center",p:16,children:[i?(0,x.jsx)(R.ShadesSurface,{br:8,clsx:IU.default.loadingShimmer,style:{width:840,height:600}}):null,(0,x.jsx)(jh.default,{src:t,alt:"Screenshot preview",width:840,height:600,clsx:IU.default.modalImage,onLoad:()=>r(!1),unoptimized:!0,style:{display:i?"none":"block"}})]})}):null}function Iz({item:e,onAddToChat:t,onSendToAgent:n,onUpdateStatus:i}){return(0,x.jsx)(IE,{layout:!0,initial:{opacity:0,scale:.92,y:-8},animate:{opacity:1,scale:1,y:0,x:0,rotate:0},exit:{opacity:0,x:60,scale:.97,rotate:.8,transition:{duration:.3,ease:[.4,0,1,1]}},transition:{type:"spring",stiffness:400,damping:25,mass:.8,layout:{duration:.3,ease:[.4,0,.2,1]}},children:(0,x.jsx)(IM,{item:e,onAddToChat:t,onSendToAgent:n,onUpdateStatus:i})})}function IW(){let e,{data:t}=lV({variables:{replId:(0,a9.default)()}}),{addToChat:n,sendToAgent:i}=function(){let e,t=(0,dx.useChatter)(),{showError:n}=(0,sr.default)(),i=(0,lT.useObservable)(t.sessions.agent.current),r=aD(),a=(e=n8(),(0,v.useCallback)(t=>{let n=e.get(nR);n?.openAgentWithPrompt(t)},[e])),{fs:s}=(0,sg.default)(),o=(0,fE.useIsAgentOptimisticallyWorking)(),l=(0,IO.useSetQueueIsOpen)(),u=(0,v.useCallback)((e,t)=>{a({promptValue:e,attachments:t})},[a]),d=(0,v.useCallback)(async(e,a)=>{try{let n=i;if(!n){let e=await t.sessions.create({sessionType:dg.SessionType.AGENT_SESSION});if(!e.ok)throw Error("Failed to create Agent session");n=e.payload}r.toggle(!0);let u=[];if(a&&a.length>0)for(let{fileName:e,file:t}of(await b6({urls:a,sentryContext:{sessionId:n.id}})))try{await (0,IF.uploadFiles)({parentPath:IB.ATTACHED_ASSETS_PATH,files:[t],fs:s,onError:e=>{throw e}}),u.push({path:`${IB.ATTACHED_ASSETS_PATH}/${e}`,mimeType:t.type,file:t,isLoading:!1})}catch(t){dm.withScope(i=>{i.setTag("agent-inbox-feedback-to-agent",!0),i.setTag("session-id",n.id),dm.captureException(t,{extra:{message:"Error uploading screenshot",sessionId:n.id,fileName:e}})})}if(o){let n=(0,IL.packContentsForQueuedMessage)({text:e,attachedFiles:u});if(!(await t.queue.enqueue({contents:n})).ok)throw Error("Failed to queue Agent message");l(!0)}else await n.appendEvent({kind:"message",message:e,intent:dg.MessageAction.AGENT,uploadedFiles:u.map(({path:e,mimeType:t})=>({path:e,mimeType:t}))})}catch(e){dm.withScope(t=>{t.setTag("agent-inbox-feedback-to-agent",!0),dm.captureException(e)}),n("Error sending feedback to Agent")}},[t.sessions,t.queue,i,r,n,s,o,l]);return{addToChat:u,sendToAgent:d}}(),[r]=(e={...lA,...void 0},U.useMutation(lM,e)),[a,s]=[(0,lL.useValue)(lN),(0,lL.useSet)(lN)],o=(0,ok.useDeploymentCurrentBuild)(),{preferences:{agentPosition:l},update:u}=(0,lc.usePreferences)("agentPosition"),{trackClick:d}=(0,pg.useTrackClick)(),c=t?.getRepl?.__typename==="Repl"?t.getRepl.agentFeedback:null,p=function(e,t,n){let i=function(e,t){(0,jf.default)(2,arguments);var n=(0,jg.default)(t);return(0,jx.default)(e,-n)}(new Date,7);switch(t){case"new":default:return e.filter(e=>"pending"===e.status);case"resolved":return e.filter(e=>"dismissed"===e.status||"acknowledged"===e.status||"implemented"===e.status);case"current_deployment":return e.filter(e=>"pending"===e.status&&n&&e.build?.id===n);case"recently_deleted":return e.filter(e=>"deleted"===e.status&&function(e,t){(0,jf.default)(2,arguments);var n=(0,jm.default)(e),i=(0,jm.default)(t);return n.getTime()>i.getTime()}(new Date(e.timeUpdated),i))}}(c?.__typename==="ReplAgentFeedback"?c.items:[],a,o?.id),h=0===p.length,m=(0,v.useCallback)(e=>{if("all"===e)return;let t=[...e][0];t&&(d({productArea:"agent_inbox",target:"inbox_filter_menu_item"}),s(t))},[d,s]),f=(0,v.useCallback)(()=>{d({productArea:"agent_inbox",target:"inbox_sidebar_move_button"}),u({agentPosition:"leftSidebar"===l?"rightSidebar":"leftSidebar"})},[d,l,u]);return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)(V.View,{row:!0,gap:4,align:"center",pl:6,pr:4,children:[(0,x.jsx)(V.View,{grow:!0,shrink:!0,row:!0,gap:4,align:"center",children:(0,x.jsx)(st.Text,{children:"Inbox"})}),(0,x.jsxs)(cW.PopupMenu,{trigger:(0,x.jsx)(se.Button,{text:lB[a],iconRight:(0,x.jsx)(pk.default,{}),size:"xsmall",variant:"nofill"}),"aria-label":"Inbox filter",selectionMode:"single",selectedKeys:new Set([a]),onSelectionChange:m,children:[(0,x.jsx)(cW.MenuItem,{id:"new",label:lB.new,labelProps:{variant:"small"},icon:(0,x.jsx)(hV.default,{size:12}),iconRight:"new"===a?(0,x.jsx)(p5.default,{}):null}),(0,x.jsx)(cW.MenuItem,{id:"resolved",label:lB.resolved,labelProps:{variant:"small"},icon:(0,x.jsx)(II.default,{size:12}),iconRight:"resolved"===a?(0,x.jsx)(p5.default,{}):null}),(0,x.jsx)(cW.MenuItem,{id:"current_deployment",label:lB.current_deployment,labelProps:{variant:"small"},icon:(0,x.jsx)(IP,{size:12}),iconRight:"current_deployment"===a?(0,x.jsx)(p5.default,{}):null}),(0,x.jsx)(cW.MenuItem,{id:"recently_deleted",label:lB.recently_deleted,labelProps:{variant:"small"},icon:(0,x.jsx)(cg.default,{size:12}),iconRight:"recently_deleted"===a?(0,x.jsx)(p5.default,{}):null})]}),(0,x.jsx)(cW.PopupMenu,{trigger:(0,x.jsx)(uX.IconButton,{alt:"More options",children:(0,x.jsx)(dz.default,{color:A.tokens.foregroundDimmest})}),"aria-label":"Inbox options",children:(0,x.jsx)(cW.MenuItem,{label:`Move sidebar to the ${"leftSidebar"===l?"left":"right"}`,labelProps:{variant:"small"},icon:"leftSidebar"===l?(0,x.jsx)(as.default,{size:12}):(0,x.jsx)(ao.default,{size:12}),onAction:f})})]}),(0,x.jsxs)(V.View,{grow:!0,shrink:!0,clsx:IU.default.scrollableContent,children:[(0,x.jsx)(Ih,{features:Ir,children:(0,x.jsx)(Io,{children:(0,x.jsx)(V.View,{clsx:IU.default.filterContainer,children:(0,x.jsx)(V.View,{gap:10,p:8,clsx:IU.default.itemsContainer,children:(0,x.jsx)(jF,{initial:!1,mode:"popLayout",children:p.map(e=>(0,x.jsx)(Iz,{item:e,onAddToChat:n,onSendToAgent:i,onUpdateStatus:(e,t)=>r({variables:{input:{id:e,status:t}}})},e.id))})})},a)})}),h?(0,x.jsxs)(V.View,{align:"center",pt:64,gap:8,clsx:IU.default.emptyState,children:[(0,x.jsx)(lI,{size:24}),(0,x.jsx)(st.Text,{color:"dimmer",children:"Inbox is empty"})]}):null]})]})}var IH=e.i(978497),Iq=e.i(779830),IK=e.i(160290),IY=e.i(710078),IX=e.i(939040),IQ=e.i(491694);let IZ=(0,A.cvarsFrom)("Search.module.css",["--input-height"]),IJ={type:"context",icon:(0,x.jsx)(oH.default,{}),label:"",description:"Search"};function I0(e){let{fs:t}=(0,sg.default)(),n=(0,nC.useGetRecentFiles)(),i=aC(),r=(0,lS.useShouldHideFileInWorkspace)(),a=(0,v.useMemo)(()=>{let e=(0,ly.createFindOrCreateFileCommand)({openFile:i,fs:t,shouldHideFile:r,getRecentFiles:n});return e.data=IJ,delete e.match,e},[i,t,r,n]);return(0,x.jsx)(V.View,{onContextMenu:e.onContextMenu,clsx:IQ.default.root,style:{[IZ.inputHeight]:"32px"},children:(0,x.jsx)(aY.CommandBar,{fullWidth:!0,command:a,openOnInput:!0,compact:!0})})}var I1=e.i(483570),I2=e.i(312421),I5=e.i(714312),I4=e.i(712771),I8=e.i(840111),I3=e.i(240913),I6=e.i(133294),I9=e.i(185511),I7=e.i(274526),Pe=e.i(714603);function Pt({size:e,iconUrl:t,name:n}){return(0,x.jsx)(f0.default,{src:t,width:e,height:e,alt:`Icon for file opener: ${n}`})}let Pn=/[*]{2}\/[*]\.([a-z0-9.]+)/;var Pi=e.i(943124);function Pr({onClose:e}){let{filetree:t,activeModal:n,closeModal:i,onRootContextMenu:r}=function(){let e=(0,a9.default)(),[t,n]=(0,v.useState)(null),i=aC(),r=(0,I2.useTrackOpenFile)(),a=(0,lS.useShouldHideFileInWorkspace)(!0),s=(0,v.useCallback)(e=>!a(e.filename),[a]),{fs:o}=(0,sg.default)(),{preferences:l}=(0,lc.usePreferences)("multiselectModifierKey"),u=n9(tj),d="cmdOrCtrlKey"===l.multiselectModifierKey?"cmdOrCtrlKey":"altKey",c=(0,nC.useGetRecentFiles)(),p=(0,v.useCallback)(e=>(0,I5.getFileExtensionSuggestions)(e,c),[c]),{onContextMenu:h}=(0,fe.useContextMenu)(),m=function(){let e=(0,a9.default)(),{fs:t}=(0,sg.default)(),n=aC(),i=n9(nI),r=n3(tg),a=(0,sl.useExtensionCommands)(s_.ContributionType.FiletreeContextMenu),s=n3(iT),o=n9(iP),l=(0,H.useFlag)({controlName:"flag-folder-downloads"}),u=(0,H.useFlag)({controlName:"flag-direct-file-downloads"}),d=n9(iE),c=(0,v.useCallback)(e=>{let{extensionId:t,fileExtension:n,fileHandlerId:i}=e,r=s[n];r&&r.extensionId===t&&r.fileHandlerId===i||d(e)},[d,s]),p=(0,v.useCallback)((i,l)=>{let{path:d}=i,p=[{data:{type:"group",key:"rename"},commands:()=>[(0,I7.getRenameCommand)(()=>l.rename(d))]}];(0,rt.isOTFile)(d)&&p.push({data:{type:"group",key:"saveFile"},commands:()=>[(0,I7.getSaveCommand)(async()=>{await t.flush(new Set([d]),n_.FlushSource.MANUAL_SAVE)})]}),p.push({data:{type:"group",key:"open"},commands:()=>(function({path:e,getSelectedNodes:t,openFile:n}){let i=[{type:n_.FileType.File,path:e}];for(let[n,r]of t())r!==n_.FileType.Directory&&n!==e&&i.push({path:n,type:r});let r=i.length,a=1===r?"Open":`Open ${r} files`;return[{label:a,icon:(0,x.jsx)(I4.default,{}),run:()=>{for(let e of i)n({path:e.path,newTab:!0})}},{label:a+" in split",icon:(0,x.jsx)(as.default,{}),run:()=>{let[e,...t]=i;for(let i of(n({path:e.path,newPane:!0}),t))n({path:i.path,newTab:!0})}}].map(({label:e,icon:t,run:n})=>({match:a_.matchLabel,data:{type:"action",label:e,icon:t,run:n}}))})({path:d,getSelectedNodes:l.getSelectedNodes,openFile:n})});let h=function({path:e,handlers:t,filetypeAssociations:n,openFile:i,requestAssociateFiletype:r,associateFiletype:a}){let s=(0,rn.getFileExtension)(e),o=s?n[s]:null,l=[];for(let n in t){let a=t[n],s=(0,gu.globToRegExp)(a.glob);if(!s||!s.exec(e))continue;let o=Pn.exec(a.glob),u=a.icon?a.icon:a.extension.manifest.icon,d=a.name?a.name:a.extension.manifest.name,c=u?(0,sc.getAssetUrl)(a.extension.baseUrl,u):null;l.push({match:a_.matchLabel,data:{type:"action",icon:c?(0,x.jsx)(Pt,{size:16,name:d,iconUrl:c}):(0,x.jsx)(I4.default,{}),label:"Open with "+d,run:()=>{o&&r({extensionId:a.extension.extensionId,fileHandlerId:n,fileExtension:o[1]}),i({path:e,opener:{paneType:"extension",supports:()=>!0,extensionFileHandler:a}})}}})}return o&&s&&l.length&&l.push({match:a_.matchLabel,data:{icon:(0,x.jsx)(cg.default,{}),type:"action",label:"Use default opener",run:()=>{a({fileExtension:s,newAssociation:null})}}}),l}({path:d,handlers:r,filetypeAssociations:s,requestAssociateFiletype:c,associateFiletype:o,openFile:n});return h.length&&p.push({data:{type:"group",key:"extensions"},commands:()=>h}),p.push({data:{type:"group",key:"copy"},commands:()=>(0,I7.getCopyCommands)(d)}),p.push((0,I7.getDuplicateCommand)(async()=>{let n=null;try{n=await (0,I6.default)(d,t)}catch(e){return{type:"error",message:"Error duplicating file"}}(0,Pe.default)({replId:e,action:"duplicated",fileType:n_.FileType.File}),l.rename(n)})),p.push((0,I9.createDownloadCommand)(d,t,u)),p.push({data:{type:"group",key:"deleteFile"},commands:()=>[(0,I7.getDeleteCommand)(()=>l.deleteNodes(i))]}),p.push({data:{type:"group",key:"extensions"},commands:async()=>{let e=[{data:{filePath:d,fileType:n_.FileType.File}}];return(await Promise.all(a.map(async t=>{let n=await t.create({path:e});return n?(0,sd.wrapExtensionCommand)(n,{path:e}):null}))).filter(Boolean)}}),p},[r,s,c,o,n,t,u,e,a]),h=(0,wm.useSetAreHiddenFilesVisible)(),m=(0,wm.useAreHiddenFilesVisible)(),{preferences:{agentPosition:f},update:g}=(0,lc.usePreferences)("agentPosition"),y=(0,v.useCallback)((e,t)=>{let{path:n}=e,r=n===I3.ROOT_PATH,s=r?[]:[{data:{type:"group",key:"rename"},commands:()=>[(0,I7.getRenameCommand)(()=>t.rename(e.path))]}];if(s.push({data:{type:"group",key:"search"},commands:()=>{var t;return[(t=e.path,{match:a_.matchLabel,data:{type:"action",icon:(0,x.jsx)(oH.default,{}),label:"Search this directory",run:()=>{i({pane:{type:"searchReplace",data:{initialIncludeGlob:`${t}/**`}},edge:"right"})}}})]}}),s.push(...(0,I7.getCreateCommands)(n=>t.create(n,e.path))),s.push({data:{type:"group",key:"openShell"},commands:()=>[{match:a_.matchLabel,data:{type:"action",label:"Open shell here",icon:(0,x.jsx)(I8.default,{}),run:()=>{i({pane:{type:"shell",data:{initialPwd:n}},edge:"left"})}}}]}),r||s.push({data:{type:"group",key:"copy"},commands:()=>(0,I7.getCopyCommands)(n)}),t.getExpandedDirs()&&s.push({match:a_.matchLabel,data:{icon:(0,x.jsx)(yp.default,{}),type:"action",label:"Collapse "+(r?"all":"child folders"),run(){let e=t.getExpandedDirs(n);e&&t.collapse([...e])}}}),!r&&l&&s.push({data:{type:"group",key:"downloadFolder"},commands:()=>[(0,I9.createDownloadFolderCommand)(n)]}),r||s.push({data:{type:"group",key:"deleteFile"},commands:()=>[(0,I7.getDeleteCommand)(()=>t.deleteNodes(e))]}),r&&s.push({data:{type:"group",key:"hiddenFiles"},commands:()=>[{match:a_.matchLabel,data:{type:"action",label:(m?"Hide":"Show")+" hidden files",icon:m?(0,x.jsx)(cc.default,{}):(0,x.jsx)(I4.default,{}),run(){h(!m)}}}]}),s.push({data:{type:"group",key:"extensions"},commands:async()=>{let e=[{data:{dirPath:n,fileType:n_.FileType.Directory}}];return(await Promise.all(a.map(async t=>{let n=await t.create({path:e});return n?(0,sd.wrapExtensionCommand)(n,{path:e}):null}))).filter(Boolean)}}),r){let e={type:"action",label:"Move sidebar to the "+("leftSidebar"===f?"left":"right"),icon:"leftSidebar"===f?(0,x.jsx)(as.default,{}):(0,x.jsx)(ao.default,{}),run(){g({agentPosition:"leftSidebar"===f?"rightSidebar":"leftSidebar"})}};s.push({data:{type:"group",key:"move"},commands:()=>[{match:a_.matchLabel,data:e}]})}return s},[m,h,a,i,l,g,f]);return(0,v.useCallback)((e,t)=>({data:{type:"context",label:"Search actions",icon:(0,x.jsx)(oH.default,{})},commands:()=>e.type===n_.FileType.Directory?y(e,t):p(e,t)}),[p,y])}(),f=(0,wm.useSetFileRenameInProgress)(),g=(0,IK.useFiletree)({fs:o,filter:s,fontSize:13,onFileDoubleClick(e,t){u(t)},onFileSelect({path:e,type:t,event:n}){let a="click"===t&&"altKey"===d?(0,l4.getCmdOrCtrl)(n):n.altKey;i({path:e,newTab:a}),r(e,{newTab:a})},onCreate(e){e.type===n_.FileType.File&&i({opener:{paneType:(0,e9.getPaneTypeForFile)({path:e.path})},path:e.path})},multiselectModifierKey:d,onConflicts:e=>n({type:"conflicts",data:e}),onDeleteNodes:e=>n({type:"deleteNode",data:e}),onContextMenu:(e,t)=>h(e,{command:m(t,g)}),autocomplete:p,localCacheKey:e+":sidebar",onFileRenameStart:f,onFileRenameEnd:()=>f(null)}),y=(0,I1.useFileTreeGitStatus)();(0,v.useEffect)(()=>g.setFileStatus(y),[g,y]);let w=(0,nC.useObservableActiveFile)();(0,v.useEffect)(()=>{async function e(e){null===e?g.select(null):(await g.select({path:e,type:n_.FileType.File}),w.current===e&&g.scrollToPath(e))}return e(w.current),w.subscribe(e)},[w,g]);let b=aA(),j=(0,up.default)(b.activeContent),S=(0,nC.useObservableRevealFile)(),k=(0,nC.useSetRevealFile)();(0,v.useEffect)(()=>{async function e(e){null!==e&&("filetree"!==j&&b.toggleContent("filetree"),await g.select({path:e,type:n_.FileType.File}),g.scrollToPath(e),k(null))}return e(S.current),S.subscribe(e)},[S,k,g,b,j]);let C=(0,v.useCallback)(e=>h(e,{command:m({type:n_.FileType.Directory,path:"."},g)}),[g,m,h]);return{filetree:g,activeModal:t,closeModal:()=>n(null),onRootContextMenu:C}}();return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)(V.View,{clsx:Pi.default.header,row:!0,gap:4,align:"center",pl:6,pr:4,children:[(0,x.jsx)(V.View,{grow:!0,shrink:!0,row:!0,gap:4,align:"center",children:(0,x.jsx)(st.Text,{css:Pi.default.title,children:"Files"})}),(0,x.jsxs)(V.View,{row:!0,gap:0,align:"center",children:[(0,x.jsx)(uX.IconButton,{dataCy:"filetree-add-file",alt:"New file",onClick:()=>{t.create(n_.FileType.File)},children:(0,x.jsx)(ym.default,{})}),(0,x.jsx)(uX.IconButton,{alt:"New folder",onClick:()=>{t.create(n_.FileType.Directory)},children:(0,x.jsx)(IH.default,{})}),(0,x.jsx)(Iq.RootActions,{closeFiletree:e,filetree:t})]})]}),(0,x.jsxs)(V.View,{clsx:Pi.default.content,grow:!0,shrink:!0,children:[(0,x.jsx)(I0,{onContextMenu:r}),(0,x.jsx)(V.View,{grow:!0,shrink:!0,dataCy:"sidebar-filetree-section",children:(0,x.jsx)(IK.Filetree,{store:t.store})})]}),(0,x.jsxs)(aK.Modal,{isOpen:!!n,onRequestClose:i,children:[n?.type==="conflicts"?(0,x.jsx)(IY.default,{paths:n.data.conflicts.map(e=>e.path),onCancel:i,onConfirm:()=>{let{data:e}=n;"move"===e.type?t.move({nodes:e.nodes,to:e.to,overwrite:!0}):t.upload({files:e.files,parentPath:e.to,overwrite:!0}),i()}}):null,n?.type==="deleteNode"?(0,x.jsx)(di.default,{...(0,IX.getDeleteText)(n.data.nodes),delete:()=>n.data.confirm(),hideModal:i}):null]})]})}function Pa(){let e=aA(),t=aD(),n=(0,up.default)(t.agentFiletreeOrder),i=(0,v.useRef)(null);return(0,x.jsx)(jt,{gutter:t.gutter,side:"agent-filetree"===n?"left":"right",onPointerDown:function(t){(0,mL.measureMouseMove)(t,{start(){document.activeElement instanceof HTMLElement&&(i.current=document.activeElement),e.resize.start()},move({delta:t}){e.resize.update(t.x)},end(){e.resize.end(),i.current?.focus?.(),i.current=null}})},onDoubleClick:()=>{e.closeSidebar()}})}let Ps=(0,A.cvarsFrom)("index.module.css",["--width","--height","--transform","--pointer-events","--opacity","--z-index"]),Po=(0,v.memo)(function(){let e=(0,v.useRef)(null),t=aA(),{view:n}=t,i=(0,up.default)(t.activeContent);!function(){let e=(0,a9.default)(),{subscribeToMore:t}=lV({variables:{replId:e}});(0,v.useEffect)(()=>t({document:l_,variables:{replId:e},updateQuery:(e,{subscriptionData:t})=>{let n=t.data?.agentFeedback;return n?(0,eq.produce)(e,e=>{if(e.getRepl?.__typename!=="Repl"||e.getRepl.agentFeedback?.__typename!=="ReplAgentFeedback")return;let t=e.getRepl.agentFeedback.items,i=t.findIndex(e=>e.id===n.id);i>=0?t[i]=n:t.unshift(n),e.getRepl.agentFeedback.pendingCount=t.filter(e=>"pending"===e.status).length}):e}}),[e,t])}();let{isAvailable:r}=lG();(0,v.useEffect)(()=>{"inbox"!==i||r||t.closeSidebar()},[i,r,t]),(0,tZ.useStyleSet)(e,mD(n,t.getTransitionEnabled),e=>({[Ps.width]:e.width+"px",[Ps.height]:e.height+"px",[Ps.transform]:`translate(${e.x}px, ${e.y}px)`,[Ps.pointerEvents]:e.isOpen?"all":"none",[Ps.opacity]:e.opacity.toString(),[Ps.zIndex]:tN.filetreeDragLayer.toString()}));let a=(0,v.useCallback)(()=>{t.closeSidebar()},[t]);return(0,x.jsxs)(R.ShadesSurface,{clsx:Pi.default.root,innerRef:e,elevate:!1,children:["filetree"===i?(0,x.jsx)(Pr,{onClose:a}):null,"inbox"===i?(0,x.jsx)(IW,{}):null,(0,x.jsx)(Pa,{})]})});var Pl=e.i(437535);let Pu={IN_PROGRESS:Pl.default.blue,PREPARING_FOR_MERGE:Pl.default.blue,REQUEST_INPUT:Pl.default.yellow,READY_TO_MERGE:Pl.default.yellow,COMPLETED:Pl.default.green,PROPOSED:Pl.default.grey,PENDING:Pl.default.grey,CANCELLED:Pl.default.red};function Pd({isActive:e}){let t=function(){let e=n3(tL),{replId:t}=(0,w4.useTasksContext)(),{data:n}=(0,bZ.useLiveQuery)(e=>e.from({taskItems:bR.TasksCollection}).where(e=>(0,bQ.eq)(e.taskItems.replId,t)));if(!e)return;let i=n?.find(t=>t.id===e);return i?.state}(),n=n3(t$);if(!e||!t)return null;let i=Pu[t]??Pl.default.grey,r={left:n.x,top:n.y,width:n.width,height:n.height,zIndex:tN.subreplBorder};return(0,x.jsx)(V.View,{clsx:[Pl.default.overlay,i],style:r})}var Pc=e.i(928807);function Pp({isActive:e}){let t=n3(tz);return e?(0,x.jsxs)(V.View,{clsx:[Pc.default.overlay,Pc.default.actions],style:t,row:!0,align:"center",px:6,gap:4,children:[(0,x.jsx)(pl,{}),(0,x.jsx)(hD,{flipped:!0})]}):null}function Ph({onClose:e,onTaskCreated:t}){let{replId:n}=(0,w4.useTasksContext)(),[i,r]=(0,v.useState)(""),[a,s]=(0,v.useState)(""),[o,l]=(0,v.useState)("");return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(st.Text,{variant:"headerDefault",children:"Add new task"}),(0,x.jsxs)(V.View,{gap:12,children:[(0,x.jsx)(cL.Input,{placeholder:"Task title",value:i,onChange:e=>r(e.target.value)}),(0,x.jsx)(cL.MultiLineInput,{placeholder:"Task description",value:a,onChange:e=>s(e.target.value),autoSize:!0})]}),o?(0,x.jsx)(st.Text,{color:"dimmer",variant:"small",children:o}):null,(0,x.jsxs)(V.View,{row:!0,gap:8,justify:"end",children:[(0,x.jsx)(se.Button,{variant:"nofill",text:"Cancel",onClick:()=>{r(""),s(""),l(""),e()}}),(0,x.jsx)(se.Button,{variant:"default",colorway:"primary",text:"Create task",onClick:()=>{if(!i.trim()||!a.trim())return void l("Both title and description are required");l("");let o=`temp-${Date.now()}-${Math.random()}`,u=new Date().toISOString(),d={id:o,replId:n,title:i.trim(),description:a.trim(),state:"PENDING",createdAt:u,updatedAt:u};bR.TasksCollection.insert(d),r(""),s(""),l(""),t?.(d),e()}})]})]})}var Pm=e.i(460206),Pf=e.i(851722);function Pg({selectedTaskId:e,onSelectTask:t,onSelectMainVersion:n}){let{replId:i}=(0,w4.useTasksContext)(),{data:r}=(0,bZ.useLiveQuery)(e=>e.from({taskItems:bR.TasksCollection}).where(e=>(0,bQ.eq)(e.taskItems.replId,i)).orderBy(({taskItems:e})=>e.createdAt,"desc")),a=r?.filter(e=>!["COMPLETED","CANCELLED"].includes(e.state))??[];return(0,x.jsxs)(V.View,{gap:2,children:[(0,x.jsx)(uX.IconButton,{alt:"Main version",onClick:n,colorway:e?void 0:"primary",filled:!e,size:32,children:(0,x.jsx)(II.default,{})}),a.map(n=>{let i=n.id===e;return(0,x.jsx)(uX.IconButton,{alt:n.title,onClick:()=>t(n.id),colorway:i?"primary":void 0,filled:i,size:32,children:(0,x.jsx)(Pf.default,{})},n.id)})]})}var Px=e.i(125822);function Py({selectedTaskId:e,onSelectTask:t,onSelectMainVersion:n,onToggle:i,isOnLeft:r}){return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(V.View,{align:"center",children:(0,x.jsx)(Pg,{selectedTaskId:e,onSelectTask:t,onSelectMainVersion:n})}),(0,x.jsx)(V.View,{clsx:[Px.default.toggleButton,r?Px.default.left:Px.default.right],children:(0,x.jsx)(uX.IconButton,{alt:"Expand tasks",onClick:()=>i(!0),size:32,children:(0,x.jsx)(hP.default,{})})})]})}var Pv=e.i(526896),Pw=e.i(298924);function Pb({selectedTaskId:e,pendingTaskTitle:t,activeTasks:n,onSelectMainVersion:i,onSelectTask:r,onRunTask:a,onMerge:s,onDelete:o,onAddTask:l}){return(0,x.jsxs)(V.View,{gap:12,grow:!0,clsx:Pw.default.scrollContainer,children:[(0,x.jsx)(R.ShadesSurface,{p:8,br:"container",border:"subtle",onClick:i,colorShade:e||t?void 0:"notice",clsx:Pw.default.clickable,children:(0,x.jsx)(st.Text,{children:"Main version"})}),(0,x.jsx)(V.View,{gap:8,children:0===n.length?(0,x.jsx)(st.Text,{color:"dimmer",children:"No tasks yet"}):n.map(n=>{let i=!!(n.id===e||t&&n.title===t);return(0,x.jsx)(Pv.TaskCard,{task:n,isSelected:i,onSelect:r,onRunTask:a,onMerge:s,onDelete:o},n.id)})}),(0,x.jsx)(se.Button,{text:"Add new task",iconLeft:(0,x.jsx)(a5.default,{}),onClick:l,stretch:!0})]})}var Pj=e.i(670690);function PS({selectedTaskId:e,pendingTaskTitle:t,activeTasks:n,onToggle:i,onSelectMainVersion:r,onSelectTask:a,onRunTask:s,onMerge:o,onDelete:l,onAddTask:u}){return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(V.View,{p:12,gap:12,grow:!0,children:(0,x.jsx)(Pb,{selectedTaskId:e,pendingTaskTitle:t,activeTasks:n,onSelectMainVersion:r,onSelectTask:a,onRunTask:s,onMerge:o,onDelete:l,onAddTask:u})}),(0,x.jsx)(V.View,{clsx:Pj.default.toggleButton,children:(0,x.jsx)(uX.IconButton,{alt:"Collapse tasks sidebar",onClick:()=>i(!1),size:32,children:(0,x.jsx)(pT.default,{})})})]})}var Pk=e.i(2865);function PC({selectedTaskId:e,pendingTaskTitle:t,activeTasks:n,onToggle:i,onSelectMainVersion:r,onSelectTask:a,onRunTask:s,onMerge:o,onDelete:l,onAddTask:u}){return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(V.View,{p:12,gap:12,grow:!0,children:(0,x.jsx)(Pb,{selectedTaskId:e,pendingTaskTitle:t,activeTasks:n,onSelectMainVersion:r,onSelectTask:a,onRunTask:s,onMerge:o,onDelete:l,onAddTask:u})}),(0,x.jsx)(V.View,{clsx:Pk.default.toggleButton,children:(0,x.jsx)(uX.IconButton,{alt:"Collapse tasks sidebar",onClick:()=>i(!1),size:32,children:(0,x.jsx)(pT.default,{})})})]})}function PT(){let e,t,n=aR(),i=aD(),r=(0,up.default)(i.agentFiletreeOrder),a=(0,up.default)(n.isOpen),s=n3(tL),o=(e=n9(tU),t=(0,dx.useChatter)(),(0,v.useCallback)(async n=>{if(!n)return void e(void 0);let i=bR.TasksCollection.get(n);if(!i?.subreplRunId)return void e({taskId:n});try{let r=await t.subreplrun.run(i.subreplRunId).data.once();e({taskId:n,subreplId:r.subreplId})}catch(t){dm.captureException(t),e({taskId:n})}},[e,t])),l=(0,Pm.useTaskMerge)(),u=(0,dx.useChatter)(),{replId:d}=(0,w4.useTasksContext)(),[c,p]=(0,v.useState)(null),[h,m]=(0,v.useState)(!1),{data:f}=(0,bZ.useLiveQuery)(e=>e.from({taskItems:bR.TasksCollection}).where(e=>(0,bQ.eq)(e.taskItems.replId,d)).orderBy(({taskItems:e})=>e.createdAt,"desc")),g=f?.filter(e=>!["COMPLETED","CANCELLED"].includes(e.state))??[],y=(0,v.useCallback)(e=>{a||e!==s?(o(e),p(null)):n.toggle(!0)},[o,a,s,n]),w=(0,v.useCallback)(()=>{a||s?(o(void 0),p(null)):n.toggle(!0)},[o,a,s,n]),b=(0,v.useCallback)(async e=>{let t=await u.subreplrun.debugCreateWithTask(e);t.ok&&bR.TasksCollection.update(e,e=>{e.subreplRunId=t.payload.id})},[u]),j=(0,v.useCallback)(e=>{e===s&&(o(void 0),p(null)),bR.TasksCollection.delete(e)},[s,o]),S="agent-filetree"===r;return a?S?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(PS,{selectedTaskId:s,pendingTaskTitle:c,activeTasks:g,onToggle:n.toggle,onSelectMainVersion:w,onSelectTask:y,onRunTask:b,onMerge:l??void 0,onDelete:j,onAddTask:()=>m(!0)}),(0,x.jsx)(aK.Modal,{isOpen:h,onRequestClose:()=>m(!1),maxWidth:512,centered:!0,children:(0,x.jsx)(Ph,{onClose:()=>m(!1),onTaskCreated:e=>{p(e.title)}})})]}):(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(PC,{selectedTaskId:s,pendingTaskTitle:c,activeTasks:g,onToggle:n.toggle,onSelectMainVersion:w,onSelectTask:y,onRunTask:b,onMerge:l??void 0,onDelete:j,onAddTask:()=>m(!0)}),(0,x.jsx)(aK.Modal,{isOpen:h,onRequestClose:()=>m(!1),maxWidth:512,centered:!0,children:(0,x.jsx)(Ph,{onClose:()=>m(!1),onTaskCreated:e=>{p(e.title)}})})]}):(0,x.jsx)(Py,{selectedTaskId:s,onSelectTask:y,onSelectMainVersion:w,onToggle:n.toggle,isOnLeft:S})}var PE=e.i(910248);let PI=(0,A.cvarsFrom)("index.module.css",["--width","--height","--transform","--pointer-events","--opacity","--z-index"]),PP=(0,v.memo)(function(){let e=(0,v.useRef)(null),t=aR(),n=aD(),i=(0,up.default)(n.agentFiletreeOrder),r=(0,v.useRef)(null);return(0,tZ.useStyleSet)(e,mD(t.view,t.getTransitionEnabled),e=>({[PI.width]:e.width+"px",[PI.height]:e.height+"px",[PI.transform]:`translate(${e.x}px, ${e.y}px)`,[PI.pointerEvents]:"all",[PI.opacity]:e.opacity.toString(),[PI.zIndex]:tN.taskSidebar.toString()})),(0,x.jsxs)(R.ShadesSurface,{background:!1,elevate:!1,clsx:PE.default.root,innerRef:e,grow:!0,children:[(0,x.jsx)(PT,{}),(0,x.jsx)(jt,{gutter:n.gutter,side:"agent-filetree"===i?"right":"left",onPointerDown:e=>{(0,mL.measureMouseMove)(e,{start(){document.activeElement instanceof HTMLElement&&(r.current=document.activeElement),t.resize.start()},move({delta:e}){t.resize.update(e.x)},end(){t.resize.end(),r.current?.focus?.(),r.current=null}})},onDoubleClick:()=>{t.close()}})]})});var PA=e.i(732964),PR=e.i(718632),PD=e.i(755181);function PV({repl:e,currentUser:t}){let n,i,r,a=(0,y.useRouter)(),s=(0,X.useQueryParam)("enterInAgentMode","boolean"),o=(0,X.useQueryParam)("enterInExpertMode","boolean"),l=(0,X.useQueryParam)("popupId","string"),u=(0,Y.isInBonsaiWebview)(a),d=(0,Y.doesBonsaiWebviewSupportFeature)(a,"workspace2"),c=(0,n0.useFilePaneFlag)(),[p]=(0,v.useState)(()=>(0,aF.createPaneUI)({config:{...(0,vl.createPaneUIConfig)(),webview:vs,commands:f$,tutorial:y0,extension:f1,extensionStore:xI,replAuth:xD,searchReplace:yB,deployments:vd.deploymentsUI,config:fq,integrations:vc.integrationsUI,extensionDevtools:xj,csvPreview:vu.csvPreviewUI,agentChat:fk,agentSkills:fN,agentProgress:vp.unsupportedUI,multiplayer:vp.unsupportedUI},filePaneFlag:c})),h=null;if(l){let e;h=jp(!(e=t2.default.get(t9(l)))||"string"==typeof e&&parseInt(e,10)<Date.now()?null:t2.default.get(t6(l)),p.decode)}else e.layoutState&&(h=jp(e.layoutState,p.decode));let m=!!e.config.isAgentStack;h||(n=o?"split-with-console":m?"split-with-automations":"split-with-webview");let f=(i=(0,X.useQueryParam)("deploymentPane","boolean"),r=(0,X.useQueryParam)("projectPane","boolean"),(0,q.default)(()=>i?{type:"deployments"}:r?{type:"project"}:void 0,[i,r])),g=(!!e.origin?.id||o)&&!e.config.isInPlanningPhase,w=(s||!!e.config.isInPlanningPhase)&&!e.config.figmaUrl&&!g,b=(0,H.useFlag)({controlName:"flag-agent-teamwork"});return(0,x.jsx)(my.TrackingHierarchyProvider,{hierarchy:{page:"workspace"},children:(0,x.jsxs)(Q.Pid2Provider,{currentUsername:t.username,replId:e.id,children:[(0,x.jsx)(w4.TasksProvider,{replId:e.id,children:(0,x.jsx)(dt.SessionProvider,{children:(0,x.jsx)(n4,{initialPane:f,savedLayoutState:h,popupId:l,agentCenteredLayout:w,agentLayoutVariation:n,agentPosition:t.workspacePreferences.agentPosition,hasReplPortal:b,children:(0,x.jsx)(wE,{tour:null,userId:t.id,children:(0,x.jsx)(P_,{ui:p,repl:e,currentUser:t,isBonsaiWebview:u,doesBonsaiSupportWorkspace2:d},e.id)})})})}),(0,x.jsx)(Z.default,{})]})})}function P_({repl:e,currentUser:t,isBonsaiWebview:n,doesBonsaiSupportWorkspace2:i,ui:r}){let{services:a,isPleaseRefresh:s,isNotAllowed:o}=function(){let e=aC(),t=n9(ra),n=n9(rs),i=(0,m0.useThrowBsod)(),r=(0,H.useFlag)({controlName:"flag-null-diagnostics",logFlagToAnalytics:!1}),[a,s]=(0,v.useState)(!1),[o,l]=(0,v.useState)(!1),u=(0,c0.useUpdatePresence)(),d=(0,c0.useGetColorForUser)(),c=(0,H.useFlag)({controlName:"flag-open-telemetry-tracing"}),p=(0,H.useFlag)({controlName:"flag-multi-lsp-connections"}),h=(0,q.default)(()=>({onPresenceCommand:u,getColorForUser:d,onUnrecoverableError:(0,wA.default)({origin:"replEnvironmentDesktop: services/unrecoverableError",tags:{environment:"desktop"},onNonBsodUnrecoverableError:e=>{e===z.NonBsodErrorType.NotAllowed?s(!0):e===z.NonBsodErrorType.RequiresRefresh&&l(!0)},throwBsod:i}),openFile:e,openMultipleFiles:t,openMultipleURLs:n,enableUserEvents:r,enableMultipleLSPClientsPerFile:p,openTelemetryTracing:c,enableReplspaceSshTokenPassthrough:!0}),[r,e,t,n,i,u,d,c,p]),m=(0,wI.useCreateServices)(h);return(0,q.default)(()=>({services:m,isPleaseRefresh:o,isNotAllowed:a}),[m,o,a])}();(0,K.usePid1ConnectionMonitor)(a?.container);let l=(0,H.useFlag)({controlName:"flag-build-score-survey"}),u=(0,H.useFlag)({controlName:"flag-agent-teamwork"}),d=(0,q.default)(()=>(0,u1.initKeybindings)(t?.keybindings.keybindings),[t]);if(!a)return(0,x.jsx)(L,{});let c=e.authorizations.useAdvancedChat.isAuthorized;return(0,x.jsx)($.AiProvider,{replId:e.id,currentUser:t,hasAccessToAdvancedModel:c,orgId:e.org?.id,renderEmptyState:()=>(0,x.jsx)(L,{}),children:(0,x.jsx)(w_.ContextMenuProvider,{children:(0,x.jsxs)(u6,{services:a,ui:r,repl:e,userKeybindings:d,children:[(0,x.jsxs)(m5,{origin:"ErrorBoundary: ReplEnvironmentDesktop Top level",bsod:!0,children:[(0,x.jsx)(uI,{}),(0,x.jsx)(l1,{isAdmin:t.isAdmin,isSubscribed:t.isSubscribed}),(0,x.jsx)(w1.default,{repl:e}),n&&!i?(0,x.jsx)(dc,{}):null,(0,x.jsx)(aJ,{}),(0,x.jsx)(de,{}),(0,x.jsx)(wC,{repl:e,currentUser:t}),(0,x.jsx)(dD,{}),(0,x.jsx)(dI,{}),(0,x.jsx)(PF,{repl:e,currentUser:t,hasReplPortal:u}),(0,x.jsx)(ob,{}),(0,x.jsx)(og,{}),(0,x.jsx)(wM,{}),(0,x.jsx)(wF.default,{}),(0,x.jsx)(wq,{}),(0,x.jsx)(vT,{replId:e.id}),(0,x.jsx)(wJ.default,{isOpen:o}),(0,x.jsx)(w0.default,{isOpen:s}),(0,x.jsx)(PR.GitInShellConfirmModal,{}),(0,x.jsx)(PA.DefaultBucketAccessConfirmModal,{}),(0,x.jsx)(op,{}),(0,x.jsx)(dr,{}),(0,x.jsx)(wO.DisconnectedModal,{}),(0,x.jsx)(lr,{}),(0,x.jsx)(w2.ConvertedToProjectModal,{repl:e}),l?(0,x.jsx)(w5.BuildScoreSurveyTopLevelHook,{}):null]}),(0,x.jsx)(PM,{replId:e.id})]})})})}function PM({replId:e}){let t,[n]=(0,m0.useBsod)(),[i]=(t={...N,...void 0},U.useMutation(G,t)),r=(0,v.useCallback)(()=>{i({variables:{input:{replId:e,state:{}}}})},[i,e]);return(0,v.useEffect)(()=>{n&&r()},[n,r]),(0,x.jsx)(wP.default,{})}let PF=(0,v.memo)(function({repl:e,currentUser:t,hasReplPortal:n}){let i,r,a,s,o,l,u,d,c=(i=n9(tY),r=n7(e6),a=(0,W.default)(),s=(0,dF.useIsMac)(),o=(0,dF.useIsWindows)(),l=(s||o)&&a?_.HEADER_HEIGHT:0,u=(0,v.useRef)(null),d=(0,dM.default)(({width:e,height:t})=>{if(!e||!t||!u.current)return;let{top:n,left:a}=u.current.getBoundingClientRect(),s={width:e,height:t,x:a,y:n-l};(0,ti.default)(s,r())||i(s)}),(0,v.useCallback)(function(e){u.current=e,d(e)},[d])),p=n3(tw),h=n3(eK),m=n3(eY),f=n3(eX),g=n3(tB),y=(0,v.useRef)(null),w=(0,v.useCallback)(e=>{c(e),y.current=e},[c]),b=(0,W.default)(),j=!1;return e.org?e.org.customer?.__typename==="Customer"&&(j=e.org.customer.isUnifiedPlanEnabled):j=t.customer.isUnifiedPlanEnabled,(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)(R.ShadesSurface,{innerRef:w,clsx:[PD.default.contentContainer,{[PD.default.desktopApp]:b}],elevate:!1,children:[p?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(mS,{repl:e,isUnifiedPlanEnabled:j}),n&&(0,x.jsx)(PP,{}),(0,x.jsxs)(bF,{currentUser:t,subreplId:g,children:[(0,x.jsx)(Po,{}),(0,x.jsxs)("main",{id:"main-content",children:[m.map(e=>(0,x.jsx)(vA,{handleId:e},e)),f.map(e=>(0,x.jsx)(fy,{headerId:e},e)),h.map(e=>(0,x.jsx)(m6,{paneId:e},e)),0===h.length?(0,x.jsx)(jo,{}):null]}),(0,x.jsx)(ig,{}),(0,x.jsx)(ay,{}),(0,x.jsx)(uU,{}),(0,x.jsx)(m7.ContextMenu,{}),(0,x.jsx)(ja,{})]}),(0,x.jsx)(Pd,{isActive:!!g}),(0,x.jsx)(Pp,{isActive:!!g})]}):null,(0,x.jsx)(wV,{})]}),p?null:(0,x.jsx)(L,{})]})});var PO=e.i(745844);function PL(){return(0,x.jsx)(l7.Global,{styles:[{body:{overscrollBehaviorX:"none"}}]})}var PB=e.i(80366),PU=e.i(722313),PN=e.i(507187),PG=e.i(932495),P$=e.i(714260),Pz=e.i(788124),PW=e.i(578134),PH=e.i(662792),Pq=e.i(838720);e.s(["default",0,()=>{var e;let t,n,i,r,{query:a}=(0,y.useRouter)();if(!a.replUrl)throw Error("Expected replUrl to be set");if(!a.replId)throw Error("Expected replId to be set");let s=a.replId.toString(),{data:o,loading:l,error:u}=(e={variables:{replId:s,environment:(0,PN.useEnvironment)(),platform:(0,PG.usePlatform)()},ssr:!!a.ssr},r={...k,...e},j.useQuery(C,r)),d=o?.currentUser||void 0,c=o?.getRepl&&("Repl"===o.getRepl.__typename||"ReplRedirect"===o.getRepl.__typename||"ReplSubscriptionExpired"===o.getRepl.__typename)?o.getRepl:null,p=o?.getRepl?.__typename==="ReplOrgPermissionDeniedError"?o.getRepl:null,h=o?.getRepl?.__typename==="NotFoundError"?o.getRepl:null,m=o?.getRepl?.__typename==="UnauthorizedError"||o?.getRepl?.__typename==="UserError"?o.getRepl:null,f=c?.__typename==="Repl"?c:null,g=u?.message;if((0,v.useEffect)(()=>{f&&!f.authorizations.connectToWorkspace.isAuthorized&&E.logger.warn("[Desktop App Authz] replEnvironmentDesktop.workspace_not_authorized",{replid:f.id,replUrl:f.url,userId:d?.id,platform:"desktop"})},[f,d?.id]),c&&("ReplRedirect"===c.__typename||"ReplSubscriptionExpired"===c.__typename))return(0,x.jsx)(PB.default,{replId:s});let w=!1,b=!1,S=!1;return p?(n="Permission Denied",w=!0,b=!0,S=!0,t=(0,x.jsx)(B.ReplOrgPermissionDeniedError,{ownerUsername:p.ownerUsername,ownerImage:p.ownerImage})):g||h||m?(n="Not Found",t=(0,x.jsx)(PH.default,{})):!l&&f&&d?d.isVerified?f.authorizations.connectToWorkspace.isAuthorized?(n=f.title,i=f.description??void 0,w=!0,b=!0,S=!0,t=(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(PU.OEmbedHead,{replPath:f.url}),(0,x.jsx)(P$.default.Provider,{value:f.id,children:(0,x.jsx)(PV,{repl:f,currentUser:d},f.id)}),(0,x.jsx)(PB.default,{replId:s})]})):(n=f.title,i=f.description??void 0,t=(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(PU.OEmbedHead,{replPath:f.url}),(0,x.jsx)(PH.default,{})]})):(n=f.title,i=f.description??void 0,t=(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(PU.OEmbedHead,{replPath:f.url}),(0,x.jsx)(V.View,{clsx:Pq.default.emailVerificationWrapper,grow:!0,shrink:!0,children:(0,x.jsx)(T.default,{})})]})):(n="Loading...",t=(0,x.jsx)(L,{animation:!0}),w=!0,b=!0,S=!0),(0,x.jsx)(Pz.default,{children:(0,x.jsxs)(PW.default,{dataCy:"workspace-page",title:n,description:i,noHeader:w,noMain:b,noSidebar:S,noFooter:!0,hideEmailVerify:!0,children:[(0,x.jsx)(I.OpenTelemetryTracer,{}),(0,x.jsxs)(c3.Surface,{clsx:Pq.default.surface,children:[(0,x.jsx)(PO.HideBodyOverflow,{}),(0,x.jsx)(PL,{}),t]})]})})}],453926)},545749,(e,t,n)=>{let i="/replEnvironmentDesktop";(window.__NEXT_P=window.__NEXT_P||[]).push([i,()=>e.r(453926)]),t.hot&&t.hot.dispose(function(){window.__NEXT_P.push([i])})}]);

//# debugId=c4af53a4-99d8-4158-889c-3dbd9dc33f51
//# sourceMappingURL=813099300dc0ed1f.js.map