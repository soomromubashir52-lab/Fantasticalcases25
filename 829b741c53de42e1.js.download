;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="47c0ac88-3da7-f78c-3c0b-1d8d05fdb079")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,764767,(e,t,n)=>{"use strict";var i=e.i(221042),s=function(e){if(e=e||{},this.Promise=e.Promise||Promise,this.queues=Object.create(null),this.domainReentrant=e.domainReentrant||!1,this.domainReentrant){if(void 0===i.default||void 0===i.default.domain)throw Error("Domain-reentrant locks require `process.domain` to exist. Please flip `opts.domainReentrant = false`, use a NodeJS version that still implements Domain, or install a browser polyfill.");this.domains=Object.create(null)}this.timeout=e.timeout||s.DEFAULT_TIMEOUT,this.maxOccupationTime=e.maxOccupationTime||s.DEFAULT_MAX_OCCUPATION_TIME,this.maxExecutionTime=e.maxExecutionTime||s.DEFAULT_MAX_EXECUTION_TIME,e.maxPending===1/0||Number.isInteger(e.maxPending)&&e.maxPending>=0?this.maxPending=e.maxPending:this.maxPending=s.DEFAULT_MAX_PENDING};s.DEFAULT_TIMEOUT=0,s.DEFAULT_MAX_OCCUPATION_TIME=0,s.DEFAULT_MAX_EXECUTION_TIME=0,s.DEFAULT_MAX_PENDING=1e3,s.prototype.acquire=function(e,t,n,s){if(Array.isArray(e))return this._acquireBatch(e,t,n,s);if("function"!=typeof t)throw Error("You must pass a function to execute");var r=null,a=null,o=null;"function"!=typeof n&&(s=n,n=null,o=new this.Promise(function(e,t){r=e,a=t})),s=s||{};var p=!1,l=null,d=null,c=null,u=this,T=function(t,i,s){d&&(clearTimeout(d),d=null),c&&(clearTimeout(c),c=null),t&&(u.queues[e]&&0===u.queues[e].length&&delete u.queues[e],u.domainReentrant&&delete u.domains[e]),p||(o?i?a(i):r(s):"function"==typeof n&&n(i,s),p=!0),t&&u.queues[e]&&u.queues[e].length>0&&u.queues[e].shift()()},y=function(n){if(p)return T(n);l&&(clearTimeout(l),l=null),u.domainReentrant&&n&&(u.domains[e]=i.default.domain);var r=s.maxExecutionTime||u.maxExecutionTime;if(r&&(c=setTimeout(function(){u.queues[e]&&T(n,Error("Maximum execution time is exceeded "+e))},r)),1===t.length){var a=!1;try{t(function(e,t){a||(a=!0,T(n,e,t))})}catch(e){a||(a=!0,T(n,e))}}else u._promiseTry(function(){return t()}).then(function(e){T(n,void 0,e)},function(e){T(n,e)})};u.domainReentrant&&i.default.domain&&(y=i.default.domain.bind(y));var g=s.maxPending||u.maxPending;if(u.queues[e])if(u.domainReentrant&&i.default.domain&&i.default.domain===u.domains[e])y(!1);else if(u.queues[e].length>=g)T(!1,Error("Too many pending tasks in queue "+e));else{var h=function(){y(!0)};s.skipQueue?u.queues[e].unshift(h):u.queues[e].push(h);var f=s.timeout||u.timeout;f&&(l=setTimeout(function(){l=null,T(!1,Error("async-lock timed out in queue "+e))},f))}else u.queues[e]=[],y(!0);var m=s.maxOccupationTime||u.maxOccupationTime;if(m&&(d=setTimeout(function(){u.queues[e]&&T(!1,Error("Maximum occupation time is exceeded in queue "+e))},m)),o)return o},s.prototype._acquireBatch=function(e,t,n,i){"function"!=typeof n&&(i=n,n=null);var s=this,r=e.reduceRight(function(e,t){return function(n){s.acquire(t,e,n,i)}},t);if("function"!=typeof n)return new this.Promise(function(e,t){1===r.length?r(function(n,i){n?t(n):e(i)}):e(r())});r(n)},s.prototype.isBusy=function(e){return e?!!this.queues[e]:Object.keys(this.queues).length>0},s.prototype._promiseTry=function(e){try{return this.Promise.resolve(e())}catch(e){return this.Promise.reject(e)}},t.exports=s},650392,(e,t,n)=>{"use strict";t.exports=e.r(764767)},267710,644464,17886,e=>{"use strict";var t=e.i(862927),n=e.i(650392),i=e.i(830675);function s(e,t){return"string"==typeof e&&(e=Error(e)),i.withScope(n=>{n.setTag("ai-chat",!0),t&&n.setExtras(t),i.captureException(e)}),e}e.s(["sendErrorToSentry",()=>s],644464);var r=e.i(960933);e.i(837399),r.Type.Object({replId:r.Type.Union([r.Type.String(),r.Type.Null()]),orgId:r.Type.Optional(r.Type.String())}),r.Type.Object({userId:r.Type.Number(),orgId:r.Type.Optional(r.Type.String()),replId:r.Type.Optional(r.Type.String())});let a=r.Type.Object({token:r.Type.String()}),o=r.Type.Object({isAuthorized:r.Type.Literal(!0),code:r.Type.Literal("authorized"),message:r.Type.String()}),p=r.Type.Object({isAuthorized:r.Type.Literal(!1),code:r.Type.Union([r.Type.Literal("feature_disabled"),r.Type.Literal("feature_unsupported_for_non_teams"),r.Type.Literal("feature_unsupported_for_replit_teams"),r.Type.Literal("feature_unsupported_for_teams_edu"),r.Type.Literal("feature_unsupported_for_teams_pro"),r.Type.Literal("feature_unsupported_for_teams_free"),r.Type.Literal("insufficient_permissions"),r.Type.Literal("insufficient_quota"),r.Type.Literal("insufficient_budget"),r.Type.Literal("requires_payment_method"),r.Type.Literal("requires_active_subscription")]),message:r.Type.String()}),l=r.Type.Union([o,p]);async function d(e,n){let i=await fetch("/ai/auth",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({replId:e,orgId:n})}),r=await i.json();if(!t.Value.Check(a,r))throw s("Authentication to chat service failed",{detail:r});return r.token}r.Type.Object({basicModel:l,advancedModel:l,paidAgent:l,freeAgent:l,basicAssistant:l,advancedAssistant:l,modelFarm:l,openRouter:l,openAI:l,anthropic:l,gemini:l});let c={},u=new n.default;async function T(e,t,n){return u.acquire(e??"non-repl-key",async()=>{let i=c[t];if(i&&new Date().getTime()<i.expiration)return i.token;let s=await d(e,n),r=new Date().getTime()+18e5;return c[t]={token:s,expiration:r},s})}e.s(["auth",()=>T],267710),e.s(["isEnvProduction",0,()=>{{let e=window.location.hostname;return e.includes("replit.com")&&!e.includes("staging.replit.com")}}],17886)},660670,711566,806240,230153,351677,187822,943673,170039,281128,813702,957410,986684,e=>{"use strict";let t;e.i(227062);var n,i,s,r,a,o,p,l,d,c,u,T,y,g,h,f,m,S,E,v,R,b,O,C,I,A,U,k,N,D,P,w,j,M,L,_,x,B,F,$,G,q,V,W,K,H,z,Y,Q,X,J,Z,ee,et,en,ei,es,er,ea,eo,ep,el,ed=e.i(627922),ec=e.i(960933);let eu="SERVER",eT={codec:ed.BinaryCodec,heartbeatIntervalMs:2500,heartbeatsUntilDead:40,enableTransparentSessionReconnects:!0,sessionDisconnectGraceMs:15e3,connectionTimeoutMs:1e4,handshakeTimeoutMs:1e4};({...eT});let ey={...eT,baseIntervalMs:250,maxJitterMs:500,maxBackoffMs:32e3,attemptBudgetCapacity:5,budgetRestoreIntervalMs:2e3},eg=ec.Type.Object({token:ec.Type.String()});e.s(["ChortRiverHandshakeRequestSchema",0,eg,"RIVER_CLIENT_TRANSPORT_OPTIONS",0,ey,"RIVER_SERVER_ID",0,eu],711566);var eh=((n={})[n.AGENT_STATE_UNKNOWN=0]="AGENT_STATE_UNKNOWN",n[n.AGENT_STATE_RUNNING=1]="AGENT_STATE_RUNNING",n[n.AGENT_STATE_PAUSING=2]="AGENT_STATE_PAUSING",n[n.AGENT_STATE_PAUSED=3]="AGENT_STATE_PAUSED",n[n.AGENT_STATE_NOT_STARTED=4]="AGENT_STATE_NOT_STARTED",n),ef=((i={})[i.AGENT_FEEDBACK_UNKNOWN=0]="AGENT_FEEDBACK_UNKNOWN",i[i.AGENT_FEEDBACK_THUMB_UP=1]="AGENT_FEEDBACK_THUMB_UP",i[i.AGENT_FEEDBACK_THUMB_DOWN=2]="AGENT_FEEDBACK_THUMB_DOWN",i),em=((s={})[s.SECRET_UNKNOWN=0]="SECRET_UNKNOWN",s[s.SECRET_COMPLETED=1]="SECRET_COMPLETED",s[s.SECRET_IGNORED=2]="SECRET_IGNORED",s),eS=((r={})[r.UNKNOWN=0]="UNKNOWN",r[r.LOVABLE=1]="LOVABLE",r[r.BOLT=2]="BOLT",r[r.REPLIT=3]="REPLIT",r[r.OTHER_GITHUB=4]="OTHER_GITHUB",r[r.FIGMA=5]="FIGMA",r[r.VERCEL=6]="VERCEL",r[r.BITBUCKET=7]="BITBUCKET",r),eE=((a={})[a.UNSPECIFIED=0]="UNSPECIFIED",a[a.PENDING=1]="PENDING",a[a.IN_PROGRESS=2]="IN_PROGRESS",a[a.COMPLETED=3]="COMPLETED",a[a.COMPLETED_PENDING_REVIEW=4]="COMPLETED_PENDING_REVIEW",a),ev=((o={})[o.UNKNOWN=0]="UNKNOWN",o[o.PYTHON=1]="PYTHON",o),eR=((p={})[p.UNKNOWN=0]="UNKNOWN",p[p.STDOUT=1]="STDOUT",p[p.STDERR=2]="STDERR",p),eb=((l={})[l.STEP_UNKNOWN=0]="STEP_UNKNOWN",l[l.STEP_NOT_STARTED=1]="STEP_NOT_STARTED",l[l.STEP_IN_PROGRESS=2]="STEP_IN_PROGRESS",l[l.STEP_COMPLETE=3]="STEP_COMPLETE",l[l.STEP_FAILED=4]="STEP_FAILED",l[l.STEP_ABORTED=5]="STEP_ABORTED",l),eO=((d={})[d.UNKNOWN=0]="UNKNOWN",d[d.NEON_DATABASE=1]="NEON_DATABASE",d),eC=((c={})[c.UNKNOWN_TRIGGER_TYPE=0]="UNKNOWN_TRIGGER_TYPE",c[c.SLACK_MESSAGE=1]="SLACK_MESSAGE",c[c.TELEGRAM_MESSAGE=2]="TELEGRAM_MESSAGE",c[c.TIME_BASED=3]="TIME_BASED",c[c.CONNECTOR_TRIGGER=4]="CONNECTOR_TRIGGER",c),eI=((u={})[u.UNSPECIFIED=0]="UNSPECIFIED",u[u.FEATURE=1]="FEATURE",u[u.STACK=2]="STACK",u[u.STYLING=3]="STYLING",u),eA=((T={})[T.UNSPECIFIED=0]="UNSPECIFIED",T[T.GENERAL=1]="GENERAL",T[T.REPLIT_DOCUMENTATION=2]="REPLIT_DOCUMENTATION",T[T.MASTRA_DOCUMENTATION=3]="MASTRA_DOCUMENTATION",T),eU=((y={})[y.UNSPECIFIED=0]="UNSPECIFIED",y[y.RECENT=1]="RECENT",y[y.LAST_DEPLOYED=2]="LAST_DEPLOYED",y[y.RECOMMENDED=3]="RECOMMENDED",y),ek=((g={})[g.UNSPECIFIED=0]="UNSPECIFIED",g[g.TABLE=1]="TABLE",g[g.SLIDES=2]="SLIDES",g[g.PDF=3]="PDF",g[g.WORD_DOCUMENT=4]="WORD_DOCUMENT",g[g.TEXT=5]="TEXT",g[g.IMAGE=6]="IMAGE",g[g.VIDEO=7]="VIDEO",g[g.AUDIO=8]="AUDIO",g),eN=((h={})[h.UNKNOWN=0]="UNKNOWN",h[h.SUCCESSFUL=1]="SUCCESSFUL",h[h.RECURSION_LIMIT_REACHED=2]="RECURSION_LIMIT_REACHED",h[h.EXCEPTION=3]="EXCEPTION",h),eD=((f={})[f.UNSPECIFIED=0]="UNSPECIFIED",f[f.WEB=1]="WEB",f[f.MOBILE=2]="MOBILE",f[f.SLIDES=3]="SLIDES",f[f.VIDEO=4]="VIDEO",f),eP=((m={})[m.UNKNOWN=0]="UNKNOWN",m[m.REPL_CREATION_V1=1]="REPL_CREATION_V1",m),ew=((S={})[S.UNSPECIFIED=0]="UNSPECIFIED",S[S.URL_SCREENSHOT=1]="URL_SCREENSHOT",S[S.URL_CRAWL_CONTENT=2]="URL_CRAWL_CONTENT",S[S.URL_AS_PROMPT=3]="URL_AS_PROMPT",S[S.URL_CRAWL_HTML=4]="URL_CRAWL_HTML",S[S.URL_CRAWL_BRANDING=5]="URL_CRAWL_BRANDING",S),ej=((E={})[E.GENERATION_STATE_UNKNOWN=0]="GENERATION_STATE_UNKNOWN",E[E.GENERATION_IN_PROGRESS=1]="GENERATION_IN_PROGRESS",E[E.GENERATION_REGENERATING=2]="GENERATION_REGENERATING",E[E.GENERATION_COMPLETE=3]="GENERATION_COMPLETE",E[E.GENERATION_ERROR=4]="GENERATION_ERROR",E),eM=((v={})[v.UNKNOWN=0]="UNKNOWN",v[v.ENGLISH=1]="ENGLISH",v[v.CRON=2]="CRON",v),eL=((R={})[R.UNKNOWN=0]="UNKNOWN",R[R.BASIC=1]="BASIC",R[R.ADVANCED=2]="ADVANCED",R[R.OVERRIDE=3]="OVERRIDE",R),e_=((b={})[b.UNKNOWN=0]="UNKNOWN",b[b.FILE=1]="FILE",b[b.INLINE=2]="INLINE",b),ex=((O={})[O.UNKNOWN=0]="UNKNOWN",O[O.CONSOLE=1]="CONSOLE",O[O.LSP=2]="LSP",O),eB=((C={})[C.UNKNOWN=0]="UNKNOWN",C[C.IN_PROGRESS=1]="IN_PROGRESS",C[C.COMPLETE=2]="COMPLETE",C),eF=((I={})[I.UNKNOWN=0]="UNKNOWN",I[I.EXPLAIN_CODE=1]="EXPLAIN_CODE",I[I.DEBUGGER=2]="DEBUGGER",I[I.GENERATE_CODE=3]="GENERATE_CODE",I[I.TRANSFORM_CODE=4]="TRANSFORM_CODE",I),e$=((A={})[A.UNKNOWN=0]="UNKNOWN",A[A.USER=1]="USER",A[A.AI=2]="AI",A[A.SERVICE=3]="SERVICE",A),eG=((U={})[U.UNKNOWN=0]="UNKNOWN",U[U.CHAT=1]="CHAT",U[U.INLINE_CHAT=2]="INLINE_CHAT",U[U.SINGLE_USE_SESSION=3]="SINGLE_USE_SESSION",U[U.REPL_CREATION=4]="REPL_CREATION",U[U.AGENT_SESSION=5]="AGENT_SESSION",U[U.HOSTING_DEBUG_SUMMARY=6]="HOSTING_DEBUG_SUMMARY",U[U.REPL_CREATION_V2=7]="REPL_CREATION_V2",U[U.REPL_CREATION_V3=8]="REPL_CREATION_V3",U[U.AGENT_REPLAY_SESSION=9]="AGENT_REPLAY_SESSION",U[U.SAMPLING_SESSION=10]="SAMPLING_SESSION",U[U.SUB_AGENT=11]="SUB_AGENT",U[U.TASK_AGENT=12]="TASK_AGENT",U[U.ORCHESTRATOR_SESSION=13]="ORCHESTRATOR_SESSION",U),eq=((k={})[k.UNKNOWN=0]="UNKNOWN",k[k.MAX_TOKENS=1]="MAX_TOKENS",k[k.STOP_TOKEN=2]="STOP_TOKEN",k[k.SAFETY=3]="SAFETY",k[k.RECITATION=4]="RECITATION",k[k.TOOL_CALLS=5]="TOOL_CALLS",k[k.CONTENT_FILTER=6]="CONTENT_FILTER",k),eV=((N={})[N.UNKNOWN=0]="UNKNOWN",N[N.NONE=1]="NONE",N[N.REPLIT_DOCS=2]="REPLIT_DOCS",N[N.GENERATE=3]="GENERATE",N[N.EXPLAIN=4]="EXPLAIN",N[N.TRANSFORM=5]="TRANSFORM",N[N.DEBUG=6]="DEBUG",N[N.FIND_INTENT=7]="FIND_INTENT",N[N.AGENT=8]="AGENT",N[N.ITERATIVE_AGENT=9]="ITERATIVE_AGENT",N),eW=((D={})[D.UNKNOWN=0]="UNKNOWN",D[D.FREE=1]="FREE",D[D.CORE=2]="CORE",D[D.TEAMS=3]="TEAMS",D),eK=((P={})[P.UNKNOWN=0]="UNKNOWN",P[P.MANUALLY_ABORTED=1]="MANUALLY_ABORTED",P[P.INCOMPLETE_UPDATE=2]="INCOMPLETE_UPDATE",P[P.INTERNAL_SERVER_ERROR=3]="INTERNAL_SERVER_ERROR",P[P.USAGE_LIMIT=4]="USAGE_LIMIT",P[P.TEST_ERROR=5]="TEST_ERROR",P[P.INVALID_INPUT=6]="INVALID_INPUT",P[P.UNAUTHORIZED=7]="UNAUTHORIZED",P[P.AGENT_EXECUTION_ERROR=8]="AGENT_EXECUTION_ERROR",P[P.AI_QUOTA_ERROR_UNKNOWN=9]="AI_QUOTA_ERROR_UNKNOWN",P[P.AI_QUOTA_INSUFFICIENT_BUDGET=10]="AI_QUOTA_INSUFFICIENT_BUDGET",P[P.AI_QUOTA_NO_PAYMENT_METHOD=11]="AI_QUOTA_NO_PAYMENT_METHOD",P[P.AI_QUOTA_NO_SUBSCRIPTION=12]="AI_QUOTA_NO_SUBSCRIPTION",P),eH=((w={})[w.UNSPECIFIED=0]="UNSPECIFIED",w[w.GENERAL=1]="GENERAL",w[w.DISCUSSION=2]="DISCUSSION",w[w.INITIAL_PLANNING=3]="INITIAL_PLANNING",w[w.QUICK_EDIT=4]="QUICK_EDIT",w),ez=((j={})[j.UNSPECIFIED=0]="UNSPECIFIED",j[j.SYNC=1]="SYNC",j[j.ASYNC=2]="ASYNC",j[j.DESIGN=3]="DESIGN",j[j.BUILD=4]="BUILD",j),eY=((M={})[M.UNSPECIFIED=0]="UNSPECIFIED",M[M.LOW=1]="LOW",M[M.MEDIUM=2]="MEDIUM",M[M.HIGH=3]="HIGH",M[M.MAX=4]="MAX",M),eQ=((L={})[L.UNSPECIFIED=0]="UNSPECIFIED",L[L.LITE=1]="LITE",L[L.PRO=2]="PRO",L),eX=((_={})[_.UNSPECIFIED=0]="UNSPECIFIED",_[_.REPLIT_UI=1]="REPLIT_UI",_[_.CHATGPT=2]="CHATGPT",_),eJ=((x={})[x.UNSPECIFIED=0]="UNSPECIFIED",x[x.STANDARD=1]="STANDARD",x[x.ADVANCED=2]="ADVANCED",x),eZ=((B={})[B.SET=0]="SET",B[B.ADD=1]="ADD",B[B.CLEAR=2]="CLEAR",B[B.APPEND=3]="APPEND",B),e0=((F={})[F.UNSPECIFIED=0]="UNSPECIFIED",F[F.INSUFFICIENT_BUDGET=1]="INSUFFICIENT_BUDGET",F[F.REQUIRES_PAYMENT_METHOD=2]="REQUIRES_PAYMENT_METHOD",F[F.REQUIRES_ACTIVE_SUBSCRIPTION=3]="REQUIRES_ACTIVE_SUBSCRIPTION",F[F.AGENT_UNKNOWN_AUTHORIZATION_ERROR=4]="AGENT_UNKNOWN_AUTHORIZATION_ERROR",F[F.INSUFFICIENT_PERMISSIONS=5]="INSUFFICIENT_PERMISSIONS",F[F.INSUFFICIENT_QUOTA=6]="INSUFFICIENT_QUOTA",F[F.PAYMENT_DELINQUENT=7]="PAYMENT_DELINQUENT",F),e1=(($={})[$.NULL_VALUE=0]="NULL_VALUE",$),e2=((G={})[G.STRING=0]="STRING",G[G.INTEGER=1]="INTEGER",G),e3=((q={})[q.AGENT=0]="AGENT",q[q.USER=1]="USER",q[q.DEPLOYMENT=2]="DEPLOYMENT",q),e6=((V={})[V.UNSPECIFIED=0]="UNSPECIFIED",V[V.ZERO_RATED=1]="ZERO_RATED",V[V.NORMAL=2]="NORMAL",V),e8=((W={})[W.UNSPECIFIED=0]="UNSPECIFIED",W[W.RAPID_BUILD_FEEDBACK=1]="RAPID_BUILD_FEEDBACK",W[W.FEEDBACK_REQUESTED=2]="FEEDBACK_REQUESTED",W[W.AGENT_USAGE_MAX_THRESHOLD=3]="AGENT_USAGE_MAX_THRESHOLD",W[W.AGENT_USAGE_LIMIT_THRESHOLD=4]="AGENT_USAGE_LIMIT_THRESHOLD",W[W.USER_RESPONSE=5]="USER_RESPONSE",W[W.PROPOSE_PLAN_TOOL=6]="PROPOSE_PLAN_TOOL",W[W.LAST_MESSAGE=7]="LAST_MESSAGE",W[W.SESSION_START=8]="SESSION_START",W[W.NEON_DATABASE_EVENT=9]="NEON_DATABASE_EVENT",W[W.GENERATE_3D_MODEL=10]="GENERATE_3D_MODEL",W[W.CONTINUE_WITH_PLAN=11]="CONTINUE_WITH_PLAN",W[W.WORKSPACE_TRIGGERED_AGENT=12]="WORKSPACE_TRIGGERED_AGENT",W[W.WORKSPACE_TRIGGERED_USER=13]="WORKSPACE_TRIGGERED_USER",W[W.WORKSPACE_TRIGGERED_DEPLOYMENT=14]="WORKSPACE_TRIGGERED_DEPLOYMENT",W[W.PROPOSE_MVP_PLAN=15]="PROPOSE_MVP_PLAN",W[W.INTERMEDIATE_CHECKPOINT=16]="INTERMEDIATE_CHECKPOINT",W[W.PREREVERT=17]="PREREVERT",W[W.REVERT=18]="REVERT",W[W.TEST=19]="TEST",W[W.PLAN_APPROVED=20]="PLAN_APPROVED",W[W.REACT_LOOP_CAP_HIT=21]="REACT_LOOP_CAP_HIT",W[W.SUCCESS_TOOL=22]="SUCCESS_TOOL",W[W.LOOP_END=23]="LOOP_END",W[W.AGENT_PAUSE=24]="AGENT_PAUSE",W[W.COMPLETED_TASK=25]="COMPLETED_TASK",W[W.PLAN_TO_BUILD_TRANSITION=26]="PLAN_TO_BUILD_TRANSITION",W),e4=((K={})[K.DISCOUNTED_EFFORT_UNSPECIFIED=0]="DISCOUNTED_EFFORT_UNSPECIFIED",K[K.DISCOUNTED_EFFORT_FREE_HIGH_POWERED_MODE=1]="DISCOUNTED_EFFORT_FREE_HIGH_POWERED_MODE",K),e5=((H={})[H.REVERT_DATA_STAGE_UNKNOWN=0]="REVERT_DATA_STAGE_UNKNOWN",H[H.REVERT_DATA_STAGE_LOADING_PREVIOUS_STATE=1]="REVERT_DATA_STAGE_LOADING_PREVIOUS_STATE",H[H.REVERT_DATA_STAGE_SHUTTING_DOWN_WORKFLOWS=2]="REVERT_DATA_STAGE_SHUTTING_DOWN_WORKFLOWS",H[H.REVERT_DATA_STAGE_REVERTING_COMMIT=3]="REVERT_DATA_STAGE_REVERTING_COMMIT",H[H.REVERT_DATA_STAGE_RESTARTING_WORKFLOWS=4]="REVERT_DATA_STAGE_RESTARTING_WORKFLOWS",H[H.REVERT_DATA_STAGE_COMPLETE=5]="REVERT_DATA_STAGE_COMPLETE",H[H.REVERT_DATA_STAGE_ROLLING_BACK_DATABASE=6]="REVERT_DATA_STAGE_ROLLING_BACK_DATABASE",H[H.REVERT_DATA_STAGE_ROLLING_BACK_DEPLOYMENT=7]="REVERT_DATA_STAGE_ROLLING_BACK_DEPLOYMENT",H),e9=((z={})[z.MEDIA_TYPE_UNKNOWN=0]="MEDIA_TYPE_UNKNOWN",z[z.MEDIA_TYPE_IMAGE=1]="MEDIA_TYPE_IMAGE",z[z.MEDIA_TYPE_VIDEO=2]="MEDIA_TYPE_VIDEO",z[z.MEDIA_TYPE_3D_MODEL=3]="MEDIA_TYPE_3D_MODEL",z),e7=((Y={})[Y.UNSPECIFIED=0]="UNSPECIFIED",Y[Y.ONE=1]="ONE",Y[Y.ALL=2]="ALL",Y),te=((Q={})[Q.UNSPECIFIED=0]="UNSPECIFIED",Q[Q.PENDING=1]="PENDING",Q[Q.ACKNOWLEDGED_CONTINUE_CURRENT_STEP=2]="ACKNOWLEDGED_CONTINUE_CURRENT_STEP",Q[Q.ACKNOWLEDGED_ABORT_CURRENT_STEP=3]="ACKNOWLEDGED_ABORT_CURRENT_STEP",Q),tt=((X={})[X.SUCCESS=0]="SUCCESS",X[X.FAILURE=1]="FAILURE",X[X.UNABLE=3]="UNABLE",X),tn=((J={})[J.UNKNOWN=0]="UNKNOWN",J[J.THOUGHTS_ONLY=1]="THOUGHTS_ONLY",J[J.ALL_EVENTS=2]="ALL_EVENTS",J),ti=((Z={})[Z.UNSPECIFIED=0]="UNSPECIFIED",Z[Z.ENVIRONMENT_SETUP=1]="ENVIRONMENT_SETUP",Z[Z.SAMPLING=2]="SAMPLING",Z[Z.RANKING=3]="RANKING",Z[Z.APPLYING=4]="APPLYING",Z[Z.CONCLUDED=5]="CONCLUDED",Z),ts=((ee={})[ee.UNSPECIFIED=0]="UNSPECIFIED",ee[ee.ENVIRONMENT_SETUP=5]="ENVIRONMENT_SETUP",ee[ee.IN_PROGRESS=1]="IN_PROGRESS",ee[ee.SUCCESSFUL=2]="SUCCESSFUL",ee[ee.FAILED=3]="FAILED",ee[ee.CHOSEN=4]="CHOSEN",ee),tr=((et={})[et.VISUAL_STARTED=0]="VISUAL_STARTED",et[et.VISUAL_COMPLETE_PENDING_REVIEW=1]="VISUAL_COMPLETE_PENDING_REVIEW",et[et.VISUAL_COMPLETE=2]="VISUAL_COMPLETE",et[et.MVP_STARTED=3]="MVP_STARTED",et[et.MVP_COMPLETE_PENDING_REVIEW=4]="MVP_COMPLETE_PENDING_REVIEW",et[et.MVP_COMPLETE=5]="MVP_COMPLETE",et),ta=((en={})[en.UNKNOWN=0]="UNKNOWN",en[en.LOG_FILE=1]="LOG_FILE",en),to=((ei={})[ei.UNSPECIFIED=0]="UNSPECIFIED",ei[ei.INFO=1]="INFO",ei[ei.WARNING=2]="WARNING",ei[ei.ERROR=3]="ERROR",ei),tp=((es={})[es.NONE=0]="NONE",es[es.OPEN_MCP_PANE=1]="OPEN_MCP_PANE",es),tl=((er={})[er.UNSPECIFIED=0]="UNSPECIFIED",er[er.DEVELOPMENT=1]="DEVELOPMENT",er[er.PRODUCTION=2]="PRODUCTION",er[er.SHARED=3]="SHARED",er),td=((ea={})[ea.UNSPECIFIED=0]="UNSPECIFIED",ea[ea.ENV=1]="ENV",ea[ea.SECRET=2]="SECRET",ea);e.s(["AgentAuthorizationFailedCode",()=>e0,"AgentInitialBuildMode",()=>ez,"AgentInitialBuildTier",()=>eQ,"AgentMode",()=>eH,"AgentPlanStepStatus",()=>eb,"AgentRunState",()=>eh,"AgentStackTriggerType",()=>eC,"AgentUserFeedbackType",()=>ef,"AlertLevel",()=>to,"AlertNextAction",()=>tp,"ArtifactKind",()=>eD,"AttachedFormType",()=>eP,"AutonomyLevel",()=>eY,"BYOPromptResponseParameterType",()=>e2,"BenchmarkConclusionReason",()=>eN,"BlueprintCategory",()=>eI,"CheckpointSuggestionReason",()=>eU,"CheckpointTriggerReason",()=>e8,"CodeReferenceType",()=>e_,"CommitAuthor",()=>e3,"CommitBillingRate",()=>e6,"DebugErrorSource",()=>ex,"DiscountedEffortType",()=>e4,"EnvironmentType",()=>tl,"EnvironmentVariableType",()=>td,"EventErrorType",()=>eK,"EventState",()=>eB,"FileChangeGenerationState",()=>ej,"FileOutputType",()=>ek,"GeneralSubagentEventFilter",()=>tn,"GeneratedMediaType",()=>e9,"InitialBuildPhase",()=>tr,"InlineMessageType",()=>eF,"MembershipType",()=>eW,"MessageAction",()=>eV,"MessageSource",()=>eX,"MessageStopReason",()=>eq,"ModelProfile",()=>eJ,"ModelType",()=>eL,"NullValue",()=>e1,"ProjectImportSource",()=>eS,"RequestFeatureAddType",()=>eO,"RevertStatus",()=>e5,"SamplingEventState",()=>ti,"SandboxLanguage",()=>ev,"SandboxOutputType",()=>eR,"SessionType",()=>eG,"SpecialFileType",()=>ta,"StepTooComplexEventContentsState",()=>te,"TaskStatus",()=>eE,"TrajectoryState",()=>ts,"TranslationTarget",()=>eM,"UITestingSubagentResultType",()=>tt,"UpdateEventOperationType",()=>eZ,"UrlIntent",()=>ew,"UserSecretResponseStatus",()=>em,"UserType",()=>e$,"WaitingForBackgroundJobType",()=>e7,"WebSearchType",()=>eA],806240);var tc=((eo={})[eo.NONE=0]="NONE",eo[eo.FLASK_VANILLA_JS=1]="FLASK_VANILLA_JS",eo[eo.PYTHON_API=2]="PYTHON_API",eo[eo.STREAMLIT=3]="STREAMLIT",eo[eo.FULLSTACK_JS=4]="FULLSTACK_JS",eo[eo.GAMESTACK_JS=5]="GAMESTACK_JS",eo[eo.CUSTOM=6]="CUSTOM",eo[eo.EXPO=7]="EXPO",eo[eo.AGENT=8]="AGENT",eo[eo.MOCKUP_JS=9]="MOCKUP_JS",eo[eo.BEST_EFFORT_FALLBACK=10]="BEST_EFFORT_FALLBACK",eo[eo.VIDEO_JS=11]="VIDEO_JS",eo);let tu=ec.Type.Module({StackBlueprint:ec.Type.Enum(tc)}).Import("StackBlueprint"),tT=ec.Type.Module({AgentRunState:ec.Type.Enum(eh),AgentUserFeedbackType:ec.Type.Enum(ef),UserSecretResponseStatus:ec.Type.Enum(em),ProjectImportSource:ec.Type.Enum(eS),TaskStatus:ec.Type.Enum(eE),SandboxLanguage:ec.Type.Enum(ev),SandboxOutputType:ec.Type.Enum(eR),AgentPlanStepStatus:ec.Type.Enum(eb),RequestFeatureAddType:ec.Type.Enum(eO),AgentStackTriggerType:ec.Type.Enum(eC),BlueprintCategory:ec.Type.Enum(eI),WebSearchType:ec.Type.Enum(eA),CheckpointSuggestionReason:ec.Type.Enum(eU),FileOutputType:ec.Type.Enum(ek),BenchmarkConclusionReason:ec.Type.Enum(eN),ArtifactKind:ec.Type.Enum(eD),AttachedFormType:ec.Type.Enum(eP),UrlIntent:ec.Type.Enum(ew),FileChangeGenerationState:ec.Type.Enum(ej),TranslationTarget:ec.Type.Enum(eM),ModelType:ec.Type.Enum(eL),CodeReferenceType:ec.Type.Enum(e_),DebugErrorSource:ec.Type.Enum(ex),EventState:ec.Type.Enum(eB),InlineMessageType:ec.Type.Enum(eF),UserType:ec.Type.Enum(e$),SessionType:ec.Type.Enum(eG),MessageStopReason:ec.Type.Enum(eq),MessageAction:ec.Type.Enum(eV),MembershipType:ec.Type.Enum(eW),EventErrorType:ec.Type.Enum(eK),AgentMode:ec.Type.Enum(eH),AgentInitialBuildMode:ec.Type.Enum(ez),AutonomyLevel:ec.Type.Enum(eY),AgentInitialBuildTier:ec.Type.Enum(eQ),MessageSource:ec.Type.Enum(eX),ModelProfile:ec.Type.Enum(eJ),UpdateEventOperationType:ec.Type.Enum(eZ),AgentAuthorizationFailedCode:ec.Type.Enum(e0),NullValue:ec.Type.Enum(e1),BYOPromptResponseParameterType:ec.Type.Enum(e2),CommitAuthor:ec.Type.Enum(e3),CommitBillingRate:ec.Type.Enum(e6),CheckpointTriggerReason:ec.Type.Enum(e8),DiscountedEffortType:ec.Type.Enum(e4),RevertStatus:ec.Type.Enum(e5),GeneratedMediaType:ec.Type.Enum(e9),WaitingForBackgroundJobType:ec.Type.Enum(e7),StepTooComplexEventContentsState:ec.Type.Enum(te),UITestingSubagentResultType:ec.Type.Enum(tt),GeneralSubagentEventFilter:ec.Type.Enum(tn),SamplingEventState:ec.Type.Enum(ti),TrajectoryState:ec.Type.Enum(ts),InitialBuildPhase:ec.Type.Enum(tr),SpecialFileType:ec.Type.Enum(ta),AlertLevel:ec.Type.Enum(to),AlertNextAction:ec.Type.Enum(tp),EnvironmentType:ec.Type.Enum(tl),EnvironmentVariableType:ec.Type.Enum(td),RevertToCommitRequest:ec.Type.Object({replId:ec.Type.String(),targetCommitId:ec.Type.String(),newSessionTitle:ec.Type.String(),originalSessionId:ec.Type.String(),databaseRollbackTimestamp:ec.Type.String(),deploymentBuildId:ec.Type.String(),rollbackDatabase:ec.Type.Boolean(),revertedToSessionId:ec.Type.Optional(ec.Type.Union([ec.Type.String(),ec.Type.Undefined()])),revertedToEventId:ec.Type.Optional(ec.Type.Union([ec.Type.String(),ec.Type.Undefined()]))}),RevertToCommitResponse:ec.Type.Object({revertedSessionId:ec.Type.String()}),CloneSessionRequest:ec.Type.Object({sessionId:ec.Type.String(),newReplId:ec.Type.String(),sessionType:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("SessionType"),ec.Type.Undefined()]))}),CloneSessionResponse:ec.Type.Object({clonedSessionId:ec.Type.String()}),Ping:ec.Type.Object({}),Pong:ec.Type.Object({}),Event:ec.Type.Object({id:ec.Type.String(),parentEventId:ec.Type.String(),contents:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("EventContents"),ec.Type.Undefined()])),context:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("EventContext"),ec.Type.Undefined()])),state:ec.Type.Ref("EventState"),created:ec.Type.Optional(ec.Type.Union([ec.Type.Date(),ec.Type.Undefined()])),updated:ec.Type.Optional(ec.Type.Union([ec.Type.Date(),ec.Type.Undefined()])),sender:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("UserContext"),ec.Type.Undefined()])),sessionId:ec.Type.String(),updateEventOperations:ec.Type.Array(ec.Type.Ref("UpdateEventOperation")),typedUpdateEventOperations:ec.Type.Array(ec.Type.Ref("TypedUpdateEventOperation")),error:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("EventError"),ec.Type.Undefined()])),agentStepId:ec.Type.String()}),EventShape:ec.Type.Object({id:ec.Type.String(),parentEventId:ec.Type.String(),created:ec.Type.Optional(ec.Type.Union([ec.Type.Date(),ec.Type.Undefined()]))}),AgentUserFeedback:ec.Type.Object({type:ec.Type.Ref("AgentUserFeedbackType"),comment:ec.Type.String()}),SubmitAgentUserFeedbackRequest:ec.Type.Object({sessionId:ec.Type.String(),sourceEventId:ec.Type.String(),feedback:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("AgentUserFeedback"),ec.Type.Undefined()])),sessionType:ec.Type.Ref("SessionType")}),SubmitAgentUserFeedbackResponse:ec.Type.Object({}),ReplAgentState:ec.Type.Object({activeAgentSessionId:ec.Type.String()}),Session:ec.Type.Object({id:ec.Type.String(),title:ec.Type.String(),sessionType:ec.Type.Ref("SessionType"),replId:ec.Type.String(),events:ec.Type.Array(ec.Type.Ref("Event")),sessionCreationEventId:ec.Type.String(),archived:ec.Type.Boolean(),lastEventTime:ec.Type.Optional(ec.Type.Union([ec.Type.Date(),ec.Type.Undefined()])),created:ec.Type.Optional(ec.Type.Union([ec.Type.Date(),ec.Type.Undefined()])),updated:ec.Type.Optional(ec.Type.Union([ec.Type.Date(),ec.Type.Undefined()])),activeEventId:ec.Type.String(),readOnly:ec.Type.Boolean(),taskId:ec.Type.String(),revertedToSessionId:ec.Type.String(),revertedToEventId:ec.Type.String()}),Secret:ec.Type.Object({description:ec.Type.String(),key:ec.Type.String()}),SecretRequestAction:ec.Type.Object({secrets:ec.Type.Array(ec.Type.Ref("Secret"))}),UserSecretResponse:ec.Type.Object({key:ec.Type.String(),status:ec.Type.Ref("UserSecretResponseStatus")}),DeployRequest:ec.Type.Object({}),DeployResponse:ec.Type.Object({success:ec.Type.Boolean()}),MessageButton:ec.Type.Object({name:ec.Type.String(),description:ec.Type.String(),responseText:ec.Type.String()}),DeployRequestAction:ec.Type.Object({}),MessageButtonAction:ec.Type.Object({buttons:ec.Type.Array(ec.Type.Ref("MessageButton"))}),AgentUserSecretsRequest:ec.Type.Object({secrets:ec.Type.Array(ec.Type.Ref("Secret")),message:ec.Type.String()}),AgentUserSecretsResponse:ec.Type.Object({providedSecrets:ec.Type.Array(ec.Type.Ref("UserSecretResponse"))}),AgentDebugRequest:ec.Type.Object({enabled:ec.Type.Boolean(),isSelected:ec.Type.Boolean()}),AgentDebugResponse:ec.Type.Object({accepted:ec.Type.Boolean()}),AgentContinueRequest:ec.Type.Object({enabled:ec.Type.Boolean(),isSelected:ec.Type.Boolean()}),AgentContinueResponse:ec.Type.Object({accepted:ec.Type.Boolean()}),AgentNewFeatureRequest:ec.Type.Object({featureName:ec.Type.String(),id:ec.Type.Number(),isSelected:ec.Type.Boolean()}),UserMessageContents:ec.Type.Object({content:ec.Type.String(),uploadedFiles:ec.Type.Array(ec.Type.Ref("UploadedFile")),attachedUrls:ec.Type.Array(ec.Type.Ref("AttachedUrl"))}),AgentNewFeatureResponse:ec.Type.Object({selectedFeatureId:ec.Type.Number(),featureName:ec.Type.String(),userMessage:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("UserMessageContents"),ec.Type.Undefined()]))}),AgentDeployRequest:ec.Type.Object({}),AgentDeployResponse:ec.Type.Object({}),AgentAction:ec.Type.Object({optionType:ec.Type.Optional(ec.Type.Union([ec.Type.Object({$case:ec.Type.Literal("messageButtonAction"),value:ec.Type.Ref("MessageButtonAction")}),ec.Type.Object({$case:ec.Type.Literal("secretRequestAction"),value:ec.Type.Ref("SecretRequestAction")}),ec.Type.Object({$case:ec.Type.Literal("deployRequestAction"),value:ec.Type.Ref("DeployRequestAction")}),ec.Type.Undefined()]))}),AgentNextStepRequest:ec.Type.Object({newFeatureRequests:ec.Type.Array(ec.Type.Ref("AgentNewFeatureRequest")),debugRequest:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("AgentDebugRequest"),ec.Type.Undefined()])),keepWorkingRequest:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("AgentContinueRequest"),ec.Type.Undefined()]))}),AgentNextStepResponse:ec.Type.Object({response:ec.Type.Optional(ec.Type.Union([ec.Type.Object({$case:ec.Type.Literal("newFeatureResponse"),value:ec.Type.Ref("AgentNewFeatureResponse")}),ec.Type.Object({$case:ec.Type.Literal("debugResponse"),value:ec.Type.Ref("AgentDebugResponse")}),ec.Type.Object({$case:ec.Type.Literal("keepWorkingResponse"),value:ec.Type.Ref("AgentContinueResponse")}),ec.Type.Undefined()]))}),AgentQueryBoolean:ec.Type.Object({question:ec.Type.String(),confirmText:ec.Type.String(),rejectText:ec.Type.String(),allowAutoConfirm:ec.Type.Boolean()}),AgentQueryChoice:ec.Type.Object({question:ec.Type.String(),options:ec.Type.Array(ec.Type.String())}),AgentQueryText:ec.Type.Object({question:ec.Type.String(),responsePlaceholderText:ec.Type.String()}),AgentQuery:ec.Type.Object({queryType:ec.Type.Optional(ec.Type.Union([ec.Type.Object({$case:ec.Type.Literal("booleanQuery"),value:ec.Type.Ref("AgentQueryBoolean")}),ec.Type.Object({$case:ec.Type.Literal("choiceQuery"),value:ec.Type.Ref("AgentQueryChoice")}),ec.Type.Object({$case:ec.Type.Literal("textQuery"),value:ec.Type.Ref("AgentQueryText")}),ec.Type.Undefined()]))}),AgentQueryBooleanResponse:ec.Type.Object({response:ec.Type.Boolean(),reason:ec.Type.String()}),AgentQueryChoiceResponse:ec.Type.Object({response:ec.Type.String(),reason:ec.Type.String()}),AgentQueryTextResponse:ec.Type.Object({response:ec.Type.String()}),AgentQueryNoResponse:ec.Type.Object({}),AgentQueryResponse:ec.Type.Object({responseType:ec.Type.Optional(ec.Type.Union([ec.Type.Object({$case:ec.Type.Literal("booleanResponse"),value:ec.Type.Ref("AgentQueryBooleanResponse")}),ec.Type.Object({$case:ec.Type.Literal("choiceResponse"),value:ec.Type.Ref("AgentQueryChoiceResponse")}),ec.Type.Object({$case:ec.Type.Literal("textResponse"),value:ec.Type.Ref("AgentQueryTextResponse")}),ec.Type.Object({$case:ec.Type.Literal("noResponse"),value:ec.Type.Ref("AgentQueryNoResponse")}),ec.Type.Undefined()]))}),QueryResponseContent:ec.Type.Object({responses:ec.Type.Array(ec.Type.Ref("AgentQueryResponse"))}),QueryRequestContent:ec.Type.Object({contextSummary:ec.Type.String(),queries:ec.Type.Array(ec.Type.Ref("AgentQuery"))}),MarkTaskCompleteRequest:ec.Type.Object({taskId:ec.Type.String()}),UserMarkedTaskComplete:ec.Type.Object({taskId:ec.Type.String()}),ApproveTaskListRequest:ec.Type.Object({taskListEventId:ec.Type.String()}),ApproveTaskListResponse:ec.Type.Object({taskListEventId:ec.Type.String(),approved:ec.Type.Boolean(),tasks:ec.Type.Array(ec.Type.Ref("Task")),agentConfig:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("AgentConfig"),ec.Type.Undefined()]))}),ApproveInitialBuildMVPRequest:ec.Type.Object({taskListEventId:ec.Type.String(),userSecretsRequest:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("AgentUserSecretsRequest"),ec.Type.Undefined()])),addingIntegrationRequest:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("AddingIntegrationsRequest"),ec.Type.Undefined()]))}),ApproveInitialBuildMVPResponse:ec.Type.Object({approved:ec.Type.Boolean(),userSecretsResponse:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("AgentUserSecretsResponse"),ec.Type.Undefined()])),addingIntegrationsResponse:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("AddingIntegrationsResponse"),ec.Type.Undefined()])),agentConfig:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("AgentConfig"),ec.Type.Undefined()]))}),ApproveInitialBuildVisualPhaseRequest:ec.Type.Object({userSecretsRequest:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("AgentUserSecretsRequest"),ec.Type.Undefined()])),addingIntegrationRequest:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("AddingIntegrationsRequest"),ec.Type.Undefined()]))}),ApproveInitialBuildVisualPhaseResponse:ec.Type.Object({approved:ec.Type.Boolean(),userSecretsResponse:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("AgentUserSecretsResponse"),ec.Type.Undefined()])),addingIntegrationsResponse:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("AddingIntegrationsResponse"),ec.Type.Undefined()])),agentConfig:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("AgentConfig"),ec.Type.Undefined()]))}),ApproveSqlQueryRequest:ec.Type.Object({sqlQuery:ec.Type.String(),executionReason:ec.Type.String()}),ApproveSqlQueryResponse:ec.Type.Object({sqlQueryEventId:ec.Type.String(),approved:ec.Type.Boolean()}),ApproveBlueprintRequest:ec.Type.Object({blueprintName:ec.Type.String(),blueprintDisplayName:ec.Type.String()}),ApproveBlueprintResponse:ec.Type.Object({blueprintEventId:ec.Type.String(),approved:ec.Type.Boolean(),blueprintName:ec.Type.String()}),ConvertMockupToAppRequest:ec.Type.Object({}),ConvertMockupToAppResponse:ec.Type.Object({approved:ec.Type.Boolean(),additionalComments:ec.Type.String()}),AgentAskUserForActionRequest:ec.Type.Object({request:ec.Type.Optional(ec.Type.Union([ec.Type.Object({$case:ec.Type.Literal("nextStepRequest"),value:ec.Type.Ref("AgentNextStepRequest")}),ec.Type.Object({$case:ec.Type.Literal("userSecretsRequest"),value:ec.Type.Ref("AgentUserSecretsRequest")}),ec.Type.Object({$case:ec.Type.Literal("deployRequest"),value:ec.Type.Ref("AgentDeployRequest")}),ec.Type.Object({$case:ec.Type.Literal("queryRequest"),value:ec.Type.Ref("QueryRequestContent")}),ec.Type.Object({$case:ec.Type.Literal("markTaskCompleteRequest"),value:ec.Type.Ref("MarkTaskCompleteRequest")}),ec.Type.Object({$case:ec.Type.Literal("approveTaskListRequest"),value:ec.Type.Ref("ApproveTaskListRequest")}),ec.Type.Object({$case:ec.Type.Literal("approveSqlQueryRequest"),value:ec.Type.Ref("ApproveSqlQueryRequest")}),ec.Type.Object({$case:ec.Type.Literal("addingIntegrationRequest"),value:ec.Type.Ref("AddingIntegrationsRequest")}),ec.Type.Object({$case:ec.Type.Literal("approveInitialBuildMvpRequest"),value:ec.Type.Ref("ApproveInitialBuildMVPRequest")}),ec.Type.Object({$case:ec.Type.Literal("approveInitialBuildVisualPhaseRequest"),value:ec.Type.Ref("ApproveInitialBuildVisualPhaseRequest")}),ec.Type.Object({$case:ec.Type.Literal("approveBlueprintRequest"),value:ec.Type.Ref("ApproveBlueprintRequest")}),ec.Type.Object({$case:ec.Type.Literal("environmentConfigRequest"),value:ec.Type.Ref("EnvironmentConfigRequest")}),ec.Type.Object({$case:ec.Type.Literal("convertMockupToAppRequest"),value:ec.Type.Ref("ConvertMockupToAppRequest")}),ec.Type.Undefined()])),message:ec.Type.String()}),AgentAskUserForActionResponse:ec.Type.Object({response:ec.Type.Optional(ec.Type.Union([ec.Type.Object({$case:ec.Type.Literal("nextStepResponse"),value:ec.Type.Ref("AgentNextStepResponse")}),ec.Type.Object({$case:ec.Type.Literal("userSecretsResponse"),value:ec.Type.Ref("AgentUserSecretsResponse")}),ec.Type.Object({$case:ec.Type.Literal("deployResponse"),value:ec.Type.Ref("AgentDeployResponse")}),ec.Type.Object({$case:ec.Type.Literal("queryResponse"),value:ec.Type.Ref("QueryResponseContent")}),ec.Type.Object({$case:ec.Type.Literal("userMarkedTaskComplete"),value:ec.Type.Ref("UserMarkedTaskComplete")}),ec.Type.Object({$case:ec.Type.Literal("approveTaskListResponse"),value:ec.Type.Ref("ApproveTaskListResponse")}),ec.Type.Object({$case:ec.Type.Literal("approveSqlQueryResponse"),value:ec.Type.Ref("ApproveSqlQueryResponse")}),ec.Type.Object({$case:ec.Type.Literal("addingIntegrationsResponse"),value:ec.Type.Ref("AddingIntegrationsResponse")}),ec.Type.Object({$case:ec.Type.Literal("approveInitialBuildMvpResponse"),value:ec.Type.Ref("ApproveInitialBuildMVPResponse")}),ec.Type.Object({$case:ec.Type.Literal("approveInitialBuildVisualPhaseResponse"),value:ec.Type.Ref("ApproveInitialBuildVisualPhaseResponse")}),ec.Type.Object({$case:ec.Type.Literal("approveBlueprintResponse"),value:ec.Type.Ref("ApproveBlueprintResponse")}),ec.Type.Object({$case:ec.Type.Literal("envVarsResponse"),value:ec.Type.Ref("EnvironmentConfigResponse")}),ec.Type.Object({$case:ec.Type.Literal("convertMockupToAppResponse"),value:ec.Type.Ref("ConvertMockupToAppResponse")}),ec.Type.Undefined()])),requestEventId:ec.Type.String()}),SetupImportedProjectEventContents:ec.Type.Object({importSource:ec.Type.Ref("ProjectImportSource"),agentConfig:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("AgentConfig"),ec.Type.Undefined()]))}),ProjectImportCompletedData:ec.Type.Object({}),MemoryCompressionData:ec.Type.Object({}),TaskListData:ec.Type.Object({tasks:ec.Type.Array(ec.Type.Ref("Task")),commitData:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("CommitData"),ec.Type.Undefined()])),agentMode:ec.Type.Ref("AgentMode"),estimatedUsageCents:ec.Type.Number()}),Task:ec.Type.Object({id:ec.Type.String(),content:ec.Type.String(),status:ec.Type.Ref("TaskStatus"),oldStatus:ec.Type.Ref("TaskStatus"),updated:ec.Type.Boolean(),summary:ec.Type.String(),extraDetails:ec.Type.String()}),EventContents:ec.Type.Object({contents:ec.Type.Optional(ec.Type.Union([ec.Type.Object({$case:ec.Type.Literal("sessionCreationEventContents"),value:ec.Type.Ref("SessionCreationEventContents")}),ec.Type.Object({$case:ec.Type.Literal("messageEventContents"),value:ec.Type.Ref("MessageEventContents")}),ec.Type.Object({$case:ec.Type.Literal("inlineActionEventContents"),value:ec.Type.Ref("InlineActionEventContents")}),ec.Type.Object({$case:ec.Type.Literal("localShellExecutionEventContents"),value:ec.Type.Ref("LocalShellExecutionEventContents")}),ec.Type.Object({$case:ec.Type.Literal("shellSuggestionEventContents"),value:ec.Type.Ref("ShellSuggestionEventContents")}),ec.Type.Object({$case:ec.Type.Literal("translateEventContents"),value:ec.Type.Ref("TranslateEventContents")}),ec.Type.Object({$case:ec.Type.Literal("byoPromptEventContents"),value:ec.Type.Ref("BYOPromptEventContents")}),ec.Type.Object({$case:ec.Type.Literal("agentPlanEventContents"),value:ec.Type.Ref("AgentPlanEventContents")}),ec.Type.Object({$case:ec.Type.Literal("agentTimelineEventContents"),value:ec.Type.Ref("AgentTimelineEventContents")}),ec.Type.Object({$case:ec.Type.Literal("benchmarkConclusion"),value:ec.Type.Ref("BenchmarkConclusionEventContents")}),ec.Type.Object({$case:ec.Type.Literal("revertEventContents"),value:ec.Type.Ref("RevertEventContents")}),ec.Type.Object({$case:ec.Type.Literal("hostingDebugSummaryEventContents"),value:ec.Type.Ref("HostingDebugSummaryEventContents")}),ec.Type.Object({$case:ec.Type.Literal("approvePlanEventContents"),value:ec.Type.Ref("ApprovePlanEventContents")}),ec.Type.Object({$case:ec.Type.Literal("userSecretsResponseEventContents"),value:ec.Type.Ref("UserSecretsResponseEventContents")}),ec.Type.Object({$case:ec.Type.Literal("replCreationEventContents"),value:ec.Type.Ref("ReplCreationEventContents")}),ec.Type.Object({$case:ec.Type.Literal("iterativeAgentEventContents"),value:ec.Type.Ref("IterativeAgentEventContents")}),ec.Type.Object({$case:ec.Type.Literal("stepTooComplexEventContents"),value:ec.Type.Ref("StepTooComplexEventContents")}),ec.Type.Object({$case:ec.Type.Literal("stepTooComplexAcknowledgementEventContents"),value:ec.Type.Ref("StepTooComplexAcknowledgementEventContents")}),ec.Type.Object({$case:ec.Type.Literal("agentAskUserForActionRequest"),value:ec.Type.Ref("AgentAskUserForActionRequest")}),ec.Type.Object({$case:ec.Type.Literal("agentAskUserForActionResponse"),value:ec.Type.Ref("AgentAskUserForActionResponse")}),ec.Type.Object({$case:ec.Type.Literal("integrationTestEventContents"),value:ec.Type.Ref("IntegrationTestEventContents")}),ec.Type.Object({$case:ec.Type.Literal("contextComplexityEventContents"),value:ec.Type.Ref("ContextComplexityEventContents")}),ec.Type.Object({$case:ec.Type.Literal("eventTooLargeEventContents"),value:ec.Type.Ref("EventTooLargeEventContents")}),ec.Type.Object({$case:ec.Type.Literal("startRapidBuildEventContents"),value:ec.Type.Ref("StartRapidBuildEventContents")}),ec.Type.Object({$case:ec.Type.Literal("databaseNudgeEventContents"),value:ec.Type.Ref("DatabaseNudgeEventContents")}),ec.Type.Object({$case:ec.Type.Literal("rapidBuildConcluded"),value:ec.Type.Ref("RapidBuildConcludedData")}),ec.Type.Object({$case:ec.Type.Literal("versionMigrated"),value:ec.Type.Ref("VersionMigratedData")}),ec.Type.Object({$case:ec.Type.Literal("rapidBuildStarted"),value:ec.Type.Ref("RapidBuildStartedData")}),ec.Type.Object({$case:ec.Type.Literal("requestFeatureAddData"),value:ec.Type.Ref("RequestFeatureAdd")}),ec.Type.Object({$case:ec.Type.Literal("triggerCheckpointEventContents"),value:ec.Type.Ref("TriggerCheckpointEventContents")}),ec.Type.Object({$case:ec.Type.Literal("setupImportedProjectEventContents"),value:ec.Type.Ref("SetupImportedProjectEventContents")}),ec.Type.Object({$case:ec.Type.Literal("tipRecommendation"),value:ec.Type.Ref("UserTipRecommendationData")}),ec.Type.Object({$case:ec.Type.Literal("subagentRunning"),value:ec.Type.Ref("SubagentRunningData")}),ec.Type.Object({$case:ec.Type.Literal("uiTestingSubagentExecutionEventContents"),value:ec.Type.Ref("UITestingSubagentExecutionEventContents")}),ec.Type.Object({$case:ec.Type.Literal("initialBuildStateUpdateEventContents"),value:ec.Type.Ref("InitialBuildStateUpdateEventContents")}),ec.Type.Object({$case:ec.Type.Literal("agentConfigUpdateEventContents"),value:ec.Type.Ref("AgentConfigUpdateEventContents")}),ec.Type.Object({$case:ec.Type.Literal("cloudBudgetExceededEventContents"),value:ec.Type.Ref("CloudBudgetExceededEventContents")}),ec.Type.Object({$case:ec.Type.Literal("executedSandboxedCodeData"),value:ec.Type.Ref("ExecutedSandboxedCodeEventData")}),ec.Type.Undefined()])),benchmarkParameters:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("BenchmarkParameters"),ec.Type.Undefined()]))}),EventContext:ec.Type.Object({metadata:ec.Type.Optional(ec.Type.Union([ec.Type.Object({$case:ec.Type.Literal("sessionCreationEventContext"),value:ec.Type.Ref("SessionCreationEventContext")}),ec.Type.Object({$case:ec.Type.Literal("messageEventContext"),value:ec.Type.Ref("MessageEventContext")}),ec.Type.Object({$case:ec.Type.Literal("inlineActionEventContext"),value:ec.Type.Ref("InlineActionEventContext")}),ec.Type.Object({$case:ec.Type.Literal("localShellExecutionEventContext"),value:ec.Type.Ref("LocalShellExecutionEventContext")}),ec.Type.Object({$case:ec.Type.Literal("shellSuggestionEventContext"),value:ec.Type.Ref("ShellSuggestionEventContext")}),ec.Type.Object({$case:ec.Type.Literal("translateEventContext"),value:ec.Type.Ref("TranslateEventContext")}),ec.Type.Object({$case:ec.Type.Literal("byoPromptEventContext"),value:ec.Type.Ref("BYOPromptEventContext")}),ec.Type.Object({$case:ec.Type.Literal("agentPlanEventContext"),value:ec.Type.Ref("AgentPlanEventContext")}),ec.Type.Object({$case:ec.Type.Literal("agentTimelineEventContext"),value:ec.Type.Ref("AgentTimelineEventContext")}),ec.Type.Object({$case:ec.Type.Literal("hostingDebugSummaryEventContext"),value:ec.Type.Ref("HostingDebugSummaryEventContext")}),ec.Type.Object({$case:ec.Type.Literal("replCreationEventContext"),value:ec.Type.Ref("ReplCreationEventContext")}),ec.Type.Object({$case:ec.Type.Literal("userSecretsResponseEventContext"),value:ec.Type.Ref("UserSecretsResponseEventContext")}),ec.Type.Object({$case:ec.Type.Literal("revertEventContext"),value:ec.Type.Ref("RevertEventContext")}),ec.Type.Object({$case:ec.Type.Literal("iterativeAgentEventContext"),value:ec.Type.Ref("IterativeAgentEventContext")}),ec.Type.Object({$case:ec.Type.Literal("integrationTestEventContext"),value:ec.Type.Ref("IntegrationTestEventContext")}),ec.Type.Undefined()]))}),StartRapidBuildEventContents:ec.Type.Object({mvpObjective:ec.Type.String(),stack:ec.Type.String(),followupSteps:ec.Type.Array(ec.Type.String()),uploadedFiles:ec.Type.Array(ec.Type.Ref("UploadedRapidBuildFile")),extraDetails:ec.Type.String(),techStack:ec.Type.String(),mvpSuccessCriteria:ec.Type.String()}),RapidBuildStartedData:ec.Type.Object({}),SessionCreationEventContents:ec.Type.Object({}),DatabaseNudgeEventContents:ec.Type.Object({}),CloudBudgetExceededEventContents:ec.Type.Object({serviceName:ec.Type.String()}),SkillLoadedEventData:ec.Type.Object({skillName:ec.Type.String(),skillFile:ec.Type.String(),skillPath:ec.Type.String()}),ExecutedSandboxedCodeEventData:ec.Type.Object({language:ec.Type.Ref("SandboxLanguage"),code:ec.Type.String(),stdout:ec.Type.String(),stderr:ec.Type.String(),description:ec.Type.String(),output:ec.Type.Array(ec.Type.Ref("SandboxOutput"))}),ProposedTaskEventData:ec.Type.Object({tasks:ec.Type.Array(ec.Type.Ref("ProposedTask"))}),ProposedTask:ec.Type.Object({id:ec.Type.String(),title:ec.Type.String(),taskPlan:ec.Type.String()}),StartTaskEventData:ec.Type.Object({taskId:ec.Type.String(),taskRunId:ec.Type.String()}),SandboxOutput:ec.Type.Object({type:ec.Type.Ref("SandboxOutputType"),output:ec.Type.String()}),AddExecutedSandboxedCodeOutput:ec.Type.Object({output:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("SandboxOutput"),ec.Type.Undefined()]))}),CodeChangeStats:ec.Type.Object({linesAdded:ec.Type.Number(),linesRemoved:ec.Type.Number(),commitId:ec.Type.String()}),AgentPlanStep:ec.Type.Recursive(e=>ec.Type.Object({id:ec.Type.String(),name:ec.Type.String(),status:ec.Type.Ref("AgentPlanStepStatus"),message:ec.Type.String(),metadata:ec.Type.Optional(ec.Type.Union([ec.Type.Object({$case:ec.Type.Literal("codeChangeStats"),value:ec.Type.Ref("CodeChangeStats")}),ec.Type.Undefined()])),timelineEventId:ec.Type.String(),subSteps:ec.Type.Array(e),blueprints:ec.Type.Array(ec.Type.String()),blueprintData:ec.Type.Array(ec.Type.Ref("BlueprintData")),mode:ec.Type.String(),commitId:ec.Type.String()})),BlueprintsSetup:ec.Type.Object({blueprintData:ec.Type.Array(ec.Type.Ref("BlueprintData"))}),RequestFeatureAdd:ec.Type.Object({type:ec.Type.Ref("RequestFeatureAddType")}),AgentPlanObjective:ec.Type.Object({description:ec.Type.String()}),AgentPlanEventContents:ec.Type.Object({planId:ec.Type.String(),objective:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("AgentPlanObjective"),ec.Type.Undefined()])),step:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("AgentPlanStep"),ec.Type.Undefined()])),requiresApproval:ec.Type.Boolean(),initialCommitId:ec.Type.String(),approver:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("UserContext"),ec.Type.Undefined()])),stackBlueprint:tu,designReferenceFilePaths:ec.Type.Array(ec.Type.String()),approvedDesignReferenceFilePath:ec.Type.String(),customStackReplId:ec.Type.Optional(ec.Type.Union([ec.Type.String(),ec.Type.Undefined()])),userSecretsRequest:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("AgentUserSecretsRequest"),ec.Type.Undefined()])),agentStackTriggerType:ec.Type.Ref("AgentStackTriggerType")}),AgentPlanEventContext:ec.Type.Object({}),RevertEventContext:ec.Type.Object({}),BlueprintData:ec.Type.Object({category:ec.Type.Ref("BlueprintCategory"),displayName:ec.Type.String(),name:ec.Type.String(),secrets:ec.Type.Array(ec.Type.Ref("Secret"))}),ShellExecutionData:ec.Type.Object({command:ec.Type.String(),shellId:ec.Type.String(),stdout:ec.Type.String(),stderr:ec.Type.String(),exitCode:ec.Type.Number(),processId:ec.Type.String(),isExecuting:ec.Type.Boolean(),output:ec.Type.String()}),FileEditData:ec.Type.Object({filePath:ec.Type.String(),diff:ec.Type.String(),removedLines:ec.Type.Number(),addedLines:ec.Type.Number()}),CreateFileData:ec.Type.Object({filePath:ec.Type.String(),content:ec.Type.String()}),ReadFileData:ec.Type.Object({filePath:ec.Type.String(),content:ec.Type.String(),startLine:ec.Type.Number(),endLine:ec.Type.Number()}),ReadDirData:ec.Type.Object({path:ec.Type.String(),paths:ec.Type.Array(ec.Type.String())}),PackagerInstallData:ec.Type.Object({inputLanguage:ec.Type.String(),inputPackages:ec.Type.Array(ec.Type.String()),output:ec.Type.String(),processId:ec.Type.String(),isExecuting:ec.Type.Boolean()}),PackagerUninstallData:ec.Type.Object({inputLanguage:ec.Type.String(),inputPackages:ec.Type.Array(ec.Type.String())}),SearchFilesystemData:ec.Type.Object({queryDescription:ec.Type.String(),filePaths:ec.Type.Array(ec.Type.String()),classNames:ec.Type.Array(ec.Type.String()),functionNames:ec.Type.Array(ec.Type.String()),resultFileNames:ec.Type.Array(ec.Type.String()),resultFileSummaries:ec.Type.Array(ec.Type.String())}),WebSearchResultPage:ec.Type.Object({title:ec.Type.String(),url:ec.Type.String()}),GoogleSuggestedSearch:ec.Type.Object({webSearchQueries:ec.Type.Array(ec.Type.String())}),WebSearchData:ec.Type.Object({query:ec.Type.String(),response:ec.Type.String(),pageResults:ec.Type.Array(ec.Type.Ref("WebSearchResultPage")),googleSuggestedSearch:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("GoogleSuggestedSearch"),ec.Type.Undefined()])),searchType:ec.Type.Ref("WebSearchType")}),WebPageVisitData:ec.Type.Object({url:ec.Type.String(),title:ec.Type.String(),snippet:ec.Type.String(),favicon:ec.Type.String()}),ScreenshotData:ec.Type.Object({port:ec.Type.Number(),path:ec.Type.String(),imageUrl:ec.Type.String()}),ToolchainInstallData:ec.Type.Object({modules:ec.Type.Array(ec.Type.String())}),WorkflowsGetOutputToolData:ec.Type.Object({name:ec.Type.String(),output:ec.Type.String()}),WorkflowsRemoveRunConfigToolData:ec.Type.Object({name:ec.Type.String()}),WorkflowsRestartToolData:ec.Type.Object({name:ec.Type.String()}),WorkflowsSetRunConfigToolData:ec.Type.Object({name:ec.Type.String(),command:ec.Type.String()}),WorkflowsStartToolData:ec.Type.Object({name:ec.Type.String()}),WorkflowsStopToolData:ec.Type.Object({name:ec.Type.String()}),CheckpointSuggestions:ec.Type.Object({recommended:ec.Type.Boolean(),commitData:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("CommitData"),ec.Type.Undefined()])),suggestionReason:ec.Type.Ref("CheckpointSuggestionReason"),rollbackDatabase:ec.Type.Boolean(),rollbackRepl:ec.Type.Boolean()}),SuggestRollbackData:ec.Type.Object({suggestRollbackReason:ec.Type.String(),checkpointCommitSha:ec.Type.String(),checkpointSuggestions:ec.Type.Array(ec.Type.Ref("CheckpointSuggestions"))}),AgentStoppedData:ec.Type.Object({checkpointSuggestions:ec.Type.Array(ec.Type.Ref("CheckpointSuggestions"))}),PresentResultsToolData:ec.Type.Object({resultType:ec.Type.String(),shellCommand:ec.Type.String(),websitePort:ec.Type.Number(),shellCommandWorkflowName:ec.Type.String(),websiteRoute:ec.Type.String()}),SearchFileData:ec.Type.Object({filePath:ec.Type.String(),query:ec.Type.String()}),SuggestGeneralBuildModeData:ec.Type.Object({message:ec.Type.String(),suggestedAutonomyLevel:ec.Type.Ref("AutonomyLevel")}),FileOutput:ec.Type.Object({id:ec.Type.String(),uri:ec.Type.String(),type:ec.Type.Ref("FileOutputType"),title:ec.Type.String()}),FileOutputsData:ec.Type.Object({fileOutputs:ec.Type.Array(ec.Type.Ref("FileOutput"))}),AgentTimelineEventContents:ec.Type.Object({toolName:ec.Type.String(),planStepId:ec.Type.String(),message:ec.Type.String(),toolData:ec.Type.Optional(ec.Type.Union([ec.Type.Object({$case:ec.Type.Literal("shellExecutionData"),value:ec.Type.Ref("ShellExecutionData")}),ec.Type.Object({$case:ec.Type.Literal("fileEditData"),value:ec.Type.Ref("FileEditData")}),ec.Type.Object({$case:ec.Type.Literal("createFileData"),value:ec.Type.Ref("CreateFileData")}),ec.Type.Object({$case:ec.Type.Literal("readFileData"),value:ec.Type.Ref("ReadFileData")}),ec.Type.Object({$case:ec.Type.Literal("packagerInstallData"),value:ec.Type.Ref("PackagerInstallData")}),ec.Type.Object({$case:ec.Type.Literal("searchFilesystemData"),value:ec.Type.Ref("SearchFilesystemData")}),ec.Type.Object({$case:ec.Type.Literal("messageData"),value:ec.Type.Ref("MessageEventContents")}),ec.Type.Object({$case:ec.Type.Literal("packagerUninstallData"),value:ec.Type.Ref("PackagerUninstallData")}),ec.Type.Object({$case:ec.Type.Literal("screenshotData"),value:ec.Type.Ref("ScreenshotData")}),ec.Type.Object({$case:ec.Type.Literal("toolchainInstallData"),value:ec.Type.Ref("ToolchainInstallData")}),ec.Type.Object({$case:ec.Type.Literal("workflowsGetOutputToolData"),value:ec.Type.Ref("WorkflowsGetOutputToolData")}),ec.Type.Object({$case:ec.Type.Literal("workflowsRemoveRunConfigToolData"),value:ec.Type.Ref("WorkflowsRemoveRunConfigToolData")}),ec.Type.Object({$case:ec.Type.Literal("workflowsRestartToolData"),value:ec.Type.Ref("WorkflowsRestartToolData")}),ec.Type.Object({$case:ec.Type.Literal("workflowsSetRunConfigToolData"),value:ec.Type.Ref("WorkflowsSetRunConfigToolData")}),ec.Type.Object({$case:ec.Type.Literal("workflowsStartToolData"),value:ec.Type.Ref("WorkflowsStartToolData")}),ec.Type.Object({$case:ec.Type.Literal("workflowsStopToolData"),value:ec.Type.Ref("WorkflowsStopToolData")}),ec.Type.Object({$case:ec.Type.Literal("planProgressData"),value:ec.Type.Ref("PlanProgressData")}),ec.Type.Object({$case:ec.Type.Literal("summarizeObjectiveData"),value:ec.Type.Ref("SummarizeObjectiveData")}),ec.Type.Object({$case:ec.Type.Literal("presentResultsToolData"),value:ec.Type.Ref("PresentResultsToolData")}),ec.Type.Object({$case:ec.Type.Literal("searchFileData"),value:ec.Type.Ref("SearchFileData")}),ec.Type.Object({$case:ec.Type.Literal("systemDependencyInstallData"),value:ec.Type.Ref("SystemDependencyInstallData")}),ec.Type.Object({$case:ec.Type.Literal("systemDependencyUninstallData"),value:ec.Type.Ref("SystemDependencyUninstallData")}),ec.Type.Object({$case:ec.Type.Literal("deployData"),value:ec.Type.Ref("DeployData")}),ec.Type.Object({$case:ec.Type.Literal("revertData"),value:ec.Type.Ref("RevertData")}),ec.Type.Object({$case:ec.Type.Literal("deployConfigData"),value:ec.Type.Ref("DeployConfigData")}),ec.Type.Object({$case:ec.Type.Literal("agentPlanStepBegin"),value:ec.Type.Ref("AgentPlanStepBeginData")}),ec.Type.Object({$case:ec.Type.Literal("acknowledgeUserMessage"),value:ec.Type.Ref("AcknowledgeUserMessage")}),ec.Type.Object({$case:ec.Type.Literal("createPostgresqlDatabaseData"),value:ec.Type.Ref("CreatePostgreSQLDatabaseData")}),ec.Type.Object({$case:ec.Type.Literal("sqlExecutionData"),value:ec.Type.Ref("SqlExecutionData")}),ec.Type.Object({$case:ec.Type.Literal("newSessionNudge"),value:ec.Type.Ref("NewSessionNudge")}),ec.Type.Object({$case:ec.Type.Literal("commitData"),value:ec.Type.Ref("CommitData")}),ec.Type.Object({$case:ec.Type.Literal("readDirData"),value:ec.Type.Ref("ReadDirData")}),ec.Type.Object({$case:ec.Type.Literal("thoughts"),value:ec.Type.Ref("AgentThoughtsData")}),ec.Type.Object({$case:ec.Type.Literal("blueprintsSetup"),value:ec.Type.Ref("BlueprintsSetup")}),ec.Type.Object({$case:ec.Type.Literal("webPageVisitData"),value:ec.Type.Ref("WebPageVisitData")}),ec.Type.Object({$case:ec.Type.Literal("webSearchData"),value:ec.Type.Ref("WebSearchData")}),ec.Type.Object({$case:ec.Type.Literal("imageGenerationData"),value:ec.Type.Ref("ImageGenerationData")}),ec.Type.Object({$case:ec.Type.Literal("projectImportCompleted"),value:ec.Type.Ref("ProjectImportCompletedData")}),ec.Type.Object({$case:ec.Type.Literal("memoryCompressionData"),value:ec.Type.Ref("MemoryCompressionData")}),ec.Type.Object({$case:ec.Type.Literal("suggestRollbackData"),value:ec.Type.Ref("SuggestRollbackData")}),ec.Type.Object({$case:ec.Type.Literal("taskListData"),value:ec.Type.Ref("TaskListData")}),ec.Type.Object({$case:ec.Type.Literal("samplingEvent"),value:ec.Type.Ref("SamplingEvent")}),ec.Type.Object({$case:ec.Type.Literal("setupObjectStorageData"),value:ec.Type.Ref("SetupObjectStorageData")}),ec.Type.Object({$case:ec.Type.Literal("endOfRunSummaryData"),value:ec.Type.Ref("EndOfRunSummaryData")}),ec.Type.Object({$case:ec.Type.Literal("stockImageData"),value:ec.Type.Ref("StockImageData")}),ec.Type.Object({$case:ec.Type.Literal("searchIntegrationsData"),value:ec.Type.Ref("SearchIntegrationsData")}),ec.Type.Object({$case:ec.Type.Literal("viewIntegrationData"),value:ec.Type.Ref("ViewIntegrationData")}),ec.Type.Object({$case:ec.Type.Literal("setupModelfarmData"),value:ec.Type.Ref("SetupModelfarmData")}),ec.Type.Object({$case:ec.Type.Literal("viewLogsData"),value:ec.Type.Ref("ViewLogsData")}),ec.Type.Object({$case:ec.Type.Literal("uiTestingSubagentTakeOverData"),value:ec.Type.Ref("UITestingSubagentTakeOverData")}),ec.Type.Object({$case:ec.Type.Literal("viewSpecialFiles"),value:ec.Type.Ref("ViewSpecialFilesData")}),ec.Type.Object({$case:ec.Type.Literal("designGuidelinesData"),value:ec.Type.Ref("DesignGuidelinesData")}),ec.Type.Object({$case:ec.Type.Literal("mcpToolData"),value:ec.Type.Ref("MCPToolData")}),ec.Type.Object({$case:ec.Type.Literal("alertData"),value:ec.Type.Ref("AlertData")}),ec.Type.Object({$case:ec.Type.Literal("viewEnvVarData"),value:ec.Type.Ref("ViewEnvVarData")}),ec.Type.Object({$case:ec.Type.Literal("setEnvVarData"),value:ec.Type.Ref("SetEnvVarData")}),ec.Type.Object({$case:ec.Type.Literal("deleteEnvVarData"),value:ec.Type.Ref("DeleteEnvVarData")}),ec.Type.Object({$case:ec.Type.Literal("videoGenerationData"),value:ec.Type.Ref("VideoGenerationData")}),ec.Type.Object({$case:ec.Type.Literal("generateMediaData"),value:ec.Type.Ref("GenerateMediaData")}),ec.Type.Object({$case:ec.Type.Literal("waitingForBackgroundJobsData"),value:ec.Type.Ref("WaitingForBackgroundJobsData")}),ec.Type.Object({$case:ec.Type.Literal("suggestGeneralBuildModeData"),value:ec.Type.Ref("SuggestGeneralBuildModeData")}),ec.Type.Object({$case:ec.Type.Literal("messagedBackgroundAgent"),value:ec.Type.Ref("MessagedBackgroundAgentData")}),ec.Type.Object({$case:ec.Type.Literal("subagentReportResultData"),value:ec.Type.Ref("SubagentReportResultData")}),ec.Type.Object({$case:ec.Type.Literal("reportAgentIssueData"),value:ec.Type.Ref("ReportAgentIssueData")}),ec.Type.Object({$case:ec.Type.Literal("agentStoppedData"),value:ec.Type.Ref("AgentStoppedData")}),ec.Type.Object({$case:ec.Type.Literal("createAutomationPreviewData"),value:ec.Type.Ref("CreateAutomationPreviewData")}),ec.Type.Object({$case:ec.Type.Literal("skillLoadedData"),value:ec.Type.Ref("SkillLoadedEventData")}),ec.Type.Object({$case:ec.Type.Literal("executedSandboxedCodeData"),value:ec.Type.Ref("ExecutedSandboxedCodeEventData")}),ec.Type.Object({$case:ec.Type.Literal("proposedTaskEventData"),value:ec.Type.Ref("ProposedTaskEventData")}),ec.Type.Object({$case:ec.Type.Literal("startTaskEventData"),value:ec.Type.Ref("StartTaskEventData")}),ec.Type.Object({$case:ec.Type.Literal("fileOutputData"),value:ec.Type.Ref("FileOutputsData")}),ec.Type.Object({$case:ec.Type.Literal("artifactBuildingData"),value:ec.Type.Ref("ArtifactBuildingData")}),ec.Type.Object({$case:ec.Type.Literal("artifactPresentedData"),value:ec.Type.Ref("ArtifactPresentedData")}),ec.Type.Undefined()])),fallbackEvent:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("FallbackEvent"),ec.Type.Undefined()]))}),AgentPlanStepBeginData:ec.Type.Object({planStep:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("AgentPlanStep"),ec.Type.Undefined()])),starts:ec.Type.Optional(ec.Type.Union([ec.Type.Date(),ec.Type.Undefined()]))}),FallbackEvent:ec.Type.Object({summary:ec.Type.String(),input:ec.Type.String(),output:ec.Type.String()}),SummarizeObjectiveData:ec.Type.Object({summarizedObjective:ec.Type.String()}),AgentThoughtsData:ec.Type.Object({thoughts:ec.Type.String(),redactedThoughtsMarkers:ec.Type.Array(ec.Type.Ref("RedactedThoughtsMarker")),totalTimeTakenMs:ec.Type.Number(),summary:ec.Type.String()}),RedactedThoughtsMarker:ec.Type.Object({index:ec.Type.Number()}),RapidBuildConcludedData:ec.Type.Object({willContinueWorking:ec.Type.Boolean()}),VersionMigratedData:ec.Type.Object({version:ec.Type.Number()}),PlanProgressData:ec.Type.Object({updatedPlanStep:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("AgentPlanStep"),ec.Type.Undefined()]))}),BenchmarkConclusionEventContents:ec.Type.Object({completionReason:ec.Type.Ref("BenchmarkConclusionReason"),steps:ec.Type.Number(),exception:ec.Type.String(),datasetId:ec.Type.String(),instanceId:ec.Type.String(),runId:ec.Type.String(),metrics:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("BenchmarkMetrics"),ec.Type.Undefined()]))}),BenchmarkMetrics:ec.Type.Object({increment:ec.Type.Array(ec.Type.Ref("Metric")),decrement:ec.Type.Array(ec.Type.Ref("Metric")),gauge:ec.Type.Array(ec.Type.Ref("Metric")),histogram:ec.Type.Array(ec.Type.Ref("Metric")),distribution:ec.Type.Array(ec.Type.Ref("Metric")),timing:ec.Type.Array(ec.Type.Ref("Metric"))}),Metric:ec.Type.Object({name:ec.Type.String(),metrics:ec.Type.Array(ec.Type.Ref("MetricByTag"))}),MetricByTag:ec.Type.Object({tags:ec.Type.Array(ec.Type.String()),values:ec.Type.Array(ec.Type.Number())}),AgentTimelineEventContext:ec.Type.Object({}),Range:ec.Type.Object({indexFrom:ec.Type.Number(),indexTo:ec.Type.Number(),lineFrom:ec.Type.Number(),lineTo:ec.Type.Number()}),CodeReference:ec.Type.Object({code:ec.Type.String(),filePath:ec.Type.String(),fileVersion:ec.Type.Number(),fileContent:ec.Type.String(),range:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("Range"),ec.Type.Undefined()])),language:ec.Type.String(),referenceType:ec.Type.Ref("CodeReferenceType")}),ArtifactReference:ec.Type.Object({id:ec.Type.String(),displayName:ec.Type.String(),kind:ec.Type.Ref("ArtifactKind")}),ArtifactBuildingData:ec.Type.Object({artifactId:ec.Type.String(),kind:ec.Type.Ref("ArtifactKind"),displayName:ec.Type.String()}),ArtifactPresentedData:ec.Type.Object({artifactId:ec.Type.String(),kind:ec.Type.Ref("ArtifactKind"),displayName:ec.Type.String()}),MessageEventContents:ec.Type.Object({content:ec.Type.String(),intent:ec.Type.Ref("MessageAction"),stopReason:ec.Type.Ref("MessageStopReason"),debugFullPrompt:ec.Type.String(),codeReference:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("CodeReference"),ec.Type.Undefined()])),debugErrorSource:ec.Type.Ref("DebugErrorSource"),media:ec.Type.Array(ec.Type.Ref("MediaReference")),usedModelSelector:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("ModelSelector"),ec.Type.Undefined()])),sources:ec.Type.Array(ec.Type.Ref("Source")),extraActions:ec.Type.Optional(ec.Type.Union([ec.Type.Object({$case:ec.Type.Literal("suggestedTemplates"),value:ec.Type.Ref("SuggestedTemplates")}),ec.Type.Object({$case:ec.Type.Literal("proposedFileChanges"),value:ec.Type.Ref("ProposedFileChanges")}),ec.Type.Undefined()])),benchmarkMode:ec.Type.Boolean(),benchmarkParameters:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("BenchmarkParameters"),ec.Type.Undefined()])),agentAction:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("AgentAction"),ec.Type.Undefined()])),uploadedFiles:ec.Type.Array(ec.Type.Ref("UploadedFile")),attachedUrls:ec.Type.Array(ec.Type.Ref("AttachedUrl")),commitId:ec.Type.String(),lastSeenWebviewLogTimestamp:ec.Type.Number(),assistantProposedActions:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("AssistantProposedActions"),ec.Type.Undefined()])),ragContext:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("SelectedRagContext"),ec.Type.Undefined()])),attachedForm:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("AttachedForm"),ec.Type.Undefined()])),enableDeepThinking:ec.Type.Boolean(),targetedElement:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("TargetedElement"),ec.Type.Undefined()])),requestedStackBlueprint:tu,quickEdit:ec.Type.Boolean(),agentConfig:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("AgentConfig"),ec.Type.Undefined()])),customStackReplId:ec.Type.String(),themeConfig:ec.Type.String(),agentStackTriggerType:ec.Type.Ref("AgentStackTriggerType"),artifacts:ec.Type.Array(ec.Type.Ref("ArtifactReference"))}),TargetedElement:ec.Type.Object({filePath:ec.Type.String(),lineNumber:ec.Type.Number(),componentName:ec.Type.String(),textContent:ec.Type.String(),imageSourceUrl:ec.Type.String(),hasChildElements:ec.Type.Boolean(),siblingCount:ec.Type.Number(),parent:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("RelatedElement"),ec.Type.Undefined()])),nextSibling:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("RelatedElement"),ec.Type.Undefined()])),grandparent:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("RelatedElement"),ec.Type.Undefined()]))}),RelatedElement:ec.Type.Object({tagName:ec.Type.String(),className:ec.Type.String(),textContent:ec.Type.String(),id:ec.Type.String()}),AttachedForm:ec.Type.Object({formType:ec.Type.Ref("AttachedFormType"),fields:ec.Type.Array(ec.Type.Ref("AttachedFormField"))}),AttachedFormField:ec.Type.Object({path:ec.Type.String(),formType:ec.Type.Optional(ec.Type.Union([ec.Type.Object({$case:ec.Type.Literal("string"),value:ec.Type.Ref("AttachedFormStringField")}),ec.Type.Object({$case:ec.Type.Literal("files"),value:ec.Type.Ref("AttachedFormFilesField")}),ec.Type.Undefined()]))}),AttachedFormStringField:ec.Type.Object({value:ec.Type.String()}),AttachedFormFilesField:ec.Type.Object({files:ec.Type.Array(ec.Type.Ref("AttachedFormFiles"))}),AttachedFormFiles:ec.Type.Object({name:ec.Type.String(),url:ec.Type.String(),mimeType:ec.Type.String()}),UpdateAttachedFormStringFieldSet:ec.Type.Object({path:ec.Type.String(),value:ec.Type.String()}),UpdateAttachedFormStringFieldAppend:ec.Type.Object({path:ec.Type.String(),value:ec.Type.String()}),SelectedRagContext:ec.Type.Object({replitDocumentationQuery:ec.Type.String(),fileSearchQuery:ec.Type.String(),selectedFiles:ec.Type.String(),selectedClasses:ec.Type.String()}),AssistantProposedActions:ec.Type.Object({summary:ec.Type.String(),commitId:ec.Type.String(),shellCommands:ec.Type.Array(ec.Type.Ref("ProposedShellCommand")),fileChanges:ec.Type.Array(ec.Type.Ref("ProposedFileChange")),workspaceToolNudges:ec.Type.Array(ec.Type.Ref("ProposedWorkspaceToolNudge")),packageInstalls:ec.Type.Array(ec.Type.Ref("ProposedPackageInstall")),didCreateCheckpoint:ec.Type.Boolean(),didCountEditRequest:ec.Type.Boolean(),runConfigurations:ec.Type.Array(ec.Type.Ref("ProposedRunConfiguration")),deploymentConfigurations:ec.Type.Array(ec.Type.Ref("ProposedDeploymentConfiguration")),workflowConfigurations:ec.Type.Array(ec.Type.Ref("ProposedWorkflowConfiguration"))}),IntegrationTestEventContents:ec.Type.Object({expectedResponseString:ec.Type.String(),streamedResponse:ec.Type.Boolean(),timeBetweenChunks:ec.Type.Number()}),ContextComplexityEventContents:ec.Type.Object({fullness:ec.Type.Number()}),EventTooLargeEventContents:ec.Type.Object({}),IntegrationTestEventContext:ec.Type.Object({}),AttachedUrl:ec.Type.Object({url:ec.Type.String(),intent:ec.Type.Ref("UrlIntent")}),UploadedFile:ec.Type.Object({path:ec.Type.String(),mimeType:ec.Type.String()}),UploadedRapidBuildFile:ec.Type.Object({fileName:ec.Type.String(),downloadUrl:ec.Type.String()}),SimpleFileBasedVerifier:ec.Type.Object({criteria:ec.Type.String(),additionalInstruction:ec.Type.Optional(ec.Type.Union([ec.Type.String(),ec.Type.Undefined()]))}),BrowserVerifier:ec.Type.Object({testPlan:ec.Type.String(),additionalInstruction:ec.Type.Optional(ec.Type.Union([ec.Type.String(),ec.Type.Undefined()]))}),SeedingVerifier:ec.Type.Object({testPlan:ec.Type.String(),additionalInstruction:ec.Type.Optional(ec.Type.Union([ec.Type.String(),ec.Type.Undefined()]))}),BenchmarkVerifier:ec.Type.Object({verifier:ec.Type.Optional(ec.Type.Union([ec.Type.Object({$case:ec.Type.Literal("simpleFileBasedVerifier"),value:ec.Type.Ref("SimpleFileBasedVerifier")}),ec.Type.Object({$case:ec.Type.Literal("browserVerifier"),value:ec.Type.Ref("BrowserVerifier")}),ec.Type.Object({$case:ec.Type.Literal("seedingVerifier"),value:ec.Type.Ref("SeedingVerifier")}),ec.Type.Undefined()]))}),BenchmarkParameters:ec.Type.Object({datasetId:ec.Type.String(),instanceId:ec.Type.String(),runId:ec.Type.String(),replDescription:ec.Type.String(),disableSandbox:ec.Type.Boolean(),commandPrefix:ec.Type.Array(ec.Type.String()),overrideShellExecuteTimeoutSeconds:ec.Type.Number(),overrideMaxSteps:ec.Type.Number(),verifier:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("BenchmarkVerifier"),ec.Type.Undefined()]))}),SuggestedTemplates:ec.Type.Object({suggestedTemplates:ec.Type.Array(ec.Type.Ref("SuggestedTemplate"))}),SuggestedTemplate:ec.Type.Object({name:ec.Type.String(),replId:ec.Type.String(),description:ec.Type.String(),icon:ec.Type.String(),language:ec.Type.String(),id:ec.Type.String(),ownerUsername:ec.Type.String(),slug:ec.Type.String()}),ProposedFileChanges:ec.Type.Object({changes:ec.Type.Array(ec.Type.Ref("ProposedFileChange")),commitId:ec.Type.String(),summary:ec.Type.String()}),ProposedFileChange:ec.Type.Object({filePath:ec.Type.String(),content:ec.Type.String(),changeSummary:ec.Type.String(),state:ec.Type.Ref("FileChangeGenerationState"),messageContentsOffset:ec.Type.Number(),diff:ec.Type.String()}),ProposedShellCommand:ec.Type.Object({messageContentsOffset:ec.Type.Number(),command:ec.Type.String(),workingDirectory:ec.Type.String(),isDangerous:ec.Type.Boolean()}),ProposedPackageInstall:ec.Type.Object({messageContentsOffset:ec.Type.Number(),language:ec.Type.String(),packageList:ec.Type.Array(ec.Type.String())}),ProposedWorkspaceToolNudge:ec.Type.Object({messageContentsOffset:ec.Type.Number(),toolName:ec.Type.String(),reason:ec.Type.String(),description:ec.Type.String()}),ProposedRunConfiguration:ec.Type.Object({messageContentsOffset:ec.Type.Number(),workflowName:ec.Type.String(),setRunButton:ec.Type.Boolean(),oldCommand:ec.Type.String(),newCommand:ec.Type.String()}),ProposedWorkflowConfiguration:ec.Type.Object({messageContentsOffset:ec.Type.Number(),workflowName:ec.Type.String(),commands:ec.Type.Array(ec.Type.String()),setRunButton:ec.Type.Boolean(),mode:ec.Type.String()}),ProposedDeploymentConfiguration:ec.Type.Object({messageContentsOffset:ec.Type.Number(),buildCommand:ec.Type.String(),runCommand:ec.Type.String()}),Source:ec.Type.Object({url:ec.Type.String(),contents:ec.Type.String(),lineNumber:ec.Type.Number(),id:ec.Type.String()}),InlineActionEventContents:ec.Type.Object({messageType:ec.Type.Ref("InlineMessageType"),debugErrorSource:ec.Type.Ref("DebugErrorSource"),content:ec.Type.String(),codeReference:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("CodeReference"),ec.Type.Undefined()])),usedModelSelector:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("ModelSelector"),ec.Type.Undefined()])),media:ec.Type.Array(ec.Type.Ref("MediaReference")),sources:ec.Type.Array(ec.Type.Ref("Source"))}),ShellSuggestionEventContents:ec.Type.Object({content:ec.Type.String()}),SessionCreationEventContext:ec.Type.Object({}),TranslateEventContents:ec.Type.Object({inputTarget:ec.Type.Ref("TranslationTarget"),outputTarget:ec.Type.Ref("TranslationTarget"),content:ec.Type.String()}),TranslateEventContext:ec.Type.Object({modelSelector:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("ModelSelector"),ec.Type.Undefined()]))}),LocalShellExecutionEventContents:ec.Type.Object({command:ec.Type.String(),result:ec.Type.String(),eventId:ec.Type.String(),index:ec.Type.Number(),exitCode:ec.Type.Number(),channelName:ec.Type.String(),executed:ec.Type.Boolean()}),LocalShellExecutionEventContext:ec.Type.Object({}),ShellSuggestionEventContext:ec.Type.Object({modelSelector:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("ModelSelector"),ec.Type.Undefined()]))}),ModelSelector:ec.Type.Object({type:ec.Type.Ref("ModelType"),overrideModelName:ec.Type.String()}),EventError:ec.Type.Object({type:ec.Type.Ref("EventErrorType"),message:ec.Type.String(),shortMessage:ec.Type.String()}),MediaReference:ec.Type.Object({identifier:ec.Type.String(),url:ec.Type.String(),mimeType:ec.Type.String()}),AgentConfig:ec.Type.Object({maxSteps:ec.Type.Number(),enablePlanMode:ec.Type.Optional(ec.Type.Union([ec.Type.Boolean(),ec.Type.Undefined()])),enableHumanInLoop:ec.Type.Optional(ec.Type.Union([ec.Type.Boolean(),ec.Type.Undefined()])),thinkingEnabled:ec.Type.Optional(ec.Type.Union([ec.Type.Boolean(),ec.Type.Undefined()])),modelProfile:ec.Type.Ref("ModelProfile"),enableAutomatedTesting:ec.Type.Optional(ec.Type.Union([ec.Type.Boolean(),ec.Type.Undefined()])),samplingRate:ec.Type.Number(),webSearchEnabled:ec.Type.Optional(ec.Type.Union([ec.Type.Boolean(),ec.Type.Undefined()])),agentMode:ec.Type.Ref("AgentMode"),imageGenerationEnabled:ec.Type.Optional(ec.Type.Union([ec.Type.Boolean(),ec.Type.Undefined()])),initialBuildMode:ec.Type.Ref("AgentInitialBuildMode"),maxAutonomyEnabled:ec.Type.Optional(ec.Type.Union([ec.Type.Boolean(),ec.Type.Undefined()])),autonomyLevel:ec.Type.Ref("AutonomyLevel"),agentInitialBuildTier:ec.Type.Ref("AgentInitialBuildTier"),headlessMode:ec.Type.Boolean(),workspaceLessMode:ec.Type.Optional(ec.Type.Union([ec.Type.Boolean(),ec.Type.Undefined()])),enableAutoCheckpointing:ec.Type.Optional(ec.Type.Union([ec.Type.Boolean(),ec.Type.Undefined()]))}),MessageEventContext:ec.Type.Object({mostRecentFile:ec.Type.String(),fileContext:ec.Type.Array(ec.Type.Ref("CodeReference")),modelSelector:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("ModelSelector"),ec.Type.Undefined()])),intent:ec.Type.Ref("MessageAction"),extraResources:ec.Type.Array(ec.Type.String()),useRag:ec.Type.Boolean(),agentConfig:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("AgentConfig"),ec.Type.Undefined()])),messageSource:ec.Type.Ref("MessageSource")}),InlineActionEventContext:ec.Type.Object({mostRecentFile:ec.Type.String(),fileContext:ec.Type.Array(ec.Type.Ref("CodeReference")),modelSelector:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("ModelSelector"),ec.Type.Undefined()])),extraResources:ec.Type.Array(ec.Type.String()),useRag:ec.Type.Boolean()}),UpdateEventOperation:ec.Type.Object({id:ec.Type.String(),operationType:ec.Type.Ref("UpdateEventOperationType"),key:ec.Type.String(),value:ec.Type.String(),intValue:ec.Type.Number(),boolValue:ec.Type.Boolean(),protobufValue:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("Any"),ec.Type.Undefined()])),structValue:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("Struct"),ec.Type.Undefined()]))}),TypedUpdateEventOperation:ec.Type.Object({id:ec.Type.String(),operation:ec.Type.Optional(ec.Type.Union([ec.Type.Object({$case:ec.Type.Literal("messageContentsUpdate"),value:ec.Type.Ref("MessageContentsUpdate")}),ec.Type.Object({$case:ec.Type.Literal("shellSuggestionContentsUpdate"),value:ec.Type.Ref("ShellSuggestionContentsUpdate")}),ec.Type.Object({$case:ec.Type.Literal("addSourcesUpdate"),value:ec.Type.Ref("AddSourcesUpdate")}),ec.Type.Object({$case:ec.Type.Literal("addSuggestedTemplatesUpdate"),value:ec.Type.Ref("AddSuggestedTemplatesUpdate")}),ec.Type.Object({$case:ec.Type.Literal("byoPromptResultUpdate"),value:ec.Type.Ref("BYOPromptResultUpdate")}),ec.Type.Object({$case:ec.Type.Literal("messageContentsSet"),value:ec.Type.Ref("MessageContentsSet")}),ec.Type.Object({$case:ec.Type.Literal("agentTimelineEventSet"),value:ec.Type.Ref("AgentTimelineEventSet")}),ec.Type.Object({$case:ec.Type.Literal("hostingDebugSummaryEventSet"),value:ec.Type.Ref("HostingDebugSummaryEventSet")}),ec.Type.Object({$case:ec.Type.Literal("replCreationEventSet"),value:ec.Type.Ref("ReplCreationEventSet")}),ec.Type.Object({$case:ec.Type.Literal("localShellExecutionEventSet"),value:ec.Type.Ref("LocalShellExecutionEventSet")}),ec.Type.Object({$case:ec.Type.Literal("agentTimelineEventCreateFileAddContent"),value:ec.Type.Ref("AgentTimelineEventCreateFileAddContent")}),ec.Type.Object({$case:ec.Type.Literal("addProposedFileChange"),value:ec.Type.Ref("AddProposedFileChange")}),ec.Type.Object({$case:ec.Type.Literal("updateProposedFileChange"),value:ec.Type.Ref("UpdateProposedFileChange")}),ec.Type.Object({$case:ec.Type.Literal("addProposedFileChangesMetadata"),value:ec.Type.Ref("AddProposedFileChangesMetadata")}),ec.Type.Object({$case:ec.Type.Literal("addProposedShellCommand"),value:ec.Type.Ref("AddProposedShellCommand")}),ec.Type.Object({$case:ec.Type.Literal("addProposedActionsMetadata"),value:ec.Type.Ref("AddProposedActionsMetadata")}),ec.Type.Object({$case:ec.Type.Literal("agentAskUserForActionRequestSet"),value:ec.Type.Ref("AgentAskUserForActionRequestSet")}),ec.Type.Object({$case:ec.Type.Literal("addRagContext"),value:ec.Type.Ref("AddRagContext")}),ec.Type.Object({$case:ec.Type.Literal("addProposedWorkspaceToolNudge"),value:ec.Type.Ref("AddProposedWorkspaceToolNudge")}),ec.Type.Object({$case:ec.Type.Literal("integrationTestEventContents"),value:ec.Type.Ref("IntegrationTestEventContentsUpdate")}),ec.Type.Object({$case:ec.Type.Literal("addProposedPackageInstall"),value:ec.Type.Ref("AddProposedPackageInstall")}),ec.Type.Object({$case:ec.Type.Literal("updateRevertStatus"),value:ec.Type.Ref("UpdateRevertStatus")}),ec.Type.Object({$case:ec.Type.Literal("updateAttachedFormStringFieldSet"),value:ec.Type.Ref("UpdateAttachedFormStringFieldSet")}),ec.Type.Object({$case:ec.Type.Literal("updateAttachedFormStringFieldAppend"),value:ec.Type.Ref("UpdateAttachedFormStringFieldAppend")}),ec.Type.Object({$case:ec.Type.Literal("addProposedRunConfiguration"),value:ec.Type.Ref("AddProposedRunConfiguration")}),ec.Type.Object({$case:ec.Type.Literal("addProposedDeploymentConfiguration"),value:ec.Type.Ref("AddProposedDeploymentConfiguration")}),ec.Type.Object({$case:ec.Type.Literal("appendTimelineMessageContentsUpdate"),value:ec.Type.Ref("AppendTimelineMessageContentsUpdate")}),ec.Type.Object({$case:ec.Type.Literal("appendThoughtContentsUpdate"),value:ec.Type.Ref("AppendThoughtContentsUpdate")}),ec.Type.Object({$case:ec.Type.Literal("appendRedactedThoughtsMarker"),value:ec.Type.Ref("AppendRedactedThoughtsMarkerUpdate")}),ec.Type.Object({$case:ec.Type.Literal("addProposedWorkflowConfiguration"),value:ec.Type.Ref("AddProposedWorkflowConfiguration")}),ec.Type.Object({$case:ec.Type.Literal("updateFileEditLineCounts"),value:ec.Type.Ref("UpdateFileEditLineCountsUpdate")}),ec.Type.Object({$case:ec.Type.Literal("addDesignReferenceFile"),value:ec.Type.Ref("AddDesignReferenceFile")}),ec.Type.Object({$case:ec.Type.Literal("updatePlanContents"),value:ec.Type.Ref("UpdatePlanContents")}),ec.Type.Object({$case:ec.Type.Literal("updatePlanApprovalStatus"),value:ec.Type.Ref("UpdatePlanApprovalStatus")}),ec.Type.Object({$case:ec.Type.Literal("newThoughtSummaryUpdate"),value:ec.Type.Ref("NewThoughtSummaryUpdate")}),ec.Type.Object({$case:ec.Type.Literal("samplingEventUpdate"),value:ec.Type.Ref("SamplingEventUpdate")}),ec.Type.Object({$case:ec.Type.Literal("samplingEventStateUpdate"),value:ec.Type.Ref("SamplingEventStateUpdate")}),ec.Type.Object({$case:ec.Type.Literal("uiTestingSubagentExecutionEventUpdate"),value:ec.Type.Ref("UITestingSubagentExecutionEventContentsUpdate")}),ec.Type.Object({$case:ec.Type.Literal("subagentRunningDataUpdate"),value:ec.Type.Ref("SubagentRunningDataUpdate")}),ec.Type.Object({$case:ec.Type.Literal("upsertGeneratedMediaData"),value:ec.Type.Ref("UpsertGeneratedMediaData")}),ec.Type.Object({$case:ec.Type.Literal("subagentReportResultUpdate"),value:ec.Type.Ref("SubagentReportResultUpdate")}),ec.Type.Object({$case:ec.Type.Literal("messagedBackgroundAgentDataUpdate"),value:ec.Type.Ref("MessagedBackgroundAgentDataUpdate")}),ec.Type.Object({$case:ec.Type.Literal("stoppedSubagentRunningUpdate"),value:ec.Type.Ref("StoppedSubagentRunningUpdate")}),ec.Type.Object({$case:ec.Type.Literal("addExecutedSandboxedCodeOutput"),value:ec.Type.Ref("AddExecutedSandboxedCodeOutput")}),ec.Type.Undefined()]))}),AppendTimelineMessageContentsUpdate:ec.Type.Object({content:ec.Type.String()}),AppendThoughtContentsUpdate:ec.Type.Object({content:ec.Type.String(),totalTimeTakenMs:ec.Type.Number()}),NewThoughtSummaryUpdate:ec.Type.Object({summary:ec.Type.String()}),AppendRedactedThoughtsMarkerUpdate:ec.Type.Object({marker:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("RedactedThoughtsMarker"),ec.Type.Undefined()]))}),AgentTimelineEventSet:ec.Type.Object({contents:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("AgentTimelineEventContents"),ec.Type.Undefined()]))}),HostingDebugSummaryEventSet:ec.Type.Object({contents:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("HostingDebugSummaryEventContents"),ec.Type.Undefined()]))}),ReplCreationEventSet:ec.Type.Object({contents:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("ReplCreationEventContents"),ec.Type.Undefined()]))}),MessageContentsUpdate:ec.Type.Object({content:ec.Type.String()}),IntegrationTestEventContentsUpdate:ec.Type.Object({content:ec.Type.String()}),AgentAskUserForActionRequestSet:ec.Type.Object({request:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("AgentAskUserForActionRequest"),ec.Type.Undefined()]))}),MessageContentsSet:ec.Type.Object({content:ec.Type.String()}),ShellSuggestionContentsUpdate:ec.Type.Object({content:ec.Type.String()}),LocalShellExecutionEventSet:ec.Type.Object({contents:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("LocalShellExecutionEventContents"),ec.Type.Undefined()]))}),AgentTimelineEventCreateFileAddContent:ec.Type.Object({content:ec.Type.String()}),AddSourcesUpdate:ec.Type.Object({sources:ec.Type.Array(ec.Type.Ref("Source"))}),AddSuggestedTemplatesUpdate:ec.Type.Object({templates:ec.Type.Array(ec.Type.Ref("SuggestedTemplate"))}),AddProposedActionsMetadata:ec.Type.Object({summary:ec.Type.String(),commitId:ec.Type.String(),didCreateCheckpoint:ec.Type.Optional(ec.Type.Union([ec.Type.Boolean(),ec.Type.Undefined()])),didCountEditRequest:ec.Type.Boolean()}),AddRagContext:ec.Type.Object({newContext:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("SelectedRagContext"),ec.Type.Undefined()]))}),AddProposedFileChangesMetadata:ec.Type.Object({summary:ec.Type.String()}),AddProposedFileChange:ec.Type.Object({change:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("ProposedFileChange"),ec.Type.Undefined()])),commitId:ec.Type.String()}),UpdateProposedFileChange:ec.Type.Object({update:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("ProposedFileChange"),ec.Type.Undefined()])),replacement:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("ProposedFileChange"),ec.Type.Undefined()]))}),AddProposedShellCommand:ec.Type.Object({command:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("ProposedShellCommand"),ec.Type.Undefined()]))}),AddProposedPackageInstall:ec.Type.Object({packageInstalls:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("ProposedPackageInstall"),ec.Type.Undefined()]))}),UpdateRevertStatus:ec.Type.Object({newStatus:ec.Type.Ref("RevertStatus")}),AddProposedWorkspaceToolNudge:ec.Type.Object({nudge:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("ProposedWorkspaceToolNudge"),ec.Type.Undefined()]))}),AddProposedRunConfiguration:ec.Type.Object({runConfiguration:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("ProposedRunConfiguration"),ec.Type.Undefined()]))}),AddProposedWorkflowConfiguration:ec.Type.Object({workflowConfiguration:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("ProposedWorkflowConfiguration"),ec.Type.Undefined()]))}),UpdateFileEditLineCountsUpdate:ec.Type.Object({removedLines:ec.Type.Number(),addedLines:ec.Type.Number()}),AddProposedDeploymentConfiguration:ec.Type.Object({deploymentConfiguration:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("ProposedDeploymentConfiguration"),ec.Type.Undefined()]))}),AddDesignReferenceFile:ec.Type.Object({filePath:ec.Type.String()}),UpdatePlanContents:ec.Type.Object({planId:ec.Type.String(),step:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("AgentPlanStep"),ec.Type.Undefined()])),objective:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("AgentPlanObjective"),ec.Type.Undefined()])),initialCommitId:ec.Type.String(),stackBlueprint:tu,agentStackTriggerType:ec.Type.Ref("AgentStackTriggerType")}),UpdatePlanApprovalStatus:ec.Type.Object({requiresApproval:ec.Type.Boolean()}),BYOPromptResultUpdate:ec.Type.Object({jsonResult:ec.Type.String()}),GovalToken:ec.Type.Object({token:ec.Type.String(),gurl:ec.Type.String()}),AuthToken:ec.Type.Object({user:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("UserContext"),ec.Type.Undefined()])),replIds:ec.Type.Array(ec.Type.String()),issuer:ec.Type.String(),overrideGovalToken:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("GovalToken"),ec.Type.Undefined()])),forkReplId:ec.Type.String()}),UserContext:ec.Type.Object({type:ec.Type.Ref("UserType"),id:ec.Type.String(),username:ec.Type.String(),membership:ec.Type.Ref("MembershipType"),roles:ec.Type.Array(ec.Type.String()),isTeam:ec.Type.Boolean(),orgId:ec.Type.String(),timeCreated:ec.Type.Optional(ec.Type.Union([ec.Type.Date(),ec.Type.Undefined()])),flaggingContext:ec.Type.String(),modelfarmDisabled:ec.Type.Boolean(),openrouterDisabled:ec.Type.Boolean(),openaiDisabled:ec.Type.Boolean(),anthropicDisabled:ec.Type.Boolean(),geminiDisabled:ec.Type.Boolean(),isEnterprise:ec.Type.Boolean(),flagOverrides:ec.Type.Optional(ec.Type.Union([ec.Type.String(),ec.Type.Undefined()]))}),CreateEventRequest:ec.Type.Object({parentEventId:ec.Type.String(),sessionId:ec.Type.String(),state:ec.Type.Ref("EventState"),contents:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("EventContents"),ec.Type.Undefined()])),context:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("EventContext"),ec.Type.Undefined()])),eventId:ec.Type.String(),error:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("EventError"),ec.Type.Undefined()])),isActive:ec.Type.Optional(ec.Type.Union([ec.Type.Boolean(),ec.Type.Undefined()])),addToChild:ec.Type.Boolean()}),CreateEventResponse:ec.Type.Object({eventId:ec.Type.String(),parentEventId:ec.Type.String(),created:ec.Type.Optional(ec.Type.Union([ec.Type.Date(),ec.Type.Undefined()]))}),CreateEventRequestWithUser:ec.Type.Object({request:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("CreateEventRequest"),ec.Type.Undefined()])),user:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("UserContext"),ec.Type.Undefined()]))}),BatchCreateEventsRequest:ec.Type.Object({events:ec.Type.Array(ec.Type.Ref("CreateEventRequestWithUser"))}),BatchCreateEventsResponse:ec.Type.Object({eventIds:ec.Type.Array(ec.Type.String())}),UpdateEventRequest:ec.Type.Object({eventId:ec.Type.String(),operations:ec.Type.Array(ec.Type.Ref("UpdateEventOperation")),typedOperations:ec.Type.Array(ec.Type.Ref("TypedUpdateEventOperation")),state:ec.Type.Ref("EventState"),error:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("EventError"),ec.Type.Undefined()])),requireCompletion:ec.Type.Optional(ec.Type.Union([ec.Type.Boolean(),ec.Type.Undefined()]))}),UpdateEventResponse:ec.Type.Object({}),UpdateAgentStateRequest:ec.Type.Object({replId:ec.Type.String(),sessionId:ec.Type.String(),runState:ec.Type.Ref("AgentRunState"),transitionReason:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("AgentStateTransitionReason"),ec.Type.Undefined()]))}),GetAgentStateRequest:ec.Type.Object({replId:ec.Type.String(),sessionId:ec.Type.String()}),GetAgentStateResponse:ec.Type.Object({runState:ec.Type.Ref("AgentRunState"),transitionReason:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("AgentStateTransitionReason"),ec.Type.Undefined()]))}),UpdateAgentStateResponse:ec.Type.Object({runState:ec.Type.Ref("AgentRunState"),transitionReason:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("AgentStateTransitionReason"),ec.Type.Undefined()]))}),UpdateAgentStateMessage:ec.Type.Object({replId:ec.Type.String(),sessionId:ec.Type.String(),runState:ec.Type.Ref("AgentRunState"),transitionReason:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("AgentStateTransitionReason"),ec.Type.Undefined()]))}),BroadcastAgentStateRequest:ec.Type.Object({replId:ec.Type.String(),sessionId:ec.Type.String(),runState:ec.Type.Ref("AgentRunState"),transitionReason:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("AgentStateTransitionReason"),ec.Type.Undefined()]))}),BroadcastAgentStateResponse:ec.Type.Object({}),AgentStateTransitionReason:ec.Type.Object({reasons:ec.Type.Optional(ec.Type.Union([ec.Type.Object({$case:ec.Type.Literal("userPaused"),value:ec.Type.Ref("AgentStateTransitionReasonUserPaused")}),ec.Type.Object({$case:ec.Type.Literal("stepLimitExceeded"),value:ec.Type.Ref("AgentStateTransitionReasonStepLimitExceeded")}),ec.Type.Object({$case:ec.Type.Literal("rateLimited"),value:ec.Type.Ref("AgentStateTransitionReasonRateLimited")}),ec.Type.Object({$case:ec.Type.Literal("waitingOnUserResponse"),value:ec.Type.Ref("AgentStateTransitionReasonWaitingOnUserResponse")}),ec.Type.Object({$case:ec.Type.Literal("waitingOnPlanApproval"),value:ec.Type.Ref("AgentStateTransitionReasonWaitingOnPlanApproval")}),ec.Type.Object({$case:ec.Type.Literal("requestedSecrets"),value:ec.Type.Ref("AgentStateTransitionReasonRequestedSecrets")}),ec.Type.Object({$case:ec.Type.Literal("testConcluded"),value:ec.Type.Ref("AgentStateTransitionReasonTestConcluded")}),ec.Type.Object({$case:ec.Type.Literal("error"),value:ec.Type.Ref("AgentStateTransitionReasonError")}),ec.Type.Object({$case:ec.Type.Literal("planConcluded"),value:ec.Type.Ref("AgentStateTransitionReasonPlanConcluded")}),ec.Type.Object({$case:ec.Type.Literal("reverted"),value:ec.Type.Ref("AgentStateTransitionReasonReverted")}),ec.Type.Object({$case:ec.Type.Literal("authorizationFailed"),value:ec.Type.Ref("AgentStateTransitionReasonAuthorizationFailed")}),ec.Type.Object({$case:ec.Type.Literal("stepTooComplex"),value:ec.Type.Ref("AgentStateTransitionReasonStepTooComplex")}),ec.Type.Object({$case:ec.Type.Literal("triggerCheckpoint"),value:ec.Type.Ref("AgentStateTransitionReasonTriggerCheckpoint")}),ec.Type.Undefined()]))}),AgentStateTransitionReasonUserPaused:ec.Type.Object({}),AgentStateTransitionReasonStepLimitExceeded:ec.Type.Object({maxSteps:ec.Type.Number()}),AgentStateTransitionReasonRateLimited:ec.Type.Object({timeWhenReset:ec.Type.String()}),AgentStateTransitionReasonAuthorizationFailed:ec.Type.Object({code:ec.Type.Ref("AgentAuthorizationFailedCode"),message:ec.Type.String()}),AgentStateTransitionReasonWaitingOnUserResponse:ec.Type.Object({}),AgentStateTransitionReasonRequestedSecrets:ec.Type.Object({}),AgentStateTransitionReasonWaitingOnPlanApproval:ec.Type.Object({}),AgentStateTransitionReasonTestConcluded:ec.Type.Object({}),AgentStateTransitionReasonPlanConcluded:ec.Type.Object({}),AgentStateTransitionReasonError:ec.Type.Object({}),AgentStateTransitionReasonReverted:ec.Type.Object({}),AgentStateTransitionReasonStepTooComplex:ec.Type.Object({}),AgentStateTransitionReasonTriggerCheckpoint:ec.Type.Object({}),ReprocessEventRequest:ec.Type.Object({eventId:ec.Type.String(),context:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("EventContext"),ec.Type.Undefined()]))}),ReprocessEventResponse:ec.Type.Object({}),GetResourceUploadUrlRequest:ec.Type.Object({mimeType:ec.Type.String()}),GetResourceUploadUrlResponse:ec.Type.Object({uploadUrl:ec.Type.String(),downloadUrl:ec.Type.String(),identifier:ec.Type.String()}),GetUrlScreenshotRequest:ec.Type.Object({url:ec.Type.String()}),GetUrlScreenshotResponse:ec.Type.Object({imageDownloadUrl:ec.Type.String()}),GetUrlScrapedContentRequest:ec.Type.Object({url:ec.Type.String()}),GetUrlScrapedContentResponse:ec.Type.Object({content:ec.Type.String()}),GetUrlBrandingRequest:ec.Type.Object({url:ec.Type.String()}),GetUrlBrandingResponse:ec.Type.Object({branding:ec.Type.String()}),AbortEventRequest:ec.Type.Object({eventId:ec.Type.String()}),AbortEventResponse:ec.Type.Object({eventId:ec.Type.String()}),GetReplSessionsRequest:ec.Type.Object({beforeTimestamp:ec.Type.Optional(ec.Type.Union([ec.Type.Date(),ec.Type.Undefined()])),limit:ec.Type.Number(),includeFirstSessionEvents:ec.Type.Boolean(),firstSessionEventsLimit:ec.Type.Number(),replId:ec.Type.String(),sessionTypes:ec.Type.Array(ec.Type.Ref("SessionType")),archived:ec.Type.Optional(ec.Type.Union([ec.Type.Boolean(),ec.Type.Undefined()]))}),GetReplSessionsResponse:ec.Type.Object({hasMore:ec.Type.Boolean(),sessions:ec.Type.Array(ec.Type.Ref("Session")),replAgentState:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("ReplAgentState"),ec.Type.Undefined()]))}),EnhanceAgentPromptRequest:ec.Type.Object({userPrompt:ec.Type.String(),uploadedFiles:ec.Type.Array(ec.Type.Ref("UploadedFile")),attachedUrls:ec.Type.Array(ec.Type.Ref("AttachedUrl")),selectedTheme:ec.Type.String()}),EnhanceAgentPromptResponse:ec.Type.Object({enhancedPrompt:ec.Type.String()}),GetSessionEventsRequest:ec.Type.Object({sessionId:ec.Type.String(),limit:ec.Type.Number(),excludeContents:ec.Type.Boolean(),afterTimestamp:ec.Type.Optional(ec.Type.Union([ec.Type.Date(),ec.Type.Undefined()]))}),GetSessionEventsResponse:ec.Type.Object({events:ec.Type.Array(ec.Type.Ref("Event")),session:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("Session"),ec.Type.Undefined()]))}),BatchGetEventsRequest:ec.Type.Object({sessionId:ec.Type.String(),eventIds:ec.Type.Array(ec.Type.String())}),BatchGetEventsResponse:ec.Type.Object({events:ec.Type.Array(ec.Type.Ref("Event"))}),CreateSessionRequest:ec.Type.Object({replId:ec.Type.String(),sessionType:ec.Type.Ref("SessionType"),title:ec.Type.String(),seededAiFirstEventContents:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("EventContents"),ec.Type.Undefined()])),taskId:ec.Type.String(),revertedToSessionId:ec.Type.String(),revertedToEventId:ec.Type.String()}),CreateSessionResponse:ec.Type.Object({sessionId:ec.Type.String(),sessionCreationEventId:ec.Type.String(),seededAiFirstEventId:ec.Type.String()}),GetEventListRequest:ec.Type.Object({sessionId:ec.Type.String(),limit:ec.Type.Number(),ancestorsOf:ec.Type.Optional(ec.Type.Union([ec.Type.String(),ec.Type.Undefined()])),afterTimestamp:ec.Type.Optional(ec.Type.Union([ec.Type.Date(),ec.Type.Undefined()]))}),GetEventListResponse:ec.Type.Object({shapes:ec.Type.Array(ec.Type.Ref("EventShape")),hasMore:ec.Type.Boolean()}),SubscribeToReplEventsRequest:ec.Type.Object({replId:ec.Type.String()}),ReplEventsSubscriptionMessage:ec.Type.Object({sender:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("UserContext"),ec.Type.Undefined()])),seqno:ec.Type.Number(),message:ec.Type.Optional(ec.Type.Union([ec.Type.Object({$case:ec.Type.Literal("subscriptionStatusMessage"),value:ec.Type.Ref("SubscriptionStatusMessage")}),ec.Type.Object({$case:ec.Type.Literal("createEventMessage"),value:ec.Type.Ref("CreateEventMessage")}),ec.Type.Object({$case:ec.Type.Literal("createSessionMessage"),value:ec.Type.Ref("CreateSessionMessage")}),ec.Type.Object({$case:ec.Type.Literal("updateEventMessage"),value:ec.Type.Ref("UpdateEventMessage")}),ec.Type.Object({$case:ec.Type.Literal("updateSessionMessage"),value:ec.Type.Ref("UpdateSessionMessage")}),ec.Type.Object({$case:ec.Type.Literal("abortEventMessage"),value:ec.Type.Ref("AbortEventMessage")}),ec.Type.Object({$case:ec.Type.Literal("updateAgentStateMessage"),value:ec.Type.Ref("UpdateAgentStateMessage")}),ec.Type.Undefined()]))}),SubscriptionStatusMessage:ec.Type.Object({}),CreateEventMessage:ec.Type.Object({eventId:ec.Type.String(),parentEventId:ec.Type.String(),sessionId:ec.Type.String(),state:ec.Type.Ref("EventState"),contents:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("EventContents"),ec.Type.Undefined()])),sender:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("UserContext"),ec.Type.Undefined()])),error:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("EventError"),ec.Type.Undefined()])),isActive:ec.Type.Optional(ec.Type.Union([ec.Type.Boolean(),ec.Type.Undefined()])),created:ec.Type.Optional(ec.Type.Union([ec.Type.Date(),ec.Type.Undefined()]))}),CreateSessionMessage:ec.Type.Object({sessionId:ec.Type.String(),title:ec.Type.String(),replId:ec.Type.String(),sessionCreationEventId:ec.Type.String(),sessionType:ec.Type.Ref("SessionType"),archived:ec.Type.Optional(ec.Type.Union([ec.Type.Boolean(),ec.Type.Undefined()])),taskId:ec.Type.String(),revertedToSessionId:ec.Type.String(),revertedToEventId:ec.Type.String()}),UpdateEventMessage:ec.Type.Object({sessionId:ec.Type.String(),eventId:ec.Type.String(),operations:ec.Type.Array(ec.Type.Ref("UpdateEventOperation")),typedOperations:ec.Type.Array(ec.Type.Ref("TypedUpdateEventOperation")),state:ec.Type.Ref("EventState"),error:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("EventError"),ec.Type.Undefined()]))}),UpdateSessionMessage:ec.Type.Object({sessionId:ec.Type.String(),title:ec.Type.String(),sessionType:ec.Type.Ref("SessionType"),archived:ec.Type.Optional(ec.Type.Union([ec.Type.Boolean(),ec.Type.Undefined()])),replId:ec.Type.String(),activeEventId:ec.Type.String(),isActiveAgentSession:ec.Type.Optional(ec.Type.Union([ec.Type.Boolean(),ec.Type.Undefined()])),readOnly:ec.Type.Optional(ec.Type.Union([ec.Type.Boolean(),ec.Type.Undefined()])),taskId:ec.Type.String()}),AbortEventMessage:ec.Type.Object({replId:ec.Type.String(),sessionId:ec.Type.String(),eventId:ec.Type.String()}),Limit:ec.Type.Object({limit:ec.Type.Number(),usage:ec.Type.Number(),resetTime:ec.Type.Optional(ec.Type.Union([ec.Type.Date(),ec.Type.Undefined()]))}),GetAvailableModelRequest:ec.Type.Object({overrideModel:ec.Type.String()}),ModelName:ec.Type.Object({readable:ec.Type.String(),qualified:ec.Type.String()}),GetAvailableModelsResponse:ec.Type.Object({basicModel:ec.Type.Array(ec.Type.Ref("ModelName")),advancedModel:ec.Type.Array(ec.Type.Ref("ModelName")),overrideModel:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("ModelName"),ec.Type.Undefined()]))}),UpdateSessionRequest:ec.Type.Object({id:ec.Type.String(),title:ec.Type.String(),sessionType:ec.Type.Ref("SessionType"),archived:ec.Type.Optional(ec.Type.Union([ec.Type.Boolean(),ec.Type.Undefined()])),replId:ec.Type.String(),activeEventId:ec.Type.String(),isActiveAgentSession:ec.Type.Optional(ec.Type.Union([ec.Type.Boolean(),ec.Type.Undefined()])),readOnly:ec.Type.Optional(ec.Type.Union([ec.Type.Boolean(),ec.Type.Undefined()])),taskId:ec.Type.String()}),UpdateSessionResponse:ec.Type.Object({}),ProcessEventRequest:ec.Type.Object({replId:ec.Type.String(),contents:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("EventContents"),ec.Type.Undefined()])),context:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("EventContext"),ec.Type.Undefined()])),sessionId:ec.Type.String()}),ProcessEventResponseMessage:ec.Type.Object({message:ec.Type.Optional(ec.Type.Union([ec.Type.Object({$case:ec.Type.Literal("startMessage"),value:ec.Type.Ref("ProcessEventStartMessage")}),ec.Type.Object({$case:ec.Type.Literal("createEventMessage"),value:ec.Type.Ref("CreateEventMessage")}),ec.Type.Object({$case:ec.Type.Literal("updateEventMessage"),value:ec.Type.Ref("UpdateEventMessage")}),ec.Type.Undefined()]))}),ProcessEventStartMessage:ec.Type.Object({rootId:ec.Type.String()}),GenerateReplNameRequest:ec.Type.Object({replId:ec.Type.String(),prompt:ec.Type.String()}),GenerateReplNameResponse:ec.Type.Object({replName:ec.Type.String()}),GenerateIconRequest:ec.Type.Object({replId:ec.Type.String(),prompt:ec.Type.String()}),GenerateIconResponse:ec.Type.Object({imageUrl:ec.Type.String()}),Any:ec.Type.Object({typeUrl:ec.Type.String(),value:ec.Type.Uint8Array()}),Struct:ec.Type.Object({fields:ec.Type.Array(ec.Type.Ref("StructField")),type:ec.Type.String()}),StructField:ec.Type.Object({key:ec.Type.String(),value:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("Value"),ec.Type.Undefined()]))}),Value:ec.Type.Object({kind:ec.Type.Optional(ec.Type.Union([ec.Type.Object({$case:ec.Type.Literal("nullValue"),value:ec.Type.Ref("NullValue")}),ec.Type.Object({$case:ec.Type.Literal("numberValue"),value:ec.Type.Number()}),ec.Type.Object({$case:ec.Type.Literal("stringValue"),value:ec.Type.String()}),ec.Type.Object({$case:ec.Type.Literal("boolValue"),value:ec.Type.Boolean()}),ec.Type.Object({$case:ec.Type.Literal("structValue"),value:ec.Type.Ref("Struct")}),ec.Type.Object({$case:ec.Type.Literal("listValue"),value:ec.Type.Ref("ListValue")}),ec.Type.Undefined()]))}),ListValue:ec.Type.Object({values:ec.Type.Array(ec.Type.Ref("Value"))}),BYOPromptMessage:ec.Type.Object({role:ec.Type.String(),content:ec.Type.String()}),BYOPromptResponseParameter:ec.Type.Object({name:ec.Type.String(),required:ec.Type.Boolean(),parameterType:ec.Type.Ref("BYOPromptResponseParameterType"),description:ec.Type.String(),enums:ec.Type.Array(ec.Type.String())}),BYOPromptEventContents:ec.Type.Object({historicalPrompt:ec.Type.String(),messages:ec.Type.Array(ec.Type.Ref("BYOPromptMessage")),parameters:ec.Type.Array(ec.Type.Ref("BYOPromptResponseParameter")),result:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("Struct"),ec.Type.Undefined()])),jsonResult:ec.Type.String(),forceJson:ec.Type.Boolean(),promptName:ec.Type.String()}),BYOPromptEventContext:ec.Type.Object({modelSelector:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("ModelSelector"),ec.Type.Undefined()]))}),RevertEventContents:ec.Type.Object({commitId:ec.Type.String(),message:ec.Type.String(),eventIdBeforeRevert:ec.Type.String(),originalSessionId:ec.Type.String(),databaseRollbackTimestamp:ec.Type.String(),deploymentBuildId:ec.Type.String(),rollbackDatabase:ec.Type.Boolean(),revertedToSessionId:ec.Type.String(),revertedToEventId:ec.Type.String()}),TriggerCheckpointEventContents:ec.Type.Object({description:ec.Type.String(),onlyIfDiff:ec.Type.Boolean(),author:ec.Type.Ref("CommitAuthor"),deploymentBuildId:ec.Type.String()}),StepTooComplexAcknowledgementEventContents:ec.Type.Object({cancelCurrentStep:ec.Type.Boolean()}),AgentCapabilityUsage:ec.Type.Object({standardModelProfileLlmCalls:ec.Type.Number(),advancedModelProfileLlmCalls:ec.Type.Number(),thinkingEnabledLlmCalls:ec.Type.Number(),webSearchCalls:ec.Type.Number(),rapidBuild:ec.Type.Boolean(),testingSubagentRuns:ec.Type.Number(),architectSubagentRuns:ec.Type.Number(),generalSubagentRuns:ec.Type.Number()}),TaskEffort:ec.Type.Object({taskId:ec.Type.String(),description:ec.Type.String()}),GeneralEffort:ec.Type.Object({}),AgentInitializationEffort:ec.Type.Object({}),FreeQuickEditEffort:ec.Type.Object({}),DiscountedEffort:ec.Type.Object({effortType:ec.Type.Ref("DiscountedEffortType")}),RelatedEffortBreakdown:ec.Type.Object({effortType:ec.Type.Optional(ec.Type.Union([ec.Type.Object({$case:ec.Type.Literal("task"),value:ec.Type.Ref("TaskEffort")}),ec.Type.Object({$case:ec.Type.Literal("general"),value:ec.Type.Ref("GeneralEffort")}),ec.Type.Object({$case:ec.Type.Literal("initialization"),value:ec.Type.Ref("AgentInitializationEffort")}),ec.Type.Object({$case:ec.Type.Literal("freeQuickEdit"),value:ec.Type.Ref("FreeQuickEditEffort")}),ec.Type.Object({$case:ec.Type.Literal("discountedEffort"),value:ec.Type.Ref("DiscountedEffort")}),ec.Type.Undefined()])),commitId:ec.Type.String(),usageCents:ec.Type.Number(),workDurationSeconds:ec.Type.Number(),numLocRead:ec.Type.Number(),numFilesRead:ec.Type.Number(),addedLinesOfCode:ec.Type.Number(),removedLinesOfCode:ec.Type.Number()}),CommitData:ec.Type.Object({commitId:ec.Type.String(),screenshotUrl:ec.Type.String(),description:ec.Type.String(),billingRate:ec.Type.Ref("CommitBillingRate"),author:ec.Type.Ref("CommitAuthor"),progressSummary:ec.Type.String(),usageCents:ec.Type.Number(),workDurationSeconds:ec.Type.Number(),addedLinesOfCode:ec.Type.Number(),removedLinesOfCode:ec.Type.Number(),toolCalls:ec.Type.Number(),triggerReason:ec.Type.Ref("CheckpointTriggerReason"),capabilityUsage:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("AgentCapabilityUsage"),ec.Type.Undefined()])),ubbV2:ec.Type.Boolean(),numLocRead:ec.Type.Number(),numFilesRead:ec.Type.Number(),refunded:ec.Type.Boolean(),relatedEffortBreakdowns:ec.Type.Array(ec.Type.Ref("RelatedEffortBreakdown")),heliumCheckpointCreated:ec.Type.Boolean()}),ApprovePlanEventContents:ec.Type.Object({planEventId:ec.Type.String(),approver:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("UserContext"),ec.Type.Undefined()])),initialBuildMode:ec.Type.Ref("AgentInitialBuildMode"),userSecretsResponse:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("AgentUserSecretsResponse"),ec.Type.Undefined()])),agentConfig:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("AgentConfig"),ec.Type.Undefined()]))}),ApprovePlanEventContext:ec.Type.Object({}),UserSecretsResponseEventContents:ec.Type.Object({response:ec.Type.Array(ec.Type.Ref("UserSecretResponse"))}),HostingDebugSummaryErrorPorts:ec.Type.Object({exposeLocalhost:ec.Type.Boolean(),localPort:ec.Type.String(),externalPort:ec.Type.String()}),HostingDebugSummaryError:ec.Type.Object({provider:ec.Type.String(),buildCommand:ec.Type.String(),runCommand:ec.Type.String(),publicDir:ec.Type.Optional(ec.Type.Union([ec.Type.String(),ec.Type.Undefined()])),appType:ec.Type.Optional(ec.Type.Union([ec.Type.String(),ec.Type.Undefined()])),logs:ec.Type.Array(ec.Type.String()),envKeys:ec.Type.Array(ec.Type.String()),ports:ec.Type.Array(ec.Type.Ref("HostingDebugSummaryErrorPorts")),entrypointFilePath:ec.Type.Optional(ec.Type.Union([ec.Type.String(),ec.Type.Undefined()]))}),HostingDebugSummarySuggestion:ec.Type.Object({name:ec.Type.String(),type:ec.Type.String(),description:ec.Type.String(),before:ec.Type.String(),after:ec.Type.String(),file:ec.Type.Optional(ec.Type.Union([ec.Type.String(),ec.Type.Undefined()]))}),HostingDebugSummaryResult:ec.Type.Object({errors:ec.Type.Array(ec.Type.String()),suggestions:ec.Type.Array(ec.Type.Ref("HostingDebugSummarySuggestion"))}),HostingDebugSummaryEventContents:ec.Type.Object({error:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("HostingDebugSummaryError"),ec.Type.Undefined()])),result:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("HostingDebugSummaryResult"),ec.Type.Undefined()])),usedModelSelector:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("ModelSelector"),ec.Type.Undefined()]))}),HostingDebugSummaryEventContext:ec.Type.Object({modelSelector:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("ModelSelector"),ec.Type.Undefined()]))}),ReplCreationEventContents:ec.Type.Object({errors:ec.Type.Array(ec.Type.String()),generatedReplName:ec.Type.String(),isAgentRecommended:ec.Type.Boolean(),bestTemplate:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("SuggestedTemplate"),ec.Type.Undefined()])),matchedPlanNames:ec.Type.Array(ec.Type.String()),scaffoldTemplateName:ec.Type.String()}),ReplCreationEventContext:ec.Type.Object({modelSelector:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("ModelSelector"),ec.Type.Undefined()]))}),UserSecretsResponseEventContext:ec.Type.Object({}),IterativeAgentEventContents:ec.Type.Object({contents:ec.Type.Optional(ec.Type.Union([ec.Type.Object({$case:ec.Type.Literal("appliedFileChanges"),value:ec.Type.Ref("IterativeAgentAppliedFileChanges")}),ec.Type.Object({$case:ec.Type.Literal("revertedFileChanges"),value:ec.Type.Ref("IterativeAgentRevertedFileChanges")}),ec.Type.Object({$case:ec.Type.Literal("installingPackages"),value:ec.Type.Ref("IterativeAgentInstallingPackages")}),ec.Type.Object({$case:ec.Type.Literal("installedPackages"),value:ec.Type.Ref("IterativeAgentInstalledPackages")}),ec.Type.Object({$case:ec.Type.Literal("startedShellExecution"),value:ec.Type.Ref("IterativeAgentStartedShellExecution")}),ec.Type.Object({$case:ec.Type.Literal("finishedShellExecution"),value:ec.Type.Ref("IterativeAgentFinishedShellExecution")}),ec.Type.Object({$case:ec.Type.Literal("appliedRunConfiguration"),value:ec.Type.Ref("IterativeAgentAppliedRunConfiguration")}),ec.Type.Object({$case:ec.Type.Literal("appliedDeploymentConfiguration"),value:ec.Type.Ref("IterativeAgentAppliedDeploymentConfiguration")}),ec.Type.Object({$case:ec.Type.Literal("appliedWorkflowConfiguration"),value:ec.Type.Ref("IterativeAgentAppliedWorkflowConfiguration")}),ec.Type.Undefined()]))}),IterativeAgentAppliedFileChanges:ec.Type.Object({eventWhichProposedChanges:ec.Type.String(),appliedChanges:ec.Type.Array(ec.Type.Ref("AppliedFileChange")),commitHash:ec.Type.String()}),IterativeAgentRevertedFileChanges:ec.Type.Object({eventWhichProposedChanges:ec.Type.String(),eventWhichAppliedChanges:ec.Type.String(),revertedChanges:ec.Type.Array(ec.Type.Ref("RevertedFileChange"))}),IterativeAgentInstallingPackages:ec.Type.Object({eventWhichProposedPackageInstall:ec.Type.String(),messageContentsOffset:ec.Type.Number(),processId:ec.Type.String()}),IterativeAgentInstalledPackages:ec.Type.Object({eventWhichProposedPackageInstall:ec.Type.String(),messageContentsOffset:ec.Type.Number(),installationOutput:ec.Type.String(),processId:ec.Type.String(),exitCode:ec.Type.Number()}),AppliedFileChange:ec.Type.Object({filePath:ec.Type.String(),linesAdded:ec.Type.Number(),linesRemoved:ec.Type.Number(),changeSummary:ec.Type.String()}),RevertedFileChange:ec.Type.Object({filePath:ec.Type.String(),changeSummary:ec.Type.String()}),IterativeAgentStartedShellExecution:ec.Type.Object({eventWhichProposedShellExecution:ec.Type.String(),messageContentsOffset:ec.Type.Number(),processId:ec.Type.String()}),IterativeAgentFinishedShellExecution:ec.Type.Object({eventWhichProposedShellExecution:ec.Type.String(),messageContentsOffset:ec.Type.Number(),processId:ec.Type.String(),commandOutput:ec.Type.String(),exitCode:ec.Type.Number()}),IterativeAgentAppliedRunConfiguration:ec.Type.Object({eventWhichProposedRunConfiguration:ec.Type.String(),messageContentsOffset:ec.Type.Number()}),IterativeAgentAppliedWorkflowConfiguration:ec.Type.Object({eventWhichProposedWorkflowConfiguration:ec.Type.String(),messageContentsOffset:ec.Type.Number()}),IterativeAgentAppliedDeploymentConfiguration:ec.Type.Object({eventWhichProposedDeploymentConfiguration:ec.Type.String(),messageContentsOffset:ec.Type.Number()}),IterativeAgentEventContext:ec.Type.Object({}),SystemDependencyInstallData:ec.Type.Object({deps:ec.Type.Array(ec.Type.String())}),SystemDependencyUninstallData:ec.Type.Object({deps:ec.Type.Array(ec.Type.String())}),DeployConfigData:ec.Type.Object({deploymentTarget:ec.Type.String(),run:ec.Type.Array(ec.Type.String()),build:ec.Type.Array(ec.Type.String()),publicDir:ec.Type.String(),ignorePorts:ec.Type.Boolean()}),DeployData:ec.Type.Object({}),RevertData:ec.Type.Object({eventIdBeforeRevert:ec.Type.String(),checkpointCommit:ec.Type.Optional(ec.Type.Union([ec.Type.String(),ec.Type.Undefined()])),status:ec.Type.Ref("RevertStatus"),originalSessionId:ec.Type.String(),checkpointTitle:ec.Type.String()}),AcknowledgeUserMessage:ec.Type.Object({eventIds:ec.Type.Array(ec.Type.String())}),CreatePostgreSQLDatabaseData:ec.Type.Object({}),SqlExecutionData:ec.Type.Object({command:ec.Type.String(),output:ec.Type.String(),status:ec.Type.Optional(ec.Type.Union([ec.Type.Object({$case:ec.Type.Literal("isExecuting"),value:ec.Type.Boolean()}),ec.Type.Object({$case:ec.Type.Literal("exitCode"),value:ec.Type.Number()}),ec.Type.Undefined()]))}),ImageGenerationData:ec.Type.Object({imagePath:ec.Type.String(),imageDescription:ec.Type.String()}),VideoGenerationData:ec.Type.Object({videoPath:ec.Type.String(),videoDescription:ec.Type.String()}),GeneratedMedia:ec.Type.Object({id:ec.Type.String(),path:ec.Type.String(),description:ec.Type.String(),mediaType:ec.Type.Ref("GeneratedMediaType"),error:ec.Type.String()}),GenerateMediaData:ec.Type.Object({media:ec.Type.Array(ec.Type.Ref("GeneratedMedia")),asynchronous:ec.Type.Boolean()}),UpsertGeneratedMediaData:ec.Type.Object({media:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("GeneratedMedia"),ec.Type.Undefined()]))}),WaitingForBackgroundJobsData:ec.Type.Object({waitingType:ec.Type.Ref("WaitingForBackgroundJobType"),maxWaitTimeSeconds:ec.Type.Number(),actualWaitTimeSeconds:ec.Type.Number()}),NewSessionNudge:ec.Type.Object({}),StepTooComplexEventContents:ec.Type.Object({stepId:ec.Type.String(),state:ec.Type.Ref("StepTooComplexEventContentsState")}),UserTipRecommendationData:ec.Type.Object({tipId:ec.Type.String(),title:ec.Type.String(),recommendedReason:ec.Type.String()}),EndOfRunSummaryData:ec.Type.Object({runId:ec.Type.String(),usageCents:ec.Type.Number(),preDiscountsUsageCents:ec.Type.Number(),workDurationSeconds:ec.Type.Number(),addedLinesOfCode:ec.Type.Number(),removedLinesOfCode:ec.Type.Number(),toolCalls:ec.Type.Number(),capabilityUsage:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("AgentCapabilityUsage"),ec.Type.Undefined()])),numLocRead:ec.Type.Number(),numFilesRead:ec.Type.Number(),refunded:ec.Type.Boolean(),relatedEffortBreakdowns:ec.Type.Array(ec.Type.Ref("RelatedEffortBreakdown")),rollbackCheckpointSha:ec.Type.String(),hasUncommittedChanges:ec.Type.Optional(ec.Type.Union([ec.Type.Boolean(),ec.Type.Undefined()]))}),UITestingSubagentEventContents:ec.Type.Object({testingPlan:ec.Type.String(),finalSummary:ec.Type.String(),title:ec.Type.String(),resultType:ec.Type.Ref("UITestingSubagentResultType")}),GeneralSubagentEventContents:ec.Type.Object({task:ec.Type.String(),taskSummary:ec.Type.String(),result:ec.Type.String(),resultSummary:ec.Type.String(),taskTitle:ec.Type.String(),eventFilter:ec.Type.Ref("GeneralSubagentEventFilter")}),SubagentStateTransitionReasonCompletedSuccessfully:ec.Type.Object({}),SubagentStateTransitionReasonPaused:ec.Type.Object({}),SubagentStateTransitionReason:ec.Type.Object({reasons:ec.Type.Optional(ec.Type.Union([ec.Type.Object({$case:ec.Type.Literal("completedSuccessfully"),value:ec.Type.Ref("SubagentStateTransitionReasonCompletedSuccessfully")}),ec.Type.Object({$case:ec.Type.Literal("paused"),value:ec.Type.Ref("SubagentStateTransitionReasonPaused")}),ec.Type.Undefined()]))}),SubagentRunningData:ec.Type.Object({subagentId:ec.Type.String(),childSessionId:ec.Type.String(),totalExecutionTimeSeconds:ec.Type.Number(),subagentName:ec.Type.String(),transitionReason:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("SubagentStateTransitionReason"),ec.Type.Undefined()])),contents:ec.Type.Optional(ec.Type.Union([ec.Type.Object({$case:ec.Type.Literal("uiTestingSubagentEventContents"),value:ec.Type.Ref("UITestingSubagentEventContents")}),ec.Type.Object({$case:ec.Type.Literal("generalSubagentEventContents"),value:ec.Type.Ref("GeneralSubagentEventContents")}),ec.Type.Undefined()]))}),UITestingSubagentExecutionEventContents:ec.Type.Object({gcsDownloadUrl:ec.Type.String(),mimeType:ec.Type.String(),narration:ec.Type.String(),miniNarration:ec.Type.String()}),UITestingSubagentTakeOverResultSuccess:ec.Type.Object({userNotes:ec.Type.String()}),UITestingSubagentTakeOverResultDeclined:ec.Type.Object({}),UITestingSubagentTakeOverResultTimedOut:ec.Type.Object({}),UITestingSubagentTakeOverData:ec.Type.Object({userInstructions:ec.Type.String(),result:ec.Type.Optional(ec.Type.Union([ec.Type.Object({$case:ec.Type.Literal("success"),value:ec.Type.Ref("UITestingSubagentTakeOverResultSuccess")}),ec.Type.Object({$case:ec.Type.Literal("declined"),value:ec.Type.Ref("UITestingSubagentTakeOverResultDeclined")}),ec.Type.Object({$case:ec.Type.Literal("timedOut"),value:ec.Type.Ref("UITestingSubagentTakeOverResultTimedOut")}),ec.Type.Undefined()]))}),AgentConfigUpdateEventContents:ec.Type.Object({operation:ec.Type.Optional(ec.Type.Union([ec.Type.Object({$case:ec.Type.Literal("automatedTesting"),value:ec.Type.Ref("AgentConfigUpdateAutomatedTesting")}),ec.Type.Undefined()]))}),AgentConfigUpdateAutomatedTesting:ec.Type.Object({enabled:ec.Type.Boolean(),reason:ec.Type.String()}),SamplingTrajectory:ec.Type.Object({id:ec.Type.String(),contents:ec.Type.String(),state:ec.Type.Ref("TrajectoryState")}),SamplingEvent:ec.Type.Object({state:ec.Type.Ref("SamplingEventState"),trajectories:ec.Type.Array(ec.Type.Ref("SamplingTrajectory"))}),SamplingEventUpdate:ec.Type.Object({trajectoryId:ec.Type.String(),contents:ec.Type.String(),state:ec.Type.Ref("TrajectoryState")}),SamplingEventStateUpdate:ec.Type.Object({state:ec.Type.Ref("SamplingEventState")}),UITestingSubagentExecutionEventContentsUpdate:ec.Type.Object({state:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("UITestingSubagentExecutionEventContents"),ec.Type.Undefined()]))}),SubagentRunningDataUpdate:ec.Type.Object({state:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("SubagentRunningData"),ec.Type.Undefined()])),totalExecutionTimeSeconds:ec.Type.Number()}),StoppedSubagentRunningUpdate:ec.Type.Object({totalExecutionTimeSeconds:ec.Type.Number(),transitionReason:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("SubagentStateTransitionReason"),ec.Type.Undefined()]))}),SetupObjectStorageData:ec.Type.Object({bucketName:ec.Type.String(),bucketId:ec.Type.String()}),MoveEventsBetweenSessionsRequest:ec.Type.Object({sourceSessionId:ec.Type.String(),destinationSessionId:ec.Type.String()}),MoveEventsBetweenSessionsResponse:ec.Type.Object({}),AbortSubagentRequest:ec.Type.Object({replId:ec.Type.String(),sessionId:ec.Type.String(),subagentId:ec.Type.String()}),AbortSubagentResponse:ec.Type.Object({}),WarmAgentRequest:ec.Type.Object({replId:ec.Type.String(),sessionId:ec.Type.String()}),WarmAgentResponse:ec.Type.Object({}),StockImageData:ec.Type.Object({imageDescription:ec.Type.String(),numberOfImages:ec.Type.Number(),imageUrls:ec.Type.Array(ec.Type.String())}),AddingIntegrationsRequest:ec.Type.Object({connectorIds:ec.Type.Array(ec.Type.String()),connectionIds:ec.Type.Array(ec.Type.String())}),AddingIntegrationsResponse:ec.Type.Object({connectionIds:ec.Type.Array(ec.Type.String()),rejectedConnectionIds:ec.Type.Array(ec.Type.String()),rejectedConnectorIds:ec.Type.Array(ec.Type.String())}),InitialBuildStateUpdateEventContents:ec.Type.Object({phase:ec.Type.Ref("InitialBuildPhase")}),SearchIntegrationsData:ec.Type.Object({query:ec.Type.String(),numResults:ec.Type.Number()}),ViewIntegrationData:ec.Type.Object({name:ec.Type.String()}),ViewLogsData:ec.Type.Object({webviewConsole:ec.Type.Boolean(),workflows:ec.Type.Boolean(),deployment:ec.Type.Boolean(),lsp:ec.Type.Boolean()}),SetupModelfarmData:ec.Type.Object({}),ViewSpecialFilesData:ec.Type.Object({fileType:ec.Type.Ref("SpecialFileType")}),DesignGuidelinesData:ec.Type.Object({}),MCPToolData:ec.Type.Object({toolName:ec.Type.String(),serverName:ec.Type.String(),parameters:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("Struct"),ec.Type.Undefined()])),result:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("MCPToolResult"),ec.Type.Undefined()])),progress:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("MCPToolProgress"),ec.Type.Undefined()])),insecureError:ec.Type.String()}),MCPToolParameter:ec.Type.Object({key:ec.Type.String(),value:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("Any"),ec.Type.Undefined()]))}),MCPToolResult:ec.Type.Object({content:ec.Type.String(),contentBlocks:ec.Type.Array(ec.Type.Ref("MCPContentBlock")),structuredContent:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("Struct"),ec.Type.Undefined()])),isError:ec.Type.Boolean()}),MCPToolProgress:ec.Type.Object({progress:ec.Type.Number(),total:ec.Type.Optional(ec.Type.Union([ec.Type.Number(),ec.Type.Undefined()])),message:ec.Type.Optional(ec.Type.Union([ec.Type.String(),ec.Type.Undefined()]))}),MCPContentBlock:ec.Type.Object({block:ec.Type.Optional(ec.Type.Union([ec.Type.Object({$case:ec.Type.Literal("textContent"),value:ec.Type.Ref("MCPContentBlockTextContent")}),ec.Type.Object({$case:ec.Type.Literal("imageContent"),value:ec.Type.Ref("MCPContentBlockImageContent")}),ec.Type.Object({$case:ec.Type.Literal("audioContent"),value:ec.Type.Ref("MCPContentBlockAudioContent")}),ec.Type.Object({$case:ec.Type.Literal("resourceLink"),value:ec.Type.Ref("MCPContentBlockResourceLink")}),ec.Type.Object({$case:ec.Type.Literal("embeddedResource"),value:ec.Type.Ref("MCPContentBlockEmbeddedResource")}),ec.Type.Undefined()]))}),MCPAnnotations:ec.Type.Object({audience:ec.Type.Array(ec.Type.String()),priority:ec.Type.Optional(ec.Type.Union([ec.Type.Number(),ec.Type.Undefined()]))}),MCPContentBlockTextContent:ec.Type.Object({text:ec.Type.String(),annotations:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("MCPAnnotations"),ec.Type.Undefined()])),meta:ec.Type.Optional(ec.Type.Union([ec.Type.String(),ec.Type.Undefined()]))}),MCPContentBlockImageContent:ec.Type.Object({data:ec.Type.String(),mimeType:ec.Type.String(),annotations:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("MCPAnnotations"),ec.Type.Undefined()])),meta:ec.Type.Optional(ec.Type.Union([ec.Type.String(),ec.Type.Undefined()]))}),MCPContentBlockAudioContent:ec.Type.Object({data:ec.Type.String(),mimeType:ec.Type.String(),annotations:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("MCPAnnotations"),ec.Type.Undefined()])),meta:ec.Type.Optional(ec.Type.Union([ec.Type.String(),ec.Type.Undefined()]))}),MCPContentBlockResourceLink:ec.Type.Object({name:ec.Type.String(),title:ec.Type.Optional(ec.Type.Union([ec.Type.String(),ec.Type.Undefined()])),uri:ec.Type.String(),description:ec.Type.Optional(ec.Type.Union([ec.Type.String(),ec.Type.Undefined()])),mimeType:ec.Type.Optional(ec.Type.Union([ec.Type.String(),ec.Type.Undefined()])),size:ec.Type.Optional(ec.Type.Union([ec.Type.Number(),ec.Type.Undefined()])),annotations:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("MCPAnnotations"),ec.Type.Undefined()])),meta:ec.Type.Optional(ec.Type.Union([ec.Type.String(),ec.Type.Undefined()]))}),MCPResourceContents:ec.Type.Object({uri:ec.Type.String(),mimeType:ec.Type.Optional(ec.Type.Union([ec.Type.String(),ec.Type.Undefined()])),meta:ec.Type.Optional(ec.Type.Union([ec.Type.String(),ec.Type.Undefined()])),contents:ec.Type.Optional(ec.Type.Union([ec.Type.Object({$case:ec.Type.Literal("text"),value:ec.Type.String()}),ec.Type.Object({$case:ec.Type.Literal("blob"),value:ec.Type.String()}),ec.Type.Undefined()]))}),MCPContentBlockEmbeddedResource:ec.Type.Object({resource:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("MCPResourceContents"),ec.Type.Undefined()])),annotations:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("MCPAnnotations"),ec.Type.Undefined()])),meta:ec.Type.Optional(ec.Type.Union([ec.Type.String(),ec.Type.Undefined()]))}),AlertData:ec.Type.Object({alertLevel:ec.Type.Ref("AlertLevel"),message:ec.Type.String(),nextAction:ec.Type.Ref("AlertNextAction")}),EnvVar:ec.Type.Object({key:ec.Type.String(),environment:ec.Type.Ref("EnvironmentType")}),EnvironmentConfigRequest:ec.Type.Object({envVars:ec.Type.Array(ec.Type.Ref("EnvVar")),message:ec.Type.String()}),ProvidedEnvVar:ec.Type.Object({key:ec.Type.String(),value:ec.Type.String(),environment:ec.Type.Ref("EnvironmentType")}),EnvironmentConfigResponse:ec.Type.Object({providedEnvVars:ec.Type.Array(ec.Type.Ref("ProvidedEnvVar"))}),ViewEnvVarData:ec.Type.Object({type:ec.Type.Ref("EnvironmentVariableType"),environment:ec.Type.Ref("EnvironmentType"),keys:ec.Type.Array(ec.Type.String())}),SetEnvVarData:ec.Type.Object({type:ec.Type.Ref("EnvironmentVariableType"),environment:ec.Type.Ref("EnvironmentType"),keys:ec.Type.Array(ec.Type.String())}),DeleteEnvVarData:ec.Type.Object({type:ec.Type.Ref("EnvironmentVariableType"),environment:ec.Type.Ref("EnvironmentType"),keys:ec.Type.Array(ec.Type.String())}),ClassifyInitialUserPromptRequest:ec.Type.Object({userPrompt:ec.Type.String(),uploadedFiles:ec.Type.Array(ec.Type.Ref("UploadedFile"))}),ClassifyInitialUserPromptResponse:ec.Type.Object({stackType:tu,agentInitialBuildTier:ec.Type.Ref("AgentInitialBuildTier")}),MessagedBackgroundAgentData:ec.Type.Object({message:ec.Type.String(),summary:ec.Type.String()}),MessagedBackgroundAgentDataUpdate:ec.Type.Object({delta:ec.Type.String()}),SubagentReportResultData:ec.Type.Object({result:ec.Type.String()}),SubagentReportResultUpdate:ec.Type.Object({delta:ec.Type.String()}),ReportAgentIssueData:ec.Type.Object({}),CreateAutomationPreviewData:ec.Type.Object({result:ec.Type.String()})});tT.Import("AgentRunState"),tT.Import("AgentUserFeedbackType"),tT.Import("UserSecretResponseStatus"),tT.Import("ProjectImportSource"),tT.Import("TaskStatus"),tT.Import("SandboxLanguage"),tT.Import("SandboxOutputType"),tT.Import("AgentPlanStepStatus"),tT.Import("RequestFeatureAddType"),tT.Import("AgentStackTriggerType"),tT.Import("BlueprintCategory"),tT.Import("WebSearchType"),tT.Import("CheckpointSuggestionReason"),tT.Import("FileOutputType"),tT.Import("BenchmarkConclusionReason"),tT.Import("ArtifactKind"),tT.Import("AttachedFormType"),tT.Import("UrlIntent"),tT.Import("FileChangeGenerationState"),tT.Import("TranslationTarget"),tT.Import("ModelType"),tT.Import("CodeReferenceType"),tT.Import("DebugErrorSource"),tT.Import("EventState"),tT.Import("InlineMessageType"),tT.Import("UserType");let ty=tT.Import("SessionType");tT.Import("MessageStopReason"),tT.Import("MessageAction"),tT.Import("MembershipType"),tT.Import("EventErrorType"),tT.Import("AgentMode"),tT.Import("AgentInitialBuildMode"),tT.Import("AutonomyLevel"),tT.Import("AgentInitialBuildTier"),tT.Import("MessageSource"),tT.Import("ModelProfile"),tT.Import("UpdateEventOperationType"),tT.Import("AgentAuthorizationFailedCode"),tT.Import("NullValue"),tT.Import("BYOPromptResponseParameterType"),tT.Import("CommitAuthor"),tT.Import("CommitBillingRate"),tT.Import("CheckpointTriggerReason"),tT.Import("DiscountedEffortType"),tT.Import("RevertStatus"),tT.Import("GeneratedMediaType"),tT.Import("WaitingForBackgroundJobType"),tT.Import("StepTooComplexEventContentsState"),tT.Import("UITestingSubagentResultType"),tT.Import("GeneralSubagentEventFilter"),tT.Import("SamplingEventState"),tT.Import("TrajectoryState"),tT.Import("InitialBuildPhase"),tT.Import("SpecialFileType"),tT.Import("AlertLevel"),tT.Import("AlertNextAction"),tT.Import("EnvironmentType"),tT.Import("EnvironmentVariableType"),tT.Import("RevertToCommitRequest"),tT.Import("RevertToCommitResponse"),tT.Import("CloneSessionRequest"),tT.Import("CloneSessionResponse"),tT.Import("Ping"),tT.Import("Pong"),tT.Import("Event"),tT.Import("EventShape"),tT.Import("AgentUserFeedback"),tT.Import("SubmitAgentUserFeedbackRequest"),tT.Import("SubmitAgentUserFeedbackResponse"),tT.Import("ReplAgentState"),tT.Import("Session"),tT.Import("Secret"),tT.Import("SecretRequestAction"),tT.Import("UserSecretResponse"),tT.Import("DeployRequest"),tT.Import("DeployResponse"),tT.Import("MessageButton"),tT.Import("DeployRequestAction"),tT.Import("MessageButtonAction"),tT.Import("AgentUserSecretsRequest"),tT.Import("AgentUserSecretsResponse"),tT.Import("AgentDebugRequest"),tT.Import("AgentDebugResponse"),tT.Import("AgentContinueRequest"),tT.Import("AgentContinueResponse"),tT.Import("AgentNewFeatureRequest"),tT.Import("UserMessageContents"),tT.Import("AgentNewFeatureResponse"),tT.Import("AgentDeployRequest"),tT.Import("AgentDeployResponse"),tT.Import("AgentAction"),tT.Import("AgentNextStepRequest"),tT.Import("AgentNextStepResponse"),tT.Import("AgentQueryBoolean"),tT.Import("AgentQueryChoice"),tT.Import("AgentQueryText"),tT.Import("AgentQuery"),tT.Import("AgentQueryBooleanResponse"),tT.Import("AgentQueryChoiceResponse"),tT.Import("AgentQueryTextResponse"),tT.Import("AgentQueryNoResponse"),tT.Import("AgentQueryResponse"),tT.Import("QueryResponseContent"),tT.Import("QueryRequestContent"),tT.Import("MarkTaskCompleteRequest"),tT.Import("UserMarkedTaskComplete"),tT.Import("ApproveTaskListRequest"),tT.Import("ApproveTaskListResponse"),tT.Import("ApproveInitialBuildMVPRequest"),tT.Import("ApproveInitialBuildMVPResponse"),tT.Import("ApproveInitialBuildVisualPhaseRequest"),tT.Import("ApproveInitialBuildVisualPhaseResponse"),tT.Import("ApproveSqlQueryRequest"),tT.Import("ApproveSqlQueryResponse"),tT.Import("ApproveBlueprintRequest"),tT.Import("ApproveBlueprintResponse"),tT.Import("ConvertMockupToAppRequest"),tT.Import("ConvertMockupToAppResponse"),tT.Import("AgentAskUserForActionRequest"),tT.Import("AgentAskUserForActionResponse"),tT.Import("SetupImportedProjectEventContents"),tT.Import("ProjectImportCompletedData"),tT.Import("MemoryCompressionData"),tT.Import("TaskListData"),tT.Import("Task"),tT.Import("EventContents"),tT.Import("EventContext"),tT.Import("StartRapidBuildEventContents"),tT.Import("RapidBuildStartedData"),tT.Import("SessionCreationEventContents"),tT.Import("DatabaseNudgeEventContents"),tT.Import("CloudBudgetExceededEventContents"),tT.Import("SkillLoadedEventData"),tT.Import("ExecutedSandboxedCodeEventData"),tT.Import("ProposedTaskEventData"),tT.Import("ProposedTask"),tT.Import("StartTaskEventData"),tT.Import("SandboxOutput"),tT.Import("AddExecutedSandboxedCodeOutput"),tT.Import("CodeChangeStats"),tT.Import("AgentPlanStep"),tT.Import("BlueprintsSetup"),tT.Import("RequestFeatureAdd"),tT.Import("AgentPlanObjective"),tT.Import("AgentPlanEventContents"),tT.Import("AgentPlanEventContext"),tT.Import("RevertEventContext"),tT.Import("BlueprintData"),tT.Import("ShellExecutionData"),tT.Import("FileEditData"),tT.Import("CreateFileData"),tT.Import("ReadFileData"),tT.Import("ReadDirData"),tT.Import("PackagerInstallData"),tT.Import("PackagerUninstallData"),tT.Import("SearchFilesystemData"),tT.Import("WebSearchResultPage"),tT.Import("GoogleSuggestedSearch"),tT.Import("WebSearchData"),tT.Import("WebPageVisitData"),tT.Import("ScreenshotData"),tT.Import("ToolchainInstallData"),tT.Import("WorkflowsGetOutputToolData"),tT.Import("WorkflowsRemoveRunConfigToolData"),tT.Import("WorkflowsRestartToolData"),tT.Import("WorkflowsSetRunConfigToolData"),tT.Import("WorkflowsStartToolData"),tT.Import("WorkflowsStopToolData"),tT.Import("CheckpointSuggestions"),tT.Import("SuggestRollbackData"),tT.Import("AgentStoppedData"),tT.Import("PresentResultsToolData"),tT.Import("SearchFileData"),tT.Import("SuggestGeneralBuildModeData"),tT.Import("FileOutput"),tT.Import("FileOutputsData"),tT.Import("AgentTimelineEventContents"),tT.Import("AgentPlanStepBeginData"),tT.Import("FallbackEvent"),tT.Import("SummarizeObjectiveData"),tT.Import("AgentThoughtsData"),tT.Import("RedactedThoughtsMarker"),tT.Import("RapidBuildConcludedData"),tT.Import("VersionMigratedData"),tT.Import("PlanProgressData"),tT.Import("BenchmarkConclusionEventContents"),tT.Import("BenchmarkMetrics"),tT.Import("Metric"),tT.Import("MetricByTag"),tT.Import("AgentTimelineEventContext"),tT.Import("Range"),tT.Import("CodeReference"),tT.Import("ArtifactReference"),tT.Import("ArtifactBuildingData"),tT.Import("ArtifactPresentedData");let tg=tT.Import("MessageEventContents");tT.Import("TargetedElement"),tT.Import("RelatedElement"),tT.Import("AttachedForm"),tT.Import("AttachedFormField"),tT.Import("AttachedFormStringField"),tT.Import("AttachedFormFilesField"),tT.Import("AttachedFormFiles"),tT.Import("UpdateAttachedFormStringFieldSet"),tT.Import("UpdateAttachedFormStringFieldAppend"),tT.Import("SelectedRagContext"),tT.Import("AssistantProposedActions"),tT.Import("IntegrationTestEventContents"),tT.Import("ContextComplexityEventContents"),tT.Import("EventTooLargeEventContents"),tT.Import("IntegrationTestEventContext"),tT.Import("AttachedUrl"),tT.Import("UploadedFile"),tT.Import("UploadedRapidBuildFile"),tT.Import("SimpleFileBasedVerifier"),tT.Import("BrowserVerifier"),tT.Import("SeedingVerifier"),tT.Import("BenchmarkVerifier"),tT.Import("BenchmarkParameters"),tT.Import("SuggestedTemplates"),tT.Import("SuggestedTemplate"),tT.Import("ProposedFileChanges"),tT.Import("ProposedFileChange"),tT.Import("ProposedShellCommand"),tT.Import("ProposedPackageInstall"),tT.Import("ProposedWorkspaceToolNudge"),tT.Import("ProposedRunConfiguration"),tT.Import("ProposedWorkflowConfiguration"),tT.Import("ProposedDeploymentConfiguration"),tT.Import("Source"),tT.Import("InlineActionEventContents"),tT.Import("ShellSuggestionEventContents"),tT.Import("SessionCreationEventContext"),tT.Import("TranslateEventContents"),tT.Import("TranslateEventContext"),tT.Import("LocalShellExecutionEventContents"),tT.Import("LocalShellExecutionEventContext"),tT.Import("ShellSuggestionEventContext"),tT.Import("ModelSelector"),tT.Import("EventError"),tT.Import("MediaReference");let th=tT.Import("AgentConfig");tT.Import("MessageEventContext"),tT.Import("InlineActionEventContext"),tT.Import("UpdateEventOperation"),tT.Import("TypedUpdateEventOperation"),tT.Import("AppendTimelineMessageContentsUpdate"),tT.Import("AppendThoughtContentsUpdate"),tT.Import("NewThoughtSummaryUpdate"),tT.Import("AppendRedactedThoughtsMarkerUpdate"),tT.Import("AgentTimelineEventSet"),tT.Import("HostingDebugSummaryEventSet"),tT.Import("ReplCreationEventSet"),tT.Import("MessageContentsUpdate"),tT.Import("IntegrationTestEventContentsUpdate"),tT.Import("AgentAskUserForActionRequestSet"),tT.Import("MessageContentsSet"),tT.Import("ShellSuggestionContentsUpdate"),tT.Import("LocalShellExecutionEventSet"),tT.Import("AgentTimelineEventCreateFileAddContent"),tT.Import("AddSourcesUpdate"),tT.Import("AddSuggestedTemplatesUpdate"),tT.Import("AddProposedActionsMetadata"),tT.Import("AddRagContext"),tT.Import("AddProposedFileChangesMetadata"),tT.Import("AddProposedFileChange"),tT.Import("UpdateProposedFileChange"),tT.Import("AddProposedShellCommand"),tT.Import("AddProposedPackageInstall"),tT.Import("UpdateRevertStatus"),tT.Import("AddProposedWorkspaceToolNudge"),tT.Import("AddProposedRunConfiguration"),tT.Import("AddProposedWorkflowConfiguration"),tT.Import("UpdateFileEditLineCountsUpdate"),tT.Import("AddProposedDeploymentConfiguration"),tT.Import("AddDesignReferenceFile"),tT.Import("UpdatePlanContents"),tT.Import("UpdatePlanApprovalStatus"),tT.Import("BYOPromptResultUpdate"),tT.Import("GovalToken"),tT.Import("AuthToken"),tT.Import("UserContext"),tT.Import("CreateEventRequest"),tT.Import("CreateEventResponse"),tT.Import("CreateEventRequestWithUser"),tT.Import("BatchCreateEventsRequest"),tT.Import("BatchCreateEventsResponse"),tT.Import("UpdateEventRequest"),tT.Import("UpdateEventResponse"),tT.Import("UpdateAgentStateRequest"),tT.Import("GetAgentStateRequest"),tT.Import("GetAgentStateResponse"),tT.Import("UpdateAgentStateResponse"),tT.Import("UpdateAgentStateMessage"),tT.Import("BroadcastAgentStateRequest"),tT.Import("BroadcastAgentStateResponse"),tT.Import("AgentStateTransitionReason"),tT.Import("AgentStateTransitionReasonUserPaused"),tT.Import("AgentStateTransitionReasonStepLimitExceeded"),tT.Import("AgentStateTransitionReasonRateLimited"),tT.Import("AgentStateTransitionReasonAuthorizationFailed"),tT.Import("AgentStateTransitionReasonWaitingOnUserResponse"),tT.Import("AgentStateTransitionReasonRequestedSecrets"),tT.Import("AgentStateTransitionReasonWaitingOnPlanApproval"),tT.Import("AgentStateTransitionReasonTestConcluded"),tT.Import("AgentStateTransitionReasonPlanConcluded"),tT.Import("AgentStateTransitionReasonError"),tT.Import("AgentStateTransitionReasonReverted"),tT.Import("AgentStateTransitionReasonStepTooComplex"),tT.Import("AgentStateTransitionReasonTriggerCheckpoint"),tT.Import("ReprocessEventRequest"),tT.Import("ReprocessEventResponse"),tT.Import("GetResourceUploadUrlRequest"),tT.Import("GetResourceUploadUrlResponse"),tT.Import("GetUrlScreenshotRequest"),tT.Import("GetUrlScreenshotResponse"),tT.Import("GetUrlScrapedContentRequest"),tT.Import("GetUrlScrapedContentResponse"),tT.Import("GetUrlBrandingRequest"),tT.Import("GetUrlBrandingResponse"),tT.Import("AbortEventRequest"),tT.Import("AbortEventResponse"),tT.Import("GetReplSessionsRequest"),tT.Import("GetReplSessionsResponse"),tT.Import("EnhanceAgentPromptRequest"),tT.Import("EnhanceAgentPromptResponse"),tT.Import("GetSessionEventsRequest"),tT.Import("GetSessionEventsResponse"),tT.Import("BatchGetEventsRequest"),tT.Import("BatchGetEventsResponse"),tT.Import("CreateSessionRequest"),tT.Import("CreateSessionResponse"),tT.Import("GetEventListRequest"),tT.Import("GetEventListResponse"),tT.Import("SubscribeToReplEventsRequest"),tT.Import("ReplEventsSubscriptionMessage"),tT.Import("SubscriptionStatusMessage"),tT.Import("CreateEventMessage"),tT.Import("CreateSessionMessage"),tT.Import("UpdateEventMessage"),tT.Import("UpdateSessionMessage"),tT.Import("AbortEventMessage"),tT.Import("Limit"),tT.Import("GetAvailableModelRequest"),tT.Import("ModelName"),tT.Import("GetAvailableModelsResponse"),tT.Import("UpdateSessionRequest"),tT.Import("UpdateSessionResponse"),tT.Import("ProcessEventRequest"),tT.Import("ProcessEventResponseMessage"),tT.Import("ProcessEventStartMessage"),tT.Import("GenerateReplNameRequest"),tT.Import("GenerateReplNameResponse"),tT.Import("GenerateIconRequest"),tT.Import("GenerateIconResponse"),tT.Import("Any"),tT.Import("Struct"),tT.Import("StructField"),tT.Import("Value"),tT.Import("ListValue"),tT.Import("BYOPromptMessage"),tT.Import("BYOPromptResponseParameter"),tT.Import("BYOPromptEventContents"),tT.Import("BYOPromptEventContext"),tT.Import("RevertEventContents"),tT.Import("TriggerCheckpointEventContents"),tT.Import("StepTooComplexAcknowledgementEventContents"),tT.Import("AgentCapabilityUsage"),tT.Import("TaskEffort"),tT.Import("GeneralEffort"),tT.Import("AgentInitializationEffort"),tT.Import("FreeQuickEditEffort"),tT.Import("DiscountedEffort"),tT.Import("RelatedEffortBreakdown"),tT.Import("CommitData"),tT.Import("ApprovePlanEventContents"),tT.Import("ApprovePlanEventContext"),tT.Import("UserSecretsResponseEventContents"),tT.Import("HostingDebugSummaryErrorPorts"),tT.Import("HostingDebugSummaryError"),tT.Import("HostingDebugSummarySuggestion"),tT.Import("HostingDebugSummaryResult"),tT.Import("HostingDebugSummaryEventContents"),tT.Import("HostingDebugSummaryEventContext"),tT.Import("ReplCreationEventContents"),tT.Import("ReplCreationEventContext"),tT.Import("UserSecretsResponseEventContext"),tT.Import("IterativeAgentEventContents"),tT.Import("IterativeAgentAppliedFileChanges"),tT.Import("IterativeAgentRevertedFileChanges"),tT.Import("IterativeAgentInstallingPackages"),tT.Import("IterativeAgentInstalledPackages"),tT.Import("AppliedFileChange"),tT.Import("RevertedFileChange"),tT.Import("IterativeAgentStartedShellExecution"),tT.Import("IterativeAgentFinishedShellExecution"),tT.Import("IterativeAgentAppliedRunConfiguration"),tT.Import("IterativeAgentAppliedWorkflowConfiguration"),tT.Import("IterativeAgentAppliedDeploymentConfiguration"),tT.Import("IterativeAgentEventContext"),tT.Import("SystemDependencyInstallData"),tT.Import("SystemDependencyUninstallData"),tT.Import("DeployConfigData"),tT.Import("DeployData"),tT.Import("RevertData"),tT.Import("AcknowledgeUserMessage"),tT.Import("CreatePostgreSQLDatabaseData"),tT.Import("SqlExecutionData"),tT.Import("ImageGenerationData"),tT.Import("VideoGenerationData"),tT.Import("GeneratedMedia"),tT.Import("GenerateMediaData"),tT.Import("UpsertGeneratedMediaData"),tT.Import("WaitingForBackgroundJobsData"),tT.Import("NewSessionNudge"),tT.Import("StepTooComplexEventContents"),tT.Import("UserTipRecommendationData"),tT.Import("EndOfRunSummaryData"),tT.Import("UITestingSubagentEventContents"),tT.Import("GeneralSubagentEventContents"),tT.Import("SubagentStateTransitionReasonCompletedSuccessfully"),tT.Import("SubagentStateTransitionReasonPaused"),tT.Import("SubagentStateTransitionReason"),tT.Import("SubagentRunningData"),tT.Import("UITestingSubagentExecutionEventContents"),tT.Import("UITestingSubagentTakeOverResultSuccess"),tT.Import("UITestingSubagentTakeOverResultDeclined"),tT.Import("UITestingSubagentTakeOverResultTimedOut"),tT.Import("UITestingSubagentTakeOverData"),tT.Import("AgentConfigUpdateEventContents"),tT.Import("AgentConfigUpdateAutomatedTesting"),tT.Import("SamplingTrajectory"),tT.Import("SamplingEvent"),tT.Import("SamplingEventUpdate"),tT.Import("SamplingEventStateUpdate"),tT.Import("UITestingSubagentExecutionEventContentsUpdate"),tT.Import("SubagentRunningDataUpdate"),tT.Import("StoppedSubagentRunningUpdate"),tT.Import("SetupObjectStorageData"),tT.Import("MoveEventsBetweenSessionsRequest"),tT.Import("MoveEventsBetweenSessionsResponse"),tT.Import("AbortSubagentRequest"),tT.Import("AbortSubagentResponse"),tT.Import("WarmAgentRequest"),tT.Import("WarmAgentResponse"),tT.Import("StockImageData"),tT.Import("AddingIntegrationsRequest"),tT.Import("AddingIntegrationsResponse"),tT.Import("InitialBuildStateUpdateEventContents"),tT.Import("SearchIntegrationsData"),tT.Import("ViewIntegrationData"),tT.Import("ViewLogsData"),tT.Import("SetupModelfarmData"),tT.Import("ViewSpecialFilesData"),tT.Import("DesignGuidelinesData"),tT.Import("MCPToolData"),tT.Import("MCPToolParameter"),tT.Import("MCPToolResult"),tT.Import("MCPToolProgress"),tT.Import("MCPContentBlock"),tT.Import("MCPAnnotations"),tT.Import("MCPContentBlockTextContent"),tT.Import("MCPContentBlockImageContent"),tT.Import("MCPContentBlockAudioContent"),tT.Import("MCPContentBlockResourceLink"),tT.Import("MCPResourceContents"),tT.Import("MCPContentBlockEmbeddedResource"),tT.Import("AlertData"),tT.Import("EnvVar"),tT.Import("EnvironmentConfigRequest"),tT.Import("ProvidedEnvVar"),tT.Import("EnvironmentConfigResponse"),tT.Import("ViewEnvVarData"),tT.Import("SetEnvVarData"),tT.Import("DeleteEnvVarData"),tT.Import("ClassifyInitialUserPromptRequest"),tT.Import("ClassifyInitialUserPromptResponse"),tT.Import("MessagedBackgroundAgentData"),tT.Import("MessagedBackgroundAgentDataUpdate"),tT.Import("SubagentReportResultData"),tT.Import("SubagentReportResultUpdate"),tT.Import("ReportAgentIssueData"),tT.Import("CreateAutomationPreviewData"),e.s(["AgentConfigSchema",0,th,"MessageEventContentsSchema",0,tg,"SessionTypeSchema",0,ty],230153);var tf=e.i(862927);Error("timeout while waiting for mutex to become available"),Error("mutex already locked");let tm=Error("request for lock canceled");class tS{constructor(e,t=tm){this._value=e,this._cancelError=t,this._queue=[],this._weightedWaiters=[]}acquire(e=1,t=0){if(e<=0)throw Error(`invalid weight ${e}: must be positive`);return new Promise((n,i)=>{let s={resolve:n,reject:i,weight:e,priority:t},r=tE(this._queue,e=>t<=e.priority);-1===r&&e<=this._value?this._dispatchItem(s):this._queue.splice(r+1,0,s)})}runExclusive(e){var t,n,i,s;return t=this,n=arguments,i=void 0,s=function*(e,t=1,n=0){let[i,s]=yield this.acquire(t,n);try{return yield e(i)}finally{s()}},new(i||(i=Promise))(function(e,r){function a(e){try{p(s.next(e))}catch(e){r(e)}}function o(e){try{p(s.throw(e))}catch(e){r(e)}}function p(t){var n;t.done?e(t.value):((n=t.value)instanceof i?n:new i(function(e){e(n)})).then(a,o)}p((s=s.apply(t,n||[])).next())})}waitForUnlock(e=1,t=0){if(e<=0)throw Error(`invalid weight ${e}: must be positive`);return this._couldLockImmediately(e,t)?Promise.resolve():new Promise(n=>{var i,s;let r;this._weightedWaiters[e-1]||(this._weightedWaiters[e-1]=[]),i=this._weightedWaiters[e-1],s={resolve:n,priority:t},r=tE(i,e=>s.priority<=e.priority),i.splice(r+1,0,s)})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(e){this._value=e,this._dispatchQueue()}release(e=1){if(e<=0)throw Error(`invalid weight ${e}: must be positive`);this._value+=e,this._dispatchQueue()}cancel(){this._queue.forEach(e=>e.reject(this._cancelError)),this._queue=[]}_dispatchQueue(){for(this._drainUnlockWaiters();this._queue.length>0&&this._queue[0].weight<=this._value;)this._dispatchItem(this._queue.shift()),this._drainUnlockWaiters()}_dispatchItem(e){let t=this._value;this._value-=e.weight,e.resolve([t,this._newReleaser(e.weight)])}_newReleaser(e){let t=!1;return()=>{t||(t=!0,this.release(e))}}_drainUnlockWaiters(){if(0===this._queue.length)for(let e=this._value;e>0;e--){let t=this._weightedWaiters[e-1];t&&(t.forEach(e=>e.resolve()),this._weightedWaiters[e-1]=[])}else{let e=this._queue[0].priority;for(let t=this._value;t>0;t--){let n=this._weightedWaiters[t-1];if(!n)continue;let i=n.findIndex(t=>t.priority<=e);(-1===i?n:n.splice(0,i)).forEach(e=>e.resolve())}}}_couldLockImmediately(e,t){return(0===this._queue.length||this._queue[0].priority<t)&&e<=this._value}}function tE(e,t){for(let n=e.length-1;n>=0;n--)if(t(e[n]))return n;return -1}let tv=new Map,tR=new class{constructor(e){this._semaphore=new tS(1,e)}acquire(){var e,t,n,i;return e=this,t=arguments,n=void 0,i=function*(e=0){let[,t]=yield this._semaphore.acquire(1,e);return t},new(n||(n=Promise))(function(s,r){function a(e){try{p(i.next(e))}catch(e){r(e)}}function o(e){try{p(i.throw(e))}catch(e){r(e)}}function p(e){var t;e.done?s(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(a,o)}p((i=i.apply(e,t||[])).next())})}runExclusive(e,t=0){return this._semaphore.runExclusive(()=>e(),1,t)}isLocked(){return this._semaphore.isLocked()}waitForUnlock(e=0){return this._semaphore.waitForUnlock(1,e)}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}};async function tb(e,t,{path:n="/ai/chort/auth",cache:i=!0}={}){return await tR.runExclusive(async()=>{let s=`${e}-${t??"none"}-${n}`;if(i){let e=tv.get(s);if(e&&e.expiration>Date.now())return e.token}let r=await fetch(n,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(t?{repl:{id:t}}:{})});if(!r.ok)throw Error(`Failed to fetch Chort auth token: ${r.status}`);let a=await r.json(),o=tf.Value.Decode(eg,a);if(i){let e=Date.now()+18e5;tv.set(s,{token:o,expiration:e})}return o})}e.s(["fetchChortAuthToken",()=>tb],351677);let tO="u">typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),tC=new Uint8Array(16),tI=[];for(let e=0;e<256;++e)tI.push((e+256).toString(16).slice(1));let tA=function(e,n,i){if(tO&&!n&&!e)return tO();let s=(e=e||{}).random??e.rng?.()??function(){if(!t){if("u"<typeof crypto||!crypto.getRandomValues)throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");t=crypto.getRandomValues.bind(crypto)}return t(tC)}();if(s.length<16)throw Error("Random bytes length must be >= 16");if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,n){if((i=i||0)<0||i+16>n.length)throw RangeError(`UUID byte range ${i}:${i+15} is out of buffer bounds`);for(let e=0;e<16;++e)n[i+e]=s[e];return n}return function(e,t=0){return(tI[e[t+0]]+tI[e[t+1]]+tI[e[t+2]]+tI[e[t+3]]+"-"+tI[e[t+4]]+tI[e[t+5]]+"-"+tI[e[t+6]]+tI[e[t+7]]+"-"+tI[e[t+8]]+tI[e[t+9]]+"-"+tI[e[t+10]]+tI[e[t+11]]+tI[e[t+12]]+tI[e[t+13]]+tI[e[t+14]]+tI[e[t+15]]).toLowerCase()}(s)};e.i(977195);var tU=e.i(590467);e.i(242933);var tk=e.i(790164),tN=e.i(792129),tD=e.i(562563);class tP{clientId;serverId;log;status;transport;client;dispose=null;constructor({userId:e,connectImmediately:t,logger:n,getEndpoint:i,getToken:s,overrideWebsocket:r,onProtocolError:a,onRetriesExceeded:o}){this.clientId=`${e}-${tA()}`,this.serverId=eu,this.log=n??null,this.status=new tk.ObservableState("disconnected"),this.transport=new tD.WebSocketClientTransport(r?async()=>r((await i()).toString()):async()=>new WebSocket((await i()).toString()),this.clientId,ey),n&&this.transport.bindLogger(n,"info"),this.client=(0,tN.createClient)(this.transport,this.serverId,{eagerlyConnect:!1,connectOnInvoke:!1,handshakeOptions:(0,tN.createClientHandshakeOptions)(eg,async()=>await s())});const p=new Set;this.transport.addEventListener("sessionTransition",e=>{this.is("closed","error")||("NoConnection"!==e.state&&p.delete(e.id),"Connected"===e.state?this.status.set("connected"):this.transport.reconnectOnConnectionDrop?this.status.set("connecting"):this.status.set("disconnected"))}),this.transport.addEventListener("sessionStatus",e=>{this.is("closed","error")||("created"===e.status?p.add(e.session.id):"closed"===e.status&&(p.has(e.session.id)&&"closed"!==this.transport.getStatus()&&this.log?.("detected zombie session",{clientId:this.clientId,sessionId:e.session.id},"error"),p.delete(e.session.id),this.transport.reconnectOnConnectionDrop?this.status.set("connecting"):this.status.set("disconnected")))}),this.transport.addEventListener("protocolError",e=>{if(e.type===ed.ProtocolError.HandshakeFailed)return void this.log?.("river handshake failed",{clientId:this.clientId},"error");if(e.type===ed.ProtocolError.RetriesExceeded){this.log?.("river retry limit exceeded",{clientId:this.clientId},"error"),this.transport.reconnectOnConnectionDrop=!1,this.transport.retryBudget.startRestoringBudget(),"visible"===document.visibilityState&&o?.(e);return}this.error(),a?.(e)});{const e=()=>!this.is("closed","error")&&(0,tU.isBrowserOnline)(),n=()=>{let t=this.transport.reconnectOnConnectionDrop,n=e();this.transport.reconnectOnConnectionDrop=n,t&&!n&&this.is("connecting")&&this.status.set("disconnected"),n&&this.is("disconnected")&&this.connect()};this.transport.reconnectOnConnectionDrop=e(),document.addEventListener("visibilitychange",n),window.addEventListener("online",n),window.addEventListener("offline",n),this.dispose=()=>{document.removeEventListener("visibilitychange",n),window.removeEventListener("online",n),window.removeEventListener("offline",n)},e()&&!1!==t&&this.connect()}!0===t&&this.connect()}is(...e){return e.includes(this.status.current)}connect(){if(this.is("closed","error"))throw Error(`Cannot connect to a ${this.status.current} ChortRiverConnection`);this.is("connected","connecting")||(this.status.set("connecting"),this.transport.connect(this.serverId))}error(){this.is("closed","error")||(this.status.set("error"),this.transport.close(),this.dispose?.(),this.dispose=null)}async drained(e=1e4){let t=setTimeout(()=>{t=null},e);for(;null!==t&&0!==this.transport.sessions.size;){let e=!1;for(let t of this.transport.sessions.values())if(t.sendBuffer.some(e=>(1&e.controlFlags)!=1)){e=!0;break}if(e){await new Promise(e=>setTimeout(e,100));continue}break}return clearTimeout(t),null!==t}close(){this.is("closed","error")||(this.status.set("closed"),this.transport.close(),this.dispose?.(),this.dispose=null)}}e.s(["ChortRiverConnection",()=>tP],187822);var tw=e.i(386962);class tj{clientId;serverId;log;status;transport;client;dispose=null;connect;constructor({userId:e,logger:t,getEndpoint:n,getToken:i,isClientActiveObservable:s,overrideWebsocket:r,onProtocolError:a,onRetriesExceeded:o}){this.clientId=`${e}-${tA()}`,this.serverId=eu,this.log=t??null,this.status=new tk.ObservableState("disconnected"),this.transport=new tD.WebSocketClientTransport(r?async()=>r((await n()).toString()):async()=>new WebSocket((await n()).toString()),this.clientId,ey),t&&this.transport.bindLogger(t,"info"),this.client=(0,tN.createClient)(this.transport,this.serverId,{eagerlyConnect:!1,connectOnInvoke:!1,handshakeOptions:(0,tN.createClientHandshakeOptions)(eg,async()=>await i())}),this.transport.addEventListener("sessionTransition",e=>{this.is("closed","error")||("Connected"===e.state?this.status.set("connected"):"NoConnection"===e.state?this.status.set("disconnected"):this.status.set("connecting"))});const p=(0,tw.setupRiverTransport)({logContext:{target:"chort"},transport:this.transport,serverId:this.serverId,isClientActiveObservable:s,onRetryBudgetExhausted:()=>{o?.({type:ed.ProtocolError.RetriesExceeded,message:"Retry budget exhausted"})},onProtocolError:e=>{this.error(),a?.(e)},log:t});this.dispose=p.dispose,this.connect=p.connect}is(...e){return e.includes(this.status.current)}error(){this.is("closed","error")||(this.status.set("error"),this.transport.close(),this.dispose?.(),this.dispose=null)}async drained(e=1e4){let t=setTimeout(()=>{t=null},e);for(;null!==t&&0!==this.transport.sessions.size;){let e=!1;for(let t of this.transport.sessions.values())if(t.sendBuffer.some(e=>(1&e.controlFlags)!=1)){e=!0;break}if(e){await new Promise(e=>setTimeout(e,100));continue}break}return clearTimeout(t),null!==t}close(){this.is("closed","error")||(this.status.set("closed"),this.transport.close(),this.dispose?.(),this.dispose=null)}}e.s(["ChortRiverConnection",()=>tj],943673);let tM=e.i(221042).default.env.CHORT_HOST_OVERRIDE||null,tL="chort-development-endpoint-override",t_="chort-use-ai-chat-proxy",tx={production:"wss://production-chort.replit.com/api/river",staging:"wss://staging-chort.replit.com/api/river",development:"ws://127.0.0.1:8100/api/river"};function tB(e){try{e?window.localStorage.setItem(tL,e):window.localStorage.removeItem(tL)}catch{}}function tF(){try{return window.localStorage.getItem(tL)||null}catch{return null}}function t$(){try{let e=window.localStorage.getItem(t_);if(null===e)return null;return"true"===e}catch{return null}}function tG(e){try{null===e?window.localStorage.removeItem(t_):window.localStorage.setItem(t_,e?"true":"false")}catch{}}function tq(e){if(tM)return console.warn("chort: using environment endpoint override",tM),`ws://${tM}:8100/api/river`;{let e=tF();if(e)return console.warn("chort: using development endpoint override",e),e}return tx[e]}function tV(e){return tq(e).replace("/api/river","/api/river-chat")}e.s(["CHORT_ENDPOINTS",0,tx,"CHORT_ENVIRONMENT_HOST_OVERRIDE",0,tM,"getChatProxyEndpoint",()=>tV,"getChortEndpoint",()=>tq,"getChortLocalEndpointOverride",()=>tF,"getUseChatProxyOverride",()=>t$,"setChortLocalEndpointOverride",()=>tB,"setUseChatProxyOverride",()=>tG],170039);let tW="remove",tK="replace",tH=Symbol.for("__MUTATIVE_PROXY_DRAFT__"),tz=Symbol("__MUTATIVE_RAW_RETURN_SYMBOL__"),tY=Symbol.iterator,tQ={mutable:"mutable",immutable:"immutable"},tX={};function tJ(e,t){return e instanceof Map?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function tZ(e,t){if(t in e){let n=Reflect.getPrototypeOf(e);for(;n;){let e=Reflect.getOwnPropertyDescriptor(n,t);if(e)return e;n=Reflect.getPrototypeOf(n)}}}function t0(e){return Object.getPrototypeOf(e)===Set.prototype}function t1(e){return Object.getPrototypeOf(e)===Map.prototype}function t2(e){var t;return null!=(t=e.copy)?t:e.original}function t3(e){return!!t6(e)}function t6(e){return"object"!=typeof e?null:null==e?void 0:e[tH]}function t8(e){var t;let n=t6(e);return n?null!=(t=n.copy)?t:n.original:e}function t4(e,t){let n;return!!e&&"object"==typeof e&&(Object.getPrototypeOf(e)===Object.prototype||Array.isArray(e)||e instanceof Map||e instanceof Set||!!(null==t?void 0:t.mark)&&((n=t.mark(e,tQ))===tQ.immutable||"function"==typeof n))}function t5(e){return Array.isArray(e)?1:e instanceof Map?2:3*(e instanceof Set)}function t9(e,t){return 2===t5(e)?e.get(t):e[t]}function t7(e,t,n){2===t5(e)?e.set(t,n):e[t]=n}function ne(e,t){let n=t6(e);return(n?t2(n):e)[t]}function nt(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}function nn(e){if(e)for(;e.finalities.revoke.length>0;)e.finalities.revoke.pop()()}function ni(e,t){return t?e:[""].concat(e).map(e=>{let t=`${e}`;return -1===t.indexOf("/")&&-1===t.indexOf("~")?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}).join("/")}let ns=Object.prototype.propertyIsEnumerable;function nr(e,t){let n;if(Array.isArray(e))return Array.prototype.concat.call(e);if(e instanceof Set)return t0(e)?Set.prototype.difference?Set.prototype.difference.call(e,new Set):new Set(e.values()):new(Object.getPrototypeOf(e)).constructor(e.values());if(e instanceof Map)return t1(e)?new Map(e):new(Object.getPrototypeOf(e)).constructor(e);if((null==t?void 0:t.mark)&&void 0!==(n=t.mark(e,tQ))&&n!==tQ.mutable){if(n===tQ.immutable){let t;return t=Object.create(Object.getPrototypeOf(e)),Reflect.ownKeys(e).forEach(n=>{let i=Reflect.getOwnPropertyDescriptor(e,n);if(i.enumerable&&i.configurable&&i.writable){t[n]=e[n];return}i.writable||(i.writable=!0,i.configurable=!0),(i.get||i.set)&&(i={configurable:!0,writable:!0,enumerable:i.enumerable,value:e[n]}),Reflect.defineProperty(t,n,i)}),t}if("function"==typeof n){if(t.enablePatches||t.enableAutoFreeze)throw Error("You can't use mark and patches or auto freeze together.");return n()}throw Error(`Unsupported mark result: ${n}`)}if("object"==typeof e&&Object.getPrototypeOf(e)===Object.prototype){let t={};return Object.keys(e).forEach(n=>{t[n]=e[n]}),Object.getOwnPropertySymbols(e).forEach(n=>{ns.call(e,n)&&(t[n]=e[n])}),t}else throw Error("Please check mark() to ensure that it is a stable marker draftable function.")}function na(e){e.copy||(e.copy=nr(e.original,e.options))}function no(e){if(!t4(e))return t8(e);if(Array.isArray(e))return e.map(no);if(e instanceof Map){let t=Array.from(e.entries()).map(([e,t])=>[e,no(t)]);return t1(e)?new Map(t):new(Object.getPrototypeOf(e)).constructor(t)}if(e instanceof Set){let t=Array.from(e).map(no);return t0(e)?new Set(t):new(Object.getPrototypeOf(e)).constructor(t)}let t=Object.create(Object.getPrototypeOf(e));for(let n in e)t[n]=no(e[n]);return t}function np(e){return t3(e)?no(e):e}function nl(e){var t;e.assignedMap=null!=(t=e.assignedMap)?t:new Map,!e.operated&&(e.operated=!0,e.parent&&nl(e.parent))}function nd(){throw Error("Cannot modify frozen object")}function nc(e,t){let n=t5(e);if(0===n)Reflect.ownKeys(e).forEach(n=>{t(n,e[n],e)});else if(1===n){let n=0;for(let i of e)t(n,i,e),n+=1}else e.forEach((n,i)=>t(i,n,e))}function nu(e){3===e.type&&e.copy&&(e.copy.clear(),e.setMap.forEach(t=>{e.copy.add(t8(t))}))}function nT(e,t,n,i){if(e.operated&&e.assignedMap&&e.assignedMap.size>0&&!e.finalized){if(n&&i){let s=function e(t,n=[]){if(Object.hasOwnProperty.call(t,"key")){let e=t.parent.copy,i=t6(t9(e,t.key));if(null!==i&&(null==i?void 0:i.original)!==t.original)return null;let s=3===t.parent.type,r=s?Array.from(t.parent.setMap.keys()).indexOf(t.key):t.key;if(!(s&&e.size>r||tJ(e,r)))return null;n.push(r)}if(t.parent)return e(t.parent,n);n.reverse();try{var i=t.copy,s=n;for(let e=0;e<s.length-1;e+=1){let t=s[e];if("object"!=typeof(i=t9(3===t5(i)?Array.from(i):i,t)))throw Error(`Cannot resolve patch at '${s.join("/")}'.`)}}catch(e){return null}return n}(e);s&&t(e,s,n,i)}e.finalized=!0}}function ny(e,t,n,i){let s=t6(n);s&&(s.callbacks||(s.callbacks=[]),s.callbacks.push((r,a)=>{var o;let p=3===e.type?e.setMap:e.copy;if(nt(t9(p,t),n)){let n=s.original;s.copy&&(n=s.copy),nu(e),nT(e,i,r,a),e.options.enableAutoFreeze&&(e.options.updatedValues=null!=(o=e.options.updatedValues)?o:new WeakMap,e.options.updatedValues.set(n,s.original)),t7(p,t,n)}}),e.options.enableAutoFreeze&&s.finalities!==e.finalities&&(e.options.enableAutoFreeze=!1)),t4(n,e.options)&&e.finalities.draft.push(()=>{let i;nt(t9(3===e.type?e.setMap:e.copy,t),n)&&(i=3===e.type?e.setMap:e.copy,e.finalities.revoke.length>1&&e.assignedMap.get(t)&&i&&function e(t,n,i){if(t3(t)||!t4(t,i)||n.has(t)||Object.isFrozen(t))return;let s=t instanceof Set,r=s?new Map:void 0;if(n.add(t),nc(t,(a,o)=>{var p;if(t3(o)){let e=t6(o);na(e),t7(s?r:t,a,(null==(p=e.assignedMap)?void 0:p.size)||e.operated?e.copy:e.original)}else e(o,n,i)}),r){let e=Array.from(t);t.clear(),e.forEach(e=>{t.add(r.has(e)?r.get(e):e)})}}(t9(i,t),e.finalities.handledSet,e.options))})}function ng(e,t,n,i){let{pathAsArray:s=!0}=e.options.enablePatches;switch(e.type){case 0:case 2:return function({original:e,copy:t,assignedMap:n},i,s,r,a){n.forEach((n,o)=>{let p=t9(e,o),l=np(t9(t,o)),d=n?tJ(e,o)?tK:"add":tW;if(nt(p,l)&&d===tK)return;let c=ni(i.concat(o),a);s.push(d===tW?{op:d,path:c}:{op:d,path:c,value:l}),r.push("add"===d?{op:tW,path:c}:d===tW?{op:"add",path:c,value:p}:{op:tK,path:c,value:p})})}(e,t,n,i,s);case 1:return function(e,t,n,i,s){let{original:r,assignedMap:a,options:o}=e,p=e.copy;p.length<r.length&&([r,p]=[p,r],[n,i]=[i,n]);for(let e=0;e<r.length;e+=1)if(a.get(e.toString())&&p[e]!==r[e]){let a=ni(t.concat([e]),s);n.push({op:tK,path:a,value:np(p[e])}),i.push({op:tK,path:a,value:np(r[e])})}for(let e=r.length;e<p.length;e+=1){let i=ni(t.concat([e]),s);n.push({op:"add",path:i,value:np(p[e])})}if(r.length<p.length){let{arrayLengthAssignment:e=!0}=o.enablePatches;if(e){let e=ni(t.concat(["length"]),s);i.push({op:tK,path:e,value:r.length})}else for(let e=p.length;r.length<e;e-=1){let n=ni(t.concat([e-1]),s);i.push({op:tW,path:n})}}}(e,t,n,i,s);case 3:return function({original:e,copy:t},n,i,s,r){let a=0;e.forEach(e=>{if(!t.has(e)){let t=ni(n.concat([a]),r);i.push({op:tW,path:t,value:e}),s.unshift({op:"add",path:t,value:e})}a+=1}),a=0,t.forEach(t=>{if(!e.has(t)){let e=ni(n.concat([a]),r);i.push({op:"add",path:e,value:t}),s.unshift({op:tW,path:e,value:t})}a+=1})}(e,t,n,i,s)}}let nh=(e,t,n=!1)=>{if("object"==typeof e&&null!==e&&(!t4(e,t)||n)&&1)throw Error("Strict mode: Mutable data cannot be accessed directly, please use 'unsafe(callback)' wrap.")},nf={get size(){return t2(t6(this)).size},has(e){return t2(t6(this)).has(e)},set(e,t){let n=t6(this),i=t2(n);return i.has(e)&&nt(i.get(e),t)||(na(n),nl(n),n.assignedMap.set(e,!0),n.copy.set(e,t),ny(n,e,t,ng)),this},delete(e){if(!this.has(e))return!1;let t=t6(this);return na(t),nl(t),t.original.has(e)?t.assignedMap.set(e,!1):t.assignedMap.delete(e),t.copy.delete(e),!0},clear(){let e=t6(this);if(this.size){for(let[t]of(na(e),nl(e),e.assignedMap=new Map,e.original))e.assignedMap.set(t,!1);e.copy.clear()}},forEach(e,t){t2(t6(this)).forEach((n,i)=>{e.call(t,this.get(i),i,this)})},get(e){var t,n;let i=t6(this),s=t2(i).get(e),r=(null==(n=(t=i.options).mark)?void 0:n.call(t,s,tQ))===tQ.mutable;if(i.options.strict&&nh(s,i.options,r),r||i.finalized||!t4(s,i.options)||s!==i.original.get(e))return s;let a=tX.createDraft({original:s,parentDraft:i,key:e,finalities:i.finalities,options:i.options});return na(i),i.copy.set(e,a),a},keys(){return t2(t6(this)).keys()},values(){let e=this.keys();return{[tY]:()=>this.values(),next:()=>{let t=e.next();return t.done?t:{done:!1,value:this.get(t.value)}}}},entries(){let e=this.keys();return{[tY]:()=>this.entries(),next:()=>{let t=e.next();if(t.done)return t;let n=this.get(t.value);return{done:!1,value:[t.value,n]}}}},[tY](){return this.entries()}},nm=Reflect.ownKeys(nf),nS=(e,t,{isValuesIterator:n})=>()=>{var i,s;let r=t.next();if(r.done)return r;let a=r.value,o=e.setMap.get(a),p=t6(o),l=(null==(s=(i=e.options).mark)?void 0:s.call(i,o,tQ))===tQ.mutable;if(e.options.strict&&nh(a,e.options,l),!l&&!p&&t4(a,e.options)&&!e.finalized&&e.original.has(a)){let t=tX.createDraft({original:a,parentDraft:e,key:a,finalities:e.finalities,options:e.options});e.setMap.set(a,t),o=t}else p&&(o=p.proxy);return{done:!1,value:n?o:[o,o]}},nE={get size(){return t6(this).setMap.size},has(e){let t=t6(this);if(t.setMap.has(e))return!0;na(t);let n=t6(e);return!!(n&&t.setMap.has(n.original))},add(e){let t=t6(this);return this.has(e)||(na(t),nl(t),t.assignedMap.set(e,!0),t.setMap.set(e,e),ny(t,e,e,ng)),this},delete(e){if(!this.has(e))return!1;let t=t6(this);na(t),nl(t);let n=t6(e);return n&&t.setMap.has(n.original)?(t.assignedMap.set(n.original,!1),t.setMap.delete(n.original)):(!n&&t.setMap.has(e)?t.assignedMap.set(e,!1):t.assignedMap.delete(e),t.setMap.delete(e))},clear(){if(!this.size)return;let e=t6(this);for(let t of(na(e),nl(e),e.original))e.assignedMap.set(t,!1);e.setMap.clear()},values(){let e=t6(this);na(e);let t=e.setMap.keys();return{[Symbol.iterator]:()=>this.values(),next:nS(e,t,{isValuesIterator:!0})}},entries(){let e=t6(this);na(e);let t=e.setMap.keys();return{[Symbol.iterator]:()=>this.entries(),next:nS(e,t,{isValuesIterator:!1})}},keys(){return this.values()},[tY](){return this.values()},forEach(e,t){let n=this.values(),i=n.next();for(;!i.done;)e.call(t,i.value,i.value,this),i=n.next()}};Set.prototype.difference&&Object.assign(nE,{intersection(e){return Set.prototype.intersection.call(new Set(this.values()),e)},union(e){return Set.prototype.union.call(new Set(this.values()),e)},difference(e){return Set.prototype.difference.call(new Set(this.values()),e)},symmetricDifference(e){return Set.prototype.symmetricDifference.call(new Set(this.values()),e)},isSubsetOf(e){return Set.prototype.isSubsetOf.call(new Set(this.values()),e)},isSupersetOf(e){return Set.prototype.isSupersetOf.call(new Set(this.values()),e)},isDisjointFrom(e){return Set.prototype.isDisjointFrom.call(new Set(this.values()),e)}});let nv=Reflect.ownKeys(nE),nR=new WeakSet,nb={get(e,t,n){var i,s;let r,a=null==(i=e.copy)?void 0:i[t];if(a&&nR.has(a))return a;if(t===tH)return e;if(e.options.mark){let i="size"===t&&(e.original instanceof Map||e.original instanceof Set)?Reflect.get(e.original,t):Reflect.get(e.original,t,n);if((r=e.options.mark(i,tQ))===tQ.mutable)return e.options.strict&&nh(i,e.options,!0),i}let o=t2(e);if(o instanceof Map&&nm.includes(t)){if("size"===t)return Object.getOwnPropertyDescriptor(nf,"size").get.call(e.proxy);let n=nf[t];if(n)return n.bind(e.proxy)}if(o instanceof Set&&nv.includes(t)){if("size"===t)return Object.getOwnPropertyDescriptor(nE,"size").get.call(e.proxy);let n=nE[t];if(n)return n.bind(e.proxy)}if(!tJ(o,t)){let n=tZ(o,t);return n?"value"in n?n.value:null==(s=n.get)?void 0:s.call(e.proxy):void 0}let p=o[t];if(e.options.strict&&nh(p,e.options),e.finalized||!t4(p,e.options))return p;if(p===ne(e.original,t)){if(na(e),e.copy[t]=nO({original:e.original[t],parentDraft:e,key:1===e.type?Number(t):t,finalities:e.finalities,options:e.options}),"function"==typeof r){let n=t6(e.copy[t]);return na(n),nl(n),n.copy}return e.copy[t]}return p},set(e,t,n){var i;let s;if(3===e.type||2===e.type)throw Error("Map/Set draft does not support any property assignment.");if(1===e.type&&"length"!==t&&!(Number.isInteger(s=Number(t))&&s>=0&&(0===t||0===s||String(s)===String(t))))throw Error("Only supports setting array indices and the 'length' property.");let r=tZ(t2(e),t);if(null==r?void 0:r.set)return r.set.call(e.proxy,n),!0;let a=ne(t2(e),t),o=t6(a);return o&&nt(o.original,n)?(e.copy[t]=n,e.assignedMap=null!=(i=e.assignedMap)?i:new Map,e.assignedMap.set(t,!1),!0):!!(nt(n,a)&&(void 0!==n||tJ(e.original,t)))||(na(e),nl(e),tJ(e.original,t)&&nt(n,e.original[t])?e.assignedMap.delete(t):e.assignedMap.set(t,!0),e.copy[t]=n,ny(e,t,n,ng),!0)},has:(e,t)=>t in t2(e),ownKeys:e=>Reflect.ownKeys(t2(e)),getOwnPropertyDescriptor(e,t){let n=t2(e),i=Reflect.getOwnPropertyDescriptor(n,t);return i?{writable:!0,configurable:1!==e.type||"length"!==t,enumerable:i.enumerable,value:n[t]}:i},getPrototypeOf:e=>Reflect.getPrototypeOf(e.original),setPrototypeOf(){throw Error("Cannot call 'setPrototypeOf()' on drafts")},defineProperty(){throw Error("Cannot call 'defineProperty()' on drafts")},deleteProperty(e,t){var n;return 1===e.type?nb.set.call(this,e,t,void 0,e.proxy):(void 0!==ne(e.original,t)||t in e.original?(na(e),nl(e),e.assignedMap.set(t,!1)):(e.assignedMap=null!=(n=e.assignedMap)?n:new Map,e.assignedMap.delete(t)),e.copy&&delete e.copy[t],!0)}};function nO(e){let{original:t,parentDraft:n,key:i,finalities:s,options:r}=e,a=t5(t),o={type:a,finalized:!1,parent:n,original:t,copy:null,proxy:null,finalities:s,options:r,setMap:3===a?new Map(t.entries()):void 0};(i||"key"in e)&&(o.key=i);let{proxy:p,revoke:l}=Proxy.revocable(1===a?Object.assign([],o):o,nb);if(s.revoke.push(l),nR.add(p),o.proxy=p,n)n.finalities.draft.push((e,t)=>{var s,r;let a=t6(p),o=3===n.type?n.setMap:n.copy,l=t9(o,i),d=t6(l);if(d){let r=d.original;d.operated&&(r=t8(l)),nu(d),nT(d,ng,e,t),n.options.enableAutoFreeze&&(n.options.updatedValues=null!=(s=n.options.updatedValues)?s:new WeakMap,n.options.updatedValues.set(r,d.original)),t7(o,i,r)}null==(r=a.callbacks)||r.forEach(n=>{n(e,t)})});else{let e=t6(p);e.finalities.draft.push((t,n)=>{nu(e),nT(e,ng,t,n)})}return p}function nC(e){let{rootDraft:t,value:n,useRawReturn:i=!1,isRoot:s=!0}=e;nc(n,(n,i,s)=>{let r=t6(i);if(r&&t&&r.finalities===t.finalities){e.isContainDraft=!0;let t=r.original;if(s instanceof Set){let e=Array.from(s);s.clear(),e.forEach(e=>s.add(n===e?t:e))}else t7(s,n,t)}else"object"==typeof i&&null!==i&&(e.value=i,e.isRoot=!1,nC(e))}),s&&(e.isContainDraft||console.warn("The return value does not contain any draft, please use 'rawReturn()' to wrap the return value to improve performance."),i&&console.warn("The return value contains drafts, please don't use 'rawReturn()' to wrap the return value."))}function nI(e){if(!t3(e))throw Error(`current() is only used for Draft, parameter: ${e}`);return function e(t){var n;let i,s=t6(t);if(!t4(t,null==s?void 0:s.options))return t;let r=t5(t);if(s&&!s.operated)return s.original;function a(){i=2===r?t1(t)?new Map(t):new(Object.getPrototypeOf(t)).constructor(t):3===r?Array.from(s.setMap.values()):nr(t,null==s?void 0:s.options)}if(s){s.finalized=!0;try{a()}finally{s.finalized=!1}}else i=t;if(nc(i,(n,r)=>{if(s&&nt(t9(s.original,n),r))return;let o=e(r);o!==r&&(i===t&&a(),t7(i,n,o))}),3===r){let e=null!=(n=null==s?void 0:s.original)?n:i;return t0(e)?new Set(i):new(Object.getPrototypeOf(e)).constructor(i)}return i}(e)}tX.createDraft=nO;let nA=(e=>{if(void 0!==e&&"[object Object]"!==Object.prototype.toString.call(e))throw Error(`Invalid options: ${String(e)}, 'options' should be an object.`);return function t(n,i,s){var r,a,o,p;let l,d,c,u,T;if("function"==typeof n&&"function"!=typeof i)return function(e,...s){return t(e,e=>n.call(this,e,...s),i)};let y=s;if("function"!=typeof i&&(y=i),void 0!==y&&"[object Object]"!==Object.prototype.toString.call(y))throw Error(`Invalid options: ${y}, 'options' should be an object.`);y=Object.assign(Object.assign({},e),y);let g=t3(n)?nI(n):n,h=Array.isArray(y.mark)?(e,t)=>{for(let n of y.mark){if("function"!=typeof n)throw Error(`Invalid mark: ${n}, 'mark' should be a function.`);let i=n(e,t);if(i)return i}}:y.mark,f=null!=(r=y.enablePatches)&&r,m=null!=(a=y.strict)&&a,S={enableAutoFreeze:null!=(o=y.enableAutoFreeze)&&o,mark:h,strict:m,enablePatches:f};if(!t4(g,S)&&"object"==typeof g&&null!==g)throw Error("Invalid base state: create() only supports plain objects, arrays, Set, Map or using mark() to mark the state as immutable.");let[E,v]=(u={draft:[],revoke:[],handledSet:new WeakSet},S.enablePatches&&(d=[],c=[]),[T=(null==(p=S.mark)?void 0:p.call(S,g,tQ))!==tQ.mutable&&t4(g,S)?nO({original:g,parentDraft:null,finalities:u,options:S}):g,(e=[])=>{let[t,n,i]=function(e,t,n,i,s){var r;let a=t6(e),o=null!=(r=null==a?void 0:a.original)?r:e,p=!!t.length;if(null==a?void 0:a.operated)for(;a.finalities.draft.length>0;)a.finalities.draft.pop()(n,i);let l=p?t[0]:a?a.operated?a.copy:a.original:e;return a&&nn(a),s&&function e(t,n,i,s,r){{i=null!=i?i:new WeakMap,s=null!=s?s:[],r=null!=r?r:[];let e=i.has(t)?i.get(t):t;if(s.length>0){let t=s.indexOf(e);if(e&&"object"==typeof e&&-1!==t){if(s[0]===e)throw Error("Forbids circular reference");throw Error(`Forbids circular reference: ~/${r.slice(0,t).map((e,t)=>{if("symbol"==typeof e)return`[${e.toString()}]`;let n=s[t];return"object"==typeof e&&(n instanceof Map||n instanceof Set)?Array.from(n.keys()).indexOf(e):e}).join("/")}`)}s.push(e),r.push(n)}else s.push(e)}if(Object.isFrozen(t)||t3(t)){s.pop(),r.pop();return}switch(t5(t)){case 2:for(let[n,a]of t)e(n,n,i,s,r),e(a,n,i,s,r);t.set=t.clear=t.delete=nd;break;case 3:for(let n of t)e(n,n,i,s,r);t.add=t.clear=t.delete=nd;break;case 1:Object.freeze(t);let a=0;for(let n of t)e(n,a,i,s,r),a+=1;break;default:Object.freeze(t),Object.keys(t).forEach(n=>{e(t[n],n,i,s,r)})}s.pop(),r.pop()}(l,l,null==a?void 0:a.options.updatedValues),[l,n&&p?[{op:tK,path:[],value:t[0]}]:n,i&&p?[{op:tK,path:[],value:o}]:i]}(T,e,d,c,S.enableAutoFreeze);return S.enablePatches?[t,n,i]:t}]);if("function"!=typeof i){if(!t4(g,S))throw Error("Invalid base state: create() only supports plain objects, arrays, Set, Map or using mark() to mark the state as immutable.");return[E,v]}try{l=i(E)}catch(e){throw nn(t6(E)),e}let R=e=>{let t=t6(E);if(!t3(e)){if(void 0!==e&&!nt(e,E)&&(null==t?void 0:t.operated))throw Error("Either the value is returned as a new non-draft value, or only the draft is modified without returning any value.");let n=null==e?void 0:e[tz];if(n){let i=n[0];return S.strict&&"object"==typeof e&&null!==e&&nC({rootDraft:t,value:e,useRawReturn:!0}),v([i])}if(void 0!==e)return"object"==typeof e&&null!==e&&nC({rootDraft:t,value:e}),v([e])}if(e===E||void 0===e)return v([]);let n=t6(e);if(S===n.options){if(n.operated)throw Error("Cannot return a modified child draft.");return v([nI(e)])}return v([e])};return l instanceof Promise?l.then(R,e=>{throw nn(t6(E)),e}):R(l)}})();function nU(e,t,n){let i;for(i=t.length-1;i>=0;i-=1){let{value:n,op:s,path:r}=t[i];if(!r.length&&s===tK||""===r&&"add"===s){e=n;break}}i>-1&&(t=t.slice(i+1));let s=e=>{t.forEach(t=>{let{path:n,op:i}=t,s=Array.isArray(n)?n:n.split("/").map(e=>e.replace(/~1/g,"/").replace(/~0/g,"~")).slice(1),r=e;for(let e=0;e<s.length-1;e+=1){let t=t5(r),n=s[e];if("string"!=typeof n&&"number"!=typeof n&&(n=String(n)),(0===t||1===t)&&("__proto__"===n||"constructor"===n)||"function"==typeof r&&"prototype"===n)throw Error("Patching reserved attributes like __proto__ and constructor is not allowed.");if("object"!=typeof(r=t9(3===t?Array.from(r):r,n)))throw Error(`Cannot apply patch at '${s.join("/")}'.`)}let a=t5(r),o=no(t.value),p=s[s.length-1];switch(i){case tK:switch(a){case 2:return r.set(p,o);case 3:throw Error("Cannot apply replace patch to set.");default:return r[p]=o}case"add":switch(a){case 1:return"-"===p?r.push(o):r.splice(p,0,o);case 2:return r.set(p,o);case 3:return r.add(o);default:return r[p]=o}case tW:switch(a){case 1:return r.splice(p,1);case 2:return r.delete(p);case 3:return r.delete(t.value);default:return delete r[p]}default:throw Error(`Unsupported patch operation: ${i}.`)}})};if(t3(e)){if(void 0!==n)throw Error("Cannot apply patches with options to a draft.");return s(e),e}return nA(e,s,Object.assign(Object.assign({},n),{enablePatches:!1}))}Object.prototype.constructor.toString(),e.s(["apply",()=>nU,"create",()=>nA,"isDraftable",()=>t4],281128);let nk=ec.Type.Object({path:ec.Type.Union([ec.Type.String(),ec.Type.Array(ec.Type.Union([ec.Type.Number(),ec.Type.String()]))]),op:ec.Type.Union([ec.Type.Literal("replace"),ec.Type.Literal("add"),ec.Type.Literal("remove")]),value:ec.Type.Optional(ec.Type.Any())});function nN(e){let t=!1;return{async *[Symbol.asyncIterator](){if(t)throw Error("stream has already been consumed");let n=e.resReadable[Symbol.asyncIterator](),i=null,s=!1;for(t=!0;;){let e=await n.next();if(e.done){if(null===i&&!s)throw Error("Unexpected: no snapshot was yielded");break}if(!e.value.ok){s=!0,yield(0,tN.Err)(e.value.payload);continue}if(null===i){if(!("snapshot"in e.value.payload))throw Error("Unexpected: initial result is not a snapshot");i=(0,tN.Ok)(e.value.payload.snapshot),yield i;continue}if(!("delta"in e.value.payload))throw Error("Unexpected: follow-up result is not a delta");let t=nU(i.payload,e.value.payload.delta);i.payload!==t&&(i=(0,tN.Ok)(t),yield i)}}}}ec.Type.Array(nk),e.s(["getSnapshotStream",()=>nN],813702);let nD=ec.Type.Object({id:ec.Type.String(),title:ec.Type.String(),sessionType:ty,sessionCreationEventId:ec.Type.String(),archived:ec.Type.Boolean(),readOnly:ec.Type.Boolean(),taskId:ec.Type.String(),created:ec.Type.Date(),updated:ec.Type.Date(),revertedToSessionId:ec.Type.Union([ec.Type.String(),ec.Type.Null()]),revertedToEventId:ec.Type.Union([ec.Type.String(),ec.Type.Null()])});e.s(["SessionDataSchema",0,nD],957410);var nP=((ep={})[ep.SUBREPL_RUN_UNKNOWN=0]="SUBREPL_RUN_UNKNOWN",ep[ep.SUBREPL_RUN_READY=1]="SUBREPL_RUN_READY",ep[ep.SUBREPL_RUN_DISPOSED=2]="SUBREPL_RUN_DISPOSED",ep);let nw=ec.Type.Module({GetRequest:ec.Type.Object({id:ec.Type.String()}),CreateRequest:ec.Type.Object({replId:ec.Type.String(),metadata:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("SubreplRunMetadata"),ec.Type.Undefined()]))}),UpdateRequest:ec.Type.Object({id:ec.Type.String(),metadata:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("SubreplRunMetadata"),ec.Type.Undefined()]))}),DisposeRequest:ec.Type.Object({id:ec.Type.String()}),SubreplRun:ec.Type.Object({id:ec.Type.String(),replId:ec.Type.String(),subreplId:ec.Type.String(),state:ec.Type.Ref("SubreplRunState"),metadata:ec.Type.Optional(ec.Type.Union([ec.Type.Ref("SubreplRunMetadata"),ec.Type.Undefined()])),createdAt:ec.Type.Optional(ec.Type.Union([ec.Type.Date(),ec.Type.Undefined()])),updatedAt:ec.Type.Optional(ec.Type.Union([ec.Type.Date(),ec.Type.Undefined()]))}),SubreplRunState:ec.Type.Enum(nP),SubreplRunMetadata:ec.Type.Object({progressSummary:ec.Type.Optional(ec.Type.Union([ec.Type.String(),ec.Type.Undefined()]))})});nw.Import("GetRequest"),nw.Import("CreateRequest"),nw.Import("UpdateRequest"),nw.Import("DisposeRequest"),nw.Import("SubreplRun"),nw.Import("SubreplRunState");let nj=nw.Import("SubreplRunMetadata");var nM=((el={}).READY="READY",el.DISPOSED="DISPOSED",el);let nL=ec.Type.Enum(nM);ec.Type.Object({id:ec.Type.String(),replId:ec.Type.String(),subreplId:ec.Type.String(),state:nL,metadata:nj,createdAt:ec.Type.Date(),updatedAt:ec.Type.Date()}),e.s(["SubreplRunState",()=>nM],986684),ed.ProtocolError,e.s([],660670)},952098,e=>{"use strict";e.i(221042);var t=e.i(389959),n=e.i(830675),i=e.i(131141),s=e.i(161322),r=e.i(735744),a=e.i(17886);e.i(660670);var o=e.i(711566),o=o,p=e.i(792129),p=p,l=e.i(187822),d=e.i(943673),d=d,c=e.i(351677),u=e.i(170039),T=e.i(993796),y=e.i(98816),g=e.i(289074),h=e.i(664152);let f=window.location.search.includes("aiChatDebug=1"),m=(e,t,i)=>{f&&console[i??"info"]("[chort] "+e,t),h.logger[i??"info"](e,{river:t,riverTarget:"chort",riverVersion:p.version}),t?.tags?.includes("invariant-violation")&&n.withScope(i=>{i.setTag("chort",!0),i.setExtras(t),n.captureException(Error(e))})};function S(){let e="production";return(0,a.isEnvProduction)()||(e="staging"),(0,u.getChortEndpoint)(e)}function E(){let e="production";return(0,a.isEnvProduction)()||(e="staging"),(0,u.getChatProxyEndpoint)(e)}function v({replId:e,userId:n,onRetriesExceeded:a,onProtocolError:p}){let[u,h]=(0,t.useState)(null),f=(0,y.default)(a),E=(0,y.default)(p),v=(0,s.useSetAtom)(g.connectionKillActionsAtom),R=(0,r.default)(),b=(0,T.useFlag)({controlName:"flag-new-connection-manager",type:"boolean",default:!1});return(0,t.useEffect)(()=>{let t={userId:n,logger:m,isClientActiveObservable:R,getEndpoint:async()=>S(),getToken:async()=>(0,c.fetchChortAuthToken)(n,e),onProtocolError:e=>{E.current?.(e)},onRetriesExceeded:e=>{f.current?.(e)}},s=b?new d.ChortRiverConnection(t):new l.ChortRiverConnection(t);return h(s),v((0,i.produce)(e=>{e.chort={label:"Close WebSocket",action:()=>{let e=s.transport.sessions.get(o.RIVER_SERVER_ID);e?.state!=="Connected"?console.warn("Cannot close WebSocket: session is not connected"):(console.log("chort: closing WebSocket connection",e.conn.ws),e.conn.ws.close())}}})),()=>{h(null),s.drained().then(()=>s.close()),v((0,i.produce)(e=>{e.chort=null}))}},[e,n,f,E,b,v,R]),u}e.s(["getCurrentChatProxyEndpoint",()=>E,"getCurrentChortEndpoint",()=>S,"useCreateChortRiverConnection",()=>v],952098)},435106,58828,35438,710961,e=>{"use strict";var t,n=e.i(179104);e.i(977195);var i=e.i(590467);e.i(242933);var s=e.i(790164),r=e.i(845466),a=new TextEncoder,o=new TextDecoder,p=e.i(726753),l=e.i(770663),d={toBuffer:e=>(0,l.encode)(e,{ignoreUndefined:!0}),fromBuffer:e=>{try{let t=(0,p.decode)(e);if("object"!=typeof t)return null;return t}catch{return null}}};e.s(["BinaryCodec",()=>d],58828);var c={debug:-1,info:0,warn:1,error:2},u=e=>(t,n)=>{if(!n?.transportMessage)return void e(t,n);let{payload:i,...s}=n.transportMessage;n.transportMessage=s,e(t,n)},T=class{minLevel;output;constructor(e,t="info"){this.minLevel=t,this.output=e}debug(e,t){c[this.minLevel]<=c.debug&&this.output(e,t??{},"debug")}info(e,t){c[this.minLevel]<=c.info&&this.output(e,t??{},"info")}warn(e,t){c[this.minLevel]<=c.warn&&this.output(e,t??{},"warn")}error(e,t){c[this.minLevel]<=c.error&&this.output(e,t??{},"error")}},y=e=>({debug:u(e.debug.bind(e)),info:u(e.info.bind(e)),warn:u(e.warn.bind(e)),error:u(e.error.bind(e))}),g=e.i(434989),h=e.i(892280),f=e.i(862927),m=e.i(884348),S={heartbeatIntervalMs:1e3,heartbeatsUntilDead:2,sessionDisconnectGraceMs:5e3,connectionTimeoutMs:2e3,handshakeTimeoutMs:1e3,enableTransparentSessionReconnects:!0,codec:{toBuffer:e=>a.encode(JSON.stringify(e,function(e){let t,n=this[e];if(!(n instanceof Uint8Array))return n;return{$t:(t="",n.forEach(e=>{t+=String.fromCharCode(e)}),btoa(t))}})),fromBuffer:e=>{try{let t=JSON.parse(o.decode(e),function(e,t){return t?.$t?function(e){let t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}(t.$t):t});if("object"==typeof t)return t;return null}catch{return null}}}},E={...S,baseIntervalMs:150,maxJitterMs:200,maxBackoffMs:32e3,attemptBudgetCapacity:5,budgetRestoreIntervalMs:200};({...S});var v=((t=v||{}).NoConnection="NoConnection",t.BackingOff="BackingOff",t.Connecting="Connecting",t.Handshaking="Handshaking",t.Connected="Connected",t.WaitingForHandshake="WaitingForHandshake",t),R="session state has been consumed and is no longer valid",b=class{_isConsumed;close(){this._handleClose()}constructor(){return this._isConsumed=!1,new Proxy(this,{get(e,t){if("_isConsumed"===t||"id"===t||"state"===t)return Reflect.get(e,t);if("_handleStateExit"===t)return()=>{e._isConsumed=!0,e._handleStateExit()};if("_handleClose"===t)return()=>{e._isConsumed=!0,e._handleStateExit(),e._handleClose()};if(e._isConsumed)throw Error(`${R}: getting ${t.toString()} on consumed state`);return Reflect.get(e,t)},set(e,t,n){if(e._isConsumed)throw Error(`${R}: setting ${t.toString()} on consumed state`);return Reflect.set(e,t,n)}})}},O=class extends b{from;options;log;constructor({from:e,options:t,log:n}){super(),this.from=e,this.options=t,this.log=n}parseMsg(e){let t=this.options.codec.fromBuffer(e);if(null===t){let t=new TextDecoder().decode(g.Buffer.from(e));return this.log?.error(`received malformed msg: ${t}`,this.loggingMetadata),null}return f.Value.Check(h.OpaqueTransportMessageSchema,t)?t:(this.log?.error(`received invalid msg: ${JSON.stringify(t)}`,{...this.loggingMetadata,validationErrors:[...f.Value.Errors(h.OpaqueTransportMessageSchema,t)]}),null)}},C=class extends O{id;telemetry;to;seq;ack;sendBuffer;constructor(e){const{id:t,to:n,seq:i,ack:s,sendBuffer:r,telemetry:a,log:o}=e;super(e),this.id=t,this.to=n,this.seq=i,this.ack=s,this.sendBuffer=r,this.telemetry=a,this.log=o}get loggingMetadata(){let e=this.telemetry.span.spanContext(),t={clientId:this.from,connectedTo:this.to,sessionId:this.id};return this.telemetry.span.isRecording()&&(t.telemetry={traceId:e.traceId,spanId:e.spanId}),t}constructMsg(e){let t={...e,id:(0,h.generateId)(),to:this.to,from:this.from,seq:this.seq,ack:this.ack};return this.seq++,t}nextSeq(){return this.sendBuffer.length>0?this.sendBuffer[0].seq:this.seq}send(e){let t=this.constructMsg(e);return this.sendBuffer.push(t),t.id}_handleStateExit(){}_handleClose(){this.sendBuffer.length=0,this.telemetry.span.end()}},I=class extends C{graceExpiryTime;gracePeriodTimeout;listeners;constructor(e){super(e),this.listeners=e.listeners,this.graceExpiryTime=e.graceExpiryTime,this.gracePeriodTimeout=setTimeout(()=>{this.listeners.onSessionGracePeriodElapsed()},this.graceExpiryTime-Date.now())}_handleStateExit(){super._handleStateExit(),this.gracePeriodTimeout&&(clearTimeout(this.gracePeriodTimeout),this.gracePeriodTimeout=void 0)}_handleClose(){super._handleClose()}},A=class extends I{state="Connecting";connPromise;listeners;connectionTimeout;constructor(e){super(e),this.connPromise=e.connPromise,this.listeners=e.listeners,this.connPromise.then(e=>{this._isConsumed||this.listeners.onConnectionEstablished(e)},e=>{this._isConsumed||this.listeners.onConnectionFailed(e)}),this.connectionTimeout=setTimeout(()=>{this.listeners.onConnectionTimeout()},this.options.connectionTimeoutMs)}bestEffortClose(){let e=this.log,t=this.loggingMetadata;this.connPromise.then(n=>{n.close(),e?.info("connection eventually resolved but session has transitioned, closed connection",{...t,...n.loggingMetadata})}).catch(()=>{})}_handleStateExit(){super._handleStateExit(),this.connectionTimeout&&(clearTimeout(this.connectionTimeout),this.connectionTimeout=void 0)}_handleClose(){this.bestEffortClose(),super._handleClose()}},U=class extends I{state="NoConnection";_handleClose(){super._handleClose()}_handleStateExit(){super._handleStateExit()}},k=class extends I{state="Handshaking";conn;listeners;handshakeTimeout;constructor(e){super(e),this.conn=e.conn,this.listeners=e.listeners,this.handshakeTimeout=setTimeout(()=>{this.listeners.onHandshakeTimeout()},this.options.handshakeTimeoutMs),this.conn.addDataListener(this.onHandshakeData),this.conn.addErrorListener(this.listeners.onConnectionErrored),this.conn.addCloseListener(this.listeners.onConnectionClosed)}get loggingMetadata(){return{...super.loggingMetadata,...this.conn.loggingMetadata}}onHandshakeData=e=>{let t=this.parseMsg(e);null===t?this.listeners.onInvalidHandshake("could not parse message","MALFORMED_HANDSHAKE"):this.listeners.onHandshake(t)};sendHandshake(e){return this.conn.send(this.options.codec.toBuffer(e))}_handleStateExit(){super._handleStateExit(),this.conn.removeDataListener(this.onHandshakeData),this.conn.removeErrorListener(this.listeners.onConnectionErrored),this.conn.removeCloseListener(this.listeners.onConnectionClosed),this.handshakeTimeout&&(clearTimeout(this.handshakeTimeout),this.handshakeTimeout=void 0)}_handleClose(){super._handleClose(),this.conn.close()}},N=class extends C{state="Connected";conn;listeners;heartbeatHandle;heartbeatMisses=0;isActivelyHeartbeating;updateBookkeeping(e,t){this.sendBuffer=this.sendBuffer.filter(t=>t.seq>=e),this.ack=t+1,this.heartbeatMisses=0}send(e){let t=this.constructMsg(e);return this.sendBuffer.push(t),this.conn.send(this.options.codec.toBuffer(t)),t.id}constructor(e){if(super(e),this.conn=e.conn,this.listeners=e.listeners,this.conn.addDataListener(this.onMessageData),this.conn.addCloseListener(this.listeners.onConnectionClosed),this.conn.addErrorListener(this.listeners.onConnectionErrored),this.sendBuffer.length>0)for(const e of(this.log?.info(`sending ${this.sendBuffer.length} buffered messages, starting at seq ${this.nextSeq()}`,this.loggingMetadata),this.sendBuffer))this.conn.send(this.options.codec.toBuffer(e));this.isActivelyHeartbeating=!1,this.heartbeatHandle=setInterval(()=>{let e=this.heartbeatMisses,t=e*this.options.heartbeatIntervalMs;if(e>=this.options.heartbeatsUntilDead){this.log?.info(`closing connection to ${this.to} due to inactivity (missed ${e} heartbeats which is ${t}ms)`,this.loggingMetadata),this.telemetry.span.addEvent("closing connection due to inactivity"),this.conn.close(),clearInterval(this.heartbeatHandle),this.heartbeatHandle=void 0;return}this.isActivelyHeartbeating&&this.sendHeartbeat(),this.heartbeatMisses++},this.options.heartbeatIntervalMs)}get loggingMetadata(){return{...super.loggingMetadata,...this.conn.loggingMetadata}}startActiveHeartbeat(){this.isActivelyHeartbeating=!0}sendHeartbeat(){this.log?.debug("sending heartbeat",this.loggingMetadata),this.send({streamId:"heartbeat",controlFlags:1,payload:{type:"ACK"}})}closeConnection(){this.conn.removeDataListener(this.onMessageData),this.conn.removeCloseListener(this.listeners.onConnectionClosed),this.conn.removeErrorListener(this.listeners.onConnectionErrored),this.conn.close()}onMessageData=e=>{let t=this.parseMsg(e);if(null===t)return void this.listeners.onInvalidMessage("could not parse message");if(t.seq!==this.ack){if(t.seq<this.ack)this.log?.debug(`received duplicate msg (got seq: ${t.seq}, wanted seq: ${this.ack}), discarding`,{...this.loggingMetadata,transportMessage:t});else{let e=`received out-of-order msg, closing connection (got seq: ${t.seq}, wanted seq: ${this.ack})`;this.log?.warn(e,{...this.loggingMetadata,transportMessage:t,tags:["invariant-violation"]}),this.telemetry.span.setStatus({code:m.SpanStatusCode.ERROR,message:e}),this.closeConnection()}return}(this.log?.debug("received msg",{...this.loggingMetadata,transportMessage:t}),this.updateBookkeeping(t.ack,t.seq),(0,h.isAck)(t.controlFlags))?(this.log?.debug("discarding msg (ack bit set)",{...this.loggingMetadata,transportMessage:t}),this.isActivelyHeartbeating||this.sendHeartbeat()):this.listeners.onMessage(t)};_handleStateExit(){super._handleStateExit(),this.conn.removeDataListener(this.onMessageData),this.conn.removeCloseListener(this.listeners.onConnectionClosed),this.conn.removeErrorListener(this.listeners.onConnectionErrored),this.heartbeatHandle&&(clearInterval(this.heartbeatHandle),this.heartbeatHandle=void 0)}_handleClose(){super._handleClose(),this.conn.close()}},D=class extends I{state="BackingOff";listeners;backoffTimeout;constructor(e){super(e),this.listeners=e.listeners,this.backoffTimeout=setTimeout(()=>{this.listeners.onBackoffFinished()},e.backoffMs)}_handleClose(){super._handleClose()}_handleStateExit(){super._handleStateExit(),this.backoffTimeout&&(clearTimeout(this.backoffTimeout),this.backoffTimeout=void 0)}};function P(e){return{id:e.id,from:e.from,to:e.to,seq:e.seq,ack:e.ack,sendBuffer:e.sendBuffer,telemetry:e.telemetry,options:e.options,log:e.log}}function w(e){return{...P(e),graceExpiryTime:e.graceExpiryTime}}var j=(e,t,n,i,s)=>{let r=`session-${(0,h.generateId)()}`,a=(0,h.createSessionTelemetryInfo)(r,e,t),o=new U({listeners:n,id:r,from:t,to:e,seq:0,ack:0,graceExpiryTime:Date.now()+i.sessionDisconnectGraceMs,sendBuffer:[],telemetry:a,options:i,log:s});return o.log?.info(`session ${o.id} created in NoConnection state`,{...o.loggingMetadata,tags:["state-transition"]}),o},M={NoConnectionToBackingOff:(e,t,n)=>{let i=w(e);e._handleStateExit();let s=new D({backoffMs:t,listeners:n,...i});return s.log?.info(`session ${s.id} transition from NoConnection to BackingOff`,{...s.loggingMetadata,tags:["state-transition"]}),s},BackingOffToConnecting:(e,t,n)=>{let i=w(e);e._handleStateExit();let s=new A({connPromise:t,listeners:n,...i});return s.log?.info(`session ${s.id} transition from BackingOff to Connecting`,{...s.loggingMetadata,tags:["state-transition"]}),s},ConnectingToHandshaking:(e,t,n)=>{let i=w(e);e._handleStateExit();let s=new k({conn:t,listeners:n,...i});return s.log?.info(`session ${s.id} transition from Connecting to Handshaking`,{...s.loggingMetadata,tags:["state-transition"]}),s},HandshakingToConnected:(e,t)=>{let n=P(e),i=e.conn;e._handleStateExit();let s=new N({conn:i,listeners:t,...n});return s.log?.info(`session ${s.id} transition from Handshaking to Connected`,{...s.loggingMetadata,tags:["state-transition"]}),s},WaitingForHandshakeToConnected:(e,t,n,i,s,r)=>{let a=e.conn,{from:o,options:p}=e,l=t?P(t):{id:n,from:o,to:i,seq:0,ack:0,sendBuffer:[],telemetry:(0,h.createSessionTelemetryInfo)(n,i,o,s),options:p,log:e.log};e._handleStateExit(),t?._handleStateExit();let d=new N({conn:a,listeners:r,...l});return d.log?.info(`session ${d.id} transition from WaitingForHandshake to Connected`,{...d.loggingMetadata,tags:["state-transition"]}),d},BackingOffToNoConnection:(e,t)=>{let n=w(e);e._handleStateExit();let i=new U({listeners:t,...n});return i.log?.info(`session ${i.id} transition from BackingOff to NoConnection`,{...i.loggingMetadata,tags:["state-transition"]}),i},ConnectingToNoConnection:(e,t)=>{let n=w(e);e.bestEffortClose(),e._handleStateExit();let i=new U({listeners:t,...n});return i.log?.info(`session ${i.id} transition from Connecting to NoConnection`,{...i.loggingMetadata,tags:["state-transition"]}),i},HandshakingToNoConnection:(e,t)=>{let n=w(e);e.conn.close(),e._handleStateExit();let i=new U({listeners:t,...n});return i.log?.info(`session ${i.id} transition from Handshaking to NoConnection`,{...i.loggingMetadata,tags:["state-transition"]}),i},ConnectedToNoConnection:(e,t)=>{let n=P(e),i=Date.now()+e.options.sessionDisconnectGraceMs;e.conn.close(),e._handleStateExit();let s=new U({listeners:t,graceExpiryTime:i,...n});return s.log?.info(`session ${s.id} transition from Connected to NoConnection`,{...s.loggingMetadata,tags:["state-transition"]}),s}},L={entrypoint:j,transition:{NoConnectionToBackingOff:M.NoConnectionToBackingOff,BackingOffToConnecting:M.BackingOffToConnecting,ConnectingToHandshaking:M.ConnectingToHandshaking,HandshakingToConnected:M.HandshakingToConnected,BackingOffToNoConnection:M.BackingOffToNoConnection,ConnectingToNoConnection:M.ConnectingToNoConnection,HandshakingToNoConnection:M.HandshakingToNoConnection,ConnectedToNoConnection:M.ConnectedToNoConnection}};M.WaitingForHandshakeToConnected,M.ConnectedToNoConnection;var _={RetriesExceeded:"conn_retry_exceeded",HandshakeFailed:"handshake_failed",MessageOrderingViolated:"message_ordering_violated",InvalidMessage:"invalid_message"},x=class{eventListeners={};removeAllListeners(){this.eventListeners={}}numberOfListeners(e){return this.eventListeners[e]?.size??0}addEventListener(e,t){this.eventListeners[e]||(this.eventListeners[e]=new Set),this.eventListeners[e]?.add(t)}removeEventListener(e,t){this.eventListeners[e]&&this.eventListeners[e]?.delete(t)}dispatchEvent(e,t){let n=this.eventListeners[e];if(n)for(let e of[...n])e(t)}},B=class{status;clientId;eventDispatcher;options;log;sessions;constructor(e,t){this.options={...S,...t},this.eventDispatcher=new x,this.clientId=e,this.status="open",this.sessions=new Map}bindLogger(e,t){if("function"==typeof e){this.log=y(new T(e,t));return}this.log=y(e)}handleMsg(e){"open"===this.getStatus()&&this.eventDispatcher.dispatchEvent("message",e)}addEventListener(e,t){this.eventDispatcher.addEventListener(e,t)}removeEventListener(e,t){this.eventDispatcher.removeEventListener(e,t)}protocolError(e){this.eventDispatcher.dispatchEvent("protocolError",e)}close(){for(let e of(this.status="closed",this.sessions.values()))this.deleteSession(e);this.eventDispatcher.dispatchEvent("transportStatus",{status:this.status}),this.eventDispatcher.removeAllListeners(),this.log?.info("manually closed transport",{clientId:this.clientId})}getStatus(){return this.status}updateSession(e){let t=this.sessions.get(e.to);if(t&&t.id!==e.id)throw Error(`attempt to transition active session for ${e.to} but active session (${t.id}) is different from handle (${e.id})`);return this.sessions.set(e.to,e),t||this.eventDispatcher.dispatchEvent("sessionStatus",{status:"connect",session:e}),this.eventDispatcher.dispatchEvent("sessionTransition",{state:e.state,session:e}),e}deleteSession(e,t){if(e._isConsumed)return;let n=e.loggingMetadata;n.tags&&t?.unhealthy&&n.tags.push("unhealthy-session"),e.log?.info(`closing session ${e.id}`,n),this.eventDispatcher.dispatchEvent("sessionStatus",{status:"disconnect",session:e});let i=e.to;e.close(),this.sessions.delete(i)}onSessionGracePeriodElapsed(e){this.log?.warn(`session to ${e.to} grace period elapsed, closing`,e.loggingMetadata),this.deleteSession(e)}onConnectingFailed(e){let t=M.ConnectingToNoConnection(e,{onSessionGracePeriodElapsed:()=>{this.onSessionGracePeriodElapsed(t)}});return this.updateSession(t)}onConnClosed(e){let t;return t="Handshaking"===e.state?M.HandshakingToNoConnection(e,{onSessionGracePeriodElapsed:()=>{this.onSessionGracePeriodElapsed(t)}}):M.ConnectedToNoConnection(e,{onSessionGracePeriodElapsed:()=>{this.onSessionGracePeriodElapsed(t)}}),this.updateSession(t)}},F=class{id;telemetry;constructor(){this.id=`conn-${(0,h.generateId)()}`}get loggingMetadata(){let e={connId:this.id},t=this.telemetry?.span.spanContext();return this.telemetry?.span.isRecording()&&t&&(e.telemetry={traceId:t.traceId,spanId:t.spanId}),e}_dataListeners=new Set;_closeListeners=new Set;_errorListeners=new Set;get dataListeners(){return[...this._dataListeners]}get closeListeners(){return[...this._closeListeners]}get errorListeners(){return[...this._errorListeners]}addDataListener(e){this._dataListeners.add(e)}removeDataListener(e){this._dataListeners.delete(e)}addCloseListener(e){this._closeListeners.add(e)}removeCloseListener(e){this._closeListeners.delete(e)}addErrorListener(e){this._errorListeners.add(e)}removeErrorListener(e){this._errorListeners.delete(e)}};e.s(["Connection",()=>F,"ProtocolError",()=>_,"Transport",()=>B],35438);var $=class{budgetConsumed;intervalHandle;options;constructor(e){this.options=e,this.budgetConsumed=0}getBackoffMs(){if(0===this.getBudgetConsumed())return 0;let e=Math.max(0,this.getBudgetConsumed()-1),t=Math.floor(Math.random()*this.options.maxJitterMs);return Math.min(this.options.baseIntervalMs*2**e,this.options.maxBackoffMs)+t}get totalBudgetRestoreTime(){return this.options.budgetRestoreIntervalMs*this.options.attemptBudgetCapacity}consumeBudget(){this.stopLeak(),this.budgetConsumed=this.getBudgetConsumed()+1}getBudgetConsumed(){return this.budgetConsumed}hasBudget(){return this.getBudgetConsumed()<this.options.attemptBudgetCapacity}startRestoringBudget(){if(this.intervalHandle)return;let e=()=>{let e=this.budgetConsumed;if(!e)return void this.stopLeak();let t=e-1;0!==t&&(this.budgetConsumed=t)};this.intervalHandle=setInterval(e,this.options.budgetRestoreIntervalMs)}stopLeak(){this.intervalHandle&&(clearInterval(this.intervalHandle),this.intervalHandle=void 0)}close(){this.stopLeak()}},G=class extends B{options;retryBudget;reconnectOnConnectionDrop=!0;handshakeExtensions;sessions;constructor(e,t){super(e,t),this.sessions=new Map,this.options={...E,...t},this.retryBudget=new $(this.options)}extendHandshake(e){this.handshakeExtensions=e}tryReconnecting(e){let t=this.sessions.get(e);!this.options.enableTransparentSessionReconnects&&t&&this.deleteSession(t),this.reconnectOnConnectionDrop&&"open"===this.getStatus()&&this.connect(e)}send(e,t){if("closed"===this.getStatus()){let e="transport is closed, cant send";throw this.log?.error(e,{clientId:this.clientId,transportMessage:t,tags:["invariant-violation"]}),Error(e)}let n=this.sessions.get(e);return n||(n=this.createUnconnectedSession(e)),n.send(t)}createUnconnectedSession(e){let t=L.entrypoint(e,this.clientId,{onSessionGracePeriodElapsed:()=>{this.onSessionGracePeriodElapsed(t)}},this.options,this.log);return this.updateSession(t),t}onConnectingFailed(e){let t=super.onConnectingFailed(e);return this.tryReconnecting(t.to),t}onConnClosed(e){let t=super.onConnClosed(e);return this.tryReconnecting(t.to),t}onConnectionEstablished(e,t){let n=L.transition.ConnectingToHandshaking(e,t,{onConnectionErrored:e=>{let t=(0,h.coerceErrorString)(e);this.log?.error(`connection to ${n.to} errored during handshake: ${t}`,n.loggingMetadata)},onConnectionClosed:()=>{this.log?.warn(`connection to ${n.to} closed during handshake`,n.loggingMetadata),this.onConnClosed(n)},onHandshake:e=>{this.onHandshakeResponse(n,e)},onInvalidHandshake:(t,i)=>{this.log?.error(`invalid handshake: ${t}`,n.loggingMetadata),this.deleteSession(e,{unhealthy:!0}),this.protocolError({type:_.HandshakeFailed,code:i,message:t})},onHandshakeTimeout:()=>{this.log?.error(`connection to ${n.to} timed out during handshake`,n.loggingMetadata),this.onConnClosed(n)},onSessionGracePeriodElapsed:()=>{this.onSessionGracePeriodElapsed(n)}});return this.updateSession(n),this.sendHandshake(n),n}rejectHandshakeResponse(e,t,n){e.conn.telemetry?.span.setStatus({code:m.SpanStatusCode.ERROR,message:t}),this.log?.warn(t,n),this.deleteSession(e,{unhealthy:!0})}onHandshakeResponse(e,t){if(!f.Value.Check(h.ControlMessageHandshakeResponseSchema,t.payload))return void this.rejectHandshakeResponse(e,"received invalid handshake response",{...e.loggingMetadata,transportMessage:t,validationErrors:[...f.Value.Errors(h.ControlMessageHandshakeResponseSchema,t.payload)]});if(!t.payload.status.ok){let n=f.Value.Check(h.HandshakeErrorRetriableResponseCodes,t.payload.status.code),i=`handshake failed: ${t.payload.status.reason}`,s=e.to;this.rejectHandshakeResponse(e,i,{...e.loggingMetadata,transportMessage:t}),n?this.tryReconnecting(s):this.protocolError({type:_.HandshakeFailed,code:t.payload.status.code,message:i});return}if(t.payload.status.sessionId!==e.id){let n=`session id mismatch: expected ${e.id}, got ${t.payload.status.sessionId}`;this.rejectHandshakeResponse(e,n,{...e.loggingMetadata,transportMessage:t});return}this.log?.info(`handshake from ${t.from} ok`,{...e.loggingMetadata,transportMessage:t});let n=L.transition.HandshakingToConnected(e,{onConnectionErrored:e=>{let t=(0,h.coerceErrorString)(e);this.log?.warn(`connection to ${n.to} errored: ${t}`,n.loggingMetadata)},onConnectionClosed:()=>{this.log?.info(`connection to ${n.to} closed`,n.loggingMetadata),this.onConnClosed(n)},onMessage:e=>this.handleMsg(e),onInvalidMessage:e=>{this.deleteSession(n,{unhealthy:!0}),this.protocolError({type:_.InvalidMessage,message:e})}});this.updateSession(n),this.retryBudget.startRestoringBudget()}connect(e){if("open"!==this.getStatus())return void this.log?.info(`transport state is no longer open, cancelling attempt to connect to ${e}`);let t=this.sessions.get(e);if("NoConnection"!==(t??=this.createUnconnectedSession(e)).state)return void this.log?.debug(`session to ${e} has state ${t.state}, skipping connect attempt`,t.loggingMetadata);if(!this.retryBudget.hasBudget()){let n=this.retryBudget.getBudgetConsumed(),i=`tried to connect to ${e} but retry budget exceeded (more than ${n} attempts in the last ${this.retryBudget.totalBudgetRestoreTime}ms)`;this.log?.error(i,t.loggingMetadata),this.protocolError({type:_.RetriesExceeded,message:i});return}let n=this.retryBudget.getBackoffMs();this.log?.info(`attempting connection to ${e} (${n}ms backoff)`,t.loggingMetadata),this.retryBudget.consumeBudget();let i=L.transition.NoConnectionToBackingOff(t,n,{onBackoffFinished:()=>{this.onBackoffFinished(i)},onSessionGracePeriodElapsed:()=>{this.onSessionGracePeriodElapsed(i)}});this.updateSession(i)}onBackoffFinished(e){let t=h.tracing_default.startActiveSpan("connect",async t=>{try{return await this.createNewOutgoingConnection(e.to)}catch(n){let e=(0,h.coerceErrorString)(n);throw t.recordException(e),t.setStatus({code:m.SpanStatusCode.ERROR}),n}finally{t.end()}}),n=L.transition.BackingOffToConnecting(e,t,{onConnectionEstablished:e=>{this.log?.debug(`connection to ${n.to} established`,{...e.loggingMetadata,...n.loggingMetadata}),this.onConnectionEstablished(n,e)},onConnectionFailed:e=>{let t=(0,h.coerceErrorString)(e);this.log?.error(`error connecting to ${n.to}: ${t}`,n.loggingMetadata),this.onConnectingFailed(n)},onConnectionTimeout:()=>{this.log?.error(`connection to ${n.to} timed out`,n.loggingMetadata),this.onConnectingFailed(n)},onSessionGracePeriodElapsed:()=>{this.onSessionGracePeriodElapsed(n)}});this.updateSession(n)}async sendHandshake(e){let t;if(this.handshakeExtensions&&(t=await this.handshakeExtensions.construct()),e._isConsumed)return;let n=(0,h.handshakeRequestMessage)({from:this.clientId,to:e.to,sessionId:e.id,expectedSessionState:{nextExpectedSeq:e.ack,nextSentSeq:e.nextSeq()},metadata:t,tracing:(0,h.getPropagationContext)(e.telemetry.ctx)});this.log?.debug(`sending handshake request to ${e.to}`,{...e.loggingMetadata,transportMessage:n}),e.sendHandshake(n)}close(){this.retryBudget.close(),super.close()}},q=class extends F{ws;extras;get loggingMetadata(){let e=super.loggingMetadata;return this.extras&&(e.extras=this.extras),e}constructor(e,t){super(),this.ws=e,this.extras=t,this.ws.binaryType="arraybuffer";let n=!1;this.ws.onerror=()=>{n=!0},this.ws.onclose=({code:e,reason:t})=>{if(n){let n=Error(`websocket closed with code and reason: ${e} - ${t}`);for(let e of this.errorListeners)e(n)}for(let e of this.closeListeners)e()},this.ws.onmessage=e=>{for(let t of this.dataListeners)t(e.data)}}send(e){return this.ws.readyState===this.ws.OPEN&&(this.ws.send(e),!0)}close(){this.ws.close(1e3)}},V=class extends G{wsGetter;constructor(e,t,n){super(t,n),this.wsGetter=e}async createNewOutgoingConnection(e){this.log?.info(`establishing a new websocket to ${e}`,{clientId:this.clientId,connectedTo:e});let t=await this.wsGetter(e);await new Promise((e,n)=>{t.readyState===t.OPEN?e():t.readyState===t.CLOSING||t.readyState===t.CLOSED?n(Error("ws is closing or closed")):(t.onopen=()=>{e()},t.onclose=e=>{n(Error(e.reason))},t.onerror=e=>{n(Error(e.message))})});let n=new q(t);return this.log?.info(`raw websocket to ${e} ok`,{clientId:this.clientId,connectedTo:e,...n.loggingMetadata}),n}};function W(e){throw Error(`Unhandled discriminated union member: ${JSON.stringify(e)}`)}e.s(["WebSocketClientTransport",()=>V],710961);let K={codec:d,heartbeatIntervalMs:2500,heartbeatsUntilDead:40,enableTransparentSessionReconnects:!1,connectionTimeoutMs:1e4,handshakeTimeoutMs:15e3,sessionDisconnectGraceMs:15e3,baseIntervalMs:250,maxJitterMs:500,maxBackoffMs:32e3,attemptBudgetCapacity:5,budgetRestoreIntervalMs:2e3};class H{clientId;serverId;log;transport;#e;#t;session;dispose=null;constructor({clientId:e,serverId:t,connectImmediately:n,logger:a,getEndpoint:o,overrideWebsocket:p,onProtocolError:l,onRetriesExceeded:d}){this.clientId=e,this.serverId=t,this.log=a??null;const c={};this.transport=new V(async()=>{let e=Date.now(),t=p?p((await o()).toString()):new WebSocket((await o()).toString());return this.log?.("ai-chat: ws open",{extras:{duration:Date.now()-e}}),t},this.clientId,K),a&&this.transport.bindLogger(a,"info"),this.session=new s.ObservableState(null),this.#e=new s.ObservableState("disconnected"),this.#t=(0,r.createClient)(this.transport,t,{eagerlyConnect:!1,connectOnInvoke:!1});let u=!1;this.transport.addEventListener("sessionTransition",e=>{"NoConnection"!==e.state&&(u=!0),"BackingOff"===e.state||("Connecting"===e.state?(c.connectionStart=Date.now(),this.log?.("ai-chat: connecting",{clientId:this.clientId})):"Handshaking"===e.state?(c.handshakeStart=Date.now(),this.log?.("ai-chat: handshaking",{clientId:this.clientId})):"Connected"===e.state?(c.connectionStart&&c.handshakeStart&&this.log?.("ai-chat: connected",{clientId:this.clientId,extras:{...c,connectionDuration:c.handshakeStart-c.connectionStart,handshakeDuration:Date.now()-c.handshakeStart,totalDuration:Date.now()-c.connectionStart}}),c.connectionStart=void 0,c.handshakeStart=void 0):"NoConnection"===e.state?(this.log?.("ai-chat: no connection",{clientId:this.clientId}),c.connectionStart=void 0,c.handshakeStart=void 0):W(e)),this.is("closed","error")||("Connected"===e.state?(this.session.set(this.transport.sessions.values().next().value??null),this.#e.set("connected")):(this.session.set(null),this.transport.reconnectOnConnectionDrop?this.#e.set("connecting"):this.#e.set("disconnected")))}),this.transport.addEventListener("sessionStatus",e=>{"connect"===e.status?(u=!1,c.sessionStart=Date.now(),this.log?.("ai-chat: session started",{sessionId:e.session.id,clientId:this.clientId})):"disconnect"===e.status?(u||"closed"===this.transport.getStatus()||this.log?.("detected zombie session",{clientId:this.clientId,sessionId:e.session.id},"error"),c.sessionStart&&this.log?.("ai-chat: session ended",{sessionId:e.session.id,clientId:this.clientId,extras:{sessionDuration:Date.now()-c.sessionStart}})):W(e.status),this.is("closed","error")||"disconnect"===e.status&&(this.session.set(null),this.transport.reconnectOnConnectionDrop?this.status.set("connecting"):this.status.set("disconnected"))}),this.transport.addEventListener("protocolError",t=>{t.type===_.HandshakeFailed&&this.log?.("river handshake failed",{clientId:e},"error"),t.type===_.RetriesExceeded?(this.log?.("ai-chat: retry budget exhausted",{clientId:e},"error"),this.transport.reconnectOnConnectionDrop=!1,this.transport.retryBudget.startRestoringBudget(),"visible"===document.visibilityState&&d?.(t)):(this.error(),l?.(t))});{const e=()=>!this.is("closed","error")&&(0,i.isBrowserOnline)(),t=()=>{let t=this.transport.reconnectOnConnectionDrop,n=e();this.transport.reconnectOnConnectionDrop=n,t&&!n&&!this.session.current&&this.is("connecting")&&this.#e.set("disconnected"),n&&this.is("disconnected")&&this.connect()};this.transport.reconnectOnConnectionDrop=e(),document.addEventListener("visibilitychange",t),window.addEventListener("online",t),window.addEventListener("offline",t),this.dispose=()=>{document.removeEventListener("visibilitychange",t),window.removeEventListener("online",t),window.removeEventListener("offline",t)},e()&&!1!==n&&this.connect()}!0===n&&this.connect()}get status(){return this.#e}get service(){return this.#t.chatService}is(...e){return e.includes(this.#e.current)}connect(){if(this.is("closed","error"))throw Error(`Cannot connect to a ${this.#e.current} ChatConnection`);this.is("connected","connecting")||(this.#e.set("connecting"),this.transport.connect(this.serverId))}error(){this.is("closed","error")||(this.#e.set("error"),this.transport.close(),this.dispose?.(),this.dispose=null)}async drained(e=1e4){let t=setTimeout(()=>{t=null},e);for(;null!==t&&0!==this.transport.sessions.size;){let e=!1;for(let t of this.transport.sessions.values())if(t.sendBuffer.some(e=>(1&e.controlFlags)!=1)){e=!0;break}if(e){await new Promise(e=>setTimeout(e,100));continue}break}return clearTimeout(t),null!==t}close(){this.is("closed","error")||(this.#e.set("closed"),this.transport.close(),this.dispose?.(),this.dispose=null)}}function z({currentUserId:e}){return`chat-client-${e}-${(0,n.nanoid)()}`}e.s(["ChatConnection",()=>H,"createClientId",()=>z],435106)},600637,416143,63846,924908,885505,e=>{"use strict";var t=e.i(389959),n=e.i(830675),i=e.i(131141),s=e.i(161322),r=e.i(435106);e.i(242933);var a=e.i(790164),o=e.i(845466),p=e.i(386962),l=e.i(58828),d=e.i(35438),c=e.i(710961);let u={...{codec:l.BinaryCodec,heartbeatIntervalMs:2500,heartbeatsUntilDead:40,enableTransparentSessionReconnects:!1,connectionTimeoutMs:1e4,handshakeTimeoutMs:15e3,sessionDisconnectGraceMs:15e3},baseIntervalMs:250,maxJitterMs:500,maxBackoffMs:32e3,attemptBudgetCapacity:5,budgetRestoreIntervalMs:2e3};class T{clientId;serverId;log;transport;#e;#t;dispose=null;connect;constructor({clientId:e,serverId:t,logger:n,getEndpoint:i,isClientActiveObservable:s,overrideWebsocket:r,onProtocolError:l,onRetriesExceeded:T}){this.clientId=e,this.serverId=t,this.log=n??null,this.transport=new c.WebSocketClientTransport(async()=>{let e=Date.now(),t=r?r((await i()).toString()):new WebSocket((await i()).toString());return this.log?.("ai-chat: ws open",{extras:{duration:Date.now()-e}}),t},this.clientId,u),n&&this.transport.bindLogger(n,"info"),this.#e=new a.ObservableState("disconnected"),this.#t=(0,o.createClient)(this.transport,t,{eagerlyConnect:!1,connectOnInvoke:!1}),this.transport.addEventListener("sessionTransition",e=>{if(!this.is("closed","error"))switch(e.state){case"Connected":this.#e.set("connected");break;case"NoConnection":this.#e.set("disconnected");break;case"BackingOff":case"Connecting":case"Handshaking":this.#e.set("connecting")}});const y=(0,p.setupRiverTransport)({logContext:{target:"ai-chat"},transport:this.transport,serverId:this.serverId,isClientActiveObservable:s,onRetryBudgetExhausted:()=>{T?.({type:d.ProtocolError.RetriesExceeded,message:"Retry budget exhausted"})},onProtocolError:e=>{this.error(),l?.(e)},log:n});this.dispose=y.dispose,this.connect=y.connect}get status(){return this.#e}get service(){return this.#t.chatService}is(...e){return e.includes(this.#e.current)}error(){this.is("closed","error")||(this.#e.set("error"),this.transport.close(),this.dispose?.(),this.dispose=null)}async drained(e=1e4){let t=setTimeout(()=>{t=null},e);for(;null!==t&&0!==this.transport.sessions.size;){let e=!1;for(let t of this.transport.sessions.values())if(t.sendBuffer.some(e=>(1&e.controlFlags)!=1)){e=!0;break}if(e){await new Promise(e=>setTimeout(e,100));continue}break}return clearTimeout(t),null!==t}close(){this.is("closed","error")||(this.#e.set("closed"),this.transport.close(),this.dispose?.(),this.dispose=null)}}var y=e.i(892280),y=y,g=e.i(267710),h=e.i(952098),f=e.i(221042),m=e.i(17886);let S={production:"wss://production-ai-chat.replit.com/river",staging:"wss://staging-ai-chat.replit.com/river",development:"ws://127.0.0.1:8000/river"};e.s(["AiEndpoints",0,S],416143);var E=e.i(282453);let v="ghostwriter-chat-env",R=f.default.env.CHAT_SERVICE_OVERRIDE,b=E.default.get(v,"string"),O=()=>R||b||((0,m.isEnvProduction)()?S.production:S.staging);function C(e){E.default.set(v,e)}e.s(["endpointOverride",0,R,"getAiEndpoint",0,O,"setAiEndpoint",()=>C],63846);var I=e.i(735744);e.i(660670);var A=e.i(170039),U=e.i(993796),k=e.i(98816),N=e.i(289074),D=e.i(664152);let P="SERVER",w=window.location.search.includes("aiChatDebug=1");function j({endpoint:e,replId:a,currentUserId:o,orgId:p,onRetriesExceeded:l,onProtocolError:d}){let[c,u]=(0,t.useState)(null),f=(0,k.default)(l),m=(0,k.default)(d),S=(0,I.default)(),E=(0,U.useFlag)({controlName:"flag-new-connection-manager",type:"boolean",default:!1}),v=(0,U.useFlag)({controlName:"flag-use-chort-chat-proxy",type:"boolean",default:!1}),R=null!==(0,A.getUseChatProxyOverride)()?(0,A.getUseChatProxyOverride)():v,b=(0,s.useSetAtom)(N.connectionKillActionsAtom);return(0,t.useEffect)(()=>{R&&console.warn("[ai-chat] Creating connection with chat proxy enabled");let t=(0,r.createClientId)({currentUserId:o}),s={clientId:t,serverId:P,logger:(e,t,i)=>{w&&console[i??"info"]("[ai-chat]"+e,t),D.logger[i??"info"](e,{river:t,riverTarget:"ai-chat",riverVersion:y.version,riverProxied:R}),t?.tags?.includes("invariant-violation")&&n.withScope(i=>{i.setTag("ai-chat",!0),i.setTag("ai-chat-proxy",R),i.setExtras(t),n.captureException(Error(e))})},isClientActiveObservable:S,getEndpoint:async()=>{if(e)return e;if(R){let e=await (0,g.auth)(a,t,p),n=new URL((0,h.getCurrentChatProxyEndpoint)());return n.searchParams.set("auth_token",e),n}let n=await (0,g.auth)(a,t,p),i=new URL(O());return i.searchParams.set("auth_token",n),i},onProtocolError:e=>{m.current?.(e)},onRetriesExceeded:e=>{f.current?.(e)}},l=E?new T(s):new r.ChatConnection(s);return u(l),b((0,i.produce)(e=>{e["ai-chat"]={label:"Close WebSocket",action:()=>{let e=l.transport.sessions.get(P);e?.state!=="Connected"?console.warn("Cannot close WebSocket: session is not connected"):(console.log("ai-chat: closing WebSocket connection",e.conn.ws),e.conn.ws.close())}}})),()=>{u(null),l.drained().then(()=>l.close()),b((0,i.produce)(e=>{e["ai-chat"]=null}))}},[e,a,o,p,f,m,R,E,b,S]),c}e.s(["AI_CHAT_SERVER_ID",0,P,"useCreateChatConnection",()=>j],600637);var M=e.i(276385),L=e.i(719518);e.i(824359);let _=(0,t.createContext)(null);function x(e){let n=(0,t.useMemo)(()=>({store:e.store,yapper:e.yapper}),[e.store,e.yapper]);return(0,M.jsx)(_.Provider,{value:n,children:e.children})}function B(){let e=(0,t.useContext)(_);if(!e)throw Error("Expected Yapper in context");return e.yapper}function F(){let e=(0,t.useContext)(_);if(!e)throw Error("Expected Yapper in context");return e.yapper.chatter()}function $(){let e=(0,t.useContext)(_);return e?e.yapper.chatter():null}function G(e,n){let i=B(),s=(0,t.useRef)(n);s.current=n,(0,t.useEffect)(()=>i.hook(e,e=>s.current(e)),[i,e])}function q(){let e=(0,t.useContext)(_);if(!e)throw Error("Expected store in context");return e.store}function V(e){return(0,s.useAtomValue)(e,{store:q()})}function W(e){return(0,L.useAtomCallback)((0,t.useCallback)(t=>t(e),[e]),{store:q()})}e.s(["StoreProvider",()=>x,"useChatHook",()=>G,"useChatter",()=>F,"useGet",()=>W,"useMaybeChatter",()=>$,"useSet",0,e=>(0,s.useSetAtom)(e,{store:q()}),"useValue",()=>V,"useYapper",()=>B],924908);var K=e.i(960933),H=e.i(862927),z=e.i(279606);class Y{ok=!0;payload;constructor(e){this.payload=e}}let Q=K.Type.Object({code:K.Type.String(),message:K.Type.Optional(K.Type.String()),extras:K.Type.Optional(K.Type.Unknown())}),X=K.Type.Object({ok:K.Type.Literal(!1),payload:Q});class J extends Error{ok=!1;payload;input;reported;constructor(e){let t;const n={code:"UNCAUGHT_ERROR",message:"An unexpected error occurred"};if(e instanceof z.CompletionError)n.code="UNEXPECTED_DISCONNECT",n.message="Unexpected disconnect",t=e.stack;else if(e instanceof Error)n.message=e.message,t=e.stack;else if("UNEXPECTED_DISCONNECT"===e)n.code="UNEXPECTED_DISCONNECT",n.message="Unexpected disconnect";else if("UNCAUGHT_ERROR"===e)n.code="UNCAUGHT_ERROR",n.message="An unexpected error occurred";else if("string"==typeof e)n.message=e;else if(e&&"object"==typeof e){let t=null;H.Value.Check(Q,e)?t=e:H.Value.Check(X,e)&&(t=e.payload),t&&(n.code=t.code,n.message=t.message,n.extras=t.extras)}super(n.message),this.name="ChatError",this.payload=n,this.input=e,t&&(this.stack=t)}}function Z(e){return new Y(e)}function ee(e){return e instanceof J?e:new J(e)}function et(e,...t){return t.length?!e.ok&&t.includes(e.payload.code):!e.ok}function en(e){if("function"==typeof e)try{let t=e();if(t instanceof Promise)return t.then(e=>Z(e)).catch(e=>ee(e));return Z(t)}catch(e){return ee(e)}if(e instanceof Promise)return e.then(e=>Z(e)).catch(e=>ee(e));if(Array.isArray(e)){if(0===e.length)throw Error("At least one observable is required");return z.Observable.combine(...e).once().then(e=>Z(e)).catch(e=>ee(e))}return z.Observable.from(e).once().then(e=>Z(e)).catch(e=>ee(e))}e.s(["Err",()=>ee,"Ok",()=>Z,"get",()=>en,"isError",()=>et],885505)},986194,e=>{"use strict";function t(e){if(!e.$kind)throw Error("Object has an empty or undefined $kind property");if(!Object.prototype.hasOwnProperty.call(e,e.$kind))throw Error("Object has a $kind property that does not match the object");return e[e.$kind]}function n(e){let n=t(e);if("object"!=typeof n||null===n)throw Error("Contents is not an object");if("$kind"in n)throw Error("Contents has an unexpected $kind property");return{$kind:e.$kind,...n}}function i(e,t){return{$kind:e,[e]:t}}function s(e,...t){return!!e&&t.includes(e.$kind)}e.s(["isKind",()=>s,"unkind",()=>t,"unwrapKind",()=>n,"withKind",()=>i])},353838,e=>{"use strict";var t=e.i(862927),n=e.i(131141),i=e.i(986194),s=e.i(82259),r=e.i(634759);let a={messageEventContents:{messageContentsUpdate:(e,t)=>{e.content+=t.content},messageContentsSet:(e,t)=>{e.content=t.content},addSourcesUpdate:(e,t)=>{e.sources.push(...t.sources)},updateProposedFileChange:(e,t)=>{if(!(0,i.isKind)(e.extraActions,"proposedFileChanges"))return;let{changes:n}=(0,i.unkind)(e.extraActions),{Update:s,Replacement:r}=t;if(null!=s){let{filePath:e,content:t,changeSummary:i,messageContentsOffset:r,state:a}=s.update,o=n.find(t=>t.filePath===e);null!=o&&(o.content+=t,o.state=a,o.messageContentsOffset=r,i&&(o.changeSummary=i))}else if(null!=r){let{filePath:e,content:t,changeSummary:i,state:s,messageContentsOffset:a}=r.replacement,o=n.find(t=>t.filePath===e);null!=o&&(o.content=t,o.state=s,o.messageContentsOffset=a,i&&(o.changeSummary=i))}},addProposedFileChange:(e,t)=>{(0,i.isKind)(e.extraActions,"proposedFileChanges")||(e.extraActions=(0,i.withKind)("proposedFileChanges",{changes:[],commitId:"",summary:""})),e.extraActions.proposedFileChanges.commitId=t.commitId,e.extraActions.proposedFileChanges.changes.push(t.change)},addProposedFileChangesMetadata:(e,t)=>{(0,i.isKind)(e.extraActions,"proposedFileChanges")&&(e.extraActions.proposedFileChanges.summary=t.summary)},addProposedShellCommand:(e,t)=>{e.assistantProposedActions.shellCommands.push(t.command)},addProposedPackageInstall:(e,t)=>{e.assistantProposedActions.packageInstalls.push(t.packageInstalls)},addProposedWorkspaceToolNudge:(e,t)=>{e.assistantProposedActions.workspaceToolNudges.push(t.nudge)},addProposedActionsMetadata:(e,t)=>{t.commitId&&(e.assistantProposedActions.commitId=t.commitId),t.summary&&(e.assistantProposedActions.summary=t.summary),void 0!==t.didCreateCheckpoint&&(e.assistantProposedActions.didCreateCheckpoint=t.didCreateCheckpoint),t.didCountEditRequest&&(e.assistantProposedActions.didCountEditRequest=!0),(0,i.isKind)(e.extraActions,"proposedFileChanges")&&(e.extraActions.proposedFileChanges.commitId=t.commitId,e.extraActions.proposedFileChanges.summary=t.summary)},addProposedRunConfiguration:(e,t)=>{e.assistantProposedActions.runConfigurations.push(t.runConfiguration)},addProposedDeploymentConfiguration:(e,t)=>{e.assistantProposedActions.deploymentConfigurations.push(t.deploymentConfiguration)},addProposedWorkflowConfiguration:(e,t)=>{e.assistantProposedActions.workflowConfigurations.push(t.workflowConfiguration)},updateAttachedFormStringFieldAppend:(e,t)=>{o(e,t,!0)},updateAttachedFormStringFieldSet:(e,t)=>{o(e,t,!1)},addRagContext:(e,t)=>{e.ragContext=t.newContext}},inlineActionEventContents:{messageContentsUpdate:(e,t)=>{e.content+=t.content},messageContentsSet:(e,t)=>{e.content=t.content},addSourcesUpdate:(e,t)=>{e.sources.push(...t.sources)}},localShellExecutionEventContents:{localShellExecutionEventSet:(e,t)=>t.contents},shellSuggestionEventContents:{shellSuggestionContentsUpdate:(e,t)=>{e.content+=t.content}},byoPromptEventContents:{byoPromptResultUpdate:(e,t)=>{e.jsonResult=t.jsonResult}},agentTimelineEventContents:{agentTimelineEventSet:(e,t)=>t.contents,agentTimelineEventCreateFileAddContent:(e,t)=>{e.toolData?.$kind==="createFileData"&&(e.toolData.createFileData.content+=t.content)},updateRevertStatus:(e,t)=>{e.toolData?.$kind==="revertData"&&(e.toolData.revertData.status=t.newStatus)},appendTimelineMessageContentsUpdate:(e,t)=>{e.toolData?.$kind==="messageData"&&(e.toolData.messageData.content+=t.content)},appendThoughtContentsUpdate:(e,t)=>{e.toolData?.$kind==="thoughts"&&(e.toolData.thoughts.thoughts+=t.content,e.toolData.thoughts.totalTimeTakenMs=t.totalTimeTakenMs)},newThoughtSummaryUpdate:(e,t)=>{e.toolData?.$kind==="thoughts"&&(e.toolData.thoughts.summary=t.summary)},appendRedactedThoughtsMarker:(e,t)=>{e.toolData?.$kind==="thoughts"&&e.toolData.thoughts.redactedThoughtsMarkers.push(t.marker)},upsertGeneratedMediaData:(e,t)=>{if(e.toolData?.$kind!=="generateMediaData")return;let n=e.toolData.generateMediaData.media,i=n.findIndex(e=>e.id===t.media.id);-1!==i?n[i]=t.media:n.push(t.media)},subagentReportResultUpdate:(e,t)=>{e.toolData?.$kind==="subagentReportResultData"&&(e.toolData.subagentReportResultData.result+=t.delta)}},hostingDebugSummaryEventContents:{hostingDebugSummaryEventSet:(e,t)=>t.contents},agentAskUserForActionRequest:{agentAskUserForActionRequestSet:(e,t)=>t.request},integrationTestEventContents:{integrationTestEventContents:(e,t)=>{e.expectedResponseString+=t.content}},agentPlanEventContents:{addDesignReferenceFile:(e,t)=>{e.designReferenceFilePaths.push(t.filePath)},updatePlanContents:(e,t)=>{t.step&&(e.step=t.step),t.planId&&(e.planId=t.planId),t.objective&&t.objective.description&&(e.objective=t.objective),t.initialCommitId&&(e.initialCommitId=t.initialCommitId),void 0!==t.stackBlueprint&&t.stackBlueprint!==r.StackBlueprint.STACK_BLUEPRINT_NONE&&(e.stackBlueprint=t.stackBlueprint),void 0!==t.agentStackTriggerType&&t.agentStackTriggerType!==s.AgentStackTriggerType.UNKNOWN_TRIGGER_TYPE&&(e.agentStackTriggerType=t.agentStackTriggerType)}},subagentRunning:{subagentRunningDataUpdate:(e,t)=>{if(!t.state)return;e.subagentId=t.state.subagentId,e.childSessionId=t.state.childSessionId,e.contents=t.state.contents;let n=Math.max(t.totalExecutionTimeSeconds??0,t.state.totalExecutionTimeSeconds??0);n>0&&(e.totalExecutionTimeSeconds=n)}},uiTestingSubagentExecutionEventContents:{uiTestingSubagentExecutionEventUpdate:(e,t)=>{e.gcsDownloadUrl=t.state.gcsDownloadUrl,e.mimeType=t.state.mimeType,e.narration=t.state.narration,e.miniNarration=t.state.miniNarration}}};function o(e,t,n){if(!e.attachedForm?.formType||e.attachedForm.formType===s.AttachedFormType.ATTACHED_FORM_TYPE_UNKNOWN)return;let i=e.attachedForm.fields.find(e=>e.path===t.path);i||(i={path:t.path,formType:{$kind:"string",string:{value:""}}},e.attachedForm.fields.push(i)),i.formType?.$kind==="string"&&(i.formType.string.value=n?i.formType.string.value+t.value:t.value)}function p(e,t){let n=new Set;for(let s of t){if(!s.operation||n.has(s.id))continue;n.add(s.id);let t=a[e.$kind]?.[s.operation.$kind]?.((0,i.unkind)(e),(0,i.unkind)(s.operation));t&&(e[e.$kind]=t)}}function l(e){e.contents.contents&&e.typedUpdateEventOperations.length&&(p(e.contents.contents,e.typedUpdateEventOperations),e.typedUpdateEventOperations=[])}function d(e,i){let r=null;if(i.state!==e.state&&((r??=Object.assign({},e)).state=i.state),(i.error.type!==e.error.type||i.error.message!==e.error.message)&&((r??=Object.assign({},e)).error=i.error),!i.typedOperations.length||!e.contents.contents)return r??e;let a=(0,n.createDraft)(e.contents.contents);p(a,i.typedOperations);let o=(0,n.finishDraft)(a);return o!==e.contents.contents&&((r??=Object.assign({},e)).contents={benchmarkParameters:t.Value.Create(s.BenchmarkParametersSchema),contents:o}),r??e}e.s(["applyEventOperations",()=>l,"applyEventUpdateMessage",()=>d])},910951,e=>{"use strict";var t=e.i(862927),n=e.i(131141),i=e.i(82259),s=e.i(986194),r=e.i(15053);function a(e){return"object"==typeof e?e:"string"==typeof e?{type:i.ModelType.OVERRIDE,overrideModelName:e}:{type:e,overrideModelName:""}}let o=(0,n.freeze)(t.Value.Create(i.EventSchema),!0);function p({session:e,parent:n,sender:s,contents:a,context:p,benchmark:l}){let d=(0,r.v4)(),c=new Date,u="localShellExecutionEventContents"===a.$kind?i.EventState.IN_PROGRESS:i.EventState.COMPLETE,T={type:i.EventErrorType.EVENT_ERROR_TYPE_UNKNOWN,message:"",shortMessage:""},y=Object.assign({},o);return y.id=d,y.parentEventId=n,y.sessionId=e,y.created=c,y.updated=c,y.state=u,y.error=T,y.sender=s,y.contents={benchmarkParameters:l??t.Value.Create(i.BenchmarkParametersSchema),contents:a},y.context={metadata:p||void 0},y}let l={contents:(0,n.freeze)(t.Value.Create(i.AgentAskUserForActionRequestSchema),!0)},d={contents:(0,n.freeze)(t.Value.Create(i.AgentAskUserForActionResponseSchema),!0)},c={contents:(0,n.freeze)(t.Value.Create(i.AgentPlanEventContentsSchema),!0),context:(0,n.freeze)(t.Value.Create(i.AgentPlanEventContextSchema),!0)},u={contents:(0,n.freeze)(t.Value.Create(i.ApprovePlanEventContentsSchema),!0),context:(0,n.freeze)(t.Value.Create(i.ApprovePlanEventContextSchema),!0)},T={contents:(0,n.freeze)(t.Value.Create(i.BYOPromptEventContentsSchema),!0),context:(0,n.freeze)(t.Value.Create(i.BYOPromptEventContextSchema),!0)},y={contents:(0,n.freeze)(t.Value.Create(i.InlineActionEventContentsSchema),!0),context:(0,n.freeze)(t.Value.Create(i.InlineActionEventContextSchema),!0),reference:(0,n.freeze)(t.Value.Create(i.CodeReferenceSchema),!0)},g={applied:(0,n.freeze)(t.Value.Create(i.IterativeAgentAppliedFileChangesSchema),!0),reverted:(0,n.freeze)(t.Value.Create(i.IterativeAgentRevertedFileChangesSchema),!0),contents:(0,n.freeze)(t.Value.Create(i.IterativeAgentEventContentsSchema),!0),context:(0,n.freeze)(t.Value.Create(i.IterativeAgentEventContextSchema),!0)},h={contents:(0,n.freeze)(t.Value.Create(i.LocalShellExecutionEventContentsSchema),!0),context:(0,n.freeze)(t.Value.Create(i.LocalShellExecutionEventContextSchema),!0)},f={contents:(0,n.freeze)(t.Value.Create(i.MessageEventContentsSchema),!0),context:(0,n.freeze)(t.Value.Create(i.MessageEventContextSchema),!0),reference:(0,n.freeze)(t.Value.Create(i.CodeReferenceSchema),!0),proposedFileChanges:(0,n.freeze)((0,s.withKind)("proposedFileChanges",{changes:[],commitId:"",summary:""}),!0)},m={contents:(0,n.freeze)(t.Value.Create(i.RevertEventContentsSchema),!0),context:(0,n.freeze)(t.Value.Create(i.RevertEventContextSchema),!0)},S={contents:(0,n.freeze)(t.Value.Create(i.SetupImportedProjectEventContentsSchema),!0)},E={contents:(0,n.freeze)(t.Value.Create(i.ShellSuggestionEventContentsSchema),!0),context:(0,n.freeze)(t.Value.Create(i.ShellSuggestionEventContextSchema),!0)},v={contents:(0,n.freeze)(t.Value.Create(i.StepTooComplexEventContentsSchema),!0)},R={contents:(0,n.freeze)(t.Value.Create(i.TranslateEventContentsSchema),!0),context:(0,n.freeze)(t.Value.Create(i.TranslateEventContextSchema),!0)},b={contents:(0,n.freeze)(t.Value.Create(i.TriggerCheckpointEventContentsSchema),!0)},O=(0,n.freeze)(t.Value.Create(i.CreateEventRequestSchema),!0);function C(e){let t=function({session:e,parent:t,sender:n,model:r,data:o,benchmark:O}){"type"in n||(n={id:n.id.toString(),type:i.UserType.USER,isTeam:!1,roles:[],membership:n.membership,orgId:"",username:"",timeCreated:n.timeCreated,flaggingContext:"",modelfarmDisabled:!1,openrouterDisabled:!1,openaiDisabled:!1,anthropicDisabled:!1,geminiDisabled:!1,isEnterprise:!1});let C={session:e,parent:t,sender:n,model:r,benchmark:O,...o};switch(C.kind){case"agentPlan":let I;return(I=Object.assign({},c.contents)).planId=C.planId,I.objective=C.objective,I.step=C.step,I.stackBlueprint=C.stackBlueprint,I.requiresApproval=C.requiresApproval,I.Approver=C.approved?(0,s.withKind)("approver",C.sender):void 0,C.approvedDesignReferenceFilePath&&(I.approvedDesignReferenceFilePath=C.approvedDesignReferenceFilePath),C.agentStackTriggerType&&(I.agentStackTriggerType=C.agentStackTriggerType),p({session:C.session,parent:C.parent,sender:C.sender,contents:(0,s.withKind)("agentPlanEventContents",I),context:(0,s.withKind)("agentPlanEventContext",c.context)});case"approvePlan":let A;return(A=Object.assign({},u.contents)).planEventId=C.planEventId,A.approver=C.approver,A.initialBuildMode=C.initialBuildMode,A.userSecretsResponse=C.userSecretsResponse??{providedSecrets:[]},A.agentConfig=C.agentConfig,p({session:C.session,parent:C.parent,sender:C.sender,contents:(0,s.withKind)("approvePlanEventContents",A),context:null});case"byoPrompt":let U,k,N;return U=Object.assign({},T.contents),k=Object.assign({},T.context),N=a(C.model),U.messages=C.messages,U.parameters=C.parameters,U.forceJson=!1,k.modelSelector=N,p({session:C.session,parent:C.parent,sender:C.sender,contents:(0,s.withKind)("byoPromptEventContents",U),context:(0,s.withKind)("byoPromptEventContext",k)});case"inlineAction":let D,P,w;return D=Object.assign({},y.contents),P=Object.assign({},y.context),w=a(C.model),D.content=C.message,D.messageType=C.messageType,D.codeReference=C.codeReference??y.reference,D.usedModelSelector=w,P.mostRecentFile=C.mostRecentFile??"",P.fileContext=C.fileContext??[],P.modelSelector=w,P.useRag=C.useRag??!1,p({session:C.session,parent:C.parent,sender:C.sender,contents:(0,s.withKind)("inlineActionEventContents",D),context:(0,s.withKind)("inlineActionEventContext",P)});case"iterativeAgent":return function(e){let t=Object.assign({},g.contents);if("appliedChanges"in e.action){let n=Object.assign({},g.applied);n.eventWhichProposedChanges=e.action.eventIdWhichProposedChanges,n.appliedChanges=e.action.appliedChanges,n.commitHash=e.action.commitHash,t.contents=(0,s.withKind)("appliedFileChanges",n)}else if("revertedChanges"in e.action){let n=Object.assign({},g.reverted);n.eventWhichProposedChanges=e.action.eventIdWhichProposedChanges,n.eventWhichAppliedChanges=e.action.eventIdWhichAppliedChanges,n.revertedChanges=e.action.revertedChanges,t.contents=(0,s.withKind)("revertedFileChanges",n)}else if("eventIdWhichProposedPackageInstall"in e.action)if("installationOutput"in e.action){let{eventIdWhichProposedPackageInstall:n,...i}=e.action;t.contents=(0,s.withKind)("installedPackages",{...i,eventWhichProposedPackageInstall:n})}else{let{eventIdWhichProposedPackageInstall:n,...i}=e.action;t.contents=(0,s.withKind)("installingPackages",{...i,eventWhichProposedPackageInstall:n})}else if("eventIdWhichProposedShellExecution"in e.action)if("commandOutput"in e.action){let{eventIdWhichProposedShellExecution:n,...i}=e.action;t.contents=(0,s.withKind)("finishedShellExecution",{...i,eventWhichProposedShellExecution:n})}else{let{eventIdWhichProposedShellExecution:n,...i}=e.action;t.contents=(0,s.withKind)("startedShellExecution",{...i,eventWhichProposedShellExecution:n})}else if("eventIdWhichProposedRunConfiguration"in e.action){let{eventIdWhichProposedRunConfiguration:n,...i}=e.action;t.contents=(0,s.withKind)("appliedRunConfiguration",{...i,eventWhichProposedRunConfiguration:n})}else if("eventIdWhichProposedDeploymentConfiguration"in e.action){let{eventIdWhichProposedDeploymentConfiguration:n,...i}=e.action;t.contents=(0,s.withKind)("appliedDeploymentConfiguration",{...i,eventWhichProposedDeploymentConfiguration:n})}else if("eventIdWhichProposedWorkflowConfiguration"in e.action){let{eventIdWhichProposedWorkflowConfiguration:n,...i}=e.action;t.contents=(0,s.withKind)("appliedWorkflowConfiguration",{...i,eventWhichProposedWorkflowConfiguration:n})}return p({session:e.session,parent:e.parent,sender:e.sender,contents:(0,s.withKind)("iterativeAgentEventContents",t),context:(0,s.withKind)("iterativeAgentEventContext",g.context)})}(C);case"localShellExecution":let j;return(j=Object.assign({},h.contents)).command=C.command,j.channelName=C.channelName,j.eventId=C.event,j.index=0,j.result="",j.exitCode=0,j.executed=!1,p({session:C.session,parent:C.parent,sender:C.sender,contents:(0,s.withKind)("localShellExecutionEventContents",j),context:(0,s.withKind)("localShellExecutionEventContext",h.context)});case"message":let M,L,_;return M=Object.assign({},f.contents),L=Object.assign({},f.context),_=a(C.model),M.content=C.message,M.intent=C.intent,M.media=C.media??[],M.codeReference=C.codeReference??f.reference,M.usedModelSelector=_,M.sources=C.sources??[],M.extraActions=C.extraActions??f.proposedFileChanges,M.agentAction=C.agentAction??{},M.uploadedFiles=C.uploadedFiles??[],M.attachedUrls=C.attachedUrls??[],C.requestedStackBlueprint&&(M.requestedStackBlueprint=C.requestedStackBlueprint),C.agentStackTriggerType&&(M.agentStackTriggerType=C.agentStackTriggerType),M.customStackReplId=C.customStackReplId??"",M.themeConfig=C.themeConfig??"",M.attachedForm=C.attachedForm??{formType:i.AttachedFormType.ATTACHED_FORM_TYPE_UNKNOWN,fields:[]},M.enableDeepThinking=C.enableDeepThinking??!1,L.intent=C.intent,L.mostRecentFile=C.mostRecentFile??"",L.fileContext=C.fileContext??[],L.modelSelector=_,L.useRag=C.useRag??!1,L.extraResources=C.extraResources??[],L.messageSource=C.messageSource??i.MessageSource.MESSAGE_SOURCE_REPLIT_UI,L.agentConfig={maxSteps:0,modelProfile:C.agentConfig?.modelProfile??i.ModelProfile.MODEL_PROFILE_STANDARD,thinkingEnabled:C.agentConfig?.thinkingEnabled,enableAutomatedTesting:C.agentConfig?.enableAutomatedTesting,samplingRate:C.agentConfig?.samplingRate??0,webSearchEnabled:C.agentConfig?.webSearchEnabled??!1,imageGenerationEnabled:C.agentConfig?.imageGenerationEnabled??!1,agentMode:C.agentConfig?.agentMode??i.AgentMode.AGENT_MODE_UNSPECIFIED,initialBuildMode:C.agentConfig?.initialBuildMode??i.AgentInitialBuildMode.AGENT_INITIAL_BUILD_MODE_UNSPECIFIED,maxAutonomyEnabled:C.agentConfig?.maxAutonomyEnabled??!1,autonomyLevel:C.agentConfig?.autonomyLevel??i.AutonomyLevel.AUTONOMY_LEVEL_UNSPECIFIED,agentInitialBuildTier:C.agentConfig?.agentInitialBuildTier??i.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_UNSPECIFIED,headlessMode:!1,workspaceLessMode:C.agentConfig?.workspaceLessMode},C.webviewTargetedElement&&(M.targetedElement=C.webviewTargetedElement),void 0!==C.quickEdit&&(M.quickEdit=C.quickEdit),C.agentConfig&&(M.agentConfig={maxSteps:0,modelProfile:C.agentConfig.modelProfile??i.ModelProfile.MODEL_PROFILE_STANDARD,thinkingEnabled:C.agentConfig.thinkingEnabled,enableAutomatedTesting:C.agentConfig.enableAutomatedTesting,samplingRate:C.agentConfig.samplingRate??0,webSearchEnabled:C.agentConfig?.webSearchEnabled??!1,imageGenerationEnabled:C.agentConfig?.imageGenerationEnabled??!1,agentMode:C.agentConfig.agentMode??i.AgentMode.AGENT_MODE_UNSPECIFIED,initialBuildMode:C.agentConfig.initialBuildMode??i.AgentInitialBuildMode.AGENT_INITIAL_BUILD_MODE_UNSPECIFIED,maxAutonomyEnabled:C.agentConfig.maxAutonomyEnabled??!1,autonomyLevel:C.agentConfig.autonomyLevel??i.AutonomyLevel.AUTONOMY_LEVEL_UNSPECIFIED,agentInitialBuildTier:C.agentConfig.agentInitialBuildTier??i.AgentInitialBuildTier.AGENT_INITIAL_BUILD_TIER_UNSPECIFIED,headlessMode:!1,workspaceLessMode:C.agentConfig.workspaceLessMode}),p({session:C.session,parent:C.parent,sender:C.sender,contents:(0,s.withKind)("messageEventContents",M),context:(0,s.withKind)("messageEventContext",L)});case"revert":let x;return(x=Object.assign({},m.contents)).eventIdBeforeRevert=C.eventIdBeforeRevert,x.commitId=C.commitHash,x.message=C.commitMessage,p({session:C.session,parent:C.parent,sender:C.sender,contents:(0,s.withKind)("revertEventContents",x),context:(0,s.withKind)("revertEventContext",m.context)});case"shellSuggestion":let B,F,$;return B=Object.assign({},E.contents),F=Object.assign({},E.context),$=a(C.model),B.content=C.message,F.modelSelector=$,p({session:C.session,parent:C.parent,sender:C.sender,contents:(0,s.withKind)("shellSuggestionEventContents",B),context:(0,s.withKind)("shellSuggestionEventContext",F)});case"translate":let G;return(G=Object.assign({},R.contents)).content=C.content,G.inputTarget=C.inputTarget,G.outputTarget=C.outputTarget,p({session:C.session,parent:C.parent,sender:C.sender,contents:(0,s.withKind)("translateEventContents",G),context:(0,s.withKind)("translateEventContext",R.context)});case"stepTooComplex":let q;return(q=Object.assign({},v.contents)).state=C.state,q.stepId=C.stepId,p({session:C.session,parent:C.parent,sender:C.sender,contents:(0,s.withKind)("stepTooComplexEventContents",q),context:null});case"agentAskUserForActionResponse":let V;return(V=Object.assign({},d.contents)).response=C.response,V.requestEventId=C.requestEventId,p({session:C.session,parent:C.parent,sender:C.sender,contents:(0,s.withKind)("agentAskUserForActionResponse",V),context:null});case"agentAskUserForActionRequest":let W;return(W=Object.assign({},l.contents)).request=C.request,p({session:C.session,parent:C.parent,sender:C.sender,contents:(0,s.withKind)("agentAskUserForActionRequest",W),context:null});case"requestFeatureAdd":return p({session:C.session,parent:C.parent,sender:C.sender,contents:{$kind:"requestFeatureAddData",requestFeatureAddData:{type:C.feature}},context:null});case"triggerCheckpoint":let K;return(K=Object.assign({},b.contents)).description=C.description,K.onlyIfDiff=C.onlyIfDiff??!1,K.author=C.author??i.CommitAuthor.COMMIT_AUTHOR_AGENT,p({session:C.session,parent:C.parent,sender:C.sender,contents:(0,s.withKind)("triggerCheckpointEventContents",K),context:null});case"setupImportedProject":let H;return(H=Object.assign({},S.contents)).importSource=C.importSource,H.agentConfig=C.agentConfig,p({session:C.session,parent:C.parent,sender:C.sender,contents:(0,s.withKind)("setupImportedProjectEventContents",H),context:null})}}(e),n=Object.assign({},O);return n.addToChild=e.addToChild,n.state=t.state,n.sessionId=t.sessionId,n.parentEventId=t.parentEventId,n.eventId=t.id,n.context=t.context,n.contents=t.contents,{event:t,request:n}}e.s(["createEventRequest",()=>C],910951)},590225,e=>{"use strict";var t=e.i(862927),n=e.i(131141),i=e.i(82259);let s=(0,n.freeze)(t.Value.Create(i.UpdateEventMessageSchema),!0);function r(e){let t=Object.assign({},s);return t.eventId=e.id,t.state=e.state??i.EventState.COMPLETE,t.typedOperations=e.typedOperations??[],t}e.s(["createUpdateEventRequest",()=>r])},576106,e=>{"use strict";var t=e.i(862927),n=e.i(131141);e.i(660670);var i=e.i(957410),s=e.i(986194),r=e.i(82259);let a={session:(0,n.freeze)(t.Value.Create(r.SessionSchema),!0),data:(0,n.freeze)(t.Value.Create(i.SessionDataSchema),!0),create:(0,n.freeze)(t.Value.Create(r.CreateSessionRequestSchema),!0),update:(0,n.freeze)(t.Value.Create(r.UpdateSessionRequestSchema),!0)};function o(e){let n=Object.assign({},a.create);return n.title=e.title??"",n.sessionType=e.sessionType,n.replId=e.replId,n.SeededAiFirstEventContents=e.seededEvent?(0,s.withKind)("seededAiFirstEventContents",{benchmarkParameters:t.Value.Create(r.BenchmarkParametersSchema),contents:e.seededEvent}):void 0,e.taskId&&(n.taskId=e.taskId),n}function p(e,t){let i=(0,n.produce)(e,e=>{e.title=t.title??e.title,e.sessionType=t.sessionType??e.sessionType,e.archived=t.archived??e.archived,e.readOnly=t.readOnly??e.readOnly,e.taskId=t.taskId??e.taskId}),s=Object.assign({},a.update);return s.id=i.id,s.title=i.title,s.sessionType=i.sessionType,s.replId=i.replId,s.activeEventId=i.activeEventId,void 0!==t.archived&&i.archived!==e.archived&&(s.archived=i.archived),void 0!==t.readOnly&&i.readOnly!==e.readOnly&&(s.readOnly=i.readOnly),void 0!==t.taskId&&i.taskId!==e.taskId&&(s.taskId=i.taskId),void 0!==t.isActiveAgentSession&&(s.isActiveAgentSession=t.isActiveAgentSession,i===e&&(i=Object.assign({},i))),{session:i,request:s}}function l(e){let t=Object.assign({},a.session),n=new Date;return t.id=e.sessionId,t.title=e.title,t.sessionType=e.sessionType,t.replId=e.replId,t.sessionCreationEventId=e.sessionCreationEventId,t.archived=!!e.archived,t.taskId=e.taskId,t.lastEventTime=n,t.created=n,t.updated=n,t.revertedToSessionId=e.revertedToSessionId,t.revertedToEventId=e.revertedToEventId,t}function d(e,t){return(0,n.produce)(e,e=>{t.title&&(e.title=t.title),t.sessionType!==r.SessionType.SESSION_TYPE_UNKNOWN&&(e.sessionType=t.sessionType),void 0!==t.archived&&(e.archived=t.archived),t.activeEventId&&(e.activeEventId=t.activeEventId),void 0!==t.readOnly&&(e.readOnly=t.readOnly),t.taskId&&(e.taskId=t.taskId)})}function c(e,t){let n=Object.assign({},a.session);return n.id=t.id,n.title=t.title,n.sessionType=t.sessionType,n.replId=e,n.sessionCreationEventId=t.sessionCreationEventId,n.archived=t.archived,n.lastEventTime=t.created,n.created=t.created,n.updated=t.updated,n.readOnly=t.readOnly,n.taskId=t.taskId,n.revertedToSessionId=t.revertedToSessionId??"",n.revertedToEventId=t.revertedToEventId??"",n}function u(e){let t=Object.assign({},a.data);return t.id=e.id,t.title=e.title,t.sessionType=e.sessionType,t.sessionCreationEventId=e.sessionCreationEventId,t.archived=e.archived,t.readOnly=e.readOnly,t.taskId=e.taskId,t.created=e.created,t.updated=e.updated,t.revertedToSessionId=e.revertedToSessionId||null,t.revertedToEventId=e.revertedToEventId||null,t}e.s(["applySessionUpdateMessage",()=>d,"compatDataToSession",()=>c,"compatSessionToData",()=>u,"createSessionFromCreateSessionMessage",()=>l,"createSessionRequest",()=>o,"createUpdateSessionRequest",()=>p])},877212,568515,51553,204203,145864,165680,805763,e=>{"use strict";e.i(267710),e.i(221042);var t,n=e.i(276385),i=e.i(389959),s=e.i(971131),r=e.i(830675),a=e.i(131141),o=e.i(541793),p=e.i(161322),l=e.i(82259),d=e.i(644464),c=e.i(952098),u=e.i(600637),T=e.i(924908);e.i(242933);var y=e.i(424360),g=e.i(885505),h=e.i(281128);e.i(660670);var f=e.i(813702),m=e.i(353838),S=e.i(910951),E=e.i(590225),v=e.i(576106),R=e.i(986194);function b(e){return{state:e.runState,reason:e.transitionReason.reasons?(0,R.unwrapKind)(e.transitionReason.reasons):null}}class O{api;session;static lastWarmTimeMap=new WeakMap;constructor(e,t){this.api=e,this.session=t}active=new y.Multicast(e=>this.api.currentAgentSession.select(e=>!!e&&e.id===this.session.id).subscribe(e));state=new y.Multicast(e=>{let t=null,n=null,i=!1,s=this.api.state.register({snapshot:()=>t,rollback:e=>t=e,notify:()=>e.next(t),update:e=>{let n=!1;if("agent-state-modified"===e.kind&&e.session===this.session.id&&(t=e.state,n=!0),e.optimistic||o(),n)return!0}}),r=async()=>{n=null,i=!0;try{let n=await this.api.service.getAgentState.rpc({replId:this.api.replId,sessionId:this.session.id});if((0,g.isError)(n,"UNEXPECTED_DISCONNECT"))return;if(!n.ok)return this.api.error(n,e);let i=b(n.payload);i.state!==t?.state&&(this.api.logger.warn?.("state transition was manually corrected"),t=i,s.commit(),e.next(t))}finally{i&&(i=!1,o())}},a=()=>{i=!1,null!==n&&(clearTimeout(n),n=null)},o=()=>{null!==n&&(clearTimeout(n),n=null),i||t?.state!==l.AgentRunState.AGENT_STATE_RUNNING||(n=setTimeout(r,1e4))},p=this.api.connected.lift(e,async n=>{let i=await (0,g.get)(this.active);if(n.aborted||(0,g.isError)(i,"UNEXPECTED_DISCONNECT"))return;if(!i.ok)return this.api.error(i,e);if(!i.payload){t=null,s.commit(),e.next(t);return}let r=await this.api.service.getAgentState.rpc({replId:this.api.replId,sessionId:this.session.id});if(!(n.aborted||(0,g.isError)(r,"UNEXPECTED_DISCONNECT"))){if(!r.ok)return this.api.error(r,e);t=b(r.payload),s.commit(),e.next(t),o(),n.addEventListener("abort",a,{once:!0})}});return()=>{a(),s.unsubscribe(),p.unsubscribe()}});async update(e){let t=await (0,g.get)(this.state);if(!t.ok)return this.api.error(t);if(!t.payload)return this.api.error("session is not an agent session");let n=(0,h.create)(t.payload,t=>{t.state=e});if(t.payload===n)return(0,g.Ok)(t.payload);let[i,s]=this.api.state.stage({kind:"agent-state-modified",session:this.session.id,state:{state:e,reason:null}}),r=await this.api.service.updateAgentState.rpc({replId:this.api.replId,sessionId:this.session.id,runState:e,transitionReason:{}});return r.ok?r.payload.runState!==e?(s(),(0,g.Ok)(b(r.payload))):(this.api.hooks.trigger("client-updated-agent-state",{session:this.session,prev:t.payload,next:n}),i(),(0,g.Ok)(n)):(s(),this.api.error(r))}async warmup(){let e=O.lastWarmTimeMap.get(this.api);e||(e=new Map,O.lastWarmTimeMap.set(this.api,e));let t=Date.now(),n=e.get(this.session.id);if(n&&t-n<24e4)return(0,g.Ok)(null);let i=await (0,g.get)(this.state);if(!i.ok)return this.api.error(i);if(!i.payload)return this.api.error("session is not an agent session");if(i.payload.state===l.AgentRunState.AGENT_STATE_RUNNING||i.payload.state===l.AgentRunState.AGENT_STATE_PAUSING)return(0,g.Ok)(null);e.set(this.session.id,t);let s=await this.api.service.warmAgent.rpc({replId:this.api.replId,sessionId:this.session.id});return s.ok?(0,g.Ok)(null):this.api.error(s)}usage(e){return this.api.createUsageWatcher({sessionId:this.session.id,start:e})}}var C=e.i(279606);class I{forward=new Map;reverse=new Map;constructor(e){if(e)for(const[t,n]of e)this.set(t,n)}get size(){return this.forward.size}keys(){return this.forward.keys()}values(){return this.reverse.keys()}entries(){return this.forward.entries()}hasKey(e){return this.forward.has(e)}hasValue(e){return this.reverse.has(e)}getValue(e){let t=this.forward.get(e);if(void 0===t)throw Error("key does not exist");return t}getKey(e){let t=this.reverse.get(e);if(void 0===t)throw Error("value does not exist");return t}set(e,t){let n=this.reverse.get(t),i=this.forward.get(e);this.forward.set(e,t),this.reverse.set(t,e),void 0!==n&&n!==e&&this.forward.delete(n),void 0!==i&&i!==t&&this.reverse.delete(i)}deleteKey(e){let t=this.forward.get(e);void 0!==t&&(this.forward.delete(e),this.reverse.delete(t))}deleteValue(e){let t=this.reverse.get(e);void 0!==t&&(this.reverse.delete(e),this.forward.delete(t))}clear(){this.forward.clear(),this.reverse.clear()}[Symbol.iterator](){return this.forward.entries()}}class A{map=new I;offset=0;length=0;constructor(e){if(e){for(let t=0;t<e.length;t++)this.map.set(t,e[t]);this.length=e.length}}get first(){return this.length?this.map.getValue(0+this.offset):null}get last(){return this.length?this.map.getValue(this.map.size-1+this.offset):null}peek(e){return -1===e?this.first:this.last}has(e){return"number"==typeof e?this.map.hasKey(e-this.offset):this.map.hasValue(e)}index(e){return this.map.getKey(e)-this.offset}id(e){return this.map.getValue(e+this.offset)}dir(e,t){let n=this.map.getKey(e),i=this.map.getKey(t);return n<i?1:n>i?-1:0}append(e){for(let t=0;t<e.length;t++)this.map.set(this.map.size+this.offset,e[t]);this.length=this.map.size}prepend(e){for(let t=e.length-1;t>=0;t--)this.offset--,this.map.set(0+this.offset,e[t]);this.length=this.map.size}pop(){if(!this.last)return null;let e=this.last;return this.map.deleteValue(e),this.length=this.map.size,this.offset=this.map.size?this.offset:0,e}shift(){if(!this.first)return null;let e=this.first;return this.map.deleteValue(e),this.length=this.map.size,this.offset=this.map.size?this.offset+1:0,e}parent(e){let t=this.map.getKey(e);return t!==0+this.offset?this.map.getValue(t-1):null}child(e){let t=this.map.getKey(e);return t!==this.map.size-1+this.offset?this.map.getValue(t+1):null}adjacent(e,t){return -1===t?this.parent(e):this.child(e)}slice(e=0,t=this.length-1){if(0===this.length)return[];let n=0+this.offset,i=this.map.size-1+this.offset,s="number"==typeof e?Math.min(Math.max(e+this.offset,n),i):this.map.getKey(e),r="number"==typeof t?Math.max(Math.min(t+this.offset,i),n):this.map.getKey(t),a=s>r;a&&([s,r]=[r,s]);let o=[];for(let e=s;e<=r;e++)o.push(this.map.getValue(e));return a?o.reverse():o}patch(e,t=e.first,n=e.last){if(t&&!e.has(t)||n&&!e.has(n))throw Error("invalid merge");if(!t||!n){if(this.map.size){let e=Array.from(this.map.values());return this.clear(),{removed:e,added:[]}}return null}let i=e.slice(t,n),s=new Set(this.map.values()),r=new Set(s),a=new Set(i);for(let e of i)r.delete(e);for(let e of s)a.delete(e);return r.size||a.size?(this.clear(),this.append(i),{removed:Array.from(r),added:Array.from(a)}):null}clear(){this.map.clear(),this.offset=0,this.length=0}clone(){let e=new A;return e.map=new I(this.map),e.offset=this.offset,e.length=this.length,e}}class U{ids=new A;events=new Map;incomplete=new Set;length=0;constructor(e){e&&this.append(e)}set(e){this.events.set(e.id,e),e.state!==l.EventState.COMPLETE?this.incomplete.add(e.id):this.incomplete.delete(e.id)}delete(e){this.events.delete(e),this.incomplete.delete(e)}get first(){return this.ids.first?this.get(this.ids.first):null}get last(){return this.ids.last?this.get(this.ids.last):null}peek(e){return -1===e?this.first:this.last}index(e){return this.ids.index(e)}id(e){return this.ids.id(e)}dir(e,t){return this.ids.dir(e,t)}has(e){return this.ids.has(e)}get(e){e="number"==typeof e?this.id(e):e;let t=this.events.get(e);if(!t)throw Error("event does not exist");return t}append(e){for(let t of(this.ids.append(e.map(e=>e.id)),this.length=this.ids.length,e))this.set(t)}prepend(e){for(let t of(this.ids.prepend(e.map(e=>e.id)),this.length=this.ids.length,e))this.set(t)}pop(){let e=this.ids.pop(),t=e?this.events.get(e)??null:null;if(e&&!t)throw Error("Unexpected null for popped event");return e&&t&&(this.delete(e),this.length--),t}shift(){let e=this.ids.shift(),t=e?this.events.get(e)??null:null;if(e&&!t)throw Error("Unexpected null for shifted event");return e&&t&&(this.delete(e),this.length--),t}parent(e){let t=this.index(e);return t>0?this.get(t-1):null}child(e){let t=this.index(e);return t<this.length-1?this.get(t+1):null}adjacent(e,t){return -1===t?this.parent(e):this.child(e)}slice(e=0,t=this.length-1){return this.ids.slice(e,t).map(e=>this.get(e))}patch(e,t=e.ids.first,n=e.ids.last){let i=this.ids.patch(e.ids,t,n);this.length=this.ids.length;let s=!this.events.size,r=null,a=null;if(i){for(let e of(r??={removed:[],added:[],changed:[]},i.removed))r.removed.push(this.get(e)),this.delete(e);for(let t of i.added){let n=e.get(t);r.added.push(n),this.set(n),s||(a??=new Set).add(t)}}if(s)return r;let o=new Set(this.incomplete);for(let t=this.length-1;t>=0;t--){let n=this.ids.id(t);if(o.delete(n),a?.has(n))continue;let i=e.events.get(n);if(i&&i!==this.events.get(n)){(r??={removed:[],added:[],changed:[]}).changed.push(i),this.set(i);continue}if(!o.size&&i&&i.state===l.EventState.COMPLETE)break}return r}adopt(e,t,n=e.first,i=e.last){if(!n||!i){if(!this.length)return null;let e=Array.from(this.events.values());return this.clear(),{removed:e,added:[],changed:[],missing:[]}}if(!t?.size&&!this.length)return{removed:[],added:[],changed:[],missing:e.slice(n,i)};let s=[],r=[],a=null,o=null,p=e.index(n),l=e.index(i);for(let n=l;n>=p;n--){let i=e.id(n);if(!t?.has(i)&&!this.events.has(i)){s.push(i),o&&!a&&(a=e.child(i));continue}if(o??=i,a){s.push(i);continue}if(t?.has(i)&&this.events.has(i)){let e=t?.get(i);e&&this.events.get(i)!==e&&(r.push(e),this.set(e))}}if(!o&&!a){if(!this.length&&!s.length)return null;let e=Array.from(this.events.values());return this.clear(),{removed:e,added:[],changed:[],missing:s}}a||=n,o||=i;let d=this.ids.patch(e,a,o);if(this.length=this.ids.length,!d)return s.length||r.length?{removed:[],added:[],changed:r,missing:s}:null;let c=[],u=[];for(let e of d.removed)c.push(this.get(e)),this.delete(e);for(let e of d.added){let n=t?.get(e);if(!n)throw Error("unexpected null");u.push(n),this.set(n)}return{removed:c,added:u,changed:r,missing:s}}clear(){this.ids.clear(),this.events.clear(),this.incomplete.clear(),this.length=0}clone(){let e=new U;return e.ids=this.ids.clone(),e.events=new Map(this.events),e.incomplete=new Set(this.incomplete),e}}var k=Object.prototype.hasOwnProperty;function N(e,t,n){for(n of e.keys())if(D(n,t))return n}function D(e,t){var n,i,s;if(e===t)return!0;if(e&&t&&(n=e.constructor)===t.constructor){if(n===Date)return e.getTime()===t.getTime();if(n===RegExp)return e.toString()===t.toString();if(n===Array){if((i=e.length)===t.length)for(;i--&&D(e[i],t[i]););return -1===i}if(n===Set){if(e.size!==t.size)return!1;for(i of e)if((s=i)&&"object"==typeof s&&!(s=N(t,s))||!t.has(s))return!1;return!0}if(n===Map){if(e.size!==t.size)return!1;for(i of e)if((s=i[0])&&"object"==typeof s&&!(s=N(t,s))||!D(i[1],t.get(s)))return!1;return!0}if(n===ArrayBuffer)e=new Uint8Array(e),t=new Uint8Array(t);else if(n===DataView){if((i=e.byteLength)===t.byteLength)for(;i--&&e.getInt8(i)===t.getInt8(i););return -1===i}if(ArrayBuffer.isView(e)){if((i=e.byteLength)===t.byteLength)for(;i--&&e[i]===t[i];);return -1===i}if(!n||"object"==typeof e){for(n in i=0,e)if(k.call(e,n)&&++i&&!k.call(t,n)||!(n in t)||!D(e[n],t[n]))return!1;return Object.keys(t).length===i}}return e!=e&&t!=t}class P{api;session;direction;initial;transducer;constructor({api:e,session:t,direction:n,initial:i,transducer:s}){if(this.api=e,this.session=t,this.direction=n,this.initial=i,this.transducer=s,!(0,h.isDraftable)(i))throw Error("state must be draftable")}compute(e,t,n){let[i,s]=(0,h.create)([t,void 0]);i[1]=this.transducer(e,i[0]);let r=s();return r[0]!==t&&n&&D(r[0],n)&&(r[0]=n),r}step(e,t,n){let i=n.id,s=-this.direction,r=e.peek(s);r&&=i===r||n===r?r:e.adjacent(i,s);let a=i===(r&&="string"!=typeof r?r.id:r)?this.initial:r&&t.get(r),o=t.get(i);if(!a)throw Error("starting state not found");let[p,l]=this.compute(n,a,o),d=p!==a||!o||p!==o;return d&&t.set(i,p),{ret:l,recomputing:d}}indexed(e,t){let n=Array(t.length);for(let i=0;i<t.length;i++){let s=t[i],r="string"==typeof s?s:s.id;n[i]=e.index(r)}return n.sort((e,t)=>(e-t)*this.direction),n}}var w=((t=w||{})[t.PEEK=10]="PEEK",t[t.SCAN=150]="SCAN",t[t.TRAVERSE=500]="TRAVERSE",t);class j extends P{map;debug;constructor(e,t,n){super({api:e,session:t,direction:"forward"===n.direction?1:-1,initial:n.state,transducer:n.reducer}),this.map=n.map??(e=>e),this.debug=n.debug}result=new y.Multicast(e=>{let t=new A,n=new Set,i=new Map,s=null,r=null,a=10,o=()=>{if(!n.size)return!1;let e=this.indexed(t,Array.from(n)),s=e[0],o=!1,p=0;for(;s>=0&&s<t.length;){let l=t.id(s),d=s===e[0];if(p++,r&&r!==l&&t.dir(l,r)!==this.direction)break;let c=this.api.materializer.get(l);if(!c){if(n.add(l),o)switch(a){case 10:a=150;break;case 150:a=500}let i=Math.max(s+(a-1)*this.direction,0);d&&e.length>1&&(i=1===this.direction?Math.min(i,e[e.length-1]):Math.max(i,e[e.length-1]));let r=t.slice(s,i);return this.api.materializer.enqueue(this.session.id,r),this.debug&&this.api.logger.info?.("ran reducer",{reducer:{name:this.debug.name,type:"global",done:!1,fetching:r.length,pending:n.size,invalidated:e.length,scanned:p}}),!1}d&&(e.shift(),n.delete(l));let{ret:u,recomputing:T}=this.step(t,i,c);if(o||=d||T||!1===u,!1===u){r=c.id;break}if(c.id===r&&(r=null),T||e.length){s=T?s+this.direction:e[0];continue}break}return n.size||(a=10),o},p=()=>{let n;if(t.length){let e=r??t.peek(this.direction);n=e?i.get(e):void 0}else n=this.initial;if(void 0===n)throw Error("unexpected undefined");s!==n&&(s=n,e.next(this.map(n)))},l=this.api.state.register({snapshot:()=>({ids:t.clone(),pending:new Set(n),states:new Map(i),stop:r,batchSize:a}),rollback:e=>{t=e.ids,n=e.pending,i=e.states,r=e.stop,a=e.batchSize},notify:()=>p(),update:e=>{if("event-modified"===e.kind&&t.has(e.event.id))return n.add(e.event.id),o()}}),d=this.api.materializer.events.lift(e,e=>{e.filter(({id:e})=>n.has(e)).length&&o()&&p()}),c=this.session.ids.lift(e,e=>{let s=t.patch(e);if(s){for(let e of s.removed)i.delete(e),n.delete(e),e===r&&(r=null);for(let e of s.added)n.add(e);o()&&p()}});return()=>{l.unsubscribe(),d.unsubscribe(),c.unsubscribe()}});subscribe=this.result.subscribe.bind(this.result);[Symbol.observable](){return this.result}}class M extends P{window;map;debug;constructor(e,t,n,i){super({api:e,session:t,direction:"forward"===n.direction?1:-1,initial:n.state,transducer:n.reducer}),this.window=this.session.window(i),this.map=n.map??(e=>e),this.debug=n.debug}get size(){return this.window.size}exhaustive=new y.Multicast(e=>C.Observable.combine(this.session.ids.select(e=>e.length),this.window.size).select(([e,t])=>e<=t).subscribe(e));result=new y.Multicast(e=>{let t=new U,n=null,i=null,s=new Map,r=new Set,a=()=>{let a;if(r.size){let e=this.indexed(t,Array.from(r)),n=e[0],a=0;for(;n>=0&&n<t.length;){let o=t.get(n),p=o.id,l=n===e[0];if(a++,i&&i!==p&&t.dir(p,i)!==this.direction)break;l&&(e.shift(),r.delete(o.id));let{ret:d,recomputing:c}=this.step(t,s,o);if(!1===d){i=o.id;break}if(p===i&&(i=null),c||e.length){n=c?n+this.direction:e[0];continue}break}this.debug&&a&&(a=0)}if(t.length){let e=i??t.peek(this.direction)?.id;a=e?s.get(e):void 0}else a=this.initial;if(void 0===a)throw Error("unexpected undefined");n!==a&&(n=a,e.next(this.map(a)))},o=this.window.events.lift(e,e=>{let n=t.patch(e);if(n){for(let e of n.removed)s.delete(e.id),r.delete(e.id),e.id===i&&(i=null);for(let e of n.added)r.add(e.id);for(let e of n.changed)r.add(e.id);a()}});return()=>{o.unsubscribe()}});subscribe=this.result.subscribe.bind(this.result);[Symbol.observable](){return this.result}}var L=e.i(377930);class _ extends P{window;debug;constructor(e,t,n,i){super({api:e,session:t,direction:"forward"===n.direction?1:-1,initial:n.state,transducer:n.transformer}),this.window=this.session.window(i),this.debug=n.debug}get size(){return this.window.size}exhaustive=new y.Multicast(e=>C.Observable.combine(this.session.ids.select(e=>e.length),this.window.size).select(([e,t])=>e<=t).subscribe(e));state=new y.Multicast(e=>{let t=new U,n=new Map,i=new Map;return this.window.events.lift(e,s=>{let r=t.patch(s);if(!r)return;let a=!1,o=!1,p=0;if(!t.length){a||=!!(n.size||i.size),o||=a,a&&(n.clear(),i.clear(),e.next({events:t,transformed:i,scaled:a}));return}for(let e of r.removed)a||=i.has(e.id),o||=a,n.delete(e.id),i.delete(e.id);if(r.added.length||r.changed.length){let e=this.indexed(t,r.added.concat(r.changed)),s=e[0];for(;s>=0&&s<t.length;){let r=s===e[0];r&&e.shift();let l=t.get(s),d=i.get(l.id),{ret:c,recomputing:u}=this.step(t,n,l);if((u||r)&&(void 0!==c?i.set(l.id,c):void 0!==d&&i.delete(l.id)),a||=!!d!=!!c,o||=u||r||a,p++,u||e.length){s=u?s+this.direction:e[0];continue}break}}this.debug&&p&&(p=0),(a||o)&&e.next({events:t,transformed:i,scaled:a})})});create(e){return new y.Multicast(t=>{let n=L.None;return this.state.lift(t,i=>{let s=i.transformed.get(e);if(void 0===s)return t.complete();n!==s&&(n=s,t.next(s))})})}tuples=new y.Multicast(e=>{let t=new Map,n=!0;return this.state.lift(e,i=>{if(!i.scaled&&!n)return;n=!1;let s=[];for(let e=0;e<i.events.length;e++){let n=i.events.get(e);if(n&&i.transformed.has(n.id)){let e=t.get(n.id)??this.create(n.id);t.set(n.id,e),s.push([n.id,e])}}e.next(s)})});flat=new y.Multicast(e=>this.state.lift(e,t=>{let n=[];for(let e=0;e<t.events.length;e++){let i=t.events.get(e),s=i&&t.transformed.get(i.id);void 0!==s&&n.push(s)}e.next(n)}));mapped=this.tuples.map(e=>new Map(e));subscribe=this.tuples.subscribe.bind(this.tuples);map(e){return new y.Multicast(t=>{let n=new Map,i=L.None;return this.state.lift(t,s=>{let r=[];for(let e=0;e<s.events.length;e++){let t=s.events.get(e)?.id,i=t&&s.transformed.get(t);if(t&&i){let e=n.get(t);e||(e=this.create(t),n.set(t,e)),r.push({id:t,value:i,observable:e})}}let a=e(r);D(a,i)||(i=a,t.next(a))})})}chunked(e){return new y.Multicast(t=>{let n=null;return C.Observable.combine(this.mapped,this.state).lift(t,([i,s])=>{let r=[],a=e=>{if(e<0||e>=s.events.length)return null;let t=s.events.get(e),n=s.transformed.get(t.id);return i.has(t.id)&&n?{event:t,transformed:n}:null},o=[],p=null;for(let t=0;t<s.events.length;t++){let n=a(t);if(!n)continue;let l=null;for(let e=t+1;e<s.events.length;e++)if(i.has(s.events.get(e).id)){l=a(e);break}let d=e(n,p,l);switch(p=n,d){case"continue":o.push(n.event.id);break;case"break":o.length&&(r.push(o),o=[]),o.push(n.event.id);break;case"isolate":o.length&&(r.push(o),o=[]),r.push([n.event.id])}}o.length&&r.push(o),D(r,n)||(n=r,t.next(r.map(e=>e.map(e=>[e,i.get(e)]))))})})}[Symbol.observable](){return this.tuples}}class x{nodes=new Set;up=new Map;down=new Map;leafs=new Map;get size(){return this.nodes.size}ids(){return new Set(this.nodes.keys())}has(e){return this.nodes.has(e)}parent(e){return this.up.get(e)??null}children(e){return this.down.get(e)??null}siblings(e){let t=this.parent(e);return t?this.children(t):null}hierarchy(e){let t=[e],n=e;for(;this.up.has(n);)t.unshift(n=this.up.get(n));return t}isLeaf(e){return this.leafs.has(e)}latest(){let e=null,t=-1;for(let[n,i]of this.leafs)i>t&&(e=n,t=i);return e}walk(e,t){if(!this.nodes.has(e))throw Error("node not in graph");if(!1===t(e,this.isLeaf(e)))return;let n=this.children(e);for(;n?.size===1;){if(!1===t(e=n.values().next().value,this.isLeaf(e)))return;n=this.children(e)}if(n?.size)for(let e of n)this.walk(e,t)}append(e){let t=this.nodes.size,n=new Set;for(let t of e){if(!n.has(t.id)&&this.nodes.has(t.id)){let e=this.up.get(t.id);if(e&&e!==t.parent)throw Error("parent mismatch");continue}if(this.nodes.add(t.id),n.add(t.id),this.down.has(t.id)||this.leafs.set(t.id,t.priority),t.parent){this.leafs.delete(t.parent);let e=this.down.get(t.parent);e||(e=new Set,this.down.set(t.parent,e),this.nodes.add(t.parent),n.add(t.parent)),this.up.set(t.id,t.parent),e.add(t.id)}}return this.nodes.size!==t}clone(){let e=new x;for(let[t,n]of(e.nodes=new Set(this.nodes),e.up=new Map(this.up),e.leafs=new Map(this.leafs),this.down))e.down.set(t,new Set(n));return e}}class B{queue=[];locked=!1;acquire(){return this.locked?new Promise(e=>{this.queue.push(e)}):(this.locked=!0,Promise.resolve())}release(){if(this.queue.length>0){let e=this.queue.shift();e?.()}else this.locked=!1}async run(e){await this.acquire();try{return await e()}finally{this.release()}}clear(){this.queue.length=0,this.locked=!1}}var F=e.i(99145),$=e.i(862927);let G={messageEventContents:{$kind:"messageEventContext",messageEventContext:$.Value.Create(l.MessageEventContextSchema)},inlineActionEventContents:{$kind:"inlineActionEventContext",inlineActionEventContext:$.Value.Create(l.InlineActionEventContextSchema)},shellSuggestionEventContents:{$kind:"shellSuggestionEventContext",shellSuggestionEventContext:$.Value.Create(l.ShellSuggestionEventContextSchema)},sessionCreationEventContents:{$kind:"sessionCreationEventContext",sessionCreationEventContext:$.Value.Create(l.SessionCreationEventContextSchema)},localShellExecutionEventContents:{$kind:"localShellExecutionEventContext",localShellExecutionEventContext:$.Value.Create(l.LocalShellExecutionEventContextSchema)},translateEventContents:{$kind:"translateEventContext",translateEventContext:$.Value.Create(l.TranslateEventContextSchema)},byoPromptEventContents:{$kind:"byoPromptEventContext",byoPromptEventContext:$.Value.Create(l.BYOPromptEventContextSchema)},agentPlanEventContents:{$kind:"agentPlanEventContext",agentPlanEventContext:$.Value.Create(l.AgentPlanEventContextSchema)},agentTimelineEventContents:{$kind:"agentTimelineEventContext",agentTimelineEventContext:$.Value.Create(l.AgentTimelineEventContextSchema)},iterativeAgentEventContents:{$kind:"iterativeAgentEventContext",iterativeAgentEventContext:$.Value.Create(l.IterativeAgentEventContextSchema)}};for(let e of Object.values(G))(0,a.freeze)(e,!0);let q=(0,a.freeze)($.Value.Create(l.EventSchema),!0);class V{stockpile=new Map;registry=new FinalizationRegistry(e=>{this.stockpile.delete(e)});listeners=new F.ListenerList;get empty(){return 0===this.stockpile.size}has(e){return this.stockpile.has(e)&&this.stockpile.get(e)?.deref()!==void 0}get(e){return this.stockpile.get(e)?.deref()??null}add(e){let t=this.stockpile.get(e.id)?.deref();return t===e?t:(t&&this.registry.unregister(t),this.stockpile.set(e.id,new WeakRef(e)),this.registry.register(e,e.id,e),this.listeners.notify(e),e)}emplace(e){let t=this.stockpile.get(e.id)?.deref();return t||(this.stockpile.set(e.id,new WeakRef(e)),this.registry.register(e,e.id,e),this.listeners.notify(e),e)}delete(e){let t=this.stockpile.get(e);if(t){this.stockpile.delete(e);let n=t.deref();n&&this.registry.unregister(n)}}store(e){"string"==typeof(e??=[])&&(e=[e]);let t=new Set,n=new Map;for(let i of e)t.add(i),n.set(i,this.get(i));let i=!1,s=this.listeners.add(e=>{t.has(e.id)&&n.set(e.id,e)});return{has:e=>t.has(e),get:e=>n.get(e)??null,track:e=>{if(i)throw Error("Store has been released");for(let i of e=Array.isArray(e)?e:[e])t.add(i),n.set(i,this.get(i))},untrack:e=>{if(i)throw Error("Store has been released");for(let i of e=Array.isArray(e)?e:[e])i="string"==typeof i?i:i.id,t.delete(i),n.delete(i)},release:()=>{i||(i=!0,s(),t.clear(),n.clear())},*[Symbol.iterator](){for(let e of t){let t=n.get(e);t&&(yield t)}}}}clear(){for(let e of this.stockpile.keys())this.delete(e)}}let W={events:new class extends V{invalidate(){for(let e of this.stockpile.values()){let t=e.deref();t&&t.state!==l.EventState.COMPLETE&&this.delete(t.id)}}create(e){let t,n;return this.add(((t=Object.assign({},q)).id=e.eventId,t.parentEventId=e.parentEventId,t.sessionId=e.sessionId,t.state=e.state,t.error=e.error,t.sender=e.sender,t.contents=e.contents,t.created=new Date,(n=e.contents.contents?.$kind)&&G[n]&&(t.context={metadata:G[n]}),t))}update(e){let t=this.get(e.eventId);return t?this.add((0,m.applyEventUpdateMessage)(t,e)):null}},sessions:new class extends V{invalidate(){for(let e of this.stockpile.values()){let t=e.deref();t&&!t.archived&&this.delete(t.id)}}create(e){return this.add((0,v.createSessionFromCreateSessionMessage)(e))}update(e){let t=this.get(e.sessionId);return t?this.add((0,v.applySessionUpdateMessage)(t,e)):null}}};class K{api;id;eventId;parent;session;constructor(e,t,n,i,s){this.api=e,this.id=t,this.eventId=n,this.parent=i,this.session=s}static subagents=new WeakMap;static create(e,t,n,i,s){let r=this.subagents.get(e);r||(r=new Map,this.subagents.set(e,r));let a=r.get(t),o=a?.deref();if(a&&o||(a=new WeakRef(o=new K(e,t,n,i,s)),r.set(t,a)),o.eventId!==n)throw Error("Subagent event ID mismatch");if(o.parent!==i)throw Error("Subagent parent mismatch");if(o.session!==s)throw Error("Subagent session mismatch");return o}event=new y.Multicast(e=>{let t=W.events.store(this.eventId),n=this.api.materializer.get(this.eventId);n&&e.next(n);let i=this.api.state.register({snapshot:()=>n,rollback:e=>n=e,notify:()=>{n&&e.next(n)},update:e=>{if("event-modified"===e.kind&&e.event.id===this.eventId)return n=e.event,!0}}),s=this.api.connected.lift(e,async t=>{let s=W.events.get(this.eventId);s&&n!==s&&(n=s,i.commit(),e.next(n));let r=await (0,g.get)(this.api.materializer.materialize(this.parent.id,[this.eventId]));if(t.aborted||(0,g.isError)(r,"UNEXPECTED_DISCONNECT"))return;if(!r.ok)return this.api.error(r,e);let a=W.events.emplace(r.payload[0]);n!==a&&(n=a,i.commit(),e.next(n))});return()=>{t.release(),i.unsubscribe(),s.unsubscribe()}});data=this.event.select(e=>e.contents.contents.subagentRunning);kind=this.data.filter(e=>void 0!==e.contents).select(e=>e.contents.$kind);running=this.event.select(e=>e.state!==l.EventState.COMPLETE);totalExecutionTimeSeconds=this.data.select(e=>e.totalExecutionTimeSeconds);contents(e){return this.data.filter(t=>t.contents?.$kind===e).select(e=>(0,R.unkind)(e.contents))}async abort(){let e=await this.api.service.abortSubagent.rpc({replId:this.api.replId,sessionId:this.parent.id,subagentId:this.id});return e.ok?(0,g.Ok)(null):this.api.error(e)}}var H=e.i(790164);class z{api;session;size;constructor(e,t,n){this.api=e,this.session=t,this.size=new H.ObservableState(n)}events=new y.Multicast(e=>{let t=new A,n=new U,i=e=>{let i=e?.length?new Map(e.map(e=>[e.id,e])):null,s=n.adopt(t,i);return!!s&&(s.missing.length&&this.api.materializer.enqueue(this.session.id,s.missing),!0)},s=this.api.state.register({snapshot:()=>({ids:t.clone(),events:n.clone()}),rollback:e=>{t=e.ids,n=e.events},notify:()=>e.next(n),update:e=>{if("event-modified"===e.kind&&t.has(e.event.id))return i([e.event])}}),r=this.api.materializer.events.lift(e,s=>{let r=s.filter(({id:e})=>t.has(e));r.length&&i(r)&&e.next(n)}),a=C.Observable.combine(this.session.ids,this.size).lift(e,([s,r])=>{let a=s.length?s.id(Math.max(0,s.length-r)):null,o=t.patch(s,a);o&&i(o.added.map(e=>this.api.materializer.get(e)).filter(e=>null!==e))&&e.next(n)});return()=>{s.unsubscribe(),r.unsubscribe(),a.unsubscribe()}});subscribe=this.events.subscribe.bind(this.events);[Symbol.observable](){return this.events}}function Y(e){let{api:t,sessionId:n,tip:i,onGraphFetched:s}=e;return new y.Multicast(e=>{let r=!0,a=!0,o=new x,p=()=>{if(i&&!o.has(i))return t.error(`Tip event ${i} not found in graph`,e);let n=i??o.latest();if(!n)return t.error("Unexpected empty graph",e);let s=o.hierarchy(n),r=new A;r.append(s),e.next(r)},l=t.state.register({snapshot:()=>o.clone(),rollback:e=>o=e,notify:()=>p(),update:e=>{if(!a&&"event-modified"===e.kind&&"created"===e.type&&e.event.sessionId===n)return o.append([{id:e.event.id,parent:e.event.parentEventId,priority:e.event.created.getTime()}])}}),d=t.connected.lift(e,async d=>{let c=Date.now();l.rollback(),a=!0,t.logger.info?.(i?"Starting to fetch session graph from tip":"Starting to fetch session graph",{sessionId:n,tip:i});let u=0,T=!1,y=i??null,h=[];if(i){let s=await t.service.batchGetEvents.rpc({sessionId:n,eventIds:[i]});if(d.aborted||(0,g.isError)(s,"UNEXPECTED_DISCONNECT"))return;if(!s.ok)return t.error(s,e);if(s.payload.events.length>0){let e=s.payload.events[0];h.push({id:e.id,parent:e.parentEventId||null,priority:e.created.getTime()})}}for(let s=200;s>0;s--){u++;let s=await t.service.getEventList.rpc({sessionId:n,limit:500,AncestorsOf:y?{$kind:"ancestorsOf",ancestorsOf:y}:void 0});if((d.aborted||!s.ok)&&t.logger.info?.(i?"Aborted fetching session graph from tip":"Aborted fetching session graph",{sessionId:n,tip:i,numPagesFetched:u,amountFetched:h.length,duration:Date.now()-c}),d.aborted||(0,g.isError)(s,"UNEXPECTED_DISCONNECT"))return;if(!s.ok)return t.error(s,e);for(let e of s.payload.shapes)h.push({id:e.id,parent:e.parentEventId||null,priority:e.created.getTime()});if(s.payload.shapes.length<500||(y=s.payload.shapes[s.payload.shapes.length-1].id,o.has(y)))break}h.length&&(T=o.append(h)),a=!1,(T||r)&&(r=!1,l.commit(),p()),t.logger.info?.(i?"Finished fetching session graph from tip":"Finished fetching session graph",{sessionId:n,tip:i,numPagesFetched:u,amountFetched:h.length,duration:Date.now()-c}),s?.(Date.now()-c,h.length)});return()=>{l.unsubscribe(),d.unsubscribe()}})}class Q{api;agent;id;created;mutex=new B;constructor(e,t,n){this.api=e,this.agent=new O(e,this),this.id=t,this.created=n,this.ids=Y({api:this.api,sessionId:this.id,onGraphFetched:(e,t)=>{this.api.hooks.trigger("session-graph-fetched",{session:this,duration:e,size:t})}}),this.leaf=this.ids.select(e=>e.last).filter(e=>null!==e),this.api.teardown(()=>this.mutex.clear())}static sessions=new WeakMap;static create(e,t,n){let i=this.sessions.get(e);i||(i=new Map,this.sessions.set(e,i));let s=i.get(t),r=s?.deref();return s&&r||(s=new WeakRef(r=new Q(e,t,n)),i.set(t,s)),r}data=new y.Multicast(e=>{let t=null,n=W.sessions.get(this.id);n&&(t=(0,v.compatSessionToData)(n),e.next(n));let i=this.api.state.register({snapshot:()=>t,rollback:e=>t=e,notify:()=>{t&&e.next((0,v.compatDataToSession)(this.api.replId,t))},update:e=>{if(t&&e.optimistic&&"session-modified"===e.kind&&e.session.id===this.id){let n=(0,h.create)(t,t=>{t.title=e.session.title,t.archived=e.session.archived,t.readOnly=e.session.readOnly,t.taskId=e.session.taskId}),i=t!==n;return t=n,i&&(t.updated=new Date),i}}}),s=this.api.connected.lift(e,async n=>{let s=(0,f.getSnapshotStream)(this.api.chort.sessions.data.subscribe({sessionId:this.id},{signal:n})),r=!0;for await(let n of s){if((0,g.isError)(n,"UNEXPECTED_DISCONNECT","CANCEL"))return;if(!n.ok)return this.api.error(n,e);r&&(i.rollback(),r=!1),W.sessions.add((0,v.compatDataToSession)(this.api.replId,n.payload)),i.rebase(()=>(t=n.payload,!0))}});return()=>{i.unsubscribe(),s.unsubscribe()}});type=this.data.select(e=>e.sessionType);ids;leaf;subagent(e,t,n,i){return K.create(this.api,e,t,this,Q.create(this.api,n,i))}window(e){return new z(this.api,this,e)}from(e){return new X(this,e)}reduce(e,t){return"global"===t?new j(this.api,this,e):new M(this.api,this,e,t)}transform(e,t){return new _(this.api,this,e,t)}async updateSession(e){let t=await (0,g.get)(this.data);if(!t.ok)return this.api.error(t);let n=t.payload,{session:i,request:s}=(0,v.createUpdateSessionRequest)(n,e);if(n===i)return(0,g.Ok)(n);let[r,a]=this.api.state.stage({kind:"session-modified",type:"updated",session:i}),o=await this.api.service.updateSession.rpc(s);return o.ok?(r(),this.api.hooks.trigger("client-updated-session",{session:this,request:s,prev:n,next:i}),(0,g.Ok)(i)):(a(),this.api.error(o))}updateEvent(e){return this.mutex.run(async()=>{let t=await (0,g.get)(this.ids.map(t=>t.has(e.id)));if(!t.ok)return this.api.error(t);if(!t.payload)return this.api.error("Event does not exist in the session");let n=await (0,g.get)(this.api.materializer.materialize(this.id,[e.id]));if(!n.ok)return this.api.error(n);let[i]=n.payload,s=(0,E.createUpdateEventRequest)(e),r=(0,m.applyEventUpdateMessage)(i,s);if(r===i)return(0,g.Ok)(r);let[a,o]=this.api.state.stage({kind:"event-modified",type:"updated",event:r}),[p,l]=await this.api.service.updateEvent.upload();p.push(s),p.end();let d=await l;return d.ok?(this.api.hooks.trigger("client-updated-event",{session:this,request:s,prev:i,next:r}),a(),(0,g.Ok)(r)):(o(),this.api.error(d))})}appendEvent(e,t){return this.mutex.run(async()=>{let n=await (0,g.get)([this.leaf,this.data.select(e=>e.sessionType)]);if(!n.ok)return this.api.error(n);let[i,s]=n.payload;if(void 0!==e.modelType&&s===l.SessionType.AGENT_SESSION)return this.api.error("Agent sessions do not support model type configuration");let r=l.ModelType.BASIC;if(e.modelType===l.ModelType.ADVANCED&&(r=this.api.hasAdvancedModel.current?this.api.overrideModel.current?{type:l.ModelType.OVERRIDE,overrideModelName:this.api.overrideModel.current}:l.ModelType.ADVANCED:l.ModelType.BASIC),e.modelType===l.ModelType.OVERRIDE){if(!this.api.overrideModel.current)return this.api.error("No override model set");r={type:l.ModelType.OVERRIDE,overrideModelName:this.api.overrideModel.current}}let{event:a,request:o}=(0,S.createEventRequest)({session:this.id,sender:this.api.user.current,addToChild:!0,parent:i,model:r,data:e,benchmark:t}),[p,d]=this.api.state.stage({kind:"event-modified",type:"created",event:a,condition:e=>!("event-modified"===e.kind&&"created"===e.type&&(e.event.id===a.id?e.event.parentEventId!==a.parentEventId:e.event.parentEventId===a.parentEventId))}),c=await this.api.service.createEvent.rpc(o);if(!c.ok)return d(),this.api.error(c);if(c.payload.eventId!==a.id||c.payload.parentEventId!==a.parentEventId){d();let e=await (0,g.get)(this.api.materializer.materialize(this.id,[c.payload.eventId]));return e.ok?(this.api.hooks.trigger("client-appended-event",{session:this,event:e.payload[0]}),(0,g.Ok)(e.payload[0])):this.api.error(e)}return p(),this.api.hooks.trigger("client-appended-event",{session:this,event:a}),(0,g.Ok)(a)})}abortLastEvent(){return this.mutex.run(async()=>{let e=await (0,g.get)(this.leaf);if(!e.ok)return this.api.error(e);let t=await this.api.service.abortEvent.rpc({eventId:e.payload});return t.ok?(0,g.Ok)(null):this.api.error(t)})}async submitUserFeedback(e){let t=await (0,g.get)([this.data.select(e=>e.sessionType),this.leaf]);if(!t.ok)return this.api.error(t);let[n,i]=t.payload,s=await this.api.service.submitAgentUserFeedback.rpc({sessionId:this.id,sessionType:n,feedback:e,sourceEventId:i});return s.ok?(0,g.Ok)(null):this.api.error(s)}}class X{api;id;tip;session;ids;constructor(e,t){this.api=e.api,this.id=e.id,this.tip=t,this.session=e,this.ids=Y({api:this.api,sessionId:this.id,tip:this.tip})}window(e){return new z(this.api,this,e)}reduce(e,t){return"global"===t?new j(this.api,this,e):new M(this.api,this,e,t)}transform(e,t){return new _(this.api,this,e,t)}}class J{api;archived;readonly;limit;types;constructor(e,t={}){this.api=e,this.archived=t.archived??null,this.readonly=t.readonly??null,this.limit=t.limit??1e3,this.types=t.types??[l.SessionType.CHAT,l.SessionType.AGENT_SESSION]}map=new y.Multicast(e=>{let t=!1,n=W.sessions.store(),i=new Map,s=this.api.state.register({snapshot:()=>new Map(i),rollback:e=>{i=new Map(e);let t=n;n=W.sessions.store(Array.from(i.keys())),t.release()},notify:()=>e.next(new Map(i)),update:e=>{if(!t||"session-modified"!==e.kind)return;let n=e.session,s=this.types.includes(n.sessionType)&&(null===this.archived||n.archived===this.archived)&&(null===this.readonly||n.readOnly===this.readonly);return!i.has(n.id)&&s?(i.set(n.id,Q.create(this.api,n.id,n.created)),!0):i.has(n.id)&&!s?(i.delete(n.id),!0):void 0}}),r=this.api.connected.lift(e,r=>{this.api.queryFetchCounter.scope(async()=>{let a=await this.api.service.getReplSessions.rpc({beforeTimestamp:new Date("2099-01-01"),limit:this.limit,includeFirstSessionEvents:!1,firstSessionEventsLimit:1,replId:this.api.replId,sessionTypes:this.types,archived:this.archived??void 0});if(r.aborted||(0,g.isError)(a,"UNEXPECTED_DISCONNECT"))return;if(!a.ok)return this.api.error(a,e);s.rollback();let o=new Set(i.keys()),p=!1;for(let e of a.payload.sessions){if(e.events=[],W.sessions.emplace(e),null!==this.readonly&&e.readOnly!==this.readonly||(o.delete(e.id),i.has(e.id)))continue;let t=Q.create(this.api,e.id,e.created);n.track(e.id),i.set(e.id,t),p=!0}for(let e of o)n.untrack(e),i.delete(e),p=!0;(p||!t)&&(t=!0,s.commit(),e.next(new Map(i)))})});return()=>{n.release(),s.unsubscribe(),r.unsubscribe()}});list=this.map.select(e=>Array.from(e.values()).sort((e,t)=>t.created.getTime()-e.created.getTime()),(e,t)=>e.length===t.length&&e.every((e,n)=>e===t[n]));latest=this.map.select(e=>{let t=null;for(let n of e.values())(!t||n.created>t.created)&&(t=n);return t});subscribe=this.map.subscribe.bind(this.map);[Symbol.observable](){return this.map}}var Z=e.i(493830);class ee{__brand;is(e){return"effect"===e.kind&&e.effect===this}}class et{api;handles=new Map;onUpdateHandlers=null;refs=new Set;buffer=[];conditions=new Set;listeners=new F.ListenerList;optimistic=!1;constructor(e){this.api=e;const t=this.api.status.subscribe(e=>{"connected"!==e&&(W.events.invalidate(),W.sessions.invalidate(),this.optimistic&&this.rollback())});let n=null;const i=this.api.hooks.subscribe(e=>{if("agent-state-changed"===e.type||"received-completed-event"===e.type||"received-event"===e.type){let e=this.api.hooks.has("agent-state-changed")||this.api.hooks.has("received-completed-event")||this.api.hooks.has("received-event");e&&!n?n=this.updates.subscribe(()=>{}):!e&&n&&(n.unsubscribe(),n=null)}});this.api.teardown(()=>{t.unsubscribe(),i(),n?.unsubscribe()})}emitter=new C.Observable(e=>this.api.connected.lift(e,async t=>{let n=W.events.store(),i=W.sessions.store(),[s,r]=await this.api.service.subscribeToReplEvents.subscribe({replId:this.api.replId}),a=()=>{r(),n.release(),i.release()};if(t.aborted)return a();for await(let a of(t.addEventListener("abort",r),s)){let s;if(t.aborted||(0,g.isError)(a,"UNEXPECTED_DISCONNECT"))break;if(!a.ok){this.api.error(a,e);break}if(!a.payload.message)continue;let r=(0,R.unwrapKind)(a.payload.message);if(a.payload.sender.type!==l.UserType.USER)switch(r.$kind){case"createEventMessage":case"updateEventMessage":this.api.hooks.trigger("agent-activity",{type:"modify-event"});break;case"createSessionMessage":case"updateSessionMessage":this.api.hooks.trigger("agent-activity",{type:"modify-session"});break;case"updateAgentStateMessage":this.api.hooks.trigger("agent-activity",{type:"modify-state"})}switch(r.$kind){case"subscriptionStatusMessage":case"abortEventMessage":continue;case"createEventMessage":{let e=W.events.create(r);e.state===l.EventState.COMPLETE?this.api.hooks.trigger("received-completed-event",{event:e}):this.api.hooks.has("received-completed-event")&&n.track(e.id),void 0===e.contents.contents&&this.api.hooks.has("received-event")?i.track(e.id):this.api.hooks.trigger("received-event",{event:e}),s={kind:"event-modified",optimistic:!1,type:"created",event:e};break}case"updateEventMessage":{let e=W.events.update(r);if(!e)continue;n.has(e.id)&&e.state===l.EventState.COMPLETE&&(n.untrack(e.id),this.api.hooks.trigger("received-completed-event",{event:e})),i.has(e.id)&&void 0!==e.contents.contents&&(i.untrack(e.id),this.api.hooks.trigger("received-event",{event:e})),s={kind:"event-modified",optimistic:!1,type:"updated",event:e};break}case"createSessionMessage":s={kind:"session-modified",optimistic:!1,type:"created",session:W.sessions.create(r)};break;case"updateSessionMessage":{let e=W.sessions.update(r);if(!e)continue;s={kind:"session-modified",optimistic:!1,type:"updated",session:e};break}case"updateAgentStateMessage":{let e=b(r);this.api.hooks.trigger("agent-state-changed",{sessionId:r.sessionId,state:e}),s={kind:"agent-state-modified",optimistic:!1,session:r.sessionId,state:e}}}for(let e of this.conditions)if(!1===e(s)){this.rollback();break}e.next(s)}t.removeEventListener("abort",a),a()}));updates=new y.StatelessMulticast(e=>{let t=this.listeners.add(t=>{e.next(t)}),n=this.emitter.subscribe(e);return()=>{t(),n.unsubscribe()}});isOptimisticEvent(e){let t=this.buffer.filter(e=>"event-modified"===e.kind).find(t=>t.event.id===e);return!!t&&t.type}getOptimisticEvent(e){let t=this.buffer.filter(e=>"event-modified"===e.kind).find(t=>t.event.id===e);if(!t)throw Error("Event not found in optimistic state");return t.event}apply(e){let t=new Set;for(let[n,i]of this.handles){if(e.optimistic&&i!==L.None){n.update?.(e)&&t.add(n);continue}if(e.optimistic&&i===L.None){let i=n.snapshot();n.update?.(e)&&(this.handles.set(n,i),t.add(n));continue}if(!e.optimistic&&i!==L.None){n.rollback(i),n.update?.(e)&&t.add(n);let s=n.snapshot();for(let e of this.buffer)n.update?.(e)&&(this.handles.set(n,s),t.add(n));continue}!e.optimistic&&i===L.None&&n.update?.(e)&&t.add(n)}for(let e of t)e.notify?.()}rollback(){if(!this.optimistic)throw Error("Cannot rollback while not optimistic");this.optimistic=!1,this.buffer.length=0,this.refs.clear(),this.conditions.clear();let e=new Set;for(let[t,n]of this.handles)n!==L.None&&(t.rollback(n),this.handles.set(t,L.None),e.add(t));for(let t of e)t.notify?.()}commit(){if(!this.optimistic)throw Error("Cannot commit while not optimistic");for(let e of this.buffer)switch(e.kind){case"event-modified":W.events.emplace(e.event);break;case"session-modified":W.sessions.emplace(e.session)}for(let e of(this.optimistic=!1,this.buffer.length=0,this.refs.clear(),this.conditions.clear(),this.handles.keys()))this.handles.set(e,L.None)}stage(e,t){let n;if(e instanceof ee)n={kind:"effect",effect:e,data:t};else if(e)n=e;else throw Error("Invalid effect or update");if("connected"!==this.api.status.current)throw Error("Cannot notify while not connected");let{condition:i,...s}=n,r={...s,optimistic:!0};this.buffer.push(r),i&&this.conditions.add(i);let a=e=>{this.refs.has(a)&&(this.refs.delete(a),e?0===this.refs.size&&this.commit():(this.rollback(),this.api.hooks.trigger("client-state-rollback",{failed:r})),i&&this.conditions.delete(i))};return this.refs.add(a),this.optimistic=!0,this.listeners.notify(r),[()=>a(!0),()=>a(!1)]}register(e){this.onUpdateHandlers??=this.updates.subscribe(e=>{this.apply(e)});let t=()=>this.handles.get(e)!==L.None;return this.handles.set(e,L.None),this.optimistic&&e.update&&Promise.resolve().then(()=>{if(!this.handles.has(e)||!this.optimistic)return;let t=e.snapshot(),n=!1;for(let t of this.buffer)e.update?.(t)&&(n=!0);n&&(this.handles.set(e,t),e.notify?.())}),{get optimistic(){return t()},rollback:()=>{let t=this.handles.get(e);t!==L.None&&(e.rollback(t),this.handles.set(e,L.None))},commit:()=>{this.handles.set(e,L.None)},rebase:t=>{let n=this.handles.get(e);if(n===L.None){t()&&e.notify?.();return}let i=e.snapshot();if(e.rollback(n),this.handles.set(e,L.None),!t()){this.handles.set(e,n),e.rollback(i);return}let s=!1,r=e.snapshot();for(let t of this.buffer)e.update?.(t)&&!s&&(this.handles.set(e,r),s=!0);e.notify?.()},unsubscribe:()=>{this.handles.delete(e),0===this.handles.size&&(this.onUpdateHandlers?.unsubscribe(),this.onUpdateHandlers=null)}}}}let en=new ee,ei=new ee,es=new ee;class er{api;pauseConnections=new Map;clientIsPausedSubject=new Z.Subject;constructor(e){this.api=e}state=new y.Multicast(e=>{let t=null,n=this.api.state.register({snapshot:()=>t,rollback:e=>t=e,notify:()=>{t&&e.next(t)},update:e=>{if(t){if(en.is(e)){let n=(0,h.create)(t,t=>{let n=t.find(t=>t.id===e.data.id);n&&(n.contents=e.data.contents)}),i=n!==t;return t=n,i}if(ei.is(e)){let n=(0,h.create)(t,t=>{for(let n of e.data.ids){let e=t.findIndex(e=>e.id===n);-1!==e&&t.splice(e,1)}}),i=n!==t;return t=n,i}if(es.is(e)){let n=(0,h.create)(t,t=>{let n=t.findIndex(t=>t.id===e.data.id),i=t[n];if(!i)return;if(null===e.data.after){t.splice(n,1),t.unshift(i);return}let s=t.findIndex(t=>t.id===e.data.after);-1!==s&&(n<s&&s--,t.splice(n,1),t.splice(s+1,0,i))}),i=n!==t;return t=n,i}}}}),i=this.api.connected.lift(e,async i=>{let{resReadable:s}=this.api.chort.queue.state.subscribe({},{signal:i});for await(let i of s){if((0,g.isError)(i,"UNEXPECTED_DISCONNECT","CANCEL"))return;if(!i.ok)return this.api.error(i,e);n.rebase(()=>(t=i.payload,!0))}});return()=>{i(),n.unsubscribe()}});async get(){let e=await this.api.chort.queue.get.rpc({});return e.ok?(0,g.Ok)(e.payload):this.api.error(e)}async enqueue({contents:e}){let t=await this.api.chort.queue.enqueue.rpc({contents:e});return t.ok?(0,g.Ok)(t.payload):this.api.error(t)}async update({id:e,contents:t}){let[n,i]=this.api.state.stage(en,{id:e,contents:t}),s=await this.api.chort.queue.update.rpc({id:e,contents:t});return s.ok?(n(),(0,g.Ok)(s.payload)):(i(),this.api.error(s))}async reorder({id:e,after:t}){let[n,i]=this.api.state.stage(es,{id:e,after:t}),s=await this.api.chort.queue.reorder.rpc({id:e,after:t});return s.ok?(n(),(0,g.Ok)(s.payload)):(i(),this.api.error(s))}async flush({ids:e,session:t}){let[n,i]=this.api.state.stage(ei,{ids:e}),s=await this.api.chort.queue.flush.rpc({ids:e,session:t});return s.ok?(n(),(0,g.Ok)(s.payload)):(i(),(0,g.isError)(s,"QUEUE_PAUSED"))?(0,g.Ok)({events:[]}):this.api.error(s)}async delete({ids:e}){let[t,n]=this.api.state.stage(ei,{ids:e}),i=await this.api.chort.queue.delete.rpc({ids:e});return i.ok?(t(),(0,g.Ok)(i.payload)):(n(),this.api.error(i))}isPaused=new y.Multicast(e=>{let t=!1,n=!1,i=this.api.connected.lift(e,async i=>{let{resReadable:s}=this.api.chort.queue.pauseState.subscribe({},{signal:i});for await(let i of s){if((0,g.isError)(i,"UNEXPECTED_DISCONNECT","CANCEL"))return;if(!i.ok)return this.api.error(i,e);let s=i.payload.paused;n&&s===t||(n=!0,t=s,e.next(t))}});return()=>{i()}});clientIsPaused=new y.Multicast(e=>(e.next(this.pauseConnections.size>0),this.clientIsPausedSubject.subscribe(e)));play({session:e}){let t=this.pauseConnections.get(e);t&&(t(),this.pauseConnections.delete(e),this.clientIsPausedSubject.next(this.pauseConnections.size>0))}pause({session:e}){if(this.pauseConnections.has(e))return;let t=new AbortController,n=this.api.connected.subscribe(async n=>{if(t.signal.aborted)return;let i=new AbortController,s=()=>i.abort();n.addEventListener("abort",s),t.signal.addEventListener("abort",s);let r=()=>{let i=this.pauseConnections.get(e);i&&(i(),this.pauseConnections.delete(e),this.clientIsPausedSubject.next(this.pauseConnections.size>0)),n.removeEventListener("abort",s),t.signal.removeEventListener("abort",s)};try{let{resReadable:t}=this.api.chort.queue.pause.subscribe({session:e},{signal:i.signal});for await(let e of t){if((0,g.isError)(e,"UNEXPECTED_DISCONNECT","CANCEL"))return;if(!e.ok)return void this.api.error(e)}}finally{r()}});this.pauseConnections.set(e,()=>{t.abort(),n.unsubscribe()}),this.clientIsPausedSubject.next(this.pauseConnections.size>0)}}var ea=e.i(986684);class eo{api;constructor(e){this.api=e}run(e){return ep.create(this.api,e)}async debugCreate(e){let t=await this.api.chort.subreplrun.debugCreateSubreplRunWithMessage.rpc({message:e});return t.ok?(0,g.Ok)(t.payload.subreplRun):this.api.error(t)}async debugCreateWithTask(e){let t=await this.api.chort.subreplrun.debugCreateSubreplRunWithTask.rpc({taskId:e});return t.ok?(0,g.Ok)(t.payload.subreplRun):this.api.error(t)}}class ep{api;id;finalData=null;constructor(e,t){this.api=e,this.id=t}static cache=new WeakMap;static create(e,t){let n=this.cache.get(e);n||(n=new Map,this.cache.set(e,n));let i=n.get(t),s=i?.deref();return i&&s||(i=new WeakRef(s=new ep(e,t)),n.set(t,i)),s}data=new y.Multicast(e=>{if(this.finalData){e.next(this.finalData),e.complete();return}return this.api.connected.lift(e,async t=>{for await(let n of(0,f.getSnapshotStream)(this.api.chort.subreplrun.watch.subscribe({runId:this.id},{signal:t}))){if((0,g.isError)(n,"UNEXPECTED_DISCONNECT","CANCEL"))return;if(!n.ok)return this.api.error(n,e);let t=n.payload;if(e.next(t),t.state!==ea.SubreplRunState.READY){this.finalData=t,e.complete();return}}})});subscribe=this.data.subscribe.bind(this.data);[Symbol.observable](){return this.data}}class el{api;sessions;queue;subreplrun;constructor(e){this.api=e,this.sessions={query:e=>new J(this.api,e),create:e=>this.api.createSession(e),rollback:e=>this.api.revertToCommit(e),get:e=>this.api.getSessionObservableById(e),chat:{all:new J(e,{types:[l.SessionType.CHAT]}),open:new J(e,{types:[l.SessionType.CHAT],archived:!1}),archived:new J(e,{types:[l.SessionType.CHAT],archived:!0})},agent:{all:new J(e,{types:[l.SessionType.AGENT_SESSION,l.SessionType.TASK_AGENT]}),current:this.api.currentAgentSession,readonly:new J(e,{types:[l.SessionType.AGENT_SESSION,l.SessionType.TASK_AGENT],readonly:!0})}},this.queue=new er(this.api),this.subreplrun=new eo(this.api)}hook(e,t){return this.api.hooks.add(e,t)}usage(e){return this.api.createUsageWatcher({start:e})}}class ed{api;hooks={};listeners=new F.ListenerList;constructor(e){this.api=e}has(e){return void 0!==this.hooks[e]}add(e,t){let n=this.hooks[e];n||(n=new Map,this.hooks[e]=n);let i=()=>{n&&n.has(i)&&(n.delete(i),0===n.size&&(delete this.hooks[e],n=void 0),this.listeners.notify({kind:"hook-unregistered",type:e}))};return n.set(i,t),this.listeners.notify({kind:"hook-registered",type:e}),i}trigger(e,t){let n=this.hooks[e];if(n)for(let e of[...n.values()])try{e(t)}catch(e){this.api.error(e)}}subscribe(e){return this.listeners.add(e)}dispose(){for(let e of Object.values(this.hooks))for(let t of e.keys())t()}}class ec{connection;chortConnection;user;hasAdvancedModel;overrideModel;onError;hooks;disposed=!1;teardowns=new F.ListenerList;logger;status;constructor({connection:e,chortConnection:t,user:n,hasAdvancedModel:i,overrideModel:s,logger:r,onError:a}){this.connection=e,this.chortConnection=t??null,this.user=new H.ObservableState(n),this.hasAdvancedModel=new H.ObservableState(i),this.overrideModel=new H.ObservableState(s??null),this.logger=function(e){let t={},n="chatter: ";if(e.debug){let i=e.debug;t.debug=(e,t)=>{i(n+e,t)}}if(e.info){let i=e.info;t.info=(e,t)=>{i(n+e,t)}}if(e.warn){let i=e.warn;t.warn=(e,t)=>{i(n+e,t)}}if(e.error){let i=e.error;t.error=(e,t)=>{i(n+e,t)}}return t}(r??{}),this.onError=a,this.hooks=new ed(this),this.teardown(()=>this.hooks.dispose());const o=new H.ObservableState(eu(this.connection.status.current,this.chortConnection?.status.current??null));this.teardown(()=>{"closed"!==o.current&&"error"!==o.current&&o.set("closed")}),this.status=o;const p=this.connection.status.subscribe(e=>{let t=this.chortConnection?.status.current??null;this.logger.info?.("connection status changed",{connectionStatus:e,chortConnectionStatus:t}),o.set(eu(e,t)),("closed"===e||"error"===e)&&this.dispose()});if(this.teardown(()=>p.unsubscribe()),this.chortConnection){const e=this.chortConnection.status.subscribe(e=>{let t=this.connection.status.current;this.logger.info?.("connection status changed",{connectionStatus:t,chortConnectionStatus:e}),o.set(eu(t,e)),("closed"===e||"error"===e)&&this.dispose()});this.teardown(()=>e.unsubscribe())}this.logger.info?.("API initialized")}get service(){return this.connection.service}get chort(){if(!this.chortConnection)throw Error("Chort connection is not set");return this.chortConnection.client}connected=new C.Observable(e=>{if(this.disposed)return"error"===this.status.current?e.error(Error("Connection error")):e.complete(),()=>{};let t=null,n=this.teardowns.add(()=>{t?.abort(),t=null,e.complete()}),i=this.status.subscribe(n=>{"connected"!==n?(t?.abort(),t=null,"closed"===n?e.complete():"error"===n&&e.error(Error("Connection error"))):t||(t=new AbortController,e.next(t.signal))});return()=>{t?.abort(),t=null,n(),i.unsubscribe()}});closed=new C.Observable(e=>{if(this.disposed)return e.next(),e.complete(),()=>{};let t=this.teardowns.add(()=>{e.next(),e.complete()}),n=this.status.subscribe(t=>{("closed"===t||"error"===t)&&(e.next(),e.complete())});return()=>{t(),n.unsubscribe()}});error(e,t){let n=(0,g.Err)(e);if(!(0,g.isError)(n,"UNEXPECTED_DISCONNECT")&&!n.reported)if(n.reported=!0,this.onError){let t=null;"object"==typeof e&&"payload"in e&&(t=n.payload),this.onError(n,t)}else setTimeout(()=>{throw n},0);return t&&t.error(n),(0,g.isError)(n,"UNEXPECTED_DISCONNECT")?this.hooks.trigger("unexpected-disconnect",{error:n}):this.hooks.trigger("unhandled-exception",{error:n}),n}teardown(e){return this.disposed?(e(),()=>{}):this.teardowns.add(e)}async ping(){let e=await this.service.pingPong.rpc({});if((0,g.isError)(e,"UNEXPECTED_DISCONNECT"))return(0,g.Ok)(!1);if(!e.ok)return this.error(e);if(this.chortConnection){let e=await this.chort.debug.ping.rpc({});if((0,g.isError)(e,"UNEXPECTED_DISCONNECT"))return(0,g.Ok)(!1);if(!e.ok)return this.error(e)}return(0,g.Ok)(!0)}dispose(){this.disposed||(this.disposed=!0,this.teardowns.notify(),this.teardowns.clear(),this.logger?.info?.("API disposed"))}async enhancePrompt(e,t=[],n=[],i){let s=await this.service.enhanceAgentPrompt.rpc({userPrompt:e,uploadedFiles:t,attachedUrls:n,selectedTheme:i||""});return s.ok?(0,g.Ok)(s.payload.enhancedPrompt):this.error(s)}async generateReplName(e,t){let n=await this.service.generateReplName.rpc({replId:e,prompt:t});return n.ok?(0,g.Ok)(n.payload.replName):this.error(n)}async getUrlScrapedContent(e){let t=await this.service.getUrlScrapedContent.rpc({url:e});return t.ok?(0,g.Ok)(t.payload.content):this.error(t)}async getUrlScreenshot(e){let t=await this.service.getUrlScreenshot.rpc({url:e});return t.ok?(0,g.Ok)(t.payload.imageDownloadUrl):this.error(t)}async getUrlBranding(e){let t=await this.service.getUrlBranding.rpc({url:e});return t.ok?(0,g.Ok)(t.payload.branding):this.error(t)}async generateReplIcon(e,t){let n=await this.service.generateIcon.rpc({replId:e,prompt:t});return n.ok?(0,g.Ok)(n.payload.imageUrl):this.error(n)}async classifyInitialUserPrompt(e,t=[]){let n=await this.service.classifyInitialUserPrompt.rpc({userPrompt:e,uploadedFiles:t});return n.ok?(0,g.Ok)(n.payload):this.error(n)}async uploadStackSelectionFile({fileName:e,mimeType:t,file:n}){let i;try{i=n instanceof ArrayBuffer?new Blob([n]).stream():n.stream()}catch(e){return this.error(e)}let s=new AbortController,{reqWritable:r,finalize:a}=this.chort.media.uploadStackSelectionFile.upload({fileName:e,mimeType:t},{signal:s.signal}),o=null;try{for await(let e of eT(i)){if(s.signal.aborted){o=Error("Upload aborted");break}try{r.write({chunk:e})}catch(e){o=e instanceof Error?e:String(e);break}}}catch(e){o=e instanceof Error?e:String(e),s.abort()}let p=await a();return o?s.signal.aborted||o instanceof Error&&o.message.includes("closed")?(0,g.Err)({code:"UPLOAD_CANCELLED",message:"Upload was cancelled"}):this.error(o):p.ok?(0,g.Ok)({url:p.payload.url,expires:p.payload.expires}):this.error(p)}async getResourceUploadUrl(e){let t=await this.service.getResourceUploadUrl.rpc({mimeType:e});return t.ok?(0,g.Ok)(t.payload):this.error(t)}}function eu(e,t){return null===t?e:"closed"===e||"closed"===t?"closed":"error"===e||"error"===t?"error":"disconnected"===e||"disconnected"===t?"disconnected":"connecting"===e||"connecting"===t?"connecting":"connected"}async function*eT(e){let t=e.getReader();try{for(;;){let{done:e,value:n}=await t.read();if(e)break;yield n}}finally{t.releaseLock()}}class ey{current=0;resolves=[];get count(){return this.current}increment(){this.current++}decrement(){if(this.current--,this.current<0)throw this.current=0,Error("Reference count cannot be negative");for(;0===this.current&&this.resolves.length>0;){let e=this.resolves.shift();e?.()}}async drained(){if(0!==this.current||(await Promise.resolve(),0!==this.current))return new Promise(e=>{this.resolves.push(e)})}async scope(e){this.increment();try{return await e()}finally{this.decrement()}}}class eg{api;queue=new Map;store=W.events.store();enqueued=null;constructor(e){this.api=e}enqueue(e,t){if(!t.length)return;let n=this.queue.get(e);for(let i of(n||(n=new Set,this.queue.set(e,n)),t))n.add(i);this.store.track(t),this.enqueued?.()}async materialize(e,t){let n=new Set(t),i=W.events.store(t);for(let e of i)n.delete(e.id);n.size&&(this.enqueue(e,Array.from(n)),await new Promise((e,t)=>{let s=this.events.subscribe({next:t=>{for(let e of t)n.has(e.id)&&n.delete(e.id);n.size||(s.unsubscribe(),e())},error:e=>{i.release(),t(e)},complete:()=>{i.release(),t(new C.CompletionError)}})}));let s=[];for(let e of t){let t=this.get(e);if(!t)throw i.release(),this.api.error("Unexpected missing event");s.push(t)}return i.release(),s}get(e){return this.api.state.isOptimisticEvent(e)?this.api.state.getOptimisticEvent(e):W.events.get(e)}events=new y.StatelessMulticast(e=>{let t=!1,n=this.api.closed.subscribe(()=>{e.complete()}),i=async()=>{for(;this.queue.size;)for(let[n,i]of this.queue){if(this.api.state.optimistic){let t=[];for(let e of i){let s=this.api.state.isOptimisticEvent(e);if(s){let r=this.api.state.getOptimisticEvent(e);t.push(r),i.delete(e),this.api.logger.warn?.("materialized optimistic event",{sessionId:n,eventId:e,eventOptimisticType:s})}}if(t.length&&(this.store.untrack(t),e.next(t)),!i.size){this.queue.delete(n);continue}}if(!W.events.empty){let t=[];for(let e of i){let n=W.events.get(e);n&&(t.push(n),i.delete(e))}t.length&&(this.store.untrack(t),e.next(t))}if(!i.size){this.queue.delete(n);continue}let s=Date.now(),r=Array.from(i).slice(0,500),a=await this.api.service.batchGetEvents.rpc({sessionId:n,eventIds:r});if(!t)return;if((0,g.isError)(a,"UNEXPECTED_DISCONNECT"))continue;if(a.ok&&!a.payload.events.length){for(let e of r)i.delete(e);i.size||this.queue.delete(n),this.store.untrack(r),this.api.logger.warn?.("detected infinite materialization loop",{sessionId:n,eventIds:r});continue}if(!a.ok){for(let e of r)i.delete(e);return i.size||this.queue.delete(n),this.store.untrack(r),this.api.error(a,e)}let o=a.payload.events;this.api.logger?.info?.("materialized events",{sessionId:n,duration:Date.now()-s,count:o.length}),this.api.hooks.trigger("events-materialized",{sessionId:n,duration:Date.now()-s,count:o.length});let p=[];for(let e of o){let t=W.events.get(e.id);t?e=t:((0,m.applyEventOperations)(e),W.events.add(e)),i.has(e.id)&&(p.push(e),i.delete(e.id))}i.size||this.queue.delete(n),p.length&&(this.store.untrack(p),e.next(p))}t=!1};return this.enqueued=()=>{t||(t=!0,i().catch(t=>e.error(t)))},this.queue.size&&this.enqueued(),()=>{t=!1,this.enqueued=null,n.unsubscribe()}})}class eh extends ec{replId;materializer;state;queryFetchCounter;sessionObservables=new Map;constructor(e){if(!e.replId)throw Error("Chatter API is disabled");super(e),this.replId=e.replId,this.materializer=new eg(this),this.state=new et(this),this.queryFetchCounter=new ey}currentAgentSession=new y.Multicast(e=>{let t=!1,n="",i=null,s=async t=>{if(i?.abort(),!t)return e.next(null);let n=W.sessions.get(t);if(n){e.next(Q.create(this,t,n.created)),i=null;return}let s=(i=new AbortController).signal,r=await this.service.getSessionEvents.rpc({excludeContents:!0,sessionId:t,limit:1});if(s.aborted||(0,g.isError)(r,"UNEXPECTED_DISCONNECT"))return;if(!r.ok)return this.error(r,e);r.payload.session.events=[],i=null;let a=W.sessions.emplace(r.payload.session);e.next(Q.create(this,t,a.created))},r=this.state.updates.filter(e=>"agent-state-modified"===e.kind).select(e=>e.session).lift(e,e=>{n!==e&&(n=e,s(e))}),a=this.connected.lift(e,async i=>{let r=await this.service.getReplSessions.rpc({beforeTimestamp:new Date("2099-01-01"),limit:5,includeFirstSessionEvents:!1,firstSessionEventsLimit:1,replId:this.replId,sessionTypes:[l.SessionType.AGENT_SESSION,l.SessionType.TASK_AGENT],archived:void 0});if(i.aborted||(0,g.isError)(r,"UNEXPECTED_DISCONNECT"))return;if(!r.ok)return this.error(r,e);for(let e of r.payload.sessions)e.events=[],W.sessions.emplace(e);let a=r.payload.replAgentState.activeAgentSessionId,o=r.payload.sessions.filter(e=>!e.readOnly).sort((e,t)=>t.created.getTime()-e.created.getTime())[0],p=a||o?.id||"";n===p&&t||(t=!0,n=p,s(p))});return()=>{i?.abort(),r.unsubscribe(),a.unsubscribe()}});getSessionObservableById(e){let t=this.sessionObservables.get(e);return t||(t=new y.Multicast(t=>{let n=null,i=W.sessions.get(e);i?t.next(Q.create(this,e,i.created)):n=this.connected.lift(t,async i=>{let s=await this.service.getSessionEvents.rpc({excludeContents:!0,sessionId:e,limit:1});if(i.aborted||(0,g.isError)(s,"UNEXPECTED_DISCONNECT"))return;if(!s.ok)return this.error(s,t);s.payload.session.events=[];let r=W.sessions.emplace(s.payload.session);t.next(Q.create(this,e,r.created)),n?.unsubscribe(),n=null});let s=this.teardown(()=>{t.complete()});return()=>{n?.unsubscribe(),s()}}),this.sessionObservables.set(e,t)),t}async createSession(e){let t=(0,v.createSessionRequest)({...e,replId:this.replId}),n=await this.service.createSession.rpc(t);if(!n.ok)return this.error(n);let i=Q.create(this,n.payload.sessionId,new Date);return this.hooks.trigger("client-created-session",{session:i,request:t}),(0,g.Ok)(i)}async revertToCommit(e){let t={replId:this.replId,databaseRollbackTimestamp:e.databaseRollbackTimestamp??"",deploymentBuildId:e.deploymentBuildId??"",...e},n=await this.service.revertToCommit.rpc(t);if(!n.ok)return this.error(n);let i=n.payload.revertedSessionId,s=W.sessions.get(i);if(s){let e=Q.create(this,i,s.created);return this.hooks.trigger("client-reverted-session",{session:e,request:t}),(0,g.Ok)(e)}let r=await this.service.getSessionEvents.rpc({excludeContents:!0,sessionId:i,limit:1});if(!r.ok)return this.error(r);r.payload.session.events=[];let a=W.sessions.emplace(r.payload.session),o=Q.create(this,i,a.created);return this.hooks.trigger("client-reverted-session",{session:o,request:t}),(0,g.Ok)(o)}createUsageWatcher({sessionId:e,start:t}){return new y.Multicast(n=>this.connected.lift(n,async i=>{let{resReadable:s}=this.chort.agent.watchUsage.subscribe({sessionId:e,start:t},{signal:i});for await(let e of s){if((0,g.isError)(e,"UNEXPECTED_DISCONNECT","CANCEL"))return;if(!e.ok)return this.error(e,n);n.next({cents:e.payload.cents})}}))}}class ef{api;_chatter;constructor(e){e.replId?(this.api=new eh(e),this._chatter=new el(this.api)):(this.api=new ec(e),this._chatter=null)}chatter(){if(!this._chatter)throw Error("Chatter API is disabled");return this._chatter}hook(e,t){return this.api.hooks.add(e,t)}get status(){return this.api.status}get user(){return this.api.user}get hasAdvancedModel(){return this.api.hasAdvancedModel}get overrideModel(){return this.api.overrideModel}enhancePrompt(e,t=[],n=[],i){return this.api.enhancePrompt(e,t,n,i)}getUrlScrapedContent(e){return this.api.getUrlScrapedContent(e)}getUrlScreenshot(e){return this.api.getUrlScreenshot(e)}getUrlBranding(e){return this.api.getUrlBranding(e)}generateReplName(e,t){return this.api.generateReplName(e,t)}generateReplIcon(e,t){return this.api.generateReplIcon(e,t)}classifyInitialUserPrompt(e,t=[]){return this.api.classifyInitialUserPrompt(e,t)}uploadStackSelectionFile(e){return this.api.uploadStackSelectionFile(e)}getResourceUploadUrl(e){return this.api.getResourceUploadUrl(e)}dispose(){this.api.dispose()}}e.s(["Yapper",()=>ef],568515);var em=e.i(98816),eS=e.i(664152);e.i(925218);var eE=e.i(641555);let ev=(0,o.atom)({hasAccessToAdvancedModel:!1});function eR(){let e=(0,T.useYapper)();return(0,eE.useObservableMemo)(()=>e.status.map(e=>"connected"===e),[e],{default:!1})}e.s(["configAtom",0,ev,"useIsAiClientConnected",()=>eR],51553);var eb=e.i(289074);let eO=(0,o.atom)(!1);function eC(){return(0,T.useValue)(eO)}function eI({replId:e,currentUser:t,hasAccessToAdvancedModel:y,children:g,mockStore:h,mockYapper:f,orgId:m,renderEmptyState:S=()=>null}){let{store:E,yapper:v}=function({replId:e,currentUser:t,orgId:n,hasAccessToAdvancedModel:T,mockStore:y,mockYapper:g}){let h=(0,p.useSetAtom)(eb.connectionStateAtom),f=(0,i.useMemo)(()=>g?new URL("ws://localhost/mock"):void 0,[g]),m=(0,u.useCreateChatConnection)({endpoint:f,replId:e,currentUserId:t.id,orgId:n,onProtocolError:e=>{(0,d.sendErrorToSentry)(e.message,{code:e.type})},onRetriesExceeded:e=>{(0,s.flushSync)(()=>{E.set(eO,!0),h((0,a.produce)(e=>{e["ai-chat"]="fatal"}))}),r.captureException("Chat service connection retries exhausted in AiProvider"),(0,d.sendErrorToSentry)(e.message,{code:e.type})}}),S=(0,c.useCreateChortRiverConnection)({replId:e,userId:t.id,onProtocolError:e=>{(0,d.sendErrorToSentry)(e.message,{code:e.type})},onRetriesExceeded:e=>{h((0,a.produce)(e=>{e.chort="fatal"})),(0,d.sendErrorToSentry)(e.message,{code:e.type})}}),[E]=(0,i.useState)(()=>(y&&console.error("mockStore in only meant for tests or development, not production"),y??(0,o.createStore)())),{id:v,timeCreated:R}=t;(0,i.useEffect)(()=>{E.set(ev,{hasAccessToAdvancedModel:T})},[E,T]);let b=function({connection:e,chortConnection:t,replId:n,user:s,hasAdvancedModel:r,overrideModel:a=null,onError:o}){let[p,l]=(0,i.useState)(null),d=(0,em.default)(o),c=!!o;return(0,i.useEffect)(()=>{if(!e||!t)return;let i=new ef({connection:e,chortConnection:t,replId:n,user:s,hasAdvancedModel:r,overrideModel:a,logger:eS.logger,onError:c?(e,t)=>d.current?.(e,t):void 0});return l(i),()=>{l(null),Promise.resolve().then(()=>i.dispose())}},[e,t,n,c]),(0,i.useEffect)(()=>{p&&(p.user.current!==s&&p.user.set(s),p.hasAdvancedModel.current!==r&&p.hasAdvancedModel.set(r),p.overrideModel.current!==a&&p.overrideModel.set(a??null))},[p,s,r,a]),p}({connection:m,chortConnection:S,replId:e,user:(0,i.useMemo)(()=>({id:v.toString(),type:l.UserType.USER,isTeam:!1,roles:[],membership:T?l.MembershipType.CORE:l.MembershipType.FREE,orgId:"",username:"",timeCreated:new Date(R),flaggingContext:"",modelfarmDisabled:!1,openrouterDisabled:!1,openaiDisabled:!1,anthropicDisabled:!1,geminiDisabled:!1,isEnterprise:!1}),[v,T,R]),hasAdvancedModel:T,overrideModel:null,onError:(e,t)=>{setTimeout(()=>{(0,d.sendErrorToSentry)(e,t??void 0)})}});return{store:E,yapper:g??b}}({replId:e,currentUser:t,hasAccessToAdvancedModel:y,mockStore:h,mockYapper:f,orgId:m});return v?(0,n.jsx)(T.StoreProvider,{store:E,yapper:v,children:g}):(0,n.jsx)(S,{})}e.s(["AiProvider",()=>eI,"useIsRiverRetryBudgetExceeded",()=>eC],204203),e.i(17886);let eA=(0,o.atom)(null);function eU(){return(0,T.useValue)(eA)}function ek(){return(0,T.useGet)(eA)}function eN(){let e=(0,T.useSet)(eA);return(0,i.useCallback)(t=>e(t),[e])}let eD=(0,o.atom)(void 0),eP=(0,o.atom)(void 0);function ew(){return(0,T.useValue)(eD)}function ej(){let e=(0,T.useSet)(eD);return(0,i.useCallback)(t=>e(t),[e])}function eM(){let e=(0,T.useSet)(eP);return(0,i.useCallback)(t=>e(t),[e])}let eL=(0,o.atom)(void 0);function e_(){let e=(0,T.useGet)(eL);return(0,i.useCallback)(()=>e(),[e])}function ex(){let e=(0,T.useSet)(eL);return(0,i.useCallback)(()=>e(void 0),[e])}e.s(["useAgentPlanApprovalState",()=>eU,"useClearPlanProposalUserSecretsResponse",()=>ex,"useGetAgentPlanApprovalState",()=>ek,"useGetPlanProposalUserSecretsResponse",()=>e_,"useProposedPlan",()=>ew,"useSetAgentPlanApprovalState",()=>eN,"useSetApprovedPlan",()=>eM,"useSetProposedPlan",()=>ej],145864);let eB=(0,o.atom)(!1);function eF(){return(0,T.useValue)(eB)}function e$(){let e=(0,T.useSet)(eB);return(0,i.useCallback)(t=>e(t),[e])}e.s(["useAgentPausedByUser",()=>eF,"useSetAgentPausedByUser",()=>e$],165680);var eG=e.i(63846),eq=e.i(710643),eV=e.i(416143);function eW(e,t){let n,i,s=(n=(0,eG.getAiEndpoint)(),i=window.location.host.startsWith("staging")||n===eV.AiEndpoints.development||n===eV.AiEndpoints.staging,t===l.SessionType.AGENT_SESSION?i?"2a95b8aa-201c-481e-8ee3-858a19efdc53":"430ef9d3-abfe-4318-8a6d-4cadfe35d0ce":i?"c50da37d-4044-4795-b28e-8e1d21473f96":"cf9ea4d0-b92a-4076-b8f9-44441d907f6a"),r=`https://smith.langchain.com/o/ed54f928-4630-409b-b66a-947e0fbac288/projects/p/${s}`,a=encodeURIComponent('{"duration":"7d"}'),o=`{"filter":"and(eq(is_root, true), and(eq(metadata_key, \\"session_id\\"), eq(metadata_value, \\"${e}\\")))"}`,p=(0,eq.stringify)({timeModel:a,searchModel:o});return`${r}?${p}`}function eK(e){let t,n=(0,eG.getAiEndpoint)(),i="https://cloud.temporal.io";switch(n){case eV.AiEndpoints.development:i="http://localhost:8233",t="default";break;case eV.AiEndpoints.staging:t="staging.ndbzr";break;case eV.AiEndpoints.production:default:t="production.ndbzr"}let s=`${i}/namespaces/${t}/workflows`,r=(0,eq.stringify)({query:`session_id = "${e}"`});return`${s}?${r}`}function eH(e){let t;switch((0,eG.getAiEndpoint)()){case eV.AiEndpoints.development:t="5ad850f0-3a1a-4980-b889-d21d4116b5d7";break;case eV.AiEndpoints.staging:t="45b3aed2-3dde-4f0d-a22c-9af69ee8508e";break;case eV.AiEndpoints.production:default:t="ce8b1d97-5fef-4a21-bc60-8910fa6852d5"}let n=["f=is_root:eq:true",`f=metadata.session_id:eq:${encodeURIComponent(e)}`];return`https://traceforge.app/projects/${t}?${n.join("&")}&t=1d`}function ez(e){let t;switch((0,eG.getAiEndpoint)()){case eV.AiEndpoints.development:t="development";break;case eV.AiEndpoints.staging:t="staging";break;case eV.AiEndpoints.production:default:t="production"}let n=`agent-${t}`,i=`is_root AND metadata.session_id = "${e}"`,s=JSON.stringify({filter:[{label:i,text:i,originType:"btql"}]}),r=(0,eq.stringify)({qs:"spans",search:s});return`https://www.braintrust.dev/app/ai-replit/p/${n}/logs?${r}`}function eY(e){return`https://us5.datadoghq.com/logs?query=%40replid%3A${e}`}function eQ(e){return`https://us5.datadoghq.com/apm/traces?query=%40replid%3A${e}`}e.s(["generateAiSessionBraintrustUrl",()=>ez,"generateAiSessionDatadogTracesUrl",()=>eQ,"generateAiSessionDatadogUrl",()=>eY,"generateAiSessionLangSmithUrl",()=>eW,"generateAiSessionTemporalUrl",()=>eK,"generateAiSessionTraceforgeUrl",()=>eH],805763),e.s([],877212)}]);

//# debugId=47c0ac88-3da7-f78c-3c0b-1d8d05fdb079
//# sourceMappingURL=b02561b9eb487884.js.map